<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆå§‹åŒ–é—®é¢˜ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 30px;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 8px;
            background: #f7fafc;
            border-left: 4px solid #4299e1;
        }

        .section h2 {
            color: #2d3748;
            margin-top: 0;
            font-size: 1.2em;
        }

        .section p {
            margin: 10px 0;
            line-height: 1.6;
        }

        .fix-list {
            list-style: none;
            padding: 0;
        }

        .fix-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            position: relative;
            padding-left: 25px;
        }

        .fix-list li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
        }

        .test-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }

        .test-button:hover {
            background: #3182ce;
        }

        .status-log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .success {
            color: #48bb78;
        }

        .error {
            color: #f56565;
        }

        .warning {
            color: #ed8936;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ åˆå§‹åŒ–é—®é¢˜ä¿®å¤éªŒè¯</h1>

        <div class="section">
            <h2>ğŸ“‹ ä¿®å¤å†…å®¹</h2>
            <ul class="fix-list">
                <li><strong>å¾ªç¯ä¾èµ–ä¿®å¤</strong> - ç§»é™¤auth.tsä¸­çš„å¾ªç¯ä¾èµ–è®¾ç½®</li>
                <li><strong>æ•°æ®åº“åˆå§‹åŒ–ä¼˜åŒ–</strong> - å»¶è¿Ÿæ•°æ®åº“å®ä¾‹åˆ›å»ºï¼Œé¿å…è¿‡æ—©åˆå§‹åŒ–</li>
                <li><strong>é”™è¯¯å¤„ç†å¢å¼º</strong> - ä¸ºæ¯ä¸ªåˆå§‹åŒ–æ­¥éª¤æ·»åŠ try-catchä¿æŠ¤</li>
                <li><strong>è°ƒè¯•æ—¥å¿—å®Œå–„</strong> - æ·»åŠ è¯¦ç»†çš„æ—¶é—´æˆ³å’ŒçŠ¶æ€æ—¥å¿—</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ§ª æµ‹è¯•è¯´æ˜</h2>
            <p>è¯·ç‚¹å‡»ä»¥ä¸‹æŒ‰é’®æµ‹è¯•ä¿®å¤æ•ˆæœï¼š</p>
            <button class="test-button" onclick="testInitialization()">æµ‹è¯•åˆå§‹åŒ–æµç¨‹</button>
            <button class="test-button" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            <div id="status-log" class="status-log">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <div class="section">
            <h2>ğŸ“Š é¢„æœŸç»“æœ</h2>
            <p>ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š</p>
            <ul class="fix-list">
                <li>åˆå§‹åŒ–è¿›åº¦æ­£å¸¸æ¨è¿›ï¼Œä¸å†åœç•™åœ¨0%</li>
                <li>æ•°æ®åº“è¿æ¥æˆåŠŸå»ºç«‹</li>
                <li>å³ä½¿æŸäº›æ­¥éª¤å¤±è´¥ï¼Œåº”ç”¨ä¹Ÿèƒ½ç»§ç»­è¿è¡Œ</li>
                <li>è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯å¸®åŠ©å®šä½é—®é¢˜</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ” æ•…éšœæ’é™¤</h2>
            <p>å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æ£€æŸ¥ï¼š</p>
            <ul class="fix-list">
                <li>æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰å…¶ä»–é”™è¯¯ä¿¡æ¯</li>
                <li>IndexedDB æ˜¯å¦è¢«ç¦ç”¨æˆ–å­˜å‚¨ç©ºé—´ä¸è¶³</li>
                <li>æ˜¯å¦æœ‰å…¶ä»–æ ‡ç­¾é¡µåŒæ—¶æ‰“å¼€äº†åŒä¸€ä¸ªæ•°æ®åº“</li>
                <li>æµè§ˆå™¨æ˜¯å¦æ”¯æŒIndexedDB API</li>
            </ul>
        </div>
    </div>

    <script>
        let logContainer = document.getElementById('status-log');

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="${type}">[${timestamp}] ${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLogs() {
            logContainer.innerHTML = 'æ—¥å¿—å·²æ¸…é™¤ï¼Œç­‰å¾…æ–°çš„æµ‹è¯•...';
        }

        async function testInitialization() {
            clearLogs();
            log('å¼€å§‹æµ‹è¯•åˆå§‹åŒ–æµç¨‹...');

            try {
                // æ£€æŸ¥IndexedDBæ”¯æŒ
                if (!('indexedDB' in window)) {
                    log('âŒ æµè§ˆå™¨ä¸æ”¯æŒIndexedDB', 'error');
                    return;
                }
                log('âœ… æµè§ˆå™¨æ”¯æŒIndexedDB');

                // æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²å­˜åœ¨
                const request = indexedDB.open('CardAllUnifiedDB_v3', 3);

                request.onerror = function(event) {
                    log('âŒ æ— æ³•æ‰“å¼€æ•°æ®åº“: ' + event.target.error, 'error');
                };

                request.onsuccess = function(event) {
                    log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ');
                    const db = event.target.result;
                    db.close();
                    log('âœ… æµ‹è¯•å®Œæˆï¼Œåˆå§‹åŒ–æµç¨‹åº”è¯¥æ­£å¸¸å·¥ä½œ');
                };

                request.onupgradeneeded = function(event) {
                    log('ğŸ”„ æ•°æ®åº“éœ€è¦å‡çº§ï¼Œè¿™æ˜¯æ­£å¸¸çš„');
                };

            } catch (error) {
                log('âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•...');
            setTimeout(testInitialization, 1000);
        });
    </script>
</body>
</html>