import{j as e,S as wn,a as oa,b as ia,P as bn,C as la,I as ca,c as da,d as ua,R as ma,L as fa,e as ha,f as vn,T as jn,g as ga,V as Cn,h as Nn,i as pa,k as Sn,O as xa,l as kn,m as ya,n as Tn,o as wa,D as ba,p as En,q as va,r as Dn,s as An,t as Rn,u as ja,v as Ca,w as _n,x as Na,y as Fn,z as In,A as Sa,B as ka,F as Ta,E as Ea,G as Da,H as Mn,J as Aa,K as Ra,M as _a,N as Fa,Q as Ia,U as Ma,W as Pa,X as Pn,Y as Ln,Z as La,_ as On,$ as Oa,a0 as za,a1 as zn,a2 as $a,a3 as $n,a4 as Ua,a5 as Ba,a6 as Un,a7 as Bn,a8 as Va,a9 as Vn,aa as Hn,ab as Ha,ac as Wn,ad as Wa,ae as Ga,af as Ya,ag as Ka,ah as qa,ai as Gn,aj as Ja,ak as Yn,al as Xa,am as Qa,an as Za,ao as Kn}from"./radix-w2nuJgPN.js";import{a as Ht,r as c,R as L,v as qn}from"./vendor-DBpFvjuy.js";import{d as W,u as Pe,a as Le,b as re,c as Jn}from"./sync-Dl7VuROi.js";import{_ as er}from"./supabase-BJjf9Ixn.js";import{t as Xn,c as Qn,a as Wt}from"./utils--BulIq_u.js";import{C as Gt,a as $e,b as tr,S as Zn,I as sr,X as Ye,c as eo,E as to,P as so,d as ao,e as ps,f as ro,g as ar,T as rr,F as nr,h as Ss,i as Oe,H as Ls,j as rt,D as nt,k as Os,l as or,m as xs,n as ks,o as no,p as oo,B as io,q as lo,r as co,Z as ir,s as uo,L as mo,t as fo,u as ve,v as be,w as zt,x as zs,R as Ne,y as lr,z as ho,A as go,G as St,J as kt,K as Tt,W as Ts,M as Yt,N as po,O as xo,Q as yo,U as Bt,V as ys,Y as wo,_ as $s,$ as bo,a0 as vo,a1 as jo,a2 as Co,a3 as wt,a4 as No,a5 as bt,a6 as Us,a7 as ls,a8 as cs,a9 as So,aa as ko}from"./icons-DKLFDR3M.js";import{u as To,i as Eo,M as Do,a as Ao,b as Ro,c as _o,d as Fo,e as Io,f as Mo,g as Po,h as Lo,j as Oo,E as zo}from"./editor-yCnBQ_u8.js";import"./database-Ddn5sgg-.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();var ws={},Bs=Ht;ws.createRoot=Bs.createRoot,ws.hydrateRoot=Bs.hydrateRoot;class vt{static PREFIX="cardall_";static VERSION="1.0";static setItem(t,s,r={}){try{const n=this.PREFIX+t,o={version:this.VERSION,timestamp:Date.now(),data:s,meta:{ttl:r.ttl,encrypted:r.encrypt||!1,compressed:r.compress||!1}};if(r.validate){const l=this.validateData(s);if(!l.isValid)return console.warn("Storage validation failed:",l.errors),!1}let i;try{i=this.serializeData(o)}catch(l){return console.error("Data serialization failed:",l),!1}return r.encrypt&&(i=this.encryptData(i)),r.compress&&(i=this.compressData(i)),localStorage.setItem(n,i),!0}catch(n){return console.error("Failed to store data securely:",n),!1}}static getItem(t,s={}){try{const r=this.PREFIX+t,n=localStorage.getItem(r);if(!n)return null;let o=n;s.compress&&(o=this.decompressData(o)),s.encrypt&&(o=this.decryptData(o));const i=this.deserializeData(o);if(i.version!==this.VERSION)return console.warn("Storage data version mismatch"),null;if(i.meta.ttl&&Date.now()-i.timestamp>i.meta.ttl)return console.log("Storage data expired, removing"),this.removeItem(t),null;if(s.validate){const l=this.validateData(i.data);if(!l.isValid)return console.warn("Retrieved data validation failed:",l.errors),null}return i.data}catch(r){return console.error("Failed to retrieve data securely:",r),null}}static removeItem(t){try{const s=this.PREFIX+t;localStorage.removeItem(s)}catch(s){console.error("Failed to remove storage item:",s)}}static clearAppData(){try{Object.keys(localStorage).forEach(s=>{s.startsWith(this.PREFIX)&&localStorage.removeItem(s)})}catch(t){console.error("Failed to clear app data:",t)}}static validateData(t){const s={isValid:!0,errors:[],warnings:[],sanitized:t};return t==null?s:this.hasPrototypePollution(t)?(s.isValid=!1,s.errors.push("Potential prototype pollution detected"),s):(this.hasCircularReference(t)&&(s.warnings.push("Circular reference detected in data"),s.sanitized=this.removeCircularReferences(t)),this.hasDangerousFunctions(t)?(s.isValid=!1,s.errors.push("Dangerous functions detected in data"),s):(this.estimateDataSize(t)>5*1024*1024&&s.warnings.push("Large data size may impact performance"),s))}static hasPrototypePollution(t){if(typeof t!="object"||t===null)return!1;const s=t;return["__proto__","constructor","prototype"].some(n=>n in s)}static hasCircularReference(t,s=new WeakSet){return typeof t!="object"||t===null?!1:s.has(t)?!0:(s.add(t),Array.isArray(t)?t.some(r=>this.hasCircularReference(r,s)):Object.values(t).some(r=>typeof r=="object"&&this.hasCircularReference(r,s)))}static removeCircularReferences(t,s=new WeakSet){if(typeof t!="object"||t===null)return t;if(s.has(t))return"[Circular]";if(s.add(t),Array.isArray(t))return t.map(n=>this.removeCircularReferences(n,s));const r={};for(const[n,o]of Object.entries(t))r[n]=this.removeCircularReferences(o,s);return r}static hasDangerousFunctions(t){if(typeof t!="object"||t===null)return!1;const s=t;if(Object.values(s).some(o=>typeof o=="function"))return!0;const r=["eval","Function","setTimeout","setInterval","document","window","global","process"],n=JSON.stringify(s).toLowerCase();return r.some(o=>n.includes(o.toLowerCase()))}static estimateDataSize(t){return new Blob([JSON.stringify(t)]).size}static serializeData(t){return JSON.stringify(t,(r,n)=>{if(typeof n!="function")return n===void 0?null:n instanceof Date?{__type:"Date",value:n.toISOString()}:n instanceof RegExp?{__type:"RegExp",value:n.toString()}:n})}static deserializeData(t){return JSON.parse(t,(r,n)=>{if(typeof n=="object"&&n!==null){const o=n;if(o.__type==="Date"&&typeof o.value=="string")return new Date(o.value);if(o.__type==="RegExp"&&typeof o.value=="string"){const i=o.value.match(/^\/(.*)\/([gim]*)$/);if(i)return new RegExp(i[1],i[2])}}return n})}static encryptData(t){const s="cardall-secure-key";let r="";for(let n=0;n<t.length;n++){const o=t.charCodeAt(n)^s.charCodeAt(n%s.length);r+=String.fromCharCode(o)}return btoa(r)}static decryptData(t){const s="cardall-secure-key",r=atob(t);let n="";for(let o=0;o<r.length;o++){const i=r.charCodeAt(o)^s.charCodeAt(o%s.length);n+=String.fromCharCode(i)}return n}static compressData(t){return t}static decompressData(t){return t}static getStorageStats(){try{const s=Object.keys(localStorage).filter(o=>o.startsWith(this.PREFIX));let r=0;const n=[];return s.forEach(o=>{const i=localStorage.getItem(o);if(i){const l=new Blob([i]).size;r+=l,n.push({key:o.replace(this.PREFIX,""),size:l,lastModified:Date.now()})}}),{totalSize:r,itemCount:s.length,items:n}}catch(t){return console.error("Failed to get storage stats:",t),{totalSize:0,itemCount:0,items:[]}}}}const oe={set:(a,t,s)=>vt.setItem(a,t,s),get:(a,t)=>vt.getItem(a,t),remove:a=>vt.removeItem(a),clear:()=>vt.clearAppData(),getStats:()=>vt.getStorageStats()};class Re{static dbCardToCard(t){const{userId:s,syncVersion:r,lastSyncAt:n,pendingSync:o,...i}=t;return{...i,id:i.id||"",createdAt:this.ensureDate(i.createdAt),updatedAt:this.ensureDate(i.updatedAt)}}static cardToDbCard(t,s){return{id:t.id,frontContent:t.frontContent,backContent:t.backContent,style:t.style,isFlipped:t.isFlipped,createdAt:this.ensureDate(t.createdAt),updatedAt:this.ensureDate(t.updatedAt),userId:s,syncVersion:1,pendingSync:!0,lastSyncAt:void 0}}static bulkDbCardsToCards(t){return t.map(s=>this.dbCardToCard(s))}static bulkCardsToDbCards(t,s){return t.map(r=>this.cardToDbCard(r,s))}static ensureDate(t){if(!t)return new Date;if(t instanceof Date)return t;try{return new Date(t)}catch{return new Date}}static validateCard(t){const s=[];return t.id||s.push("Card ID is required"),t.frontContent?.title||s.push("Front content title is required"),t.backContent?.title||s.push("Back content title is required"),t.createdAt||s.push("Created date is required"),t.updatedAt||s.push("Updated date is required"),{valid:s.length===0,errors:s}}static sanitizeCard(t){const s={};return t.id&&(s.id=t.id),t.frontContent&&(s.frontContent={title:String(t.frontContent.title||"").trim(),text:String(t.frontContent.text||"").trim(),images:Array.isArray(t.frontContent.images)?t.frontContent.images:[],tags:Array.isArray(t.frontContent.tags)?t.frontContent.tags.map(r=>String(r).trim()).filter(r=>r.length>0):[],lastModified:t.frontContent.lastModified||new Date}),t.backContent&&(s.backContent={title:String(t.backContent.title||"").trim(),text:String(t.backContent.text||"").trim(),images:Array.isArray(t.backContent.images)?t.backContent.images:[],tags:Array.isArray(t.backContent.tags)?t.backContent.tags.map(r=>String(r).trim()).filter(r=>r.length>0):[],lastModified:t.backContent.lastModified||new Date}),t.style&&(s.style={type:t.style.type||"solid",backgroundColor:t.style.backgroundColor||"#ffffff",fontFamily:t.style.fontFamily||"system-ui",fontSize:t.style.fontSize||"base",fontWeight:t.style.fontWeight||"normal",textColor:t.style.textColor||"#000000",borderRadius:t.style.borderRadius||"md",shadow:t.style.shadow||"none",borderWidth:t.style.borderWidth||0,gradientColors:t.style.gradientColors||void 0,gradientDirection:t.style.gradientDirection||"to-r"}),typeof t.isFlipped=="boolean"&&(s.isFlipped=t.isFlipped),t.createdAt&&(s.createdAt=this.ensureDate(t.createdAt)),t.updatedAt&&(s.updatedAt=this.ensureDate(t.updatedAt)),s}static loadFromLocalStorage(){try{const t=oe.get("cards",{validate:!0,encrypt:!0});if(!t)return[];const s=[];for(const r of t){const n=this.sanitizeCard(r),o=this.validateCard(n);o.valid?s.push(n):console.warn("Invalid card in localStorage:",r,o.errors)}return s}catch(t){return console.error("Failed to load cards from localStorage:",t),[]}}static saveToLocalStorage(t){try{const s=t.map(r=>this.sanitizeCard(r)).filter(r=>this.validateCard(r).valid);oe.set("cards",s)}catch(s){throw console.error("Failed to save cards to localStorage:",s),new Error(`Failed to save to localStorage: ${s instanceof Error?s.message:String(s)}`)}}static areCardsEqual(t,s){const r=JSON.stringify(this.sanitizeCard(t)),n=JSON.stringify(this.sanitizeCard(s));return r===n}static detectCardChanges(t,s){const r=new Map(t.map(m=>[m.id,m])),n=new Map(s.map(m=>[m.id,m])),o=[],i=[],l=[];for(const[m,f]of n){const d=r.get(m);d?this.areCardsEqual(d,f)||i.push(f):o.push(f)}for(const[m,f]of r)n.has(m)||l.push(f);return{added:o,updated:i,deleted:l}}static migrateLegacyData(t){try{if(this.isStandardCardFormat(t))return Array.isArray(t)?t:[t];const s=[];if(Array.isArray(t))for(const r of t){const n=this.migrateLegacyCard(r);n&&s.push(n)}else{const r=this.migrateLegacyCard(t);r&&s.push(r)}return s}catch(s){return console.error("Failed to migrate legacy data:",s),[]}}static migrateLegacyCard(t){try{const s={id:t.id||crypto.randomUUID(),frontContent:{title:t.frontTitle||t.title||"",text:t.frontText||t.text||"",images:t.frontImages||t.images||[],tags:t.frontTags||t.tags||[],lastModified:t.lastModified||new Date},backContent:{title:t.backTitle||t.backTitle||"",text:t.backText||t.backText||"",images:t.backImages||[],tags:t.backTags||[],lastModified:t.lastModified||new Date},style:t.style||{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#000000",borderRadius:"md",shadow:"none",borderWidth:0},isFlipped:t.isFlipped||!1,createdAt:this.ensureDate(t.createdAt||t.created||new Date),updatedAt:this.ensureDate(t.updatedAt||t.updated||new Date)},r=this.sanitizeCard(s);return this.validateCard(r).valid?r:null}catch(s){return console.error("Failed to migrate legacy card:",s),null}}static isStandardCardFormat(t){return!t||typeof t!="object"?!1:["id","frontContent","backContent","createdAt","updatedAt"].every(r=>r in t)}static generateCardChecksum(t){const s=this.sanitizeCard(t),r=JSON.stringify(s);let n=0;for(let o=0;o<r.length;o++){const i=r.charCodeAt(o);n=(n<<5)-n+i,n=n&n}return Math.abs(n).toString(16)}static compressCardData(t){const s=t.map(r=>{const n=this.sanitizeCard(r);return{i:n.id,ft:n.frontContent.title,ftx:n.frontContent.text,ftg:n.frontContent.tags,bt:n.backContent.title,btx:n.backContent.text,btg:n.backContent.tags,s:n.style,f:n.isFlipped,ca:n.createdAt.getTime(),ua:n.updatedAt.getTime()}});return JSON.stringify(s)}static decompressCardData(t){try{return JSON.parse(t).map(r=>({id:r.i,frontContent:{title:r.ft||"",text:r.ftx||"",images:[],tags:r.ftg||[],lastModified:new Date},backContent:{title:r.bt||"",text:r.btx||"",images:[],tags:r.btg||[],lastModified:new Date},style:r.s||{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#000000",borderRadius:"md",shadow:"none",borderWidth:0},isFlipped:r.f||!1,createdAt:new Date(r.ca),updatedAt:new Date(r.ua)}))}catch(s){return console.error("Failed to decompress card data:",s),[]}}}const Vs=[{id:"1",frontContent:{title:"React Best Practices",text:"Key principles for writing maintainable React code including component composition, state management, and performance optimization.",images:[],tags:["react","frontend","best-practices"],lastModified:new Date},backContent:{title:"Implementation Details",text:"Use functional components with hooks, implement proper error boundaries, optimize with React.memo and useMemo for expensive calculations.",images:[],tags:["react","frontend","best-practices"],lastModified:new Date},style:{type:"solid",backgroundColor:"#f8fafc",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"xl",shadow:"md",borderWidth:0},isFlipped:!1,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",frontContent:{title:"TypeScript Tips",text:"Advanced TypeScript patterns for better type safety and developer experience in large applications.",images:[],tags:["typescript","types","development"],lastModified:new Date},backContent:{title:"Advanced Patterns",text:"Utility types, conditional types, mapped types, and template literal types for complex type transformations.",images:[],tags:["typescript","types","development"],lastModified:new Date},style:{type:"gradient",gradientColors:["#667eea","#764ba2"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"xl",shadow:"lg",borderWidth:0},isFlipped:!1,createdAt:new Date("2024-01-16"),updatedAt:new Date("2024-01-16")}];function $o(){const[a,t]=c.useState([]),[s,r]=c.useState(!1),[n,o]=c.useState({searchTerm:"",tags:[]}),[i,l]=c.useState({layout:"grid",cardSize:"medium",showTags:!0,showDates:!1,sortBy:"updated",sortOrder:"desc"}),[m,f]=c.useState([]),d=c.useCallback(()=>{const p=a.filter(h=>{if(n.searchTerm){const x=n.searchTerm.toLowerCase(),v=h.frontContent.title.toLowerCase().includes(x)||h.backContent.title.toLowerCase().includes(x),k=h.frontContent.text.toLowerCase().includes(x)||h.backContent.text.toLowerCase().includes(x),N=[...h.frontContent.tags,...h.backContent.tags].some(w=>w.toLowerCase().includes(x));if(!v&&!k&&!N)return!1}if(n.tags.length>0){const x=[...h.frontContent.tags,...h.backContent.tags];if(!n.tags.some(v=>x.includes(v)))return!1}if(n.folderId&&h.folderId!==n.folderId)return!1;if(n.dateRange){const x=new Date(h.updatedAt);if(x<n.dateRange.start||x>n.dateRange.end)return!1}return!(n.styleType&&h.style.type!==n.styleType||n.hasImages!==void 0&&(h.frontContent.images.length>0||h.backContent.images.length>0)!==n.hasImages)});return p.sort((h,x)=>{let v=0;switch(i.sortBy){case"created":v=new Date(h.createdAt).getTime()-new Date(x.createdAt).getTime();break;case"updated":v=new Date(h.updatedAt).getTime()-new Date(x.updatedAt).getTime();break;case"title":v=h.frontContent.title.localeCompare(x.frontContent.title);break;default:v=0}return i.sortOrder==="desc"?-v:v}),p},[a,n,i]),y=c.useCallback(p=>{t(h=>{switch(p.type){case"CREATE_CARD":const x={...p.payload,id:Date.now().toString(),createdAt:new Date,updatedAt:new Date};return[...h,x];case"UPDATE_CARD":return h.map(N=>N.id===p.payload.id?{...N,...p.payload.updates,updatedAt:new Date}:N);case"DELETE_CARD":return h.filter(N=>N.id!==p.payload);case"FLIP_CARD":return h.map(N=>N.id===p.payload?{...N,isFlipped:!N.isFlipped,updatedAt:new Date}:N);case"SELECT_CARD":return f(N=>N.includes(p.payload)?N.filter(w=>w!==p.payload):[...N,p.payload]),h;case"DESELECT_ALL":return f([]),h;case"DUPLICATE_CARD":const v=h.find(N=>N.id===p.payload);if(!v)return h;const k={...v,id:Date.now().toString(),createdAt:new Date,updatedAt:new Date};return[...h,k];case"MOVE_TO_FOLDER":return h.map(N=>N.id===p.payload.cardId?{...N,folderId:p.payload.folderId,updatedAt:new Date}:N);default:return h}})},[]),g=c.useCallback(p=>a.find(h=>h.id===p),[a]),u=c.useCallback(()=>a.filter(p=>m.includes(p.id)),[a,m]),b=c.useCallback(()=>{const p=new Set;return a.forEach(h=>{h.frontContent.tags.forEach(x=>p.add(x)),h.backContent.tags.forEach(x=>p.add(x))}),Array.from(p).sort()},[a]),C=c.useCallback((p,h)=>{t(x=>x.map(v=>{const k=S=>h?S.map(D=>D===p?h:D):S.filter(D=>D!==p),N=k(v.frontContent.tags),w=k(v.backContent.tags);return JSON.stringify(N)!==JSON.stringify(v.frontContent.tags)||JSON.stringify(w)!==JSON.stringify(v.backContent.tags)?{...v,frontContent:{...v.frontContent,tags:N,lastModified:new Date},backContent:{...v.backContent,tags:w,lastModified:new Date},updatedAt:new Date}:v}))},[]),j=c.useCallback(p=>a.filter(h=>h.frontContent.tags.includes(p)||h.backContent.tags.includes(p)),[a]);return c.useEffect(()=>{if(!s)try{const p=Re.loadFromLocalStorage();p.length>0?t(p):t(Vs),r(!0)}catch(p){console.error("Failed to load cards from localStorage:",p),t(Vs),r(!0)}},[s]),c.useEffect(()=>{if(!s)return;const p=setTimeout(()=>{try{Re.saveToLocalStorage(a)}catch(h){console.error("Failed to save cards to localStorage:",h)}},1e3);return()=>clearTimeout(p)},[a,s]),{cards:d(),allCards:a,filter:n,setFilter:o,viewSettings:i,setViewSettings:l,selectedCardIds:m,dispatch:y,getCardById:g,getSelectedCards:u,getAllTags:b,updateTagsInAllCards:C,getCardsWithTag:j,isInitialized:s}}class Uo{config;directoryHandle=null;isSupported;constructor(){this.config={baseDirectory:"CardAll",imageDirectory:"images",tempDirectory:"temp",cacheDirectory:"cache"},this.isSupported="showDirectoryPicker"in window}isFileSystemAccessSupported(){return this.isSupported}async requestDirectoryAccess(){if(!this.isSupported)return console.warn("File System Access API not supported, using fallback storage"),!1;try{return this.directoryHandle=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"}),await this.ensureDirectoryStructure(),!0}catch(t){return t.name==="AbortError"?console.log("User cancelled directory selection"):console.error("Failed to access directory:",t),!1}}async ensureDirectoryStructure(){if(this.directoryHandle)try{await this.getOrCreateDirectory(this.config.imageDirectory),await this.getOrCreateDirectory(this.config.tempDirectory),await this.getOrCreateDirectory(this.config.cacheDirectory),console.log("Directory structure created successfully")}catch(t){console.error("Failed to create directory structure:",t)}}async getOrCreateDirectory(t){if(!this.directoryHandle)throw new Error("No directory handle available");try{return await this.directoryHandle.getDirectoryHandle(t)}catch{return await this.directoryHandle.getDirectoryHandle(t,{create:!0})}}async getOrCreateNestedDirectory(t){if(!this.directoryHandle)throw new Error("No directory handle available");const s=t.split("/");let r=this.directoryHandle;for(const n of s)if(n)try{r=await r.getDirectoryHandle(n)}catch{r=await r.getDirectoryHandle(n,{create:!0})}return r}generateImagePath(t,s){const r=s||"uncategorized";return`${this.config.imageDirectory}/${r}/${t}`}async saveImage(t,s,r){const n=`img_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=`${n}.webp`,l=`${this.generateImagePath(s,r)}/${o}`;try{const m=await this.processImage(t),f=await this.getImageMetadata(t,m);this.isSupported&&this.directoryHandle?await this.saveToFileSystem(l,m):await this.saveToIndexedDB(l,m);const d={id:n,cardId:s,fileName:o,filePath:l,metadata:f,createdAt:new Date,syncVersion:1,pendingSync:!0};return await W.images.add(d),{id:n,fileName:o,filePath:l,metadata:f}}catch(m){throw console.error("Failed to save image:",m),m}}async processImage(t){return new Promise((s,r)=>{const n=document.createElement("canvas"),o=n.getContext("2d"),i=new Image;i.onload=()=>{try{let{width:f,height:d}=i;if(f>1920||d>1080){const y=Math.min(1920/f,1080/d);f*=y,d*=y}n.width=f,n.height=d,o?.drawImage(i,0,0,f,d),n.toBlob(y=>{y?s(y):r(new Error("Failed to convert image"))},"image/webp",.8)}catch(l){r(l)}},i.onerror=()=>r(new Error("Failed to load image")),i.src=URL.createObjectURL(t)})}async getImageMetadata(t,s){return new Promise(r=>{const n=new Image;n.onload=()=>{r({originalName:t.name,size:s.size,width:n.width,height:n.height,format:"webp",compressed:!0})},n.src=URL.createObjectURL(s)})}async saveToFileSystem(t,s){if(!this.directoryHandle)throw new Error("No directory handle available");const r=t.split("/"),n=r.pop(),o=r.join("/"),m=await(await(await this.getOrCreateNestedDirectory(o)).getFileHandle(n,{create:!0})).createWritable();await m.write(s),await m.close()}async saveToIndexedDB(t,s){await s.arrayBuffer();const r=await this.blobToBase64(s);localStorage.setItem(`cardall_file_${t}`,r)}blobToBase64(t){return new Promise((s,r)=>{const n=new FileReader;n.onload=()=>s(n.result),n.onerror=r,n.readAsDataURL(t)})}async getImage(t){try{return this.isSupported&&this.directoryHandle?await this.getFromFileSystem(t):await this.getFromIndexedDB(t)}catch(s){throw console.error("Failed to get image:",s),s}}async getFromFileSystem(t){if(!this.directoryHandle)throw new Error("No directory handle available");const s=t.split("/"),r=s.pop(),n=s.join("/"),l=await(await(await this.getOrCreateNestedDirectory(n)).getFileHandle(r)).getFile();return URL.createObjectURL(l)}async getFromIndexedDB(t){const s=localStorage.getItem(`cardall_file_${t}`);if(!s)throw new Error("Image not found in storage");return s}async deleteImage(t){try{this.isSupported&&this.directoryHandle?await this.deleteFromFileSystem(t):await this.deleteFromIndexedDB(t),await W.images.where("filePath").equals(t).delete()}catch(s){throw console.error("Failed to delete image:",s),s}}async deleteFromFileSystem(t){if(this.directoryHandle)try{const s=t.split("/"),r=s.pop(),n=s.join("/");await(await this.getOrCreateNestedDirectory(n)).removeEntry(r)}catch(s){console.warn("Failed to delete file from filesystem:",s)}}async deleteFromIndexedDB(t){localStorage.removeItem(`cardall_file_${t}`)}async getStorageStats(){const t=await W.images.toArray(),s=t.reduce((r,n)=>r+n.metadata.size,0);return{totalImages:t.length,totalSize:s,storageMode:this.isSupported&&this.directoryHandle?"filesystem":"indexeddb"}}}const Hs=new Uo,Bo=a=>{const{userId:t,syncVersion:s,lastSyncAt:r,pendingSync:n,...o}=a;return{...o,id:o.id||"",createdAt:new Date(o.createdAt),updatedAt:new Date(o.updatedAt)}},ds=()=>Le.getCurrentUser()?.id||null;function Vo(){const[a,t]=c.useState([]),[s,r]=c.useState({searchTerm:"",tags:[]}),[n,o]=c.useState({layout:"grid",cardSize:"medium",showTags:!0,showDates:!1,sortBy:"updated",sortOrder:"desc"}),[i,l]=c.useState([]),[m,f]=c.useState(!0),d=c.useCallback(async()=>{try{f(!0);const v=(await W.cards.toArray()).map(Bo);t(v)}catch(x){console.error("Failed to load cards:",x)}finally{f(!1)}},[]);c.useEffect(()=>{d()},[d]),c.useEffect(()=>{const x=W.cards.hook("creating",(N,w,S)=>{console.log("Card creating:",N)}),v=W.cards.hook("updating",(N,w,S,D)=>{console.log("Card updating:",w)}),k=W.cards.hook("deleting",(N,w,S)=>{console.log("Card deleting:",N)});return()=>{x.unsubscribe(),v.unsubscribe(),k.unsubscribe()}},[]);const y=c.useCallback(()=>{const x=a.filter(v=>{if(s.searchTerm){const k=s.searchTerm.toLowerCase(),N=v.frontContent.title.toLowerCase().includes(k)||v.backContent.title.toLowerCase().includes(k),w=v.frontContent.text.toLowerCase().includes(k)||v.backContent.text.toLowerCase().includes(k),S=[...v.frontContent.tags,...v.backContent.tags].some(D=>D.toLowerCase().includes(k));if(!N&&!w&&!S)return!1}if(s.tags.length>0){const k=[...v.frontContent.tags,...v.backContent.tags];if(!s.tags.some(N=>k.includes(N)))return!1}if(s.folderId&&v.folderId!==s.folderId)return!1;if(s.dateRange){const k=new Date(v.updatedAt);if(k<s.dateRange.start||k>s.dateRange.end)return!1}return!(s.styleType&&v.style.type!==s.styleType||s.hasImages!==void 0&&(v.frontContent.images.length>0||v.backContent.images.length>0)!==s.hasImages)});return x.sort((v,k)=>{let N=0;switch(n.sortBy){case"created":N=new Date(v.createdAt).getTime()-new Date(k.createdAt).getTime();break;case"updated":N=new Date(v.updatedAt).getTime()-new Date(k.updatedAt).getTime();break;case"title":N=v.frontContent.title.localeCompare(k.frontContent.title);break;default:N=0}return n.sortOrder==="desc"?-N:N}),x},[a,s,n]),g=c.useCallback(async x=>{const v=ds();try{switch(x.type){case"CREATE_CARD":{const k=crypto.randomUUID(),N={...x.payload,id:k,userId:v,createdAt:new Date,updatedAt:new Date,syncVersion:1,pendingSync:!0};await W.cards.add(N),await Pe.addOperation({type:"create",entity:"card",entityId:k,data:N,priority:"normal"}),await d();break}case"UPDATE_CARD":{const k={...x.payload.updates,userId:v,updatedAt:new Date,syncVersion:1,pendingSync:!0};await W.cards.update(x.payload.id,k),await Pe.addOperation({type:"update",entity:"card",entityId:x.payload.id,data:{...x.payload.updates,userId:v},priority:"normal"}),await d();break}case"DELETE_CARD":{const k=await W.cards.get(x.payload);if(k){const N=[...k.frontContent.images,...k.backContent.images];for(const w of N)if(w.url&&!w.url.startsWith("data:"))try{await Hs.deleteImage(w.url)}catch(S){console.warn("Failed to delete image:",S)}}await W.cards.delete(x.payload),await Pe.addOperation({type:"delete",entity:"card",entityId:x.payload,data:{userId:v},priority:"high"}),await d();break}case"FLIP_CARD":{const k=await W.cards.get(x.payload);if(k){const N={isFlipped:!k.isFlipped,updatedAt:new Date,syncVersion:(k.syncVersion||0)+1,pendingSync:!0};await W.cards.update(x.payload,N),await Pe.addOperation({type:"update",table:"cards",data:N,localId:x.payload}),await d()}break}case"SELECT_CARD":l(k=>k.includes(x.payload)?k.filter(N=>N!==x.payload):[...k,x.payload]);break;case"DESELECT_ALL":l([]);break;case"DUPLICATE_CARD":{const k=await W.cards.get(x.payload);if(k){const N=crypto.randomUUID(),w={...k,id:N,userId:v,createdAt:new Date,updatedAt:new Date,syncVersion:1,pendingSync:!0};await W.cards.add(w),await Pe.addOperation({type:"create",table:"cards",data:w,localId:N}),await d()}break}case"MOVE_TO_FOLDER":{const k={folderId:x.payload.folderId,userId:v,updatedAt:new Date,syncVersion:1,pendingSync:!0};await W.cards.update(x.payload.cardId,k),await Pe.addOperation({type:"update",table:"cards",data:k,localId:x.payload.cardId}),await d();break}default:console.warn("Unknown card action:",x)}}catch(k){throw console.error("Card operation failed:",k),k}},[d]),u=c.useCallback(x=>a.find(v=>v.id===x),[a]),b=c.useCallback(()=>a.filter(x=>i.includes(x.id)),[a,i]),C=c.useCallback(()=>{const x=new Set;return a.forEach(v=>{v.frontContent.tags.forEach(k=>x.add(k)),v.backContent.tags.forEach(k=>x.add(k))}),Array.from(x).sort()},[a]),j=c.useCallback(async(x,v)=>{const k=ds();try{const N=await W.cards.filter(w=>w.frontContent.tags.includes(x)||w.backContent.tags.includes(x)).toArray();for(const w of N){const S=U=>v?U.map(J=>J===x?v:J):U.filter(J=>J!==x),D=S(w.frontContent.tags),B=S(w.backContent.tags),_={frontContent:{...w.frontContent,tags:D,lastModified:new Date},backContent:{...w.backContent,tags:B,lastModified:new Date},userId:k,updatedAt:new Date,syncVersion:(w.syncVersion||0)+1,pendingSync:!0};await W.cards.update(w.id,_),await Pe.addOperation({type:"update",table:"cards",data:_,localId:w.id})}await d()}catch(N){throw console.error("Failed to update tags in cards:",N),N}},[d]),p=c.useCallback(x=>a.filter(v=>v.frontContent.tags.includes(x)||v.backContent.tags.includes(x)),[a]),h=c.useCallback(async(x,v)=>{const k=ds();try{const N=await W.cards.get(v);if(!N)throw new Error("Card not found");const w=await Hs.saveImage(x,v,N.folderId),S={id:w.id,url:w.filePath,alt:x.name,width:w.metadata.width,height:w.metadata.height,aspectRatio:w.metadata.width/w.metadata.height},D=N.isFlipped?"backContent":"frontContent",B=[...N[D].images,S];return await W.cards.update(v,_=>{D==="frontContent"?_.frontContent={..._.frontContent,images:B,lastModified:new Date}:_.backContent={..._.backContent,images:B,lastModified:new Date},_.userId=k,_.updatedAt=new Date,_.syncVersion=(_.syncVersion||0)+1,_.pendingSync=!0}),await Pe.addOperation({type:"update",table:"cards",data:{[D]:{images:B},userId:k,updatedAt:new Date},localId:v}),await d(),S}catch(N){throw console.error("Failed to upload image:",N),N}},[d]);return{cards:y(),allCards:a,filter:s,setFilter:r,viewSettings:n,setViewSettings:o,selectedCardIds:i,isLoading:m,dispatch:g,getCardById:u,getSelectedCards:b,getAllTags:C,updateTagsInAllCards:j,getCardsWithTag:p,handleImageUpload:h,loadCards:d}}const Es={autoMigration:!0,backupOnMigration:!0,compressionEnabled:!0,cacheEnabled:!0,cacheSize:1e3,syncEnabled:!0,debugMode:!1,performanceMonitoring:!0,maxRetries:3,timeout:3e4};function cr(a){const t={...Es,...a},s=[],r=[];return(t.cacheSize<0||t.cacheSize>1e4)&&s.push("cacheSize must be between 0 and 10000"),(t.timeout<1e3||t.timeout>3e5)&&r.push("timeout should be between 1000ms and 300000ms"),(t.maxRetries<0||t.maxRetries>10)&&s.push("maxRetries must be between 0 and 10"),{valid:s.length===0,errors:s,warnings:r,config:t}}function ne(a,t,s){return{code:a,message:t,details:s,timestamp:new Date,stack:new Error().stack}}class bs{static instance=null;static async create(t){if(this.instance)return this.instance;const s=cr(t||{});if(!s.valid)throw ne("INVALID_CONFIG","Invalid storage configuration",{errors:s.errors});try{const{UniversalStorageAdapter:r}=await er(async()=>{const{UniversalStorageAdapter:n}=await Promise.resolve().then(()=>Wo);return{UniversalStorageAdapter:n}},void 0);this.instance=new r(s.config)}catch(r){throw ne("IMPORT_ERROR","Failed to import storage adapter implementation",{importError:r instanceof Error?r.message:String(r)})}return this.instance}static getInstance(){return this.instance}static resetInstance(){this.instance=null}}const Ho=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_STORAGE_CONFIG:Es,StorageAdapterFactory:bs,createStorageError:ne,validateStorageConfig:cr},Symbol.toStringTag,{value:"Module"}));class _e{static instance=null;MIGRATION_STATUS_KEY="cardall_migration_status";BACKUP_PREFIX="cardall_backup_";static getInstance(){return _e.instance||(_e.instance=new _e),_e.instance}async needsMigration(){try{return!(this.getMigrationStatus()?.completed||!oe.get("cards")||await W.cards.count()>0)}catch(t){return console.error("Failed to check migration status:",t),!1}}async migrate(t={}){const{createBackup:s=!0,validateData:r=!0,cleanupAfterSuccess:n=!0,progressCallback:o}=t,i=Date.now();try{if(!await this.needsMigration()){const g={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:[],duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"completed",progress:100,message:"No migration needed"}),g}this.reportProgress(o,{stage:"starting",progress:0,message:"Starting migration..."}),this.setMigrationStatus({started:!0,startTime:new Date,stage:"starting"}),this.reportProgress(o,{stage:"loading",progress:10,message:"Loading data from localStorage..."});const m=this.loadLocalStorageData();if(m.length===0){const g={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:["No data found in localStorage"],duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"completed",progress:100,message:"No data to migrate"}),g}let f;if(s&&(this.reportProgress(o,{stage:"backup",progress:20,message:"Creating backup..."}),f=await this.createBackup(m)),r){this.reportProgress(o,{stage:"validation",progress:30,message:"Validating data integrity..."});const g=this.validateMigrationData(m);if(!g.valid)throw ne("VALIDATION_FAILED","Data validation failed",{errors:g.errors})}this.reportProgress(o,{stage:"migration",progress:50,message:`Migrating ${m.length} cards...`});const d=await this.performMigration(m,(g,u)=>{this.reportProgress(o,{stage:"migration",progress:50+g*.4,message:u})});if(r){this.reportProgress(o,{stage:"verification",progress:90,message:"Verifying migration results..."});const g=await this.verifyMigrationResults(m.length);if(!g.success)throw ne("VERIFICATION_FAILED","Migration verification failed",{details:g.errors})}n&&d.errors.length===0&&(this.reportProgress(o,{stage:"cleanup",progress:95,message:"Cleaning up original data..."}),this.cleanupLocalStorage()),this.setMigrationStatus({completed:!0,completedAt:new Date,success:!0,migratedCards:d.migratedCards,totalCards:m.length});const y={success:d.success,migratedCards:d.migratedCards,totalCards:m.length,errors:d.errors,warnings:d.warnings,duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"completed",progress:100,message:`Migration completed successfully: ${d.migratedCards}/${m.length} cards migrated`}),y}catch(l){this.setMigrationStatus({completed:!0,completedAt:new Date,success:!1,error:l instanceof Error?l.message:String(l)});const m={success:!1,migratedCards:0,totalCards:0,errors:[l instanceof Error?l.message:"Unknown migration error"],warnings:[],duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"error",progress:0,message:`Migration failed: ${l instanceof Error?l.message:"Unknown error"}`}),m}}loadLocalStorageData(){try{return Re.loadFromLocalStorage()}catch(t){throw ne("LOAD_DATA_FAILED","Failed to load data from localStorage",{error:t instanceof Error?t.message:String(t)})}}async createBackup(t){try{return await(await bs.create()).backupData()}catch(s){throw ne("BACKUP_FAILED","Failed to create backup",{error:s instanceof Error?s.message:String(s)})}}validateMigrationData(t){const s=[];return Array.isArray(t)?(t.forEach((r,n)=>{const o=Re.validateCard(r);o.valid||s.push(`Card at index ${n}: ${o.errors.join(", ")}`)}),{valid:s.length===0,errors:s}):(s.push("Data is not an array"),{valid:!1,errors:s})}async performMigration(t,s){const r=[],n=[];let o=0;try{const i=Re.bulkCardsToDbCards(t);return s&&s(.1,"Starting batch migration..."),await W.cards.bulkAdd(i),o=i.length,s&&s(1,"Batch migration completed"),{migratedCards:o,errors:r,warnings:n}}catch(i){console.warn("Bulk migration failed, trying individual migration:",i);const l=t.length;for(let f=0;f<t.length;f++){const d=t[f];try{const y=Re.cardToDbCard(d);if(await W.cards.add(y),o++,s){const g=(f+1)/l;s(g,`Migrated card ${f+1}/${l}: ${d.frontContent.title}`)}}catch(y){console.error(`Failed to migrate card ${d.id}:`,y),r.push(d.id)}}return r.length===0||n.push(`Some cards failed to migrate: ${r.length} out of ${l}`),{migratedCards:o,errors:r,warnings:n}}}async verifyMigrationResults(t){const s=[];try{const r=await W.cards.count();if(r!==t&&s.push(`Record count mismatch: expected ${t}, got ${r}`),r>0){const n=await W.cards.limit(10).toArray();for(const o of n){const i=Re.dbCardToCard(o),l=Re.validateCard(i);l.valid||s.push(`Data integrity issue with card ${i.id}: ${l.errors.join(", ")}`)}}return{success:s.length===0,errors:s}}catch(r){return s.push(`Verification failed: ${r instanceof Error?r.message:String(r)}`),{success:!1,errors:s}}}cleanupLocalStorage(){try{oe.remove("cards")}catch(t){console.warn("Failed to cleanup localStorage:",t)}}async rollback(){try{const t=this.getAvailableBackups();if(t.length===0)throw ne("NO_BACKUP","No backup available for rollback");const s=t[0];return await(await bs.create()).restoreData(s)?(this.setMigrationStatus({rolledBack:!0,rolledBackAt:new Date,backupId:s.id}),await W.cards.clear(),!0):!1}catch(t){throw ne("ROLLBACK_FAILED","Failed to rollback migration",{error:t instanceof Error?t.message:String(t)})}}getAvailableBackups(){const t=[];try{for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r&&r.startsWith(this.BACKUP_PREFIX))try{const n=oe.get(r);n&&t.push({id:r,data:JSON.stringify(n),timestamp:new Date(n.timestamp),version:n.version||"1.0.0",cardCount:n.cards?.length||0,checksum:""})}catch(n){console.warn(`Failed to parse backup ${r}:`,n)}}}catch(s){console.error("Failed to get available backups:",s)}return t.sort((s,r)=>r.timestamp.getTime()-s.timestamp.getTime())}getMigrationStatus(){try{return oe.get(this.MIGRATION_STATUS_KEY)}catch{return null}}setMigrationStatus(t){try{const s=this.getMigrationStatus()||{};oe.set(this.MIGRATION_STATUS_KEY,{...s,...t})}catch(s){console.error("Failed to set migration status:",s)}}reportProgress(t,s){if(t)try{t(s)}catch(r){console.error("Progress callback error:",r)}}async getMigrationStats(){try{const t=this.getMigrationStatus(),s=this.getAvailableBackups();return{migrationNeeded:await this.needsMigration(),migrationCompleted:t?.completed||!1,migrationSuccessful:t?.success||!1,lastMigrationTime:t?.completedAt||null,availableBackups:s.length,localStorageCardCount:await this.getLocalStorageCardCount(),indexedDBCardCount:await W.cards.count()}}catch(t){throw ne("GET_STATS_FAILED","Failed to get migration stats",{error:t instanceof Error?t.message:String(t)})}}async getLocalStorageCardCount(){try{return Re.loadFromLocalStorage().length}catch{return 0}}}_e.getInstance();class dr{name="UniversalStorageAdapter";version="1.0.0";storageMode="localStorage";config;eventListeners=new Map;STORAGE_MODE_KEY="cardall_storage_mode";MIGRATION_STATUS_KEY="cardall_migration_status";constructor(t=Es){this.config=t,this.initializeStorageMode(),this.setupEventListeners()}initializeStorageMode(){try{const t=oe.get(this.STORAGE_MODE_KEY);t?this.storageMode=t:(this.storageMode="localStorage",this.saveStorageMode())}catch(t){console.warn("Failed to initialize storage mode:",t),this.storageMode="localStorage"}}saveStorageMode(){try{oe.set(this.STORAGE_MODE_KEY,this.storageMode),this.emitEvent({type:"storageModeChanged",timestamp:new Date,data:{mode:this.storageMode}})}catch(t){console.error("Failed to save storage mode:",t)}}getStorageMode(){return this.storageMode}async setStorageMode(t){if(this.storageMode===t)return;const s=this.storageMode;if(this.storageMode=t,this.saveStorageMode(),t==="indexeddb"&&this.config.autoMigration)try{await this.hasDataToMigrate()&&await this.migrateFromLocalStorage()}catch(r){throw console.error("Auto-migration failed:",r),this.storageMode=s,this.saveStorageMode(),r}}async hasDataToMigrate(){if(this.storageMode==="indexeddb")return!1;const t=oe.get("cards",{validate:!0,encrypt:!0});return t?t.length>0:!1}async migrateFromLocalStorage(){const t=Date.now();this.emitEvent({type:"migrationStarted",timestamp:new Date});try{if(!await this.hasDataToMigrate()){const l={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:[],duration:Date.now()-t,timestamp:new Date};return this.emitEvent({type:"migrationCompleted",timestamp:new Date,data:l}),l}const r=oe.get("cards",{validate:!0,encrypt:!0});if(!r||r.length===0){const l={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:[],duration:Date.now()-t,timestamp:new Date};return this.emitEvent({type:"migrationCompleted",timestamp:new Date,data:l}),l}let n;this.config.backupOnMigration&&(n=await this.backupData());const o=await this.performMigration(r);if(await this.validateMigration(r.length)&&o.success){await this.setStorageMode("indexeddb"),o.errors.length===0&&this.cleanupLocalStorage();const l={...o,totalCards:r.length,duration:Date.now()-t,timestamp:new Date};return this.emitEvent({type:"migrationCompleted",timestamp:new Date,data:l}),l}else{n&&await this.restoreData(n);const l={success:!1,migratedCards:0,totalCards:r.length,errors:["Migration validation failed"],warnings:o.warnings,duration:Date.now()-t,timestamp:new Date};return this.emitEvent({type:"migrationFailed",timestamp:new Date,data:l,error:new Error("Migration validation failed")}),l}}catch(s){const r={success:!1,migratedCards:0,totalCards:0,errors:[s instanceof Error?s.message:"Unknown migration error"],warnings:[],duration:Date.now()-t,timestamp:new Date};return this.emitEvent({type:"migrationFailed",timestamp:new Date,data:r,error:s instanceof Error?s:new Error(String(s))}),r}}async performMigration(t){const s=[],r=[];let n=0;try{const o=t.map(i=>this.convertToDbCard(i));return await W.cards.bulkAdd(o),n=o.length,{success:!0,migratedCards:n,totalCards:t.length,errors:[],warnings:r,duration:0,timestamp:new Date}}catch(o){console.error("Bulk migration failed:",o);for(const l of t)try{const m=this.convertToDbCard(l);await W.cards.add(m),n++}catch(m){console.error(`Failed to migrate card ${l.id}:`,m),s.push(l.id)}const i=s.length===0;return i||r.push(`Some cards failed to migrate: ${s.length} out of ${t.length}`),{success:i,migratedCards:n,totalCards:t.length,errors:s,warnings:r,duration:0,timestamp:new Date}}}async validateMigration(t){try{return await W.cards.count()===t}catch(s){return console.error("Migration validation failed:",s),!1}}cleanupLocalStorage(){try{oe.remove("cards")}catch(t){console.warn("Failed to cleanup localStorage:",t)}}async backupData(){const t=await this.getCards(),s={timestamp:new Date().toISOString(),version:this.version,cards:t},r=JSON.stringify(s),n=`backup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;oe.set(n,s);const o=await this.calculateChecksum(r),i={id:n,data:r,timestamp:new Date,version:this.version,cardCount:t.length,checksum:o};return this.emitEvent({type:"backupCreated",timestamp:new Date,data:i}),i}async restoreData(t){try{if(await this.calculateChecksum(t.data)!==t.checksum)throw new Error("Backup data integrity check failed");const r=JSON.parse(t.data);if(!r.cards||!Array.isArray(r.cards))throw new Error("Invalid backup data format");if(this.storageMode==="indexeddb"){const n=r.cards.map(o=>this.convertToDbCard(o));await W.cards.clear(),await W.cards.bulkAdd(n)}else oe.set("cards",r.cards);return this.emitEvent({type:"backupRestored",timestamp:new Date,data:{backupId:t.id,cardCount:t.cardCount}}),!0}catch(s){return console.error("Restore failed:",s),!1}}async calculateChecksum(t){let s=0;for(let r=0;r<t.length;r++){const n=t.charCodeAt(r);s=(s<<5)-s+n,s=s&s}return Math.abs(s).toString(16)}convertToDbCard(t){return{id:t.id,frontContent:t.frontContent,backContent:t.backContent,style:t.style,isFlipped:t.isFlipped,createdAt:t.createdAt,updatedAt:t.updatedAt,userId:void 0,syncVersion:1,pendingSync:!0,lastSyncAt:void 0}}convertFromDbCard(t){const{userId:s,syncVersion:r,lastSyncAt:n,pendingSync:o,...i}=t;return{...i,id:i.id||"",createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}}async getCards(t){try{if(this.storageMode==="indexeddb"){const r=(await W.cards.toArray()).map(n=>this.convertFromDbCard(n));return t?this.applyFilter(r,t):r}else{const s=oe.get("cards",{validate:!0,encrypt:!0})||[];return t?this.applyFilter(s,t):s}}catch(s){throw ne("GET_CARDS_FAILED","Failed to get cards",{error:s instanceof Error?s.message:String(s)})}}applyFilter(t,s){return t.filter(r=>{if(s.searchTerm){const n=s.searchTerm.toLowerCase(),o=r.frontContent.title.toLowerCase().includes(n)||r.backContent.title.toLowerCase().includes(n),i=r.frontContent.text.toLowerCase().includes(n)||r.backContent.text.toLowerCase().includes(n);if(!o&&!i)return!1}if(s.tags&&s.tags.length>0){const n=[...r.frontContent.tags,...r.backContent.tags];if(!s.tags.some(i=>n.includes(i)))return!1}return!0})}async getCardById(t){try{if(this.storageMode==="indexeddb"){const s=await W.cards.get(t);return s?this.convertFromDbCard(s):null}else return(await this.getCards()).find(r=>r.id===t)||null}catch(s){throw ne("GET_CARD_FAILED",`Failed to get card ${t}`,{error:s instanceof Error?s.message:String(s)})}}async createCard(t){const s=new Date,r={...t,id:crypto.randomUUID(),createdAt:s,updatedAt:s};try{if(this.storageMode==="indexeddb"){const n=this.convertToDbCard(r);await W.cards.add(n)}else{const n=await this.getCards();n.push(r),await this.saveCards(n)}return this.emitEvent({type:"cardCreated",timestamp:new Date,data:{card:r}}),r}catch(n){throw ne("CREATE_CARD_FAILED","Failed to create card",{error:n instanceof Error?n.message:String(n)})}}async updateCard(t,s){try{if(this.storageMode==="indexeddb"){const r=await W.cards.get(t);if(!r)throw ne("CARD_NOT_FOUND",`Card ${t} not found`);const n={...r,...s,updatedAt:new Date};return await W.cards.put(n),this.convertFromDbCard(n)}else{const r=await this.getCards(),n=r.findIndex(o=>o.id===t);if(n===-1)throw ne("CARD_NOT_FOUND",`Card ${t} not found`);return r[n]={...r[n],...s,updatedAt:new Date},await this.saveCards(r),r[n]}}catch(r){throw ne("UPDATE_CARD_FAILED",`Failed to update card ${t}`,{error:r instanceof Error?r.message:String(r)})}}async deleteCard(t){try{if(this.storageMode==="indexeddb")await W.cards.delete(t);else{const r=(await this.getCards()).filter(n=>n.id!==t);await this.saveCards(r)}return this.emitEvent({type:"cardDeleted",timestamp:new Date,data:{cardId:t}}),!0}catch(s){throw ne("DELETE_CARD_FAILED",`Failed to delete card ${t}`,{error:s instanceof Error?s.message:String(s)})}}async saveCards(t){try{if(this.storageMode==="indexeddb"){const s=t.map(r=>this.convertToDbCard(r));await W.cards.clear(),await W.cards.bulkAdd(s)}else oe.set("cards",t);this.emitEvent({type:"cardsChanged",timestamp:new Date,data:{cardCount:t.length}})}catch(s){throw ne("SAVE_CARDS_FAILED","Failed to save cards",{error:s instanceof Error?s.message:String(s)})}}async createCards(t){const s=new Date,r=t.map(n=>({...n,id:crypto.randomUUID(),createdAt:s,updatedAt:s}));try{if(this.storageMode==="indexeddb"){const n=r.map(o=>this.convertToDbCard(o));await W.cards.bulkAdd(n)}else{const n=await this.getCards();n.push(...r),await this.saveCards(n)}return r}catch(n){throw ne("CREATE_CARDS_FAILED","Failed to create cards",{error:n instanceof Error?n.message:String(n)})}}async updateCards(t){const s=[];try{if(this.storageMode==="indexeddb")for(const{id:r,updates:n}of n){const o=await this.updateCard(r,n);s.push(o)}else{const r=await this.getCards();for(const{id:n,updates:o}of o){const i=r.findIndex(l=>l.id===n);i!==-1&&(r[i]={...r[i],...o,updatedAt:new Date},s.push(r[i]))}await this.saveCards(r)}return s}catch(r){throw ne("UPDATE_CARDS_FAILED","Failed to update cards",{error:r instanceof Error?r.message:String(r)})}}async deleteCards(t){try{if(this.storageMode==="indexeddb")await W.cards.bulkDelete(t);else{const r=(await this.getCards()).filter(n=>!t.includes(n.id));await this.saveCards(r)}return!0}catch(s){throw ne("DELETE_CARDS_FAILED","Failed to delete cards",{error:s instanceof Error?s.message:String(s)})}}async searchCards(t,s){const r={...s,searchTerm:t};return this.getCards(r)}async getCardsByTag(t){const s={searchTerm:"",tags:[t]};return this.getCards(s)}async getCardsByFolder(t){return(await this.getCards()).filter(r=>r.folderId===t)}async getStats(){try{let t=0,s=0,r=0;if(this.storageMode==="indexeddb"){t=await W.cards.count();const i=await W.cards.toArray();r=JSON.stringify(i).length}else{const i=await this.getCards();t=i.length,s=JSON.stringify(i).length}const n=Math.max(s,r);return{totalCards:t,totalFolders:0,totalTags:0,totalSize:n,lastUpdated:new Date,storageMode:this.storageMode,indexedDBSize:r>0?r:void 0,localStorageSize:s>0?s:void 0}}catch(t){throw ne("GET_STATS_FAILED","Failed to get storage stats",{error:t instanceof Error?t.message:String(t)})}}async healthCheck(){const t=[],s=[];let r=100;try{if(await this.getCards(),this.storageMode==="indexeddb")try{await W.cards.count()}catch(n){t.push({level:"error",code:"INDEXEDDB_ACCESS_FAILED",message:"Cannot access IndexedDB",details:{error:n instanceof Error?n.message:String(n)}}),r-=40}try{oe.get("test")}catch(n){t.push({level:"warning",code:"LOCALSTORAGE_ACCESS_FAILED",message:"Cannot access localStorage",details:{error:n instanceof Error?n.message:String(n)}}),r-=20}if(this.storageMode==="indexeddb"){const n=await this.getStats();n.totalSize>50*1024*1024&&(t.push({level:"warning",code:"LARGE_STORAGE_SIZE",message:"Storage size is large",details:{size:n.totalSize}}),r-=10,s.push("Consider archiving old cards"))}return{healthy:r>=70,score:Math.max(0,r),issues:t,recommendations:s,timestamp:new Date}}catch(n){return{healthy:!1,score:0,issues:[{level:"error",code:"HEALTH_CHECK_FAILED",message:"Health check failed",details:{error:n instanceof Error?n.message:String(n)}}],recommendations:["Check storage permissions and browser compatibility"],timestamp:new Date}}}getConfig(){return{...this.config}}async updateConfig(t){const{validateStorageConfig:s}=await er(async()=>{const{validateStorageConfig:n}=await Promise.resolve().then(()=>Ho);return{validateStorageConfig:n}},void 0),r=s({...this.config,...t});if(!r.valid)throw ne("INVALID_CONFIG","Invalid storage configuration",{errors:r.errors});this.config=r.config}setupEventListeners(){if(this.storageMode==="indexeddb")try{W.cards.hook("creating",(t,s,r)=>{this.emitEvent({type:"cardCreated",timestamp:new Date,data:{cardId:t}})}),W.cards.hook("updating",(t,s,r,n)=>{this.emitEvent({type:"cardUpdated",timestamp:new Date,data:{cardId:s}})}),W.cards.hook("deleting",(t,s,r)=>{this.emitEvent({type:"cardDeleted",timestamp:new Date,data:{cardId:t}})})}catch(t){console.warn("Failed to setup IndexedDB event listeners:",t)}}addEventListener(t,s){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(s)}removeEventListener(t,s){const r=this.eventListeners.get(t);if(r){const n=r.indexOf(s);n>-1&&r.splice(n,1)}}emitEvent(t){const s=this.eventListeners.get(t.type);s&&s.forEach(r=>{try{r(t)}catch(n){console.error(`Event listener error for ${t.type}:`,n)}})}}const Wo=Object.freeze(Object.defineProperty({__proto__:null,UniversalStorageAdapter:dr},Symbol.toStringTag,{value:"Module"}));function Go(){const[a,t]=c.useState({mode:"localStorage",isReady:!1}),s=$o(),r=Vo();c.useEffect(()=>{(async()=>{try{t(b=>({...b,mode:"migrating",isReady:!1}));const m=_e.getInstance();await m.needsMigration()&&await m.migrate({createBackup:!0,validateData:!0,cleanupAfterSuccess:!0,progressCallback:b=>{t(C=>({...C,migrationProgress:{stage:b.stage,progress:b.progress,message:b.message}}))}});const d=new dr,y=await d.isIndexedDBAvailable(),g=await d.hasIndexedDBData();t({mode:y&&g?"indexeddb":"localStorage",isReady:!0})}catch(m){console.error("Failed to initialize adapter:",m),t({mode:"localStorage",isReady:!0})}})()},[]);const n=a.mode==="indexeddb"?r:s,o=c.useCallback(async()=>{t(l=>({...l,mode:"migrating",isReady:!1}));try{const m=await _e.getInstance().migrate({createBackup:!0,validateData:!0,cleanupAfterSuccess:!0,progressCallback:f=>{t(d=>({...d,migrationProgress:{stage:f.stage,progress:f.progress,message:f.message}}))}});t(m?{mode:"indexeddb",isReady:!0}:{mode:"localStorage",isReady:!0})}catch(l){console.error("Migration retry failed:",l),t({mode:"localStorage",isReady:!0})}},[]),i=c.useCallback(async()=>{try{await _e.getInstance().rollback()&&t({mode:"localStorage",isReady:!0})}catch(l){console.error("Rollback failed:",l)}},[]);return{...n,adapterState:a,storageMode:a.mode,isReady:a.isReady,migrationProgress:a.migrationProgress,retryMigration:o,rollbackMigration:i,isUsingLocalStorage:a.mode==="localStorage",isUsingIndexedDB:a.mode==="indexeddb",isMigrating:a.mode==="migrating"}}const Yo=[{id:"folder-1",name:"Development",color:"#3b82f6",icon:"Code",cardIds:["1"],isExpanded:!0,createdAt:new Date("2024-01-10"),updatedAt:new Date("2024-01-15")},{id:"folder-2",name:"Design Resources",color:"#8b5cf6",icon:"Palette",cardIds:[],isExpanded:!1,createdAt:new Date("2024-01-12"),updatedAt:new Date("2024-01-12")},{id:"folder-3",name:"Learning Notes",color:"#10b981",icon:"BookOpen",cardIds:["2"],parentId:"folder-1",isExpanded:!0,createdAt:new Date("2024-01-14"),updatedAt:new Date("2024-01-16")}];function Ko(){const[a,t]=c.useState(Yo),[s,r]=c.useState(null),n=c.useCallback(()=>{const g=a.filter(b=>!b.parentId),u=b=>b.map(C=>({...C,children:u(a.filter(j=>j.parentId===C.id))}));return u(g)},[a]),o=c.useCallback(g=>{t(u=>{switch(g.type){case"CREATE_FOLDER":const b={...g.payload,id:`folder-${Date.now()}`,cardIds:[],createdAt:new Date,updatedAt:new Date};return[...u,b];case"UPDATE_FOLDER":return u.map(j=>j.id===g.payload.id?{...j,...g.payload.updates,updatedAt:new Date}:j);case"DELETE_FOLDER":if(u.find(j=>j.id===g.payload)){const j=v=>{const k=u.filter(S=>S.parentId===v),N=k.map(S=>S.id),w=k.flatMap(S=>j(S.id));return[...N,...w]},p=j(g.payload),h=[g.payload,...p],x=u.filter(v=>h.includes(v.id)).flatMap(v=>v.cardIds);return"onDeleteCards"in g&&g.onDeleteCards&&x.length>0&&g.onDeleteCards(x),u.filter(v=>!h.includes(v.id))}return u.filter(j=>j.id!==g.payload);case"TOGGLE_FOLDER":return u.map(j=>j.id===g.payload?{...j,isExpanded:!j.isExpanded,updatedAt:new Date}:j);default:return u}})},[]),i=c.useCallback(g=>a.find(u=>u.id===g),[a]),l=c.useCallback(g=>{const u=[];let b=i(g);for(;b;)u.unshift(b),b=b.parentId?i(b.parentId):null;return u},[a,i]),m=c.useCallback((g,u)=>{o({type:"UPDATE_FOLDER",payload:{id:u,updates:{cardIds:[...i(u)?.cardIds||[],g]}}})},[o,i]),f=c.useCallback((g,u)=>{const b=i(u);b&&o({type:"UPDATE_FOLDER",payload:{id:u,updates:{cardIds:b.cardIds.filter(C=>C!==g)}}})},[o,i]),d=c.useCallback((g,u,b)=>{u&&f(g,u),b&&m(g,b)},[m,f]),y=c.useCallback((g,u)=>{if(g===u)return!1;let b=u;for(;b;){if(b===g)return!1;b=i(b)?.parentId??null}return!0},[i]);return c.useEffect(()=>{const g=setTimeout(()=>{oe.set("folders",a,{validate:!0,encrypt:!0})},1e3);return()=>clearTimeout(g)},[a]),c.useEffect(()=>{const g=oe.get("folders",{validate:!0,encrypt:!0});g&&t(g)},[]),{folders:a,folderTree:n(),selectedFolderId:s,setSelectedFolderId:r,dispatch:o,getFolderById:i,getFolderPath:l,addCardToFolder:m,removeCardFromFolder:f,moveCardBetweenFolders:d,canMoveFolder:y}}const qo=[{id:"tag-1",name:"react",color:"#3b82f6",count:1,createdAt:new Date("2024-01-15")},{id:"tag-2",name:"frontend",color:"#8b5cf6",count:1,createdAt:new Date("2024-01-15")},{id:"tag-3",name:"best-practices",color:"#10b981",count:1,createdAt:new Date("2024-01-15")},{id:"tag-4",name:"typescript",color:"#f59e0b",count:1,createdAt:new Date("2024-01-16")},{id:"tag-5",name:"types",color:"#ef4444",count:1,createdAt:new Date("2024-01-16")},{id:"tag-6",name:"development",color:"#06b6d4",count:1,createdAt:new Date("2024-01-16")}],Qe=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#8b5a2b","#6b7280","#ec4899","#84cc16","#f97316","#6366f1"];function Jo(){const[a,t]=c.useState(qo),[s,r]=c.useState([]),n=c.useCallback(()=>a.filter(p=>!s.includes(p.id)),[a,s]),o=c.useCallback(p=>{const h=[...n()].sort((x,v)=>v.count-x.count);return p?h.slice(0,p):h},[n]),i=c.useCallback(p=>{t(h=>{switch(p.type){case"CREATE_TAG":const x=h.find(k=>k.name.toLowerCase()===p.payload.name.toLowerCase());if(x)return h.map(k=>k.id===x.id?{...k,count:k.count+1}:k);const v={...p.payload,id:`tag-${Date.now()}`,count:1,color:p.payload.color||Qe[h.length%Qe.length],createdAt:new Date};return[...h,v];case"UPDATE_TAG":return h.map(k=>k.id===p.payload.id?{...k,...p.payload.updates}:k);case"DELETE_TAG":return h.filter(k=>k.id!==p.payload);case"TOGGLE_TAG_VISIBILITY":return r(k=>k.includes(p.payload)?k.filter(N=>N!==p.payload):[...k,p.payload]),h;default:return h}})},[]),l=c.useCallback(p=>a.find(h=>h.id===p),[a]),m=c.useCallback(p=>a.find(h=>h.name.toLowerCase()===p.toLowerCase()),[a]),f=c.useCallback((p,h)=>{const x=m(p);return x||(i({type:"CREATE_TAG",payload:{name:p,color:h||Qe[a.length%Qe.length]}}),null)},[i,m,a.length]),d=c.useCallback((p,h)=>{const x=m(p);if(x){const v=Math.max(0,x.count+h);i(v===0?{type:"DELETE_TAG",payload:x.id}:{type:"UPDATE_TAG",payload:{id:x.id,updates:{count:v}}})}},[i,m]),y=c.useCallback(p=>{const h=p.reduce((N,w)=>(N[w]=(N[w]||0)+1,N),{}),x=a.map(N=>({...N,count:h[N.name]||0})),v=new Set(a.map(N=>N.name));Object.entries(h).forEach(([N,w])=>{if(!v.has(N)){const S={id:`tag-${Date.now()}-${Math.random()}`,name:N,color:Qe[x.length%Qe.length],count:w,createdAt:new Date};x.push(S)}});const k=x.filter(N=>N.count>0);t(k)},[a]),g=c.useCallback(p=>{if(!p.trim())return n();const h=p.toLowerCase();return n().filter(x=>x.name.toLowerCase().includes(h))},[n]),u=c.useCallback((p,h=5)=>p.trim()?g(p).slice(0,h):o(h),[g,o]),b=c.useCallback((p,h)=>{const x=m(p);if(!x)return!1;const v=m(h);return v&&v.id!==x.id?!1:(i({type:"UPDATE_TAG",payload:{id:x.id,updates:{name:h.trim()}}}),!0)},[i,m]),C=c.useCallback(p=>{const h=m(p);return h?(i({type:"DELETE_TAG",payload:h.id}),!0):!1},[i,m]),j=c.useCallback(()=>a.map(p=>p.name),[a]);return c.useEffect(()=>{const p=setTimeout(()=>{oe.set("tags",a,{validate:!0,encrypt:!0}),oe.set("hidden-tags",s,{validate:!0,encrypt:!0})},1e3);return()=>clearTimeout(p)},[a,s]),c.useEffect(()=>{const p=oe.get("tags",{validate:!0,encrypt:!0});p&&t(p);const h=oe.get("hidden-tags",{validate:!0,encrypt:!0});h&&r(h)},[]),{tags:n(),allTags:a,hiddenTags:s,popularTags:o,dispatch:i,getTagById:l,getTagByName:m,createTagIfNotExists:f,updateTagCount:d,syncTagsWithCards:y,searchTags:g,getTagSuggestions:u,renameTag:b,deleteTagByName:C,getAllTagNames:j}}const ur=c.createContext(null);function Xo({children:a}){const t=Go(),s=Ko(),r=Jo();L.useEffect(()=>{if(t.isReady&&!t.isMigrating){const o=[];t.allCards.forEach(i=>{o.push(...i.frontContent.tags,...i.backContent.tags)}),r.syncTagsWithCards(o)}},[t.allCards,t.isReady,t.isMigrating,r.syncTagsWithCards]);const n={cards:t,folders:s,tags:r};return e.jsx(ur.Provider,{value:n,children:a})}function Ds(){const a=c.useContext(ur);if(!a)throw new Error("useCardAll must be used within a CardAllProvider");return a}function Qo(){return Ds().cards}function mr(){return Ds().folders}function fr(){return Ds().tags}const hr=c.createContext(void 0);function Zo({children:a}){const[t,s]=c.useState(!1),r=()=>s(!0),n=()=>s(!1);return e.jsx(hr.Provider,{value:{isOpen:t,openModal:r,closeModal:n},children:a})}function gr(){const a=c.useContext(hr);if(a===void 0)throw new Error("useAuthModal must be used within an AuthModalProvider");return a}function T(...a){return Xn(Qn(a))}const As=Wt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),I=c.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...n},o)=>{const i=r?wn:"button";return e.jsx(i,{className:T(As({variant:t,size:s,className:a})),ref:o,...n})});I.displayName="Button";const ei=vn,ti=jn,si=c.forwardRef(({className:a,inset:t,children:s,...r},n)=>e.jsxs(oa,{ref:n,className:T("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",a),...r,children:[s,e.jsx(Gt,{className:"ml-auto"})]}));si.displayName=oa.displayName;const ai=c.forwardRef(({className:a,...t},s)=>e.jsx(ia,{ref:s,className:T("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));ai.displayName=ia.displayName;const pr=c.forwardRef(({className:a,sideOffset:t=4,...s},r)=>e.jsx(bn,{children:e.jsx(la,{ref:r,sideOffset:t,className:T("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})}));pr.displayName=la.displayName;const Ae=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(ca,{ref:r,className:T("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",a),...s}));Ae.displayName=ca.displayName;const ri=c.forwardRef(({className:a,children:t,checked:s,...r},n)=>e.jsxs(da,{ref:n,className:T("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ua,{children:e.jsx($e,{className:"h-4 w-4"})})}),t]}));ri.displayName=da.displayName;const ni=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(ma,{ref:r,className:T("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ua,{children:e.jsx(tr,{className:"h-2 w-2 fill-current"})})}),t]}));ni.displayName=ma.displayName;const oi=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(fa,{ref:r,className:T("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s}));oi.displayName=fa.displayName;const vs=c.forwardRef(({className:a,...t},s)=>e.jsx(ha,{ref:s,className:T("-mx-1 my-1 h-px bg-muted",a),...t}));vs.displayName=ha.displayName;const us=[{emoji:"😀",name:"grinning"},{emoji:"😃",name:"smiley"},{emoji:"😄",name:"smile"},{emoji:"😁",name:"grin"},{emoji:"😆",name:"laughing"},{emoji:"😅",name:"sweat_smile"},{emoji:"🤣",name:"rofl"},{emoji:"😂",name:"joy"},{emoji:"🙂",name:"slightly_smiling_face"},{emoji:"🙃",name:"upside_down_face"},{emoji:"😉",name:"wink"},{emoji:"😊",name:"blush"},{emoji:"😇",name:"innocent"},{emoji:"🥰",name:"smiling_face_with_hearts"},{emoji:"😍",name:"heart_eyes"},{emoji:"🤩",name:"star_struck"},{emoji:"😘",name:"kissing_heart"},{emoji:"😗",name:"kissing"},{emoji:"😚",name:"kissing_closed_eyes"},{emoji:"😙",name:"kissing_smiling_eyes"},{emoji:"🥲",name:"smiling_face_with_tear"},{emoji:"😋",name:"yum"},{emoji:"😛",name:"stuck_out_tongue"},{emoji:"😜",name:"stuck_out_tongue_winking_eye"},{emoji:"🤪",name:"zany_face"},{emoji:"😝",name:"stuck_out_tongue_closed_eyes"},{emoji:"🤑",name:"money_mouth_face"},{emoji:"🤗",name:"hugs"},{emoji:"🤭",name:"hand_over_mouth"},{emoji:"🤫",name:"shushing_face"},{emoji:"🤔",name:"thinking"},{emoji:"🤐",name:"zipper_mouth_face"},{emoji:"🤨",name:"raised_eyebrow"},{emoji:"😐",name:"neutral_face"},{emoji:"😑",name:"expressionless"},{emoji:"😶",name:"no_mouth"},{emoji:"😏",name:"smirk"},{emoji:"😒",name:"unamused"},{emoji:"🙄",name:"roll_eyes"},{emoji:"😬",name:"grimacing"},{emoji:"🤥",name:"lying_face"},{emoji:"😔",name:"pensive"},{emoji:"😪",name:"sleepy"},{emoji:"🤤",name:"drooling_face"},{emoji:"😴",name:"sleeping"},{emoji:"😷",name:"mask"},{emoji:"🤒",name:"face_with_thermometer"},{emoji:"🤕",name:"face_with_head_bandage"},{emoji:"🤢",name:"nauseated_face"},{emoji:"🤮",name:"vomiting_face"},{emoji:"🤧",name:"sneezing_face"},{emoji:"🥵",name:"hot_face"},{emoji:"🥶",name:"cold_face"},{emoji:"🥴",name:"woozy_face"},{emoji:"😵",name:"dizzy_face"},{emoji:"🤯",name:"exploding_head"},{emoji:"🤠",name:"cowboy_hat_face"},{emoji:"🥳",name:"partying_face"},{emoji:"🥸",name:"disguised_face"},{emoji:"😎",name:"sunglasses"},{emoji:"🤓",name:"nerd_face"},{emoji:"🧐",name:"monocle_face"},{emoji:"😕",name:"confused"},{emoji:"😟",name:"worried"},{emoji:"🙁",name:"slightly_frowning_face"},{emoji:"☹️",name:"frowning_face"},{emoji:"😮",name:"open_mouth"},{emoji:"😯",name:"hushed"},{emoji:"😲",name:"astonished"},{emoji:"😳",name:"flushed"},{emoji:"🥺",name:"pleading_face"},{emoji:"😦",name:"frowning"},{emoji:"😧",name:"anguished"},{emoji:"😨",name:"fearful"},{emoji:"😰",name:"cold_sweat"},{emoji:"😥",name:"disappointed_relieved"},{emoji:"😢",name:"cry"},{emoji:"😭",name:"sob"},{emoji:"😱",name:"scream"},{emoji:"😖",name:"confounded"},{emoji:"😣",name:"persevere"},{emoji:"😞",name:"disappointed"},{emoji:"😓",name:"sweat"},{emoji:"😩",name:"weary"},{emoji:"😫",name:"tired_face"},{emoji:"🥱",name:"yawning_face"},{emoji:"😤",name:"triumph"},{emoji:"😡",name:"rage"},{emoji:"😠",name:"angry"},{emoji:"🤬",name:"cursing_face"},{emoji:"😈",name:"smiling_imp"},{emoji:"👿",name:"imp"},{emoji:"💀",name:"skull"},{emoji:"☠️",name:"skull_and_crossbones"},{emoji:"💩",name:"poop"},{emoji:"🤡",name:"clown_face"},{emoji:"👹",name:"ogre"},{emoji:"👺",name:"goblin"},{emoji:"👻",name:"ghost"},{emoji:"👽",name:"alien"},{emoji:"👾",name:"space_invader"},{emoji:"🤖",name:"robot"},{emoji:"😺",name:"smiley_cat"},{emoji:"😸",name:"smile_cat"},{emoji:"😹",name:"joy_cat"},{emoji:"😻",name:"heart_eyes_cat"},{emoji:"😼",name:"smirk_cat"},{emoji:"😽",name:"kissing_cat"},{emoji:"🙀",name:"scream_cat"},{emoji:"😿",name:"crying_cat_face"},{emoji:"😾",name:"pouting_cat"},{emoji:"👋",name:"wave"},{emoji:"🤚",name:"raised_back_of_hand"},{emoji:"🖐️",name:"raised_hand_with_fingers_splayed"},{emoji:"✋",name:"hand"},{emoji:"🖖",name:"vulcan_salute"},{emoji:"👌",name:"ok_hand"},{emoji:"🤌",name:"pinched_fingers"},{emoji:"🤏",name:"pinching_hand"},{emoji:"✌️",name:"v"},{emoji:"🤞",name:"crossed_fingers"},{emoji:"🤟",name:"love_you_gesture"},{emoji:"🤘",name:"metal"},{emoji:"🤙",name:"call_me_hand"},{emoji:"👈",name:"point_left"},{emoji:"👉",name:"point_right"},{emoji:"👆",name:"point_up_2"},{emoji:"🖕",name:"middle_finger"},{emoji:"👇",name:"point_down"},{emoji:"☝️",name:"point_up"},{emoji:"👍",name:"thumbsup"},{emoji:"👎",name:"thumbsdown"},{emoji:"✊",name:"fist"},{emoji:"👊",name:"facepunch"},{emoji:"🤛",name:"fist_left"},{emoji:"🤜",name:"fist_right"},{emoji:"👏",name:"clap"},{emoji:"🙌",name:"raised_hands"},{emoji:"👐",name:"open_hands"},{emoji:"🤲",name:"palms_up_together"},{emoji:"🤝",name:"handshake"},{emoji:"🙏",name:"pray"},{emoji:"❤️",name:"heart"},{emoji:"🧡",name:"orange_heart"},{emoji:"💛",name:"yellow_heart"},{emoji:"💚",name:"green_heart"},{emoji:"💙",name:"blue_heart"},{emoji:"💜",name:"purple_heart"},{emoji:"🖤",name:"black_heart"},{emoji:"🤍",name:"white_heart"},{emoji:"🤎",name:"brown_heart"},{emoji:"💔",name:"broken_heart"},{emoji:"❣️",name:"heavy_heart_exclamation"},{emoji:"💕",name:"two_hearts"},{emoji:"💞",name:"revolving_hearts"},{emoji:"💓",name:"heartbeat"},{emoji:"💗",name:"heartpulse"},{emoji:"💖",name:"sparkling_heart"},{emoji:"💘",name:"cupid"},{emoji:"💝",name:"gift_heart"},{emoji:"💟",name:"heart_decoration"},{emoji:"☮️",name:"peace_symbol"},{emoji:"✝️",name:"latin_cross"},{emoji:"☪️",name:"star_and_crescent"},{emoji:"🕉️",name:"om"},{emoji:"☸️",name:"wheel_of_dharma"},{emoji:"✡️",name:"star_of_david"},{emoji:"🔯",name:"six_pointed_star"},{emoji:"🕎",name:"menorah"},{emoji:"☯️",name:"yin_yang"},{emoji:"☦️",name:"orthodox_cross"},{emoji:"🛐",name:"place_of_worship"},{emoji:"⛎",name:"ophiuchus"},{emoji:"♈",name:"aries"},{emoji:"♉",name:"taurus"},{emoji:"♊",name:"gemini"},{emoji:"♋",name:"cancer"},{emoji:"♌",name:"leo"},{emoji:"♍",name:"virgo"},{emoji:"♎",name:"libra"},{emoji:"♏",name:"scorpius"},{emoji:"♐",name:"sagittarius"},{emoji:"♑",name:"capricorn"},{emoji:"♒",name:"aquarius"},{emoji:"♓",name:"pisces"},{emoji:"🆔",name:"id"},{emoji:"⚡",name:"zap"},{emoji:"💥",name:"boom"},{emoji:"💫",name:"dizzy"},{emoji:"💦",name:"sweat_drops"},{emoji:"💨",name:"dash"},{emoji:"🕳️",name:"hole"},{emoji:"💣",name:"bomb"},{emoji:"💬",name:"speech_balloon"},{emoji:"👁️‍🗨️",name:"eye_speech_bubble"},{emoji:"🗨️",name:"left_speech_bubble"},{emoji:"🗯️",name:"right_anger_bubble"},{emoji:"💭",name:"thought_balloon"},{emoji:"💤",name:"zzz"}];function ii({onEmojiSelect:a,onClose:t,query:s="",position:r}){const[n,o]=c.useState(us);c.useEffect(()=>{if(s&&s.trim()){const d=s.toLowerCase().trim(),y=us.filter(g=>g.name.toLowerCase().includes(d)||g.emoji.includes(s)||g.name.toLowerCase().startsWith(d));o(y.slice(0,20))}else o(us.slice(0,40))},[s]);const i=d=>{a(d),t()},l=d=>{d.key==="Escape"&&t()},m=()=>{if(!r)return{};const d=window.innerWidth,y=window.innerHeight,g=320,u=240;let b=r.x,C=r.y;return b+g>d&&(b=d-g-20),C+u>y&&(C=r.y-u-10),{left:Math.max(10,b),top:Math.max(10,C)}},f=e.jsxs("div",{className:"fixed bg-white border border-border rounded-lg shadow-xl p-3 w-80",style:{...m(),zIndex:2147483647},onKeyDown:l,children:[s&&e.jsxs("div",{className:"text-xs text-blue-600 mb-2 font-medium",children:['"',s,'"']}),e.jsx("div",{className:"grid grid-cols-10 gap-1 max-h-52 overflow-y-auto",children:n.map((d,y)=>e.jsx(I,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50 text-lg transition-colors",onClick:()=>i(d.emoji),title:d.name,children:d.emoji},`${d.emoji}-${y}`))}),n.length===0&&s&&e.jsx("div",{className:"text-center text-muted-foreground text-sm py-6",children:"No emojis found"})]});return Ht.createPortal(f,document.body)}function li({content:a,placeholder:t="Start typing...",onUpdate:s,onSave:r,onCancel:n,className:o,autoFocus:i=!1}){const[l,m]=c.useState(!1),[f,d]=c.useState(""),[y,g]=c.useState(null),u=c.useRef(null),b=To({extensions:[Eo.configure({strike:!1,code:!1,blockquote:!1}),Do.configure({html:!0,transformPastedText:!0,transformCopiedText:!1}),Ao,Ro.configure({nested:!0}),_o.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 underline hover:text-blue-800 cursor-pointer",target:"_blank",rel:"noopener noreferrer"},protocols:["http","https","ftp","mailto"],validate:h=>/^https?:\/\//.test(h)}),Fo.configure({HTMLAttributes:{class:"border-l-4 border-gray-300 pl-4 italic"}}),Io.configure({HTMLAttributes:{class:"inline-code"}}),Mo.configure({HTMLAttributes:{class:"code-block"}}),Po.configure({HTMLAttributes:{class:"line-through"}}),Lo.configure({inline:!0,allowBase64:!0,HTMLAttributes:{class:"rounded-md max-w-full h-auto"}}),Oo.configure({placeholder:t})],content:a,onUpdate:({editor:h})=>{s(h.getHTML())},editorProps:{attributes:{class:"tiptap-editor text-sm leading-relaxed focus:outline-none min-h-[100px] w-full"},handleKeyDown:(h,x)=>{if(x.key==="/"&&!l){const{selection:v}=h.state,{from:k}=v,N=h.state.doc.resolve(k),w=N.parent.textBetween(0,N.parentOffset);if(!w.trim()||w.endsWith(" ")){const D=h.coordsAtPos(k);return g({x:D.left,y:D.bottom+5}),m(!0),d(""),x.preventDefault(),!0}}if(l){if(x.key==="Escape")return m(!1),d(""),!0;if(x.key==="Backspace")return f.length>0?d(v=>v.slice(0,-1)):m(!1),!0;if(x.key.length===1&&!x.ctrlKey&&!x.metaKey&&x.key!==" ")return d(v=>v+x.key),!0;if(x.key===" ")return m(!1),d(""),!0}return!1}}}),C=c.useCallback(()=>{const h=document.createElement("input");h.type="file",h.accept="image/*",h.onchange=x=>{const v=x.target.files?.[0];if(v&&b){const k=new FileReader;k.onload=N=>{const w=N.target?.result;b.chain().focus().setImage({src:w}).run()},k.readAsDataURL(v)}},h.click()},[b]);c.useEffect(()=>{if(!b)return;const h=v=>{const k=v.clipboardData?.items;if(k)for(let N=0;N<k.length;N++){const w=k[N];if(w.type.indexOf("image")!==-1){v.preventDefault();const S=w.getAsFile();if(S){const D=new FileReader;D.onload=B=>{const _=B.target?.result;b.chain().focus().setImage({src:_}).run()},D.readAsDataURL(S)}}}},x=b.view.dom;return x.addEventListener("paste",h),()=>{x.removeEventListener("paste",h)}},[b]);const j=c.useCallback(h=>{b&&b.chain().focus().insertContent(h).run(),m(!1),d("")},[b]),p=c.useCallback(()=>{m(!1),d("")},[]);return c.useEffect(()=>{if(!b)return;const h=v=>{v.key==="Escape"?l?(m(!1),d("")):n():v.key==="Enter"&&(v.ctrlKey||v.metaKey)&&r()},x=b.view.dom;return x.addEventListener("keydown",h),()=>{x.removeEventListener("keydown",h)}},[b,r,n,l]),c.useEffect(()=>{b&&i&&b.commands.focus()},[b,i]),b?e.jsxs("div",{className:T("relative z-20",o),ref:u,children:[e.jsxs("div",{className:"relative p-2 -m-2",children:[e.jsx(zo,{editor:b,className:"min-h-[100px]"}),e.jsxs("div",{className:"absolute top-0 right-0 flex gap-1 opacity-60 hover:opacity-100 transition-opacity",children:[e.jsx(I,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 bg-white/90 hover:bg-white shadow-sm rounded",onClick:()=>m(!l),title:"Insert Emoji (Press / to open)",children:e.jsx(Zn,{className:"h-3 w-3"})}),e.jsx(I,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 bg-white/90 hover:bg-white shadow-sm rounded",onClick:C,title:"Insert Image",children:e.jsx(sr,{className:"h-3 w-3"})})]})]}),l&&e.jsx(ii,{onEmojiSelect:j,onClose:p,query:f,position:y||void 0}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2 pt-2 border-t border-border/30",children:[e.jsxs(I,{size:"sm",variant:"ghost",onClick:n,className:"h-7 px-3 text-xs",children:[e.jsx(Ye,{className:"h-3 w-3 mr-1"}),"Cancel"]}),e.jsxs(I,{size:"sm",onClick:r,className:"h-7 px-3 text-xs",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Accept"]})]}),b&&e.jsxs("div",{className:"absolute top-0 right-0 text-xs text-muted-foreground bg-white/90 px-2 py-1 rounded shadow-sm opacity-0 hover:opacity-100 transition-opacity pointer-events-none z-10 max-w-xs",children:["**bold** *italic* # heading - list ",">"," quote `code` ~~strike~~ [link](url) [] task / emoji"]})]}):null}function ci({content:a,onUpdate:t,onSave:s,onCancel:r,className:n,autoFocus:o=!1}){const[i,l]=c.useState(a),m=c.useRef(null);c.useEffect(()=>{l(a)},[a]),c.useEffect(()=>{o&&m.current&&(m.current.focus(),m.current.select())},[o]);const f=y=>{l(y.target.value),t(y.target.value)},d=y=>{y.key==="Enter"?s():y.key==="Escape"&&r()};return e.jsxs("div",{className:T("relative",n),children:[e.jsx("input",{ref:m,type:"text",value:i,onChange:f,onKeyDown:d,className:"w-full bg-transparent border-none outline-none text-lg font-semibold resize-none pr-16",placeholder:"Card title..."}),e.jsxs("div",{className:"absolute right-0 top-0 flex gap-1",children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:r,className:"h-6 w-6 p-0 bg-white/80 hover:bg-white shadow-sm",children:e.jsx(Ye,{className:"h-3 w-3"})}),e.jsx(I,{size:"sm",onClick:s,className:"h-6 w-6 p-0 bg-white/80 hover:bg-white shadow-sm",children:e.jsx($e,{className:"h-3 w-3"})})]})]})}const di=a=>{const t=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#8b5a2b","#6b7280","#ec4899","#84cc16","#f97316","#6366f1"];let s=0;for(let r=0;r<a.length;r++)s=a.charCodeAt(r)+((s<<5)-s);return t[Math.abs(s)%t.length]},ui=({tags:a,className:t,maxTags:s=5,size:r="sm"})=>{if(!a||a.length===0)return null;const n=a.slice(0,s),o=a.length-s,i={sm:"text-xs px-2 py-1",md:"text-sm px-2.5 py-1.5",lg:"text-base px-3 py-2"};return e.jsxs("div",{className:T("flex flex-wrap gap-1.5 mt-3",t),children:[n.map((l,m)=>e.jsx("span",{className:T("inline-flex items-center rounded-full font-medium text-white","shadow-sm transition-all duration-200 hover:scale-105",i[r]),style:{backgroundColor:di(l),fontSize:r==="sm"?"0.75rem":r==="md"?"0.875rem":"1rem"},children:l},`${l}-${m}`)),o>0&&e.jsxs("span",{className:T("inline-flex items-center rounded-full bg-gray-500 text-white font-medium",i[r]),children:["+",o]})]})};function mi({card:a,onFlip:t,onUpdate:s,onCopy:r,onScreenshot:n,onShare:o,onDelete:i,onStyleChange:l,onTagsChange:m,onMoveToFolder:f,className:d,size:y="md"}){const[g,u]=c.useState(!1),[b,C]=c.useState(!1),[j,p]=c.useState(null),[h,x]=c.useState(null),[v,k]=c.useState(null),[N,w]=c.useState(!1),S=c.useRef(null),D=a.isFlipped?a.backContent:a.frontContent,B={sm:"w-full",md:"w-full",lg:"w-full"},_={sm:"p-3",md:"p-4",lg:"p-5"},U=()=>{const{style:M}=a,V={borderRadius:"1rem",fontFamily:M.fontFamily,fontSize:M.fontSize==="sm"?"0.875rem":M.fontSize==="lg"?"1.125rem":"1rem",fontWeight:M.fontWeight,color:M.textColor,borderWidth:M.borderWidth||0,borderColor:M.borderColor};let ie="";return M.type==="gradient"&&M.gradientColors?(V.background=`linear-gradient(135deg, ${M.gradientColors.join(", ")})`,M.gradientColors.includes("#8a2be2")&&M.gradientColors.includes("#00ffff")?(ie="gradient-wave-animation",V.position="relative"):M.gradientColors.includes("#ee7752")&&M.gradientColors.includes("#23d5ab")?ie="moving-gradient-animation":M.gradientColors.includes("#667eea")&&(ie="gradient-mesh-animation")):M.type==="glass"?(V.background=M.backgroundColor||"rgba(255, 255, 255, 0.15)",V.backdropFilter="blur(20px) saturate(180%)",V.WebkitBackdropFilter="blur(20px) saturate(180%)",V.border=`1px solid ${M.borderColor||"rgba(255, 255, 255, 0.18)"}`,ie="glass-morphism"):M.backgroundColor&&M.backgroundColor.includes("linear-gradient")?(V.background=M.backgroundColor,V.backgroundSize="400% 400%",M.backgroundColor.includes("#667eea")&&(ie="gradient-mesh-animation")):(V.backgroundColor=M.backgroundColor,M.backgroundColor==="#1a1a2e"&&M.borderColor==="#4361ee"?ie="pulse-border-animation":M.backgroundColor==="#0f172a"&&(ie="glow-hover-animation")),{style:V,shadowClass:{sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg",xl:"shadow-xl",none:"","2xl":"shadow-2xl",glass:"shadow-lg"}[M.shadow||"md"]||"shadow-md",specialClasses:ie}},{style:J,shadowClass:$,specialClasses:X}=U(),te=c.useCallback(M=>{M.stopPropagation(),M.preventDefault(),!N&&(w(!0),t(a.id),setTimeout(()=>{w(!1)},600))},[a.id,t,N]),ee=M=>{M.stopPropagation(),P("content")},ue=M=>{P(M)},P=M=>{x(D),k(D),p(M),C(!0)},G=(M,V)=>{v&&k({...v,[M]:V,lastModified:new Date})},R=()=>{if(v){const V={[a.isFlipped?"backContent":"frontContent"]:v};s(a.id,V)}C(!1),p(null),x(null),k(null)},A=()=>{C(!1),p(null),x(null),k(null)},E=M=>{G("title",M.target.value)},O=M=>{G("text",M.target.value)},H=M=>{M.key==="Escape"&&A(),M.key==="Enter"&&M.ctrlKey&&R()};return e.jsx("div",{className:T("relative group",d),"data-card-id":a.id,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:e.jsx("div",{className:"flip-card-container",style:{perspective:"1000px",width:"100%",minHeight:"fit-content"},children:e.jsxs("div",{ref:S,className:T("flip-card-inner relative transition-all duration-700 ease-in-out",B[y]),style:{minHeight:"fit-content",width:"100%",transformStyle:"preserve-3d",transform:a.isFlipped?"rotateY(180deg)":"rotateY(0deg)"},children:[e.jsx("div",{className:T("flip-card-face flip-card-front w-full flex flex-col transition-all duration-300 relative",$,X,_[y]),style:{...J,borderRadius:J.borderRadius,backfaceVisibility:"hidden",position:a.isFlipped?"absolute":"relative",opacity:a.isFlipped?0:1},children:e.jsx(Ws,{content:v||a.frontContent,isEditing:b&&!a.isFlipped,editingField:j,onTitleChange:E,onTextChange:O,onTempContentUpdate:G,onSaveEdit:R,onCancelEdit:A,onDoubleClick:ue,onKeyDown:H,sideLabel:"Front",isHovered:g,onEdit:ee,onFlip:te,onCopy:()=>r(a.id),onScreenshot:()=>n(a.id),onShare:()=>o(a.id),onDelete:()=>i(a.id),onStyleChange:l?()=>l(a.id):void 0,onTagsChange:m?()=>m(a.id):void 0,onMoveToFolder:f,card:a,isFlipping:N})}),e.jsx("div",{className:T("flip-card-face flip-card-back w-full flex flex-col transition-all duration-300 relative",$,X,_[y]),style:{...J,borderRadius:J.borderRadius,backfaceVisibility:"hidden",transform:"rotateY(180deg)",position:a.isFlipped?"relative":"absolute",top:a.isFlipped?"auto":"0",opacity:a.isFlipped?1:0},children:e.jsx(Ws,{content:v||a.backContent,isEditing:b&&a.isFlipped,editingField:j,onTitleChange:E,onTextChange:O,onTempContentUpdate:G,onSaveEdit:R,onCancelEdit:A,onDoubleClick:ue,onKeyDown:H,sideLabel:"Back",isHovered:g,onEdit:ee,onFlip:te,onCopy:()=>r(a.id),onScreenshot:()=>n(a.id),onShare:()=>o(a.id),onDelete:()=>i(a.id),onStyleChange:l?()=>l(a.id):void 0,onTagsChange:m?()=>m(a.id):void 0,onMoveToFolder:f,card:a,isFlipping:N})})]})})})}function fi({images:a}){const t=a.slice(0,4),s=t.length,r=o=>{switch(o){case 1:return"flex justify-center";case 2:return"grid grid-cols-2 gap-2";case 3:return"grid grid-cols-2 gap-2";case 4:default:return"grid grid-cols-2 gap-2"}},n=(o,i)=>{const l="relative aspect-video rounded-md overflow-hidden bg-muted transition-all duration-200 hover:scale-[1.02]";return o===1?`${l} max-w-xs w-full`:o===3&&i===2?`${l} col-span-2 max-w-xs mx-auto`:l};return e.jsx("div",{className:r(s),children:t.map((o,i)=>e.jsx("div",{className:n(s,i),children:e.jsx("img",{src:o.url,alt:o.alt||`Image ${i+1}`,className:"w-full h-full object-cover transition-transform duration-200",loading:"lazy"})},i))})}function Ws({content:a,isEditing:t,editingField:s,onTitleChange:r,onTextChange:n,onTempContentUpdate:o,onSaveEdit:i,onCancelEdit:l,onDoubleClick:m,onKeyDown:f,sideLabel:d,isHovered:y,onEdit:g,onFlip:u,onCopy:b,onScreenshot:C,onShare:j,onDelete:p,onStyleChange:h,onTagsChange:x,onMoveToFolder:v,card:k,isFlipping:N}){return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1 mr-2",children:t&&s==="title"?e.jsx(ci,{content:a.title,onUpdate:w=>o("title",w),onSave:i,onCancel:l,autoFocus:!0}):e.jsx("h3",{className:"text-lg font-semibold text-left cursor-pointer hover:bg-black/5 rounded px-1 py-0.5 -mx-1 transition-colors",onDoubleClick:()=>m("title"),children:a.title||"Untitled Card"})}),e.jsxs("div",{className:T("flex gap-1 transition-all duration-200 flex-shrink-0",y||t?"opacity-100":"opacity-60"),children:[e.jsx(I,{size:"sm",variant:"ghost",className:T("h-7 w-7 p-0 rounded-md hover:bg-black/10 transition-all duration-200",N&&"animate-pulse"),onClick:u,title:`Flip to ${k.isFlipped?"Front":"Back"}`,disabled:N,children:e.jsx(eo,{className:T("h-3.5 w-3.5 transition-transform duration-200",N&&"scale-110")})}),e.jsxs(ei,{modal:!1,children:[e.jsx(ti,{asChild:!0,children:e.jsx("div",{className:"h-7 w-7 rounded-md hover:bg-black/10 flex items-center justify-center cursor-pointer transition-colors group",onMouseEnter:w=>{w.stopPropagation();const S=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});w.currentTarget.dispatchEvent(S)},onClick:w=>w.stopPropagation(),children:e.jsx(to,{className:"h-3.5 w-3.5"})})}),e.jsxs(pr,{align:"end",className:"w-48",children:[e.jsxs(Ae,{onClick:g,children:[e.jsx(so,{className:"h-4 w-4 mr-2"}),"Edit Content"]}),e.jsxs(Ae,{onClick:b,children:[e.jsx(ao,{className:"h-4 w-4 mr-2"}),"Copy Text"]}),e.jsxs(Ae,{onClick:C,children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),"Screenshot"]}),e.jsxs(Ae,{onClick:j,children:[e.jsx(ro,{className:"h-4 w-4 mr-2"}),"Share"]}),e.jsx(vs,{}),h&&e.jsxs(Ae,{onClick:h,children:[e.jsx(ar,{className:"h-4 w-4 mr-2"}),"Change Style"]}),x&&e.jsxs(Ae,{onClick:x,children:[e.jsx(rr,{className:"h-4 w-4 mr-2"}),"Manage Tags"]}),v&&e.jsxs(Ae,{onClick:v,children:[e.jsx(nr,{className:"h-4 w-4 mr-2"}),"Move to Folder"]}),e.jsx(vs,{}),e.jsxs(Ae,{onClick:p,className:"text-destructive focus:text-destructive",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Delete Card"]})]})]})]})]}),a.images.length>0&&e.jsxs("div",{className:"mb-3 flex-shrink-0",children:[e.jsx(fi,{images:a.images}),a.images.length>4&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-center",children:["+",a.images.length-4," more images"]})]}),e.jsx("div",{className:"flex-1 mb-3 relative z-10",children:t&&s==="content"?e.jsx(li,{content:a.text,placeholder:"Add your content here...",onUpdate:w=>o("text",w),onSave:i,onCancel:l,autoFocus:!0}):e.jsx("div",{className:"text-sm leading-relaxed text-left cursor-pointer hover:bg-black/5 rounded p-2 -m-2 transition-colors min-h-[100px] tiptap-editor relative z-10",onDoubleClick:w=>{w.target.tagName!=="A"&&m("content")},onClick:w=>{const S=w.target;if(S.tagName==="A"){w.stopPropagation();const D=S.getAttribute("href");D&&window.open(D,"_blank","noopener,noreferrer")}},children:e.jsx("div",{className:"whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:a.text||'<span class="text-muted-foreground">Click to add content...</span>'}})})}),e.jsxs("div",{className:"mt-auto",children:[e.jsx(ui,{tags:a.tags,size:"sm"}),a.images.length>0&&e.jsx("div",{className:"flex items-center justify-end text-xs text-muted-foreground mt-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(sr,{className:"h-3 w-3"}),e.jsx("span",{children:a.images.length})]})})]})]})}const ye=({title:a="Sample Card",content:t="This is a preview of how your card will look with this style.",style:s,isSelected:r=!1,onClick:n,className:o})=>{console.log("Rendering StylePreviewCard (Simplified):",{title:a,isSelected:r,style:s});const i=()=>{const l={minHeight:"60px",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"8px",borderRadius:"8px",cursor:"pointer",border:r?"2px solid #3b82f6":"1px solid #e5e7eb",position:"relative",fontSize:"10px",textAlign:"center",boxShadow:r?"0 4px 12px rgba(59, 130, 246, 0.3)":"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",backgroundColor:"#ffffff"};if(typeof s=="object"&&s!==null){if("background"in s||"backgroundColor"in s)return{...l,...s,cursor:"pointer",border:r?"3px solid #3b82f6":s.border||"2px solid #e5e7eb",boxShadow:r?"0 4px 12px rgba(59, 130, 246, 0.3)":s.boxShadow||"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"};if("type"in s){if(s.type==="solid")return{...l,backgroundColor:s.backgroundColor||"#ffffff",color:s.textColor||"#374151"};if(s.type==="gradient"&&s.gradientColors){const f=`linear-gradient(${s.gradientDirection||"to bottom right"}, ${s.gradientColors.join(", ")})`;return{...l,background:f,color:s.textColor||"#ffffff"}}}}return l};return e.jsxs("div",{style:i(),onClick:n,className:o,children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:"2px",fontSize:"11px"},children:a}),e.jsx("div",{style:{fontSize:"9px",opacity:.8,lineHeight:"1.1"},children:t})]})},hi=({isSelected:a,onClick:t,className:s})=>{const r={background:"#ffffff",color:"#1f2937",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"400",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",border:"1px solid #e5e7eb"};return e.jsx(ye,{title:"Classic White",content:"Clean and professional",style:r,isSelected:a,onClick:t,className:s})},gi={id:"classic-white",name:"Classic White",category:"business",description:"Clean and professional white background with subtle shadows",style:{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"2xl",shadow:"md",borderWidth:1,borderColor:"#e5e7eb"},previewComponent:hi},pi=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(135deg, #1f2937 0%, #111827 50%, #030712 100%)",color:"#f9fafb",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.1)"};return e.jsx(ye,{title:"Deep Dark",content:"Bold and mysterious",style:r,isSelected:a,onClick:t,className:s})},xi={id:"deep-dark",name:"Deep Dark",category:"personality",description:"Bold dark gradient with mysterious depth",style:{type:"gradient",gradientColors:["#1f2937","#111827","#030712"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#f9fafb",borderRadius:"2xl",shadow:"2xl",borderWidth:1,borderColor:"rgba(255, 255, 255, 0.1)"},previewComponent:pi},yi=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #c084fc 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"20px",boxShadow:"0 20px 25px -5px rgba(139, 92, 246, 0.25), 0 10px 10px -5px rgba(139, 92, 246, 0.1)",border:"none"};return e.jsx(ye,{title:"Elegant Purple",content:"Artistic and inspiring",style:r,isSelected:a,onClick:t,className:s})},wi={id:"elegant-purple",name:"Elegant Purple",category:"creative",description:"Artistic purple gradient with elegant curves and shadows",style:{type:"gradient",gradientColors:["#8b5cf6","#a855f7","#c084fc"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:yi},bi=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"16px",boxShadow:"0 20px 25px -5px rgba(16, 185, 129, 0.2), 0 10px 10px -5px rgba(16, 185, 129, 0.1)",border:"none"};return e.jsx(ye,{title:"Fresh Green",content:"Natural and harmonious",style:r,isSelected:a,onClick:t,className:s})},vi={id:"fresh-green",name:"Fresh Green",category:"natural",description:"Natural green gradient with organic harmony",style:{type:"gradient",gradientColors:["#10b981","#059669","#047857"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:bi},ji=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)",backgroundSize:"400% 400%",animation:"gradientShift 8s ease infinite",color:"#ffffff",fontFamily:'"Inter", system-ui, -apple-system, sans-serif',fontSize:"14px",fontWeight:"500",borderRadius:"12px",boxShadow:"0 8px 32px rgba(102, 126, 234, 0.3), 0 4px 16px rgba(118, 75, 162, 0.2)",border:"none",position:"relative",overflow:"hidden"},n={position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",pointerEvents:"none"};return e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ye,{title:"Gradient Mesh",content:"Dynamic gradient background",style:r,isSelected:a,onClick:t,className:s}),e.jsx("div",{style:n}),e.jsx("style",{jsx:!0,children:`
        @keyframes gradientShift {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }
      `})]})},Ci={id:"gradient-mesh",name:"Gradient Mesh",category:"creative",description:"Dynamic gradient background with animated mesh effect",style:{type:"solid",backgroundColor:"linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)",fontFamily:"Inter",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"xl",borderWidth:0,borderColor:"transparent"},previewComponent:ji},Ni=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(90deg, #fb923c 0%, #8b5cf6 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(251, 146, 60, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"none"};return e.jsx(ye,{title:"Gradient Sunset",content:"Vibrant and expressive",style:r,isSelected:a,onClick:t,className:s})},Si={id:"gradient-sunset",name:"Gradient Sunset",category:"personality",description:"Warm orange to violet gradient with magical sunset vibes",style:{type:"gradient",gradientColors:["#fb923c","#8b5cf6"],gradientDirection:"to-r",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:Ni},ki=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(135deg, #8a2be2 0%, #4b0082 25%, #9370db 50%, #00ffff 75%, #00bfff 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(138, 43, 226, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"none",position:"relative",overflow:"hidden"};return e.jsx("div",{className:"relative",children:e.jsx(ye,{title:"Gradient Wave",content:"Dynamic wave effect",style:r,isSelected:a,onClick:t,className:`${s} gradient-wave-animation`})})},Ti={id:"gradient-wave",name:"Gradient Wave",category:"creative",description:"Purple to cyan gradient with dynamic wave effect",style:{type:"gradient",gradientColors:["#8a2be2","#4b0082","#9370db","#00ffff","#00bfff"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:ki},Ei=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"16px",boxShadow:"0 10px 15px -3px rgba(59, 130, 246, 0.3), 0 4px 6px -2px rgba(59, 130, 246, 0.1)",border:"none"};return e.jsx(ye,{title:"Modern Blue",content:"Contemporary gradient design",style:r,isSelected:a,onClick:t,className:s})},Di={id:"modern-blue",name:"Modern Blue",category:"business",description:"Contemporary blue gradient with professional appeal",style:{type:"gradient",gradientColors:["#3b82f6","#1d4ed8","#1e40af"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"lg",borderWidth:0},previewComponent:Ei},Ai=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab)",backgroundSize:"400% 400%",color:"#ffffff",fontFamily:'"Poppins", system-ui, sans-serif',fontSize:"14px",fontWeight:"600",borderRadius:"16px",boxShadow:"0 15px 30px -10px rgba(0, 0, 0, 0.25)",border:"none",position:"relative",overflow:"hidden"};return e.jsx("div",{className:"relative",children:e.jsx(ye,{title:"Moving Gradient",content:"Flowing color effect",style:r,isSelected:a,onClick:t,className:`${s} moving-gradient-animation`})})},Ri={id:"moving-gradient",name:"Moving Gradient",category:"creative",description:"Colorful gradient with flowing animation effect",style:{type:"gradient",gradientColors:["#ee7752","#e73c7e","#23a6d5","#23d5ab"],gradientDirection:"to-br",fontFamily:"Poppins",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"xl",shadow:"xl",borderWidth:0},previewComponent:Ai},_i=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(90deg, #34d399 0%, #0d9488 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"20px",boxShadow:"0 10px 15px -3px rgba(52, 211, 153, 0.3), 0 4px 6px -2px rgba(13, 148, 136, 0.1)",border:"1px solid rgba(52, 211, 153, 0.3)"};return e.jsx(ye,{title:"Ocean Breeze",content:"Fresh and refreshing",style:r,isSelected:a,onClick:t,className:s})},Fi={id:"ocean-breeze",name:"Ocean Breeze",category:"natural",description:"Fresh emerald to teal gradient with tropical vibes",style:{type:"gradient",gradientColors:["#34d399","#0d9488"],gradientDirection:"to-r",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"lg",borderWidth:1,borderColor:"rgba(52, 211, 153, 0.3)"},previewComponent:_i},Ii=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(90deg, #fda4af 0%, #f87171 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"20px",boxShadow:"0 10px 15px -3px rgba(253, 164, 175, 0.3), 0 4px 6px -2px rgba(248, 113, 113, 0.1)",border:"1px solid rgba(253, 164, 175, 0.3)"};return e.jsx(ye,{title:"Soft Pink",content:"Gentle and soothing",style:r,isSelected:a,onClick:t,className:s})},Mi={id:"soft-pink",name:"Soft Pink",category:"natural",description:"Warm pink to red gradient with romantic tones",style:{type:"gradient",gradientColors:["#fda4af","#f87171"],gradientDirection:"to-r",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"lg",borderWidth:1,borderColor:"rgba(253, 164, 175, 0.3)"},previewComponent:Ii},Pi=({isSelected:a,onClick:t,className:s})=>{const r={background:"linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"18px",boxShadow:"0 25px 50px -12px rgba(255, 126, 95, 0.25), 0 0 0 1px rgba(255, 126, 95, 0.1)",border:"none"};return e.jsx(ye,{title:"Warm Orange",content:"Energetic and vibrant",style:r,isSelected:a,onClick:t,className:s})},Li={id:"warm-orange",name:"Warm Orange",category:"creative",description:"Energetic warm orange gradient with peachy tones",style:{type:"gradient",gradientColors:["#ff7e5f","#feb47b"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:Pi};class et{static instance;presets=new Map;categories=new Map;constructor(){this.initializeCategories()}static getInstance(){return et.instance||(et.instance=new et),et.instance}initializeCategories(){["business","creative","natural","personality"].forEach(s=>{this.categories.set(s,[])})}register(t){this.presets.set(t.id,t);const s=this.categories.get(t.category)||[];s.push(t),this.categories.set(t.category,s)}unregister(t){const s=this.presets.get(t);if(s){this.presets.delete(t);const n=(this.categories.get(s.category)||[]).filter(o=>o.id!==t);this.categories.set(s.category,n)}}getByCategory(t){return this.categories.get(t)||[]}getById(t){return this.presets.get(t)}getAll(){return Array.from(this.presets.values())}getAllByOrder(){const t=[];return["business","creative","natural","personality"].forEach(r=>{const n=this.getByCategory(r);t.push(...n)}),t}getCategoryCount(t){return this.categories.get(t)?.length||0}getTotalCount(){return this.presets.size}clear(){this.presets.clear(),this.initializeCategories()}}const Rs=et.getInstance(),Oi=()=>Rs.getAllByOrder();class tt{static instance;STORAGE_KEYS={USER_PREFERENCES:"cardall_style_preferences",RECENT_STYLES:"cardall_recent_styles",DEFAULT_STYLE:"cardall_default_style"};constructor(){}static getInstance(){return tt.instance||(tt.instance=new tt),tt.instance}saveUserPreference(t,s){try{const r=this.getUserPreferences();r[t]={styleId:s,appliedAt:new Date().toISOString()},localStorage.setItem(this.STORAGE_KEYS.USER_PREFERENCES,JSON.stringify(r)),this.addToRecentStyles(s)}catch(r){console.error("Failed to save user style preference:",r)}}getUserPreference(t){try{return this.getUserPreferences()[t]?.styleId||null}catch(s){return console.error("Failed to get user style preference:",s),null}}getRecentStyles(t=10){try{const s=localStorage.getItem(this.STORAGE_KEYS.RECENT_STYLES);return s?JSON.parse(s).slice(0,t):[]}catch(s){return console.error("Failed to get recent styles:",s),[]}}clearPreferences(){try{localStorage.removeItem(this.STORAGE_KEYS.USER_PREFERENCES),localStorage.removeItem(this.STORAGE_KEYS.RECENT_STYLES)}catch(t){console.error("Failed to clear style preferences:",t)}}setDefaultStyle(t){try{localStorage.setItem(this.STORAGE_KEYS.DEFAULT_STYLE,t)}catch(s){console.error("Failed to set default style:",s)}}getDefaultStyle(){try{return localStorage.getItem(this.STORAGE_KEYS.DEFAULT_STYLE)}catch(t){return console.error("Failed to get default style:",t),null}}getUserPreferences(){try{const t=localStorage.getItem(this.STORAGE_KEYS.USER_PREFERENCES);return t?JSON.parse(t):{}}catch(t){return console.error("Failed to parse user preferences:",t),{}}}addToRecentStyles(t){try{const r=this.getRecentStyles().filter(o=>o!==t),n=[t,...r].slice(0,10);localStorage.setItem(this.STORAGE_KEYS.RECENT_STYLES,JSON.stringify(n))}catch(s){console.error("Failed to update recent styles:",s)}}getStyleUsageStats(){try{const t=this.getUserPreferences(),s={};return Object.values(t).forEach(({styleId:r})=>{s[r]=(s[r]||0)+1}),s}catch(t){return console.error("Failed to get style usage stats:",t),{}}}getMostUsedStyles(t=5){try{const s=this.getStyleUsageStats();return Object.entries(s).sort(([,r],[,n])=>n-r).slice(0,t).map(([r])=>r)}catch(s){return console.error("Failed to get most used styles:",s),[]}}}const Gs=tt.getInstance(),zi=()=>{const a=[gi,Di,wi,Li,vi,Mi,Fi,xi,Si,Ci,Ti,Ri];a.forEach(t=>{Rs.register(t)}),console.log(`Registered ${a.length} card style presets`)};zi();const $i=({isOpen:a,onClose:t,context:s})=>{const[r,n]=c.useState(null),[o,i]=c.useState([]);c.useEffect(()=>{const f=Oi();console.log("Loaded style presets:",f.length,f),i(f);const d=Gs.getUserPreference(s.targetCardId);d&&n(d)},[s.targetCardId]);const l=f=>{const d=Rs.getById(f);d&&(n(f),s.onStyleApply(d.style),Gs.saveUserPreference(s.targetCardId,f))},m=()=>{n(null),t()};return a?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.1)",backdropFilter:"blur(2px)"},children:[e.jsx("div",{className:"absolute inset-0",onClick:m}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl border border-gray-200 p-6 w-full max-w-md sm:max-w-2xl lg:max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Card Styles"}),e.jsx("button",{onClick:m,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ye,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 mb-6",style:{minHeight:"300px",maxHeight:"70vh",overflowY:"auto"},children:o.map(f=>{const d=f.previewComponent;return console.log("Rendering preset:",f.id,f.name,d),e.jsxs("div",{className:"relative",children:[e.jsx(d,{isSelected:r===f.id,onClick:()=>l(f.id),className:"w-full"}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 truncate",children:f.name}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:f.category})]})]},f.id)})}),e.jsxs("div",{className:"text-xs text-gray-400 text-center mb-2",children:["Loaded ",o.length," presets"]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"Click any style to apply it instantly to your card"})]})]}):null},xr=c.createContext(void 0),Ui=()=>{const a=c.useContext(xr);if(!a)throw new Error("useStylePanel must be used within a StylePanelProvider");return a},Bi=({children:a})=>{const[t,s]=c.useState({isOpen:!1,context:null}),r=i=>{s({isOpen:!0,context:i})},n=()=>{s({isOpen:!1,context:null})},o={openStylePanel:r,closeStylePanel:n,isOpen:t.isOpen};return e.jsxs(xr.Provider,{value:o,children:[a,typeof window<"u"&&t.isOpen&&t.context&&Ht.createPortal(e.jsx($i,{isOpen:t.isOpen,onClose:n,context:t.context}),document.body)]})},yr=c.createContext(void 0);function Vi({children:a}){const[t,s]=c.useState(!1),[r,n]=c.useState(null),[o,i]=c.useState([]),[l,m]=c.useState(null),y={isOpen:t,currentCardId:r,currentCardTags:o,onTagsChange:l,openTagPanel:g=>{n(g.targetCardId),i(g.currentTags),m(()=>g.onTagsApply),s(!0)},closeTagPanel:()=>{s(!1),n(null),i([]),m(null)}};return e.jsx(yr.Provider,{value:y,children:a})}function wr(){const a=c.useContext(yr);if(a===void 0)throw new Error("useTagPanel must be used within a TagPanelProvider");return a}const he=c.forwardRef(({className:a,type:t,...s},r)=>e.jsx("input",{type:t,className:T("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:r,...s}));he.displayName="Input";const ze=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(ga,{ref:r,className:T("relative overflow-hidden",a),...s,children:[e.jsx(Cn,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(br,{}),e.jsx(Nn,{})]}));ze.displayName=ga.displayName;const br=c.forwardRef(({className:a,orientation:t="vertical",...s},r)=>e.jsx(pa,{ref:r,orientation:t,className:T("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...s,children:e.jsx(Sn,{className:"relative flex-1 rounded-full bg-border"})}));br.displayName=pa.displayName;const Hi=Wt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function K({className:a,variant:t,...s}){return e.jsx("div",{className:T(Hi({variant:t}),a),...s})}const Ge=En,Wi=kn,vr=c.forwardRef(({className:a,...t},s)=>e.jsx(xa,{ref:s,className:T("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t}));vr.displayName=xa.displayName;const Ue=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Wi,{children:[e.jsx(vr,{}),e.jsxs(ya,{ref:r,className:T("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s,children:[t,e.jsxs(Tn,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ue.displayName=ya.displayName;const ct=({className:a,...t})=>e.jsx("div",{className:T("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});ct.displayName="DialogHeader";const dt=({className:a,...t})=>e.jsx("div",{className:T("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});dt.displayName="DialogFooter";const ut=c.forwardRef(({className:a,...t},s)=>e.jsx(wa,{ref:s,className:T("text-lg font-semibold leading-none tracking-tight",a),...t}));ut.displayName=wa.displayName;const Kt=c.forwardRef(({className:a,...t},s)=>e.jsx(ba,{ref:s,className:T("text-sm text-muted-foreground",a),...t}));Kt.displayName=ba.displayName;function Gi({isOpen:a,onClose:t,currentCardId:s,currentFolderId:r,onFolderSelect:n}){const{folders:o,getFolderById:i}=mr(),[l,m]=c.useState(""),[f,d]=c.useState(r);c.useEffect(()=>{a&&(d(r),m(""))},[a,r]);const y=o.filter(p=>p.name.toLowerCase().includes(l.toLowerCase())),g=r?i(r):null,u=p=>{d(p)},b=()=>{n&&n(f),t()},C=()=>{d(r),t()},j=f!==r;return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ue,{className:"sm:max-w-md",children:[e.jsx(ct,{children:e.jsxs(ut,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Move Card to Folder"]})}),e.jsxs("div",{className:"space-y-4",children:[g&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[e.jsx(nr,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Currently in:"}),e.jsx(K,{variant:"secondary",children:g.name})]}),!g&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Currently in: Root"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(he,{placeholder:"Search folders...",value:l,onChange:p=>m(p.target.value),className:"pl-10"})]}),e.jsx(ze,{className:"h-64 w-full border rounded-md",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("div",{className:T("flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors",f===null?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>u(null),children:[e.jsx(Ls,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1",children:"Root"}),f===null&&e.jsx($e,{className:"h-4 w-4 flex-shrink-0"}),r===null&&e.jsx(K,{variant:"outline",className:"text-xs",children:"Current"})]}),y.map(p=>e.jsxs("div",{className:T("flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors",f===p.id?"bg-primary text-primary-foreground":"hover:bg-muted",r===p.id&&"opacity-60"),onClick:()=>u(p.id),children:[e.jsx(Oe,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1",children:p.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{variant:"outline",className:"text-xs",children:p.cardIds.length}),f===p.id&&e.jsx($e,{className:"h-4 w-4 flex-shrink-0"}),r===p.id&&e.jsx(K,{variant:"outline",className:"text-xs",children:"Current"})]})]},p.id)),y.length===0&&l&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Oe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No folders found"})]})]})})]}),e.jsxs(dt,{children:[e.jsx(I,{variant:"outline",onClick:C,children:"Cancel"}),e.jsx(I,{onClick:b,disabled:!j,children:j?"Move Card":"No Change"})]})]})})}const jr=c.createContext(void 0);function Yi({children:a}){const[t,s]=c.useState(!1),[r,n]=c.useState(null),[o,i]=c.useState(null),[l,m]=c.useState(null),f=g=>{n(g.targetCardId),i(g.currentFolderId||null),m(()=>g.onFolderApply),s(!0)},d=()=>{s(!1),n(null),i(null),m(null)},y={isOpen:t,currentCardId:r,currentFolderId:o,onFolderSelect:l,openFolderPanel:f,closeFolderPanel:d};return e.jsxs(jr.Provider,{value:y,children:[a,typeof window<"u"&&t&&r&&Ht.createPortal(e.jsx(Gi,{isOpen:t,onClose:d,currentCardId:r,currentFolderId:o,onFolderSelect:l}),document.body)]})}function Ki(){const a=c.useContext(jr);if(a===void 0)throw new Error("useFolderPanel must be used within a FolderPanelProvider");return a}function qi({card:a,onFlip:t,onUpdate:s,onCopy:r,onScreenshot:n,onShare:o,onDelete:i,onMoveToFolder:l,className:m,size:f="md"}){const{openStylePanel:d}=Ui(),{openTagPanel:y}=wr(),{openFolderPanel:g}=Ki(),u=(h,x)=>{s(h,{style:x,updatedAt:new Date})},b=()=>{d({targetCardId:a.id,currentStyle:a.style,onStyleApply:h=>u(a.id,h),onPanelClose:()=>{}})},C=(h,x)=>{const v=a.isFlipped?a.backContent:a.frontContent,k=a.isFlipped?"backContent":"frontContent";s(h,{[k]:{...v,tags:x,lastModified:new Date},updatedAt:new Date})},j=()=>{const h=a.isFlipped?a.backContent:a.frontContent;y({targetCardId:a.id,currentTags:h.tags,onTagsApply:x=>C(a.id,x),onPanelClose:()=>{}})},p=()=>{l&&g({targetCardId:a.id,currentFolderId:a.folderId,onFolderApply:h=>l(a.id,h),onPanelClose:()=>{}})};return e.jsx(mi,{card:a,onFlip:t,onUpdate:s,onCopy:r,onScreenshot:n,onShare:o,onDelete:i,onStyleChange:b,onTagsChange:j,onMoveToFolder:l?p:void 0,className:m,size:f})}function Ji({items:a,gap:t=16,minColumnWidth:s=280,maxColumns:r=5,breakpoints:n={sm:640,md:768,lg:1024,xl:1280,"2xl":1536}}){const o=c.useRef(null),[i,l]=c.useState(new Map),[m,f]=c.useState(0),[d,y]=c.useState({columns:1,gap:t,containerWidth:0}),g=c.useCallback(p=>{if(p===0)return 1;let h=r;p<n.sm?h=1:p<n.md?h=2:p<n.lg?h=3:p<n.xl&&(h=4);const x=p-t,v=Math.floor(x/(s+t));return Math.min(Math.max(1,v),h)},[t,s,r,n]),u=c.useCallback((p,h,x,v)=>{if(h===0||x===0)return{positions:new Map,totalHeight:0};const k=v*(h-1),N=x-k,w=Math.floor(N/h),S=new Array(h).fill(0),D=new Map;p.forEach(_=>{const U=S.indexOf(Math.min(...S)),J=U*(w+v),$=S[U];D.set(_.id,{x:J,y:$,width:w,height:_.height}),S[U]+=_.height+v});const B=Math.max(...S)-v;return{positions:D,totalHeight:B}},[]),b=c.useCallback(p=>{const h=p[0];if(!h)return;const x=h.contentRect.width,v=g(x);y(k=>({...k,columns:v,containerWidth:x}))},[g]);c.useEffect(()=>{const p=o.current;if(!p)return;const h=new ResizeObserver(x=>{b(x)});return h.observe(p),()=>{h.disconnect()}},[b]),c.useEffect(()=>{if(a.length===0||d.containerWidth===0){l(new Map),f(0);return}const{positions:p,totalHeight:h}=u(a,d.columns,d.containerWidth,t);l(p),f(h)},[a,d,t,u]);const C=c.useCallback(p=>i.get(p),[i]),j=c.useCallback((p,h)=>{const x=a.findIndex(w=>w.id===p);if(x===-1)return;const v=[...a];v[x]={...v[x],height:h};const{positions:k,totalHeight:N}=u(v,d.columns,d.containerWidth,t);l(k),f(N)},[a,d,t,u]);return{containerRef:o,positions:i,containerHeight:m,config:d,getItemPosition:C,updateItemHeight:j}}function Xi({cards:a,onCardFlip:t,onCardUpdate:s,onCardCopy:r,onCardScreenshot:n,onCardShare:o,onCardDelete:i,onMoveToFolder:l,onCardStyleChange:m,cardSize:f="md",className:d,gap:y=16,enableVirtualization:g=!0,overscan:u=5}){const[b,C]=c.useState(new Map),[j,p]=c.useState(!1),[h,x]=c.useState(0),[v,k]=c.useState(0),N=c.useRef(new Map),w=c.useRef(null),S=c.useMemo(()=>[...a].sort((P,G)=>new Date(G.createdAt).getTime()-new Date(P.createdAt).getTime()),[a]),D=c.useCallback(P=>{const R={sm:.8,md:1,lg:1.3}[f],A=200*R,E=Math.min(Math.ceil(P.frontContent.title.length/25),3)*24*R,O=Math.min(Math.ceil(P.frontContent.text.length/40),8)*18*R,H=P.frontContent.images.length>0?120*R:0,M=P.frontContent.tags.length>0?32*R:0,V=32*R;return Math.round(A+E+O+H+M+V)},[f]),B=c.useMemo(()=>S.map(P=>({id:P.id,height:b.get(P.id)||D(P)})),[S,b,D]),_=c.useMemo(()=>({sm:{minColumnWidth:240,maxColumns:5},md:{minColumnWidth:280,maxColumns:4},lg:{minColumnWidth:320,maxColumns:3}})[f],[f]),{containerRef:U,positions:J,containerHeight:$,updateItemHeight:X}=Ji({items:B,gap:y,..._,breakpoints:{sm:640,md:768,lg:1024,xl:1280,"2xl":1536}}),te=c.useMemo(()=>{if(!g||!w.current)return S;const P=w.current.clientHeight,G=h-u*100,R=h+P+u*100;return S.filter(A=>{const E=J.get(A.id);return E?E.y+E.height>=G&&E.y<=R:!0})},[S,J,h,g,u]);c.useCallback(P=>{g&&x(P.currentTarget.scrollTop)},[g]);const ee=c.useCallback(P=>{const G=N.current.get(P);if(!G)return;const R=new ResizeObserver(A=>{const E=A[0];if(E){const O=E.contentRect.height,H=b.get(P);Math.abs(O-(H||0))>3&&(C(M=>{const V=new Map(M);return V.set(P,O),V}),X(P,O))}});return R.observe(G),()=>R.disconnect()},[b,X]);c.useEffect(()=>{if(!j&&S.length>0){const P=new Map;S.forEach(G=>{P.set(G.id,D(G))}),C(P),p(!0)}},[S,D,j]),c.useEffect(()=>{const P=[];return te.forEach(G=>{const R=ee(G.id);R&&P.push(R)}),()=>{P.forEach(G=>G())}},[te,ee]);const ue=c.useCallback((P,G)=>{G?N.current.set(P,G):N.current.delete(P)},[]);return c.useEffect(()=>{w.current&&k(w.current.clientHeight)},[]),S.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-muted flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:"+"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"No cards yet"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Create your first knowledge card to get started. Click the + button to begin."})]})]})}):e.jsx("div",{ref:U,className:T("relative w-full",d),style:{height:$},children:te.map(P=>{const G=J.get(P.id);return G?e.jsx("div",{ref:R=>ue(P.id,R),className:"absolute transition-all duration-300 ease-out",style:{transform:`translate3d(${G.x}px, ${G.y}px, 0)`,width:G.width,willChange:"transform"},children:e.jsx(qi,{card:P,onFlip:t,onUpdate:s,onCopy:r,onScreenshot:n,onShare:o,onDelete:i,onMoveToFolder:l,size:f,className:"w-full"})},P.id):null})})}const Cr=c.forwardRef(({className:a,...t},s)=>e.jsxs(va,{ref:s,className:T("relative flex w-full touch-none select-none items-center",a),...t,children:[e.jsx(Dn,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(An,{className:"absolute h-full bg-primary"})}),e.jsx(Rn,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Cr.displayName=va.displayName;const Qi=Wt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ge=c.forwardRef(({className:a,...t},s)=>e.jsx(ja,{ref:s,className:T(Qi(),a),...t}));ge.displayName=ja.displayName;const st=c.forwardRef(({className:a,orientation:t="horizontal",decorative:s=!0,...r},n)=>e.jsx(Ca,{ref:n,decorative:s,orientation:t,className:T("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",a),...r}));st.displayName=Ca.displayName;const Nr=Fn,Sr=In,_s=c.forwardRef(({className:a,align:t="center",sideOffset:s=4,...r},n)=>e.jsx(_n,{children:e.jsx(Na,{ref:n,align:t,sideOffset:s,className:T("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}));_s.displayName=Na.displayName;function Ys(a){if(!a)return"";try{const t=new DOMParser().parseFromString(a,"text/html");t.querySelectorAll("img").forEach(i=>i.remove()),t.querySelectorAll("br").forEach(i=>{i.replaceWith(`
`)}),t.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote").forEach(i=>{i.insertAdjacentText("afterend",`
`)});let o=t.body.textContent||t.body.innerText||"";return o=o.replace(/[ \t]+/g," ").replace(/[ \t]*\n[ \t]*/g,`
`).replace(/\n{3,}/g,`

`).trim(),o}catch(t){return console.warn("Failed to parse HTML, falling back to regex cleanup:",t),a.replace(/<img[^>]*>/gi,"").replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(p|div|h[1-6]|li|blockquote)[^>]*>/gi,`
`).replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/[ \t]+/g," ").replace(/[ \t]*\n[ \t]*/g,`
`).replace(/\n{3,}/g,`

`).trim()}}function Zi(a,t){const s=Ys(a),r=Ys(t);return`${s}

${r}`}async function el(a){try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(a),!0;{const t=document.createElement("textarea");t.value=a,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();const s=document.execCommand("copy");return document.body.removeChild(t),s}}catch(t){return console.error("Failed to copy text to clipboard:",t),!1}}function tl(a,t){return a[13]=1,a[14]=t>>8,a[15]=t&255,a[16]=t>>8,a[17]=t&255,a}const kr=112,Tr=72,Er=89,Dr=115;let ms;function sl(){const a=new Int32Array(256);for(let t=0;t<256;t++){let s=t;for(let r=0;r<8;r++)s=s&1?3988292384^s>>>1:s>>>1;a[t]=s}return a}function al(a){let t=-1;ms||(ms=sl());for(let s=0;s<a.length;s++)t=ms[(t^a[s])&255]^t>>>8;return t^-1}function rl(a){const t=a.length-1;for(let s=t;s>=4;s--)if(a[s-4]===9&&a[s-3]===kr&&a[s-2]===Tr&&a[s-1]===Er&&a[s]===Dr)return s-3;return 0}function nl(a,t,s=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=kr,r[1]=Tr,r[2]=Er,r[3]=Dr,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=t&255,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const n=al(r),o=new Uint8Array(4);if(o[0]=n>>>24,o[1]=n>>>16,o[2]=n>>>8,o[3]=n&255,s){const i=rl(a);return a.set(r,i),a.set(o,i+13),a}else{const i=new Uint8Array(4);i[0]=0,i[1]=0,i[2]=0,i[3]=9;const l=new Uint8Array(54);return l.set(a,0),l.set(i,33),l.set(r,37),l.set(o,50),l}}const ol="AAlwSFlz",il="AAAJcEhZ",ll="AAAACXBI";function cl(a){let t=a.indexOf(ol);return t===-1&&(t=a.indexOf(il)),t===-1&&(t=a.indexOf(ll)),t}const Ar="[modern-screenshot]",Be=typeof window<"u",dl=Be&&"Worker"in window,ul=Be&&"atob"in window,ml=Be&&"btoa"in window,Fs=Be?window.navigator?.userAgent:"",Rr=Fs.includes("Chrome"),Vt=Fs.includes("AppleWebKit")&&!Rr,Is=Fs.includes("Firefox"),fl=a=>a&&"__CONTEXT__"in a,hl=a=>a.constructor.name==="CSSFontFaceRule",gl=a=>a.constructor.name==="CSSImportRule",Se=a=>a.nodeType===1,Rt=a=>typeof a.className=="object",_r=a=>a.tagName==="image",pl=a=>a.tagName==="use",Et=a=>Se(a)&&typeof a.style<"u"&&!Rt(a),xl=a=>a.nodeType===8,yl=a=>a.nodeType===3,lt=a=>a.tagName==="IMG",qt=a=>a.tagName==="VIDEO",wl=a=>a.tagName==="CANVAS",bl=a=>a.tagName==="TEXTAREA",vl=a=>a.tagName==="INPUT",jl=a=>a.tagName==="STYLE",Cl=a=>a.tagName==="SCRIPT",Nl=a=>a.tagName==="SELECT",Sl=a=>a.tagName==="SLOT",kl=a=>a.tagName==="IFRAME",Tl=(...a)=>console.warn(Ar,...a);function El(a){const t=a?.createElement?.("canvas");return t&&(t.height=t.width=1),!!t&&"toDataURL"in t&&!!t.toDataURL("image/webp").includes("image/webp")}const js=a=>a.startsWith("data:");function Fr(a,t){if(a.match(/^[a-z]+:\/\//i))return a;if(Be&&a.match(/^\/\//))return window.location.protocol+a;if(a.match(/^[a-z]+:/i)||!Be)return a;const s=Jt().implementation.createHTMLDocument(),r=s.createElement("base"),n=s.createElement("a");return s.head.appendChild(r),s.body.appendChild(n),t&&(r.href=t),n.href=a,n.href}function Jt(a){return(a&&Se(a)?a?.ownerDocument:a)??window.document}const Xt="http://www.w3.org/2000/svg";function Dl(a,t,s){const r=Jt(s).createElementNS(Xt,"svg");return r.setAttributeNS(null,"width",a.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${a} ${t}`),r}function Al(a,t){let s=new XMLSerializer().serializeToString(a);return t&&(s=s.replace(/[\u0000-\u0008\v\f\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(s)}`}function Rl(a,t){return new Promise((s,r)=>{const n=new FileReader;n.onload=()=>s(n.result),n.onerror=()=>r(n.error),n.onabort=()=>r(new Error(`Failed read blob to ${t}`)),n.readAsDataURL(a)})}const _l=a=>Rl(a,"dataUrl");function ot(a,t){const s=Jt(t).createElement("img");return s.decoding="sync",s.loading="eager",s.src=a,s}function Dt(a,t){return new Promise(s=>{const{timeout:r,ownerDocument:n,onError:o,onWarn:i}=t??{},l=typeof a=="string"?ot(a,Jt(n)):a;let m=null,f=null;function d(){s(l),m&&clearTimeout(m),f?.()}if(r&&(m=setTimeout(d,r)),qt(l)){const y=l.currentSrc||l.src;if(!y)return l.poster?Dt(l.poster,t).then(s):d();if(l.readyState>=2)return d();const g=d,u=b=>{i?.("Failed video load",y,b),o?.(b),d()};f=()=>{l.removeEventListener("loadeddata",g),l.removeEventListener("error",u)},l.addEventListener("loadeddata",g,{once:!0}),l.addEventListener("error",u,{once:!0})}else{const y=_r(l)?l.href.baseVal:l.currentSrc||l.src;if(!y)return d();const g=async()=>{if(lt(l)&&"decode"in l)try{await l.decode()}catch(b){i?.("Failed to decode image, trying to render anyway",l.dataset.originalSrc||y,b)}d()},u=b=>{i?.("Failed image load",l.dataset.originalSrc||y,b),d()};if(lt(l)&&l.complete)return g();f=()=>{l.removeEventListener("load",g),l.removeEventListener("error",u)},l.addEventListener("load",g,{once:!0}),l.addEventListener("error",u,{once:!0})}})}async function Fl(a,t){Et(a)&&(lt(a)||qt(a)?await Dt(a,t):await Promise.all(["img","video"].flatMap(s=>Array.from(a.querySelectorAll(s)).map(r=>Dt(r,t)))))}const Ir=function(){let t=0;const s=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${s()}${t}`)}();function Mr(a){return a?.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}let Ks=0;function Il(a){const t=`${Ar}[#${Ks}]`;return Ks++,{time:s=>a&&console.time(`${t} ${s}`),timeEnd:s=>a&&console.timeEnd(`${t} ${s}`),warn:(...s)=>a&&Tl(...s)}}function Ml(a){return{cache:a?"no-cache":"force-cache"}}async function Qt(a,t){return fl(a)?a:Pl(a,{...t,autoDestruct:!0})}async function Pl(a,t){const{scale:s=1,workerUrl:r,workerNumber:n=1}=t||{},o=!!t?.debug,i=t?.features??!0,l=a.ownerDocument??(Be?window.document:void 0),m=a.ownerDocument?.defaultView??(Be?window:void 0),f=new Map,d={width:0,height:0,quality:1,type:"image/png",scale:s,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:o,fetch:{requestInit:Ml(t?.fetch?.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1,...t?.fetch},fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:n,onCloneEachNode:null,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1,...t,__CONTEXT__:!0,log:Il(o),node:a,ownerDocument:l,ownerWindow:m,dpi:s===1?null:96*s,svgStyleElement:Pr(l),svgDefsElement:l?.createElementNS(Xt,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:dl&&r&&n?n:0})].map(()=>{try{const u=new Worker(r);return u.onmessage=async b=>{const{url:C,result:j}=b.data;j?f.get(C)?.resolve?.(j):f.get(C)?.reject?.(new Error(`Error receiving message from worker: ${C}`))},u.onmessageerror=b=>{const{url:C}=b.data;f.get(C)?.reject?.(new Error(`Error receiving message from worker: ${C}`))},u}catch(u){return d.log.warn("Failed to new Worker",u),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:`${[El(l)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:f,drawImageCount:0,tasks:[],features:i,isEnable:u=>u==="restoreScrollPosition"?typeof i=="boolean"?!1:i[u]??!1:typeof i=="boolean"?i:i[u]??!0,shadowRoots:[]};d.log.time("wait until load"),await Fl(a,{timeout:d.timeout,onWarn:d.log.warn}),d.log.timeEnd("wait until load");const{width:y,height:g}=Ll(a,d);return d.width=y,d.height=g,d}function Pr(a){if(!a)return;const t=a.createElement("style"),s=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(s),t}function Ll(a,t){let{width:s,height:r}=t;if(Se(a)&&(!s||!r)){const n=a.getBoundingClientRect();s=s||n.width||Number(a.getAttribute("width"))||0,r=r||n.height||Number(a.getAttribute("height"))||0}return{width:s,height:r}}async function Ol(a,t){const{log:s,timeout:r,drawImageCount:n,drawImageInterval:o}=t;s.time("image to canvas");const i=await Dt(a,{timeout:r,onWarn:t.log.warn}),{canvas:l,context2d:m}=zl(a.ownerDocument,t),f=()=>{try{m?.drawImage(i,0,0,l.width,l.height)}catch(d){t.log.warn("Failed to drawImage",d)}};if(f(),t.isEnable("fixSvgXmlDecode"))for(let d=0;d<n;d++)await new Promise(y=>{setTimeout(()=>{m?.clearRect(0,0,l.width,l.height),f(),y()},d+o)});return t.drawImageCount=0,s.timeEnd("image to canvas"),l}function zl(a,t){const{width:s,height:r,scale:n,backgroundColor:o,maximumCanvasSize:i}=t,l=a.createElement("canvas");l.width=Math.floor(s*n),l.height=Math.floor(r*n),l.style.width=`${s}px`,l.style.height=`${r}px`,i&&(l.width>i||l.height>i)&&(l.width>i&&l.height>i?l.width>l.height?(l.height*=i/l.width,l.width=i):(l.width*=i/l.height,l.height=i):l.width>i?(l.height*=i/l.width,l.width=i):(l.width*=i/l.height,l.height=i));const m=l.getContext("2d");return m&&o&&(m.fillStyle=o,m.fillRect(0,0,l.width,l.height)),{canvas:l,context2d:m}}function Lr(a,t){if(a.ownerDocument)try{const o=a.toDataURL();if(o!=="data:,")return ot(o,a.ownerDocument)}catch(o){t.log.warn("Failed to clone canvas",o)}const s=a.cloneNode(!1),r=a.getContext("2d"),n=s.getContext("2d");try{return r&&n&&n.putImageData(r.getImageData(0,0,a.width,a.height),0,0),s}catch(o){t.log.warn("Failed to clone canvas",o)}return s}function $l(a,t){try{if(a?.contentDocument?.body)return Ms(a.contentDocument.body,t)}catch(s){t.log.warn("Failed to clone iframe",s)}return a.cloneNode(!1)}function Ul(a){const t=a.cloneNode(!1);return a.currentSrc&&a.currentSrc!==a.src&&(t.src=a.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}async function Bl(a,t){if(a.ownerDocument&&!a.currentSrc&&a.poster)return ot(a.poster,a.ownerDocument);const s=a.cloneNode(!1);s.crossOrigin="anonymous",a.currentSrc&&a.currentSrc!==a.src&&(s.src=a.currentSrc);const r=s.ownerDocument;if(r){let n=!0;if(await Dt(s,{onError:()=>n=!1,onWarn:t.log.warn}),!n)return a.poster?ot(a.poster,a.ownerDocument):s;s.currentTime=a.currentTime,await new Promise(i=>{s.addEventListener("seeked",i,{once:!0})});const o=r.createElement("canvas");o.width=a.offsetWidth,o.height=a.offsetHeight;try{const i=o.getContext("2d");i&&i.drawImage(s,0,0,o.width,o.height)}catch(i){return t.log.warn("Failed to clone video",i),a.poster?ot(a.poster,a.ownerDocument):s}return Lr(o,t)}return s}function Vl(a,t){return wl(a)?Lr(a,t):kl(a)?$l(a,t):lt(a)?Ul(a):qt(a)?Bl(a,t):a.cloneNode(!1)}function Hl(a){let t=a.sandbox;if(!t){const{ownerDocument:s}=a;try{s&&(t=s.createElement("iframe"),t.id=`__SANDBOX__${Ir()}`,t.width="0",t.height="0",t.style.visibility="hidden",t.style.position="fixed",s.body.appendChild(t),t.srcdoc='<!DOCTYPE html><meta charset="UTF-8"><title></title><body>',a.sandbox=t)}catch(r){a.log.warn("Failed to getSandBox",r)}}return t}const Wl=["width","height","-webkit-text-fill-color"],Gl=["stroke","fill"];function Or(a,t,s){const{defaultComputedStyles:r}=s,n=a.nodeName.toLowerCase(),o=Rt(a)&&n!=="svg",i=o?Gl.map(C=>[C,a.getAttribute(C)]).filter(([,C])=>C!==null):[],l=[o&&"svg",n,i.map((C,j)=>`${C}=${j}`).join(","),t].filter(Boolean).join(":");if(r.has(l))return r.get(l);const f=Hl(s)?.contentWindow;if(!f)return new Map;const d=f?.document;let y,g;o?(y=d.createElementNS(Xt,"svg"),g=y.ownerDocument.createElementNS(y.namespaceURI,n),i.forEach(([C,j])=>{g.setAttributeNS(null,C,j)}),y.appendChild(g)):y=g=d.createElement(n),g.textContent=" ",d.body.appendChild(y);const u=f.getComputedStyle(g,t),b=new Map;for(let C=u.length,j=0;j<C;j++){const p=u.item(j);Wl.includes(p)||b.set(p,u.getPropertyValue(p))}return d.body.removeChild(y),r.set(l,b),b}function zr(a,t,s){const r=new Map,n=[],o=new Map;if(s)for(const l of s)i(l);else for(let l=a.length,m=0;m<l;m++){const f=a.item(m);i(f)}for(let l=n.length,m=0;m<l;m++)o.get(n[m])?.forEach((f,d)=>r.set(d,f));function i(l){const m=a.getPropertyValue(l),f=a.getPropertyPriority(l),d=l.lastIndexOf("-"),y=d>-1?l.substring(0,d):void 0;if(y){let g=o.get(y);g||(g=new Map,o.set(y,g)),g.set(l,[m,f])}t.get(l)===m&&!f||(y?n.push(y):r.set(l,[m,f]))}return r}function Yl(a,t,s,r){const{ownerWindow:n,includeStyleProperties:o,currentParentNodeStyle:i}=r,l=t.style,m=n.getComputedStyle(a),f=Or(a,null,r);i?.forEach((y,g)=>{f.delete(g)});const d=zr(m,f,o);d.delete("transition-property"),d.delete("all"),d.delete("d"),d.delete("content"),s&&(d.delete("margin-top"),d.delete("margin-right"),d.delete("margin-bottom"),d.delete("margin-left"),d.delete("margin-block-start"),d.delete("margin-block-end"),d.delete("margin-inline-start"),d.delete("margin-inline-end"),d.set("box-sizing",["border-box",""])),d.get("background-clip")?.[0]==="text"&&t.classList.add("______background-clip--text"),Rr&&(d.has("font-kerning")||d.set("font-kerning",["normal",""]),(d.get("overflow-x")?.[0]==="hidden"||d.get("overflow-y")?.[0]==="hidden")&&d.get("text-overflow")?.[0]==="ellipsis"&&a.scrollWidth===a.clientWidth&&d.set("text-overflow",["clip",""]));for(let y=l.length,g=0;g<y;g++)l.removeProperty(l.item(g));return d.forEach(([y,g],u)=>{l.setProperty(u,y,g)}),d}function Kl(a,t){(bl(a)||vl(a)||Nl(a))&&t.setAttribute("value",a.value)}const ql=[":before",":after"],Jl=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function Xl(a,t,s,r,n){const{ownerWindow:o,svgStyleElement:i,svgStyles:l,currentNodeStyle:m}=r;if(!i||!o)return;function f(d){const y=o.getComputedStyle(a,d);let g=y.getPropertyValue("content");if(!g||g==="none")return;n?.(g),g=g.replace(/(')|(")|(counter\(.+\))/g,"");const u=[Ir()],b=Or(a,d,r);m?.forEach((x,v)=>{b.delete(v)});const C=zr(y,b,r.includeStyleProperties);C.delete("content"),C.delete("-webkit-locale"),C.get("background-clip")?.[0]==="text"&&t.classList.add("______background-clip--text");const j=[`content: '${g}';`];if(C.forEach(([x,v],k)=>{j.push(`${k}: ${x}${v?" !important":""};`)}),j.length===1)return;try{t.className=[t.className,...u].join(" ")}catch(x){r.log.warn("Failed to copyPseudoClass",x);return}const p=j.join(`
  `);let h=l.get(p);h||(h=[],l.set(p,h)),h.push(`.${u[0]}:${d}`)}ql.forEach(f),s&&Jl.forEach(f)}const qs=new Set(["symbol"]);async function Js(a,t,s,r,n){if(Se(s)&&(jl(s)||Cl(s))||r.filter&&!r.filter(s))return;qs.has(t.nodeName)||qs.has(s.nodeName)?r.currentParentNodeStyle=void 0:r.currentParentNodeStyle=r.currentNodeStyle;const o=await Ms(s,r,!1,n);r.isEnable("restoreScrollPosition")&&Ql(a,o),t.appendChild(o)}async function Xs(a,t,s,r){let n=a.firstChild;Se(a)&&a.shadowRoot&&(n=a.shadowRoot?.firstChild,s.shadowRoots.push(a.shadowRoot));for(let o=n;o;o=o.nextSibling)if(!xl(o))if(Se(o)&&Sl(o)&&typeof o.assignedNodes=="function"){const i=o.assignedNodes();for(let l=0;l<i.length;l++)await Js(a,t,i[l],s,r)}else await Js(a,t,o,s,r)}function Ql(a,t){if(!Et(a)||!Et(t))return;const{scrollTop:s,scrollLeft:r}=a;if(!s&&!r)return;const{transform:n}=t.style,o=new DOMMatrix(n),{a:i,b:l,c:m,d:f}=o;o.a=1,o.b=0,o.c=0,o.d=1,o.translateSelf(-r,-s),o.a=i,o.b=l,o.c=m,o.d=f,t.style.transform=o.toString()}function Zl(a,t){const{backgroundColor:s,width:r,height:n,style:o}=t,i=a.style;if(s&&i.setProperty("background-color",s,"important"),r&&i.setProperty("width",`${r}px`,"important"),n&&i.setProperty("height",`${n}px`,"important"),o)for(const l in o)i[l]=o[l]}const ec=/^[\w-:]+$/;async function Ms(a,t,s=!1,r){const{ownerDocument:n,ownerWindow:o,fontFamilies:i,onCloneEachNode:l}=t;if(n&&yl(a))return r&&/\S/.test(a.data)&&r(a.data),n.createTextNode(a.data);if(n&&o&&Se(a)&&(Et(a)||Rt(a))){const f=await Vl(a,t);if(t.isEnable("removeAbnormalAttributes")){const C=f.getAttributeNames();for(let j=C.length,p=0;p<j;p++){const h=C[p];ec.test(h)||f.removeAttribute(h)}}const d=t.currentNodeStyle=Yl(a,f,s,t);s&&Zl(f,t);let y=!1;if(t.isEnable("copyScrollbar")){const C=[d.get("overflow-x")?.[0],d.get("overflow-y")?.[0]];y=C.includes("scroll")||(C.includes("auto")||C.includes("overlay"))&&(a.scrollHeight>a.clientHeight||a.scrollWidth>a.clientWidth)}const g=d.get("text-transform")?.[0],u=Mr(d.get("font-family")?.[0]),b=u?C=>{g==="uppercase"?C=C.toUpperCase():g==="lowercase"?C=C.toLowerCase():g==="capitalize"&&(C=C[0].toUpperCase()+C.substring(1)),u.forEach(j=>{let p=i.get(j);p||i.set(j,p=new Set),C.split("").forEach(h=>p.add(h))})}:void 0;return Xl(a,f,y,t,b),Kl(a,f),qt(a)||await Xs(a,f,t,b),await l?.(f),f}const m=a.cloneNode(!1);return await Xs(a,m,t),await l?.(m),m}function tc(a){if(a.ownerDocument=void 0,a.ownerWindow=void 0,a.svgStyleElement=void 0,a.svgDefsElement=void 0,a.svgStyles.clear(),a.defaultComputedStyles.clear(),a.sandbox){try{a.sandbox.remove()}catch(t){a.log.warn("Failed to destroyContext",t)}a.sandbox=void 0}a.workers=[],a.fontFamilies.clear(),a.fontCssTexts.clear(),a.requests.clear(),a.tasks=[],a.shadowRoots=[]}function sc(a){const{url:t,timeout:s,responseType:r,...n}=a,o=new AbortController,i=s?setTimeout(()=>o.abort(),s):void 0;return fetch(t,{signal:o.signal,...n}).then(l=>{if(!l.ok)throw new Error("Failed fetch, not 2xx response",{cause:l});switch(r){case"arrayBuffer":return l.arrayBuffer();case"dataUrl":return l.blob().then(_l);case"text":default:return l.text()}}).finally(()=>clearTimeout(i))}function At(a,t){const{url:s,requestType:r="text",responseType:n="text",imageDom:o}=t;let i=s;const{timeout:l,acceptOfImage:m,requests:f,fetchFn:d,fetch:{requestInit:y,bypassingCache:g,placeholderImage:u},font:b,workers:C,fontFamilies:j}=a;r==="image"&&(Vt||Is)&&a.drawImageCount++;let p=f.get(s);if(!p){g&&g instanceof RegExp&&g.test(i)&&(i+=(/\?/.test(i)?"&":"?")+new Date().getTime());const h=r.startsWith("font")&&b&&b.minify,x=new Set;h&&r.split(";")[1].split(",").forEach(w=>{j.has(w)&&j.get(w).forEach(S=>x.add(S))});const v=h&&x.size,k={url:i,timeout:l,responseType:v?"arrayBuffer":n,headers:r==="image"?{accept:m}:void 0,...y};p={type:r,resolve:void 0,reject:void 0,response:null},p.response=(async()=>{if(d&&r==="image"){const N=await d(s);if(N)return N}return!Vt&&s.startsWith("http")&&C.length?new Promise((N,w)=>{C[f.size&C.length-1].postMessage({rawUrl:s,...k}),p.resolve=N,p.reject=w}):sc(k)})().catch(N=>{if(f.delete(s),r==="image"&&u)return a.log.warn("Failed to fetch image base64, trying to use placeholder image",i),typeof u=="string"?u:u(o);throw N}),f.set(s,p)}return p.response}async function $r(a,t,s,r){if(!Ur(a))return a;for(const[n,o]of ac(a,t))try{const i=await At(s,{url:o,requestType:r?"image":"text",responseType:"dataUrl"});a=a.replace(rc(n),`$1${i}$3`)}catch(i){s.log.warn("Failed to fetch css data url",n,i)}return a}function Ur(a){return/url\((['"]?)([^'"]+?)\1\)/.test(a)}const Br=/url\((['"]?)([^'"]+?)\1\)/g;function ac(a,t){const s=[];return a.replace(Br,(r,n,o)=>(s.push([o,Fr(o,t)]),r)),s.filter(([r])=>!js(r))}function rc(a){const t=a.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}const nc=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function oc(a,t){return nc.map(s=>{const r=a.getPropertyValue(s);return!r||r==="none"?null:((Vt||Is)&&t.drawImageCount++,$r(r,null,t,!0).then(n=>{!n||r===n||a.setProperty(s,n,a.getPropertyPriority(s))}))}).filter(Boolean)}function ic(a,t){if(lt(a)){const s=a.currentSrc||a.src;if(!js(s))return[At(t,{url:s,imageDom:a,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(a.srcset="",a.dataset.originalSrc=s,a.src=r||"")})];(Vt||Is)&&t.drawImageCount++}else if(Rt(a)&&!js(a.href.baseVal)){const s=a.href.baseVal;return[At(t,{url:s,imageDom:a,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(a.dataset.originalSrc=s,a.href.baseVal=r||"")})]}return[]}function lc(a,t){const{ownerDocument:s,svgDefsElement:r}=t,n=a.getAttribute("href")??a.getAttribute("xlink:href");if(!n)return[];const[o,i]=n.split("#");if(i){const l=`#${i}`,m=t.shadowRoots.reduce((f,d)=>f??d.querySelector(`svg ${l}`),s?.querySelector(`svg ${l}`));if(o&&a.setAttribute("href",l),r?.querySelector(l))return[];if(m)return r?.appendChild(m.cloneNode(!0)),[];if(o)return[At(t,{url:o,responseType:"text"}).then(f=>{r?.insertAdjacentHTML("beforeend",f)})]}return[]}function Vr(a,t){const{tasks:s}=t;Se(a)&&((lt(a)||_r(a))&&s.push(...ic(a,t)),pl(a)&&s.push(...lc(a,t))),Et(a)&&s.push(...oc(a.style,t)),a.childNodes.forEach(r=>{Vr(r,t)})}async function cc(a,t){const{ownerDocument:s,svgStyleElement:r,fontFamilies:n,fontCssTexts:o,tasks:i,font:l}=t;if(!(!s||!r||!n.size))if(l&&l.cssText){const m=Zs(l.cssText,t);r.appendChild(s.createTextNode(`${m}
`))}else{const m=Array.from(s.styleSheets).filter(d=>{try{return"cssRules"in d&&!!d.cssRules.length}catch(y){return t.log.warn(`Error while reading CSS rules from ${d.href}`,y),!1}});await Promise.all(m.flatMap(d=>Array.from(d.cssRules).map(async(y,g)=>{if(gl(y)){let u=g+1;const b=y.href;let C="";try{C=await At(t,{url:b,requestType:"text",responseType:"text"})}catch(p){t.log.warn(`Error fetch remote css import from ${b}`,p)}const j=C.replace(Br,(p,h,x)=>p.replace(x,Fr(x,b)));for(const p of uc(j))try{d.insertRule(p,p.startsWith("@import")?u+=1:d.cssRules.length)}catch(h){t.log.warn("Error inserting rule from remote css import",{rule:p,error:h})}}}))),m.flatMap(d=>Array.from(d.cssRules)).filter(d=>hl(d)&&Ur(d.style.getPropertyValue("src"))&&Mr(d.style.getPropertyValue("font-family"))?.some(y=>n.has(y))).forEach(d=>{const y=d,g=o.get(y.cssText);g?r.appendChild(s.createTextNode(`${g}
`)):i.push($r(y.cssText,y.parentStyleSheet?y.parentStyleSheet.href:null,t).then(u=>{u=Zs(u,t),o.set(y.cssText,u),r.appendChild(s.createTextNode(`${u}
`))}))})}}const dc=/(\/\*[\s\S]*?\*\/)/g,Qs=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function uc(a){if(a==null)return[];const t=[];let s=a.replace(dc,"");for(;;){const o=Qs.exec(s);if(!o)break;t.push(o[0])}s=s.replace(Qs,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,n=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let o=r.exec(s);if(o)n.lastIndex=r.lastIndex;else if(o=n.exec(s),o)r.lastIndex=n.lastIndex;else break;t.push(o[0])}return t}const mc=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,fc=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Zs(a,t){const{font:s}=t,r=s?s?.preferredFormat:void 0;return r?a.replace(fc,n=>{for(;;){const[o,,i]=mc.exec(n)||[];if(!i)return"";if(i===r)return`src: ${o};`}}):a}async function hc(a,t){const s=await Qt(a,t);if(Se(s.node)&&Rt(s.node))return s.node;const{ownerDocument:r,log:n,tasks:o,svgStyleElement:i,svgDefsElement:l,svgStyles:m,font:f,progress:d,autoDestruct:y,onCloneNode:g,onEmbedNode:u,onCreateForeignObjectSvg:b}=s;n.time("clone node");const C=await Ms(s.node,s,!0);if(i&&r){let v="";m.forEach((k,N)=>{v+=`${k.join(`,
`)} {
  ${N}
}
`}),i.appendChild(r.createTextNode(v))}n.timeEnd("clone node"),await g?.(C),f!==!1&&Se(C)&&(n.time("embed web font"),await cc(C,s),n.timeEnd("embed web font")),n.time("embed node"),Vr(C,s);const j=o.length;let p=0;const h=async()=>{for(;;){const v=o.pop();if(!v)break;try{await v}catch(k){s.log.warn("Failed to run task",k)}d?.(++p,j)}};d?.(p,j),await Promise.all([...Array.from({length:4})].map(h)),n.timeEnd("embed node"),await u?.(C);const x=gc(C,s);return l&&x.insertBefore(l,x.children[0]),i&&x.insertBefore(i,x.children[0]),y&&tc(s),await b?.(x),x}function gc(a,t){const{width:s,height:r}=t,n=Dl(s,r,a.ownerDocument),o=n.ownerDocument.createElementNS(n.namespaceURI,"foreignObject");return o.setAttributeNS(null,"x","0%"),o.setAttributeNS(null,"y","0%"),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.append(a),n.appendChild(o),n}async function pc(a,t){const s=await Qt(a,t),r=await hc(s),n=Al(r,s.isEnable("removeControlCharacter"));s.autoDestruct||(s.svgStyleElement=Pr(s.ownerDocument),s.svgDefsElement=s.ownerDocument?.createElementNS(Xt,"defs"),s.svgStyles.clear());const o=ot(n,r.ownerDocument);return await Ol(o,s)}async function xc(a,t){const s=await Qt(a,t),{log:r,quality:n,type:o,dpi:i}=s,l=await pc(s);r.time("canvas to data url");let m=l.toDataURL(o,n);if(["image/png","image/jpeg"].includes(o)&&i&&ul&&ml){const[f,d]=m.split(",");let y=0,g=!1;if(o==="image/png"){const x=cl(d);x>=0?(y=Math.ceil((x+28)/3)*4,g=!0):y=33/3*4}else o==="image/jpeg"&&(y=18/3*4);const u=d.substring(0,y),b=d.substring(y),C=window.atob(u),j=new Uint8Array(C.length);for(let x=0;x<j.length;x++)j[x]=C.charCodeAt(x);const p=o==="image/png"?nl(j,i,g):tl(j,i),h=window.btoa(String.fromCharCode(...p));m=[f,",",h,b].join("")}return r.timeEnd("canvas to data url"),m}async function yc(a,t){return xc(await Qt(a,{...t,type:"image/png"}))}function wc(a,t=30){if(!a||a.trim()==="")return"untitled-card";let s=a.replace(/[^\w\s\u4e00-\u9fff\u3400-\u4dbf\u20000-\u2a6df\u2a700-\u2b73f\u2b740-\u2b81f\u2b820-\u2ceaf\uf900-\ufaff\u3300-\u33ff-]/g,"").replace(/\s+/g," ").trim();return s?(s.length>t&&(s=s.substring(0,t).trim()),s):"untitled-card"}async function bc(a,t={}){const{quality:s=1,pixelRatio:r=2,backgroundColor:n="transparent",includeStyles:o=!0}=t;try{const i=await yc(a,{quality:s,pixelRatio:r,backgroundColor:n,style:o?void 0:{},filter:m=>{if(m instanceof HTMLElement){const f=m.classList;return!f.contains("tooltip")&&!f.contains("dropdown-menu")&&!f.contains("popover")}return!0}});return await(await fetch(i)).blob()}catch(i){throw console.error("Screenshot capture failed:",i),new Error("Failed to capture screenshot")}}function vc(a,t){const s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`${t}.png`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}async function jc(a,t,s={}){const r=wc(t);return{blob:await bc(a,{quality:1,pixelRatio:2,backgroundColor:"transparent",...s}),fileName:r}}function Cc(a={}){const[t,s]=c.useState(!1),[r,n]=c.useState(!1),[o,i]=c.useState(null),[l,m]=c.useState(!1),[f,d]=c.useState(null),y=c.useCallback(async(C,j)=>{s(!0),d(null);try{const{blob:p,fileName:h}=await jc(C,j),x=URL.createObjectURL(p);i({blob:p,fileName:h,previewUrl:x}),m(!0)}catch(p){const h=p instanceof Error?p:new Error("Screenshot failed");d(h.message),a.onError?.(h)}finally{s(!1)}},[a]),g=c.useCallback(async()=>{if(o){n(!0);try{await new Promise(C=>setTimeout(C,500)),vc(o.blob,o.fileName),a.onSuccess?.(o.fileName),m(!1),setTimeout(()=>{o.previewUrl&&URL.revokeObjectURL(o.previewUrl),i(null)},100)}catch(C){const j=C instanceof Error?C:new Error("Download failed");d(j.message),a.onError?.(j)}finally{n(!1)}}},[o,a]),u=c.useCallback(()=>{m(!1),setTimeout(()=>{o?.previewUrl&&URL.revokeObjectURL(o.previewUrl),i(null)},100)},[o]),b=c.useCallback(()=>{d(null)},[]);return{isCapturing:t,isDownloading:r,showPreview:l,previewData:o,error:f,captureScreenshot:y,confirmDownload:g,cancelPreview:u,clearError:b}}function Nc({isOpen:a,onClose:t,onConfirm:s,previewUrl:r,fileName:n,isDownloading:o=!1}){const[i,l]=c.useState(!1),m=()=>{l(!0),setTimeout(()=>{s(),l(!1)},800)};return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ue,{className:"max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsx(ct,{children:e.jsxs(ut,{className:"flex items-center gap-2",children:[e.jsx(ps,{className:"h-5 w-5"}),"Screenshot Preview"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{variant:"secondary",className:"font-mono text-xs",children:[n,".png"]}),e.jsx(K,{variant:"outline",className:"text-xs",children:"High Quality"})]})}),e.jsx("div",{className:"relative bg-checkered rounded-lg overflow-hidden border",children:r?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r,alt:"Screenshot preview",className:T("w-full h-auto max-h-[60vh] object-contain transition-all duration-300",i&&"scale-95 opacity-80")}),i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-600/20 flex items-center justify-center",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-full p-6 shadow-lg animate-pulse",children:e.jsxs("div",{className:"relative",children:[e.jsx(nt,{className:"h-8 w-8 text-blue-600 animate-bounce"}),e.jsx(Os,{className:"h-4 w-4 text-purple-500 absolute -top-1 -right-1 animate-spin"})]})})})]}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(ps,{className:"h-12 w-12 mx-auto opacity-50"}),e.jsx("p",{children:"Loading preview..."})]})})}),o&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"}),"Preparing download..."]})]}),e.jsxs(dt,{className:"gap-2",children:[e.jsxs(I,{variant:"outline",onClick:t,disabled:i||o,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsx(I,{onClick:m,disabled:i||o||!r,className:T("relative overflow-hidden",i&&"bg-gradient-to-r from-blue-500 to-purple-600"),children:i?e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"h-4 w-4 mr-2 animate-spin"}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Download PNG"]})})]})]})})}const Sc=`
.bg-checkered {
  background-image: 
    linear-gradient(45deg, #f1f5f9 25%, transparent 25%), 
    linear-gradient(-45deg, #f1f5f9 25%, transparent 25%), 
    linear-gradient(45deg, transparent 75%, #f1f5f9 75%), 
    linear-gradient(-45deg, transparent 75%, #f1f5f9 75%);
  background-size: 20px 20px;
  background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
}
`;if(typeof document<"u"){const a=document.createElement("style");a.textContent=Sc,document.head.appendChild(a)}const kc=1,Tc=1e6;let fs=0;function Ec(){return fs=(fs+1)%Number.MAX_SAFE_INTEGER,fs.toString()}const hs=new Map,ea=a=>{if(hs.has(a))return;const t=setTimeout(()=>{hs.delete(a),Nt({type:"REMOVE_TOAST",toastId:a})},Tc);hs.set(a,t)},Dc=(a,t)=>{switch(t.type){case"ADD_TOAST":return{...a,toasts:[t.toast,...a.toasts].slice(0,kc)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?ea(s):a.toasts.forEach(r=>{ea(r.id)}),{...a,toasts:a.toasts.map(r=>r.id===s||s===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(s=>s.id!==t.toastId)}}},$t=[];let Ut={toasts:[]};function Nt(a){Ut=Dc(Ut,a),$t.forEach(t=>{t(Ut)})}function Ac({...a}){const t=Ec(),s=n=>Nt({type:"UPDATE_TOAST",toast:{...n,id:t}}),r=()=>Nt({type:"DISMISS_TOAST",toastId:t});return Nt({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:n=>{n||r()}}}),{id:t,dismiss:r,update:s}}function Rc(){const[a,t]=c.useState(Ut);return c.useEffect(()=>($t.push(t),()=>{const s=$t.indexOf(t);s>-1&&$t.splice(s,1)}),[a]),{...a,toast:Ac,dismiss:s=>Nt({type:"DISMISS_TOAST",toastId:s})}}const Hr=c.forwardRef(({className:a,...t},s)=>e.jsx(Sa,{ref:s,className:T("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...t}));Hr.displayName=Sa.displayName;const Wr=c.forwardRef(({className:a,...t},s)=>e.jsx(ka,{ref:s,className:T("aspect-square h-full w-full",a),...t}));Wr.displayName=ka.displayName;const Gr=c.forwardRef(({className:a,...t},s)=>e.jsx(Ta,{ref:s,className:T("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...t}));Gr.displayName=Ta.displayName;const Yr=["from-violet-500 to-pink-500","from-blue-500 to-purple-600","from-green-500 to-teal-600","from-orange-500 to-red-600","from-pink-500 to-rose-600","from-indigo-500 to-blue-600","from-yellow-500 to-orange-600","from-purple-500 to-pink-600","from-teal-500 to-green-600","from-red-500 to-pink-600","from-cyan-500 to-blue-600"];function _c(a){let t=0;for(let s=0;s<a.length;s++){const r=a.charCodeAt(s);t=(t<<5)-t+r,t=t&t}return Math.abs(t)%Yr.length}function Fc(a){return a?a.username?a.username.charAt(0).toUpperCase():a.email?a.email.charAt(0).toUpperCase():"?":"?"}function Ic(a){return a&&(a.username||a.email)||"anonymous"}function Kr({user:a,size:t="md",className:s,onClick:r,showHoverEffect:n=!0}){const o=Fc(a),i=Ic(a),l=_c(i),m=Yr[l],d=T({sm:"h-6 w-6 text-xs",md:"h-8 w-8 text-sm",lg:"h-10 w-10 text-base"}[t],n&&r&&"cursor-pointer transition-transform hover:scale-105",s),y=T("bg-gradient-to-br text-white font-semibold flex items-center justify-center",m,n&&r&&"transition-all duration-200 hover:shadow-md");return e.jsxs(Hr,{className:d,onClick:r,children:[e.jsx(Wr,{src:a?.avatar_url,alt:a?.username||a?.email||"User"}),e.jsx(Gr,{className:y,children:o})]})}const qr=Pn,Jr=Ln,Mc=c.forwardRef(({className:a,inset:t,children:s,...r},n)=>e.jsxs(Ea,{ref:n,className:T("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",a),...r,children:[s,e.jsx(Gt,{className:"ml-auto h-4 w-4"})]}));Mc.displayName=Ea.displayName;const Pc=c.forwardRef(({className:a,...t},s)=>e.jsx(Da,{ref:s,className:T("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));Pc.displayName=Da.displayName;const Ps=c.forwardRef(({className:a,...t},s)=>e.jsx(Mn,{children:e.jsx(Aa,{ref:s,className:T("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t})}));Ps.displayName=Aa.displayName;const it=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(Ra,{ref:r,className:T("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",a),...s}));it.displayName=Ra.displayName;const Lc=c.forwardRef(({className:a,children:t,checked:s,...r},n)=>e.jsxs(_a,{ref:n,className:T("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Fa,{children:e.jsx($e,{className:"h-4 w-4"})})}),t]}));Lc.displayName=_a.displayName;const Oc=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Ia,{ref:r,className:T("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Fa,{children:e.jsx(tr,{className:"h-2 w-2 fill-current"})})}),t]}));Oc.displayName=Ia.displayName;const zc=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(Ma,{ref:r,className:T("px-2 py-1.5 text-sm font-semibold text-foreground",t&&"pl-8",a),...s}));zc.displayName=Ma.displayName;const Xr=c.forwardRef(({className:a,...t},s)=>e.jsx(Pa,{ref:s,className:T("-mx-1 my-1 h-px bg-border",a),...t}));Xr.displayName=Pa.displayName;function ta({children:a,folderId:t,folderName:s,onRename:r,onDelete:n,onCreateSubfolder:o,disabled:i=!1}){return i?e.jsx(e.Fragment,{children:a}):e.jsxs(qr,{children:[e.jsx(Jr,{asChild:!0,children:a}),e.jsxs(Ps,{className:"w-48",children:[e.jsxs(it,{onClick:()=>r(t),children:[e.jsx(or,{className:"h-4 w-4 mr-2"}),"Rename Folder"]}),e.jsxs(it,{onClick:()=>o(t),children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"New Subfolder"]}),e.jsx(Xr,{}),e.jsxs(it,{onClick:()=>n(t),className:"text-destructive focus:text-destructive",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Delete Folder"]})]})]})}const $c=Vn,Uc=Hn,Qr=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(La,{ref:r,className:T("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...s,children:[t,e.jsx(On,{asChild:!0,children:e.jsx(ks,{className:"h-4 w-4 opacity-50"})})]}));Qr.displayName=La.displayName;const Zr=c.forwardRef(({className:a,...t},s)=>e.jsx(Oa,{ref:s,className:T("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(no,{className:"h-4 w-4"})}));Zr.displayName=Oa.displayName;const en=c.forwardRef(({className:a,...t},s)=>e.jsx(za,{ref:s,className:T("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(ks,{className:"h-4 w-4"})}));en.displayName=za.displayName;const tn=c.forwardRef(({className:a,children:t,position:s="popper",...r},n)=>e.jsx(zn,{children:e.jsxs($a,{ref:n,className:T("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...r,children:[e.jsx(Zr,{}),e.jsx($n,{className:T("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(en,{})]})}));tn.displayName=$a.displayName;const Bc=c.forwardRef(({className:a,...t},s)=>e.jsx(Ua,{ref:s,className:T("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...t}));Bc.displayName=Ua.displayName;const sn=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Ba,{ref:r,className:T("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Un,{children:e.jsx($e,{className:"h-4 w-4"})})}),e.jsx(Bn,{children:t})]}));sn.displayName=Ba.displayName;const Vc=c.forwardRef(({className:a,...t},s)=>e.jsx(Va,{ref:s,className:T("-mx-1 my-1 h-px bg-muted",a),...t}));Vc.displayName=Va.displayName;const Hc=[{value:"#3b82f6",label:"Blue"},{value:"#8b5cf6",label:"Purple"},{value:"#10b981",label:"Green"},{value:"#f59e0b",label:"Orange"},{value:"#ef4444",label:"Red"},{value:"#06b6d4",label:"Cyan"},{value:"#84cc16",label:"Lime"},{value:"#f97316",label:"Orange"}],gs=[{value:"Folder",label:"Folder",icon:Oe},{value:"Code",label:"Code",icon:oo},{value:"Palette",label:"Design",icon:ar},{value:"BookOpen",label:"Learning",icon:io},{value:"Star",label:"Favorites",icon:lo},{value:"Heart",label:"Personal",icon:co},{value:"Zap",label:"Quick",icon:ir},{value:"Target",label:"Goals",icon:uo},{value:"Lightbulb",label:"Ideas",icon:mo},{value:"Coffee",label:"Work",icon:fo}];function Wc({isOpen:a,onClose:t,onConfirm:s,parentId:r,initialData:n,mode:o="create"}){const[i,l]=c.useState(""),[m,f]=c.useState("#3b82f6"),[d,y]=c.useState("Folder");c.useEffect(()=>{a&&(n?(l(n.name),f(n.color),y(n.icon)):(l(""),f("#3b82f6"),y("Folder")))},[a]),c.useEffect(()=>{a&&n&&(l(n.name),f(n.color),y(n.icon))},[n,a]);const g=b=>{b.preventDefault(),i.trim()&&(s({name:i.trim(),color:m,icon:d,parentId:r}),t())},u=gs.find(b=>b.value===d)?.icon||Oe;return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ue,{className:"sm:max-w-md",children:[e.jsxs(ct,{children:[e.jsx(ut,{children:o==="create"?"Create New Folder":"Edit Folder"}),e.jsx(Kt,{children:o==="create"?"Create a new folder to organize your cards.":"Update folder details."})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"folder-name",children:"Folder Name"}),e.jsx(he,{id:"folder-name",value:i,onChange:b=>l(b.target.value),placeholder:"Enter folder name...",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{children:"Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Hc.map(b=>e.jsx("button",{type:"button",onClick:()=>f(b.value),className:`w-8 h-8 rounded-full border-2 transition-all ${m===b.value?"border-foreground scale-110":"border-muted hover:scale-105"}`,style:{backgroundColor:b.value},title:b.label},b.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{children:"Icon"}),e.jsxs($c,{value:d,onValueChange:y,children:[e.jsx(Qr,{children:e.jsx(Uc,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[L.createElement(u,{className:"h-4 w-4",style:{color:m}}),gs.find(b=>b.value===d)?.label]})})}),e.jsx(tn,{children:gs.map(b=>{const C=b.icon;return e.jsx(sn,{value:b.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),b.label]})},b.value)})})]})]}),r&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(K,{variant:"secondary",children:"Subfolder"})}),e.jsxs(dt,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),e.jsx(I,{type:"submit",disabled:!i.trim(),children:o==="create"?"Create Folder":"Save Changes"})]})]})]})})}const Gc=Gn,Yc=Wn,an=c.forwardRef(({className:a,...t},s)=>e.jsx(Ha,{className:T("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t,ref:s}));an.displayName=Ha.displayName;const rn=c.forwardRef(({className:a,...t},s)=>e.jsxs(Yc,{children:[e.jsx(an,{}),e.jsx(Wa,{ref:s,className:T("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...t})]}));rn.displayName=Wa.displayName;const nn=({className:a,...t})=>e.jsx("div",{className:T("flex flex-col space-y-2 text-center sm:text-left",a),...t});nn.displayName="AlertDialogHeader";const on=({className:a,...t})=>e.jsx("div",{className:T("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});on.displayName="AlertDialogFooter";const ln=c.forwardRef(({className:a,...t},s)=>e.jsx(Ga,{ref:s,className:T("text-lg font-semibold",a),...t}));ln.displayName=Ga.displayName;const cn=c.forwardRef(({className:a,...t},s)=>e.jsx(Ya,{ref:s,className:T("text-sm text-muted-foreground",a),...t}));cn.displayName=Ya.displayName;const dn=c.forwardRef(({className:a,...t},s)=>e.jsx(Ka,{ref:s,className:T(As(),a),...t}));dn.displayName=Ka.displayName;const un=c.forwardRef(({className:a,...t},s)=>e.jsx(qa,{ref:s,className:T(As({variant:"outline"}),"mt-2 sm:mt-0",a),...t}));un.displayName=qa.displayName;function Kc({isOpen:a,onClose:t,onConfirm:s,folderName:r,cardCount:n,hasSubfolders:o=!1,subfolderCount:i=0}){const l=()=>{s(),t()};return e.jsx(Gc,{open:a,onOpenChange:t,children:e.jsxs(rn,{children:[e.jsxs(nn,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-destructive"}),e.jsx(ln,{children:"Delete Folder"})]}),e.jsxs(cn,{className:"space-y-3",children:[e.jsxs("p",{children:["Are you sure you want to delete the folder ",e.jsxs("strong",{children:['"',r,'"']}),"?"]}),e.jsxs("div",{className:"bg-destructive/10 p-3 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:"This action will permanently delete:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n>0&&e.jsxs(K,{variant:"destructive",children:[n," card",n!==1?"s":""]}),o&&i>0&&e.jsxs(K,{variant:"destructive",children:[i," subfolder",i!==1?"s":""]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone."})]})]}),e.jsxs(on,{children:[e.jsx(un,{children:"Cancel"}),e.jsx(dn,{onClick:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Forever"})]})]})})}function qc({children:a,tagName:t,onRename:s,onDelete:r,disabled:n=!1}){const o=()=>{n||s(t)},i=()=>{n||r(t)};return n?e.jsx(e.Fragment,{children:a}):e.jsxs(qr,{children:[e.jsx(Jr,{asChild:!0,children:a}),e.jsxs(Ps,{className:"w-48",children:[e.jsxs(it,{onClick:o,className:"flex items-center gap-2",children:[e.jsx(or,{className:"h-4 w-4"}),"Rename Tag"]}),e.jsxs(it,{onClick:i,className:"flex items-center gap-2 text-destructive focus:text-destructive",children:[e.jsx(Ss,{className:"h-4 w-4"}),"Delete Tag"]})]})]})}function Jc({isOpen:a,onClose:t,onConfirm:s,tagName:r,existingTags:n}){const[o,i]=c.useState(""),[l,m]=c.useState("");c.useEffect(()=>{a&&(i(r),m(""))},[a,r]);const f=g=>{const u=g.trim();return u?u===r?"Please enter a different name":n.includes(u)?"A tag with this name already exists":u.length>50?"Tag name must be less than 50 characters":"":"Tag name cannot be empty"},d=()=>{const g=o.trim(),u=f(g);if(u){m(u);return}s(r,g),t()},y=g=>{g.key==="Enter"&&d()};return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ue,{className:"sm:max-w-md",children:[e.jsxs(ct,{children:[e.jsx(ut,{children:"Rename Tag"}),e.jsxs(Kt,{children:['Enter a new name for the tag "',r,'". This will update all cards using this tag.']})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"tag-name",children:"Tag Name"}),e.jsx(he,{id:"tag-name",value:o,onChange:g=>{i(g.target.value),l&&m("")},onKeyPress:y,placeholder:"Enter tag name...",autoFocus:!0}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-destructive",children:[e.jsx(be,{className:"h-4 w-4"}),l]})]})}),e.jsxs(dt,{children:[e.jsx(I,{variant:"outline",onClick:t,children:"Cancel"}),e.jsx(I,{onClick:d,disabled:!!l||!o.trim(),children:"Rename Tag"})]})]})})}function Xc({isOpen:a,onClose:t,onConfirm:s,tagName:r,cardCount:n}){return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsxs(Ue,{className:"sm:max-w-md",children:[e.jsxs(ct,{children:[e.jsxs(ut,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-destructive"}),"Delete Tag"]}),e.jsxs(Kt,{children:['Are you sure you want to delete the tag "',r,'"?']})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"rounded-lg bg-destructive/10 p-4 border border-destructive/20",children:[e.jsx("p",{className:"text-sm text-destructive font-medium mb-2",children:"This action cannot be undone."}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["This tag will be removed from ",e.jsx("strong",{children:n})," ",n===1?"card":"cards","."]})]})}),e.jsxs(dt,{children:[e.jsx(I,{variant:"outline",onClick:t,children:"Cancel"}),e.jsx(I,{variant:"destructive",onClick:s,children:"Delete Tag"})]})]})})}const Qc=({tag:a,isSelected:t,onClick:s,className:r,showCount:n=!0})=>e.jsxs("button",{onClick:()=>s(a),className:T("relative flex items-center justify-between px-3 py-2 rounded-xl border transition-all duration-300 ease-out","hover:shadow-lg hover:shadow-black/10 active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-blue-500/30","backdrop-blur-sm group",t?"bg-gradient-to-r from-blue-500 to-blue-600 border-blue-500 text-white shadow-md shadow-blue-500/25":"bg-white/80 border-gray-200/60 text-gray-700 hover:bg-white hover:border-gray-300/80",r),style:{boxShadow:t?"0 4px 20px -4px rgba(59, 130, 246, 0.3), 0 0 0 1px rgba(59, 130, 246, 0.1)":void 0},children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:T("w-2 h-2 rounded-full flex-shrink-0 transition-all duration-300",t?"bg-white/90 shadow-sm":"shadow-sm"),style:{backgroundColor:t?"rgba(255, 255, 255, 0.9)":a.color,boxShadow:t?"0 1px 3px rgba(0, 0, 0, 0.1)":`0 1px 3px ${a.color}40`}}),e.jsx("span",{className:T("text-sm font-medium truncate transition-all duration-300",t?"text-white":"text-gray-700 group-hover:text-gray-900"),children:a.name}),t&&e.jsx($e,{className:"w-3.5 h-3.5 text-white/90 flex-shrink-0 animate-in fade-in-0 zoom-in-95 duration-200"})]}),n&&e.jsx("span",{className:T("text-xs font-medium px-2 py-0.5 rounded-full ml-2 flex-shrink-0 transition-all duration-300",t?"text-blue-600 bg-white/90 shadow-sm":"text-gray-500 bg-gray-100/80 group-hover:bg-gray-200/80 group-hover:text-gray-600"),children:a.count})]}),Zc=({tags:a,selectedTags:t,onTagClick:s,className:r,emptyMessage:n="No tags found"})=>a.length===0?e.jsx("div",{className:T("text-center py-8 text-gray-500",r),children:e.jsx("p",{className:"text-sm",children:n})}):e.jsx("div",{className:T("grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",r),children:a.map(o=>e.jsx(Qc,{tag:o,isSelected:t.includes(o.name),onClick:s},o.id))}),ed=({onSearch:a,onCreateTag:t,searchResults:s,searchQuery:r,className:n})=>{const[o,i]=c.useState(r);c.useEffect(()=>{i(r)},[r]);const l=d=>{const y=d.target.value;i(y),a(y)},m=()=>{o.trim()&&(t(o.trim()),i(""),a(""))},f=o.trim()&&s.length===0&&!s.some(d=>d.name.toLowerCase()===o.toLowerCase());return e.jsxs("div",{className:T("space-y-3",n),children:[e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(he,{placeholder:"Search tags or create new...",value:o,onChange:l,className:"pl-11 pr-4 py-3 rounded-2xl border-gray-200/60 bg-gray-50/50 backdrop-blur-sm focus:bg-white focus:border-blue-300 transition-all duration-300"})]}),f&&e.jsxs(I,{onClick:m,variant:"outline",className:"w-full justify-start text-left rounded-xl border-dashed border-2 border-gray-300 hover:border-blue-400 hover:bg-blue-50/50 transition-all duration-300 py-3",children:[e.jsx(zt,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsxs("span",{className:"text-gray-700",children:['Create tag "',e.jsx("span",{className:"font-medium text-blue-600",children:o}),'"']})]})]})},td=({isOpen:a,onClose:t,currentCardTags:s,onTagsChange:r})=>{const{tags:n,searchTags:o,dispatch:i,createTagIfNotExists:l}=fr(),[m,f]=c.useState(""),[d,y]=c.useState([]),[g,u]=c.useState(s);c.useEffect(()=>{if(m.trim()){const h=o(m);y(h)}else{const h=[...n].sort((x,v)=>v.count-x.count);y(h)}},[m,n,o]),c.useEffect(()=>{u(s)},[s]);const b=h=>{f(h)},C=h=>{i({type:"CREATE_TAG",payload:{name:h,color:"#3b82f6"}});const x=[...g,h];u(x),r(x),f("")},j=h=>{const x=g.includes(h.name);let v;x?v=g.filter(k=>k!==h.name):v=[...g,h.name],u(v),r(v)},p=()=>{f(""),t()};return a?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.15)",backdropFilter:"blur(8px)"},children:[e.jsx("div",{className:"absolute inset-0",onClick:p}),e.jsxs("div",{className:"relative bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200/50 p-6 w-full max-w-sm sm:max-w-md lg:max-w-2xl max-h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Manage Tags"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Select tags for this card"})]}),e.jsx("button",{onClick:p,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ye,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx(ed,{onSearch:b,onCreateTag:C,searchResults:d,searchQuery:m,className:"mb-4"}),g.length>0&&e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100/50",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-700 mb-3",children:["Selected tags (",g.length,"):"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:g.map(h=>e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-sm",children:h},h))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Zc,{tags:d,selectedTags:g,onTagClick:j,emptyMessage:m?`No tags found for "${m}"`:"No tags available"})}),e.jsx("div",{className:"text-xs text-gray-400 text-center mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-300"}),e.jsx("span",{children:"Click tags to add/remove them from this card"}),e.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-300"})]})})]})]}):null},sd=()=>{const{isOpen:a,currentCardTags:t,onTagsChange:s,closeTagPanel:r}=wr();return!a||!s?null:e.jsx(td,{isOpen:a,onClose:r,currentCardTags:t,onTagsChange:s})};class ad{static generateSuggestions(t){const s=[];switch(t.type){case"card_content":s.push(...this.generateCardContentSuggestions(t));break;case"folder_name":s.push(...this.generateFolderNameSuggestions(t));break;case"tag_rename":s.push(...this.generateTagRenameSuggestions(t));break;default:s.push(this.getDefaultSuggestion())}return s.sort((r,n)=>n.confidence-r.confidence)}static generateCardContentSuggestions(t){const s=[],{localVersion:r,remoteVersion:n}=t,o=this.calculateSimilarity(r.content.frontContent.title,n.content.frontContent.title),i=this.calculateSimilarity(r.content.frontContent.text,n.content.frontContent.text),m=Math.abs(r.updatedAt.getTime()-n.updatedAt.getTime())<5*60*1e3,f=r.content.frontContent.text.length,d=n.content.frontContent.text.length,y=Math.max(f,d)/Math.min(f,d);o>.8&&i>.6&&m&&s.push({type:"merge",confidence:.9,reason:"内容高度相似，建议智能合并保留最佳内容",preview:{mergedTitle:this.mergeTitles(r.content.frontContent.title,n.content.frontContent.title),mergedLength:Math.max(f,d)}}),n.updatedAt.getTime()>r.updatedAt.getTime()&&y>2&&d>f&&s.push({type:"keep_remote",confidence:.8,reason:"远程版本内容更丰富且更新时间更近"});const g=new Set(r.content.frontContent.tags),u=new Set(n.content.frontContent.tags),b=[...g].filter(j=>!u.has(j));b.length>0&&b.length/g.size>.3&&s.push({type:"keep_local",confidence:.7,reason:"本地版本包含独特标签，可能包含重要分类信息"});const C=r.updatedAt.getTime()>n.updatedAt.getTime()?"local":"remote";return s.push({type:C==="local"?"keep_local":"keep_remote",confidence:.6,reason:`保留最新版本（${C==="local"?"本地":"远程"}设备）`}),s}static generateFolderNameSuggestions(t){const s=[],{localVersion:r,remoteVersion:n}=t,o=r.name.toLowerCase(),i=n.name.toLowerCase();if(o===i)return[];if(this.calculateSimilarity(r.name,n.name)>.8&&s.push({type:"merge",confidence:.9,reason:"文件夹名称相似，建议统一命名"}),o.includes(i)||i.includes(o)){const f=r.name.length>n.name.length?"local":"remote";s.push({type:f==="local"?"keep_local":"keep_remote",confidence:.8,reason:"保留更具描述性的文件夹名称"})}const m=r.updatedAt.getTime()>n.updatedAt.getTime()?"local":"remote";return s.push({type:m==="local"?"keep_local":"keep_remote",confidence:.6,reason:`保留最新修改的版本（${m==="local"?"本地":"远程"}）`}),s}static generateTagRenameSuggestions(t){const s=[],{localVersion:r,remoteVersion:n}=t,o=r.count/Math.max(n.count,1);o>2?s.push({type:"keep_local",confidence:.9,reason:`本地标签使用频率更高（${r.count}次 vs ${n.count}次）`}):o<.5&&s.push({type:"keep_remote",confidence:.9,reason:`远程标签使用频率更高（${n.count}次 vs ${r.count}次）`});const i=this.evaluateTagNameQuality(r.name),l=this.evaluateTagNameQuality(n.name);if(Math.abs(i-l)>.3){const f=i>l?"local":"remote";s.push({type:f==="local"?"keep_local":"keep_remote",confidence:.8,reason:`${f==="local"?"本地":"远程"}标签名称质量更好`})}const m=r.updatedAt.getTime()>n.updatedAt.getTime()?"local":"remote";return s.push({type:m==="local"?"keep_local":"keep_remote",confidence:.6,reason:"保留最新修改的版本"}),s}static calculateSimilarity(t,s){if(!t||!s)return 0;const r=t.toLowerCase().trim(),n=s.toLowerCase().trim();if(r===n)return 1;const o=Math.max(r.length,n.length);return o===0?1:1-this.levenshteinDistance(r,n)/o}static levenshteinDistance(t,s){const r=Array(s.length+1).fill(null).map(()=>Array(t.length+1).fill(null));for(let n=0;n<=t.length;n+=1)r[0][n]=n;for(let n=0;n<=s.length;n+=1)r[n][0]=n;for(let n=1;n<=s.length;n+=1)for(let o=1;o<=t.length;o+=1){const i=t[o-1]===s[n-1]?0:1;r[n][o]=Math.min(r[n][o-1]+1,r[n-1][o]+1,r[n-1][o-1]+i)}return r[s.length][t.length]}static mergeTitles(t,s){if(t===s||t.includes(s)&&t.length>s.length)return t;if(s.includes(t)&&s.length>t.length)return s;const r=new Set(t.toLowerCase().split(/\s+/)),n=new Set(s.toLowerCase().split(/\s+/)),o=new Set([...r,...n]),i=t.split(/\s+/),l=s.split(/\s+/),m=[];return i.forEach(f=>{!m.includes(f)&&o.has(f.toLowerCase())&&m.push(f)}),l.forEach(f=>{!m.includes(f)&&o.has(f.toLowerCase())&&m.push(f)}),m.join(" ")}static evaluateTagNameQuality(t){let s=.5;t.length>=3&&t.length<=20&&(s+=.2),t.length>30&&(s-=.1),/^[a-zA-Z0-9\u4e00-\u9fff\s\-_]+$/.test(t)&&(s+=.2),(t===t.toLowerCase()||/^[A-Z][a-z]+([A-Z][a-z]*)*$/.test(t))&&(s+=.1);const n=t.match(/[^a-zA-Z0-9\u4e00-\u9fff\s]/g);return n&&n.length>2&&(s-=.1),Math.max(0,Math.min(1,s))}static getDefaultSuggestion(){return{type:"manual",confidence:.5,reason:"无法自动确定最佳解决方案，建议手动处理"}}static applyResolution(t,s){switch(s.type){case"keep_local":return this.getLocalVersion(t);case"keep_remote":return this.getRemoteVersion(t);case"merge":return this.mergeVersions(t,s.mergedData);case"manual":return s.mergedData||s.manualChanges;default:throw new Error(`Unknown resolution type: ${s.type}`)}}static getLocalVersion(t){return t.entityType==="card",t.localVersion}static getRemoteVersion(t){return t.entityType==="card",t.remoteVersion}static mergeVersions(t,s){return s||this.smartMerge(t)}static smartMerge(t){if(t.entityType==="card"){const s=t,r=s.localVersion,n=s.remoteVersion;return{content:{frontContent:{title:this.mergeTitles(r.content.frontContent.title,n.content.frontContent.title),text:this.mergeText(r.content.frontContent.text,n.content.frontContent.text),tags:[...new Set([...r.content.frontContent.tags,...n.content.frontContent.tags])],lastModified:new Date},backContent:{title:this.mergeTitles(r.content.backContent.title,n.content.backContent.title),text:this.mergeText(r.content.backContent.text,n.content.backContent.text),tags:[...new Set([...r.content.backContent.tags,...n.content.backContent.tags])],lastModified:new Date}},style:r.style,folderId:r.folderId,isFlipped:r.isFlipped,updatedAt:new Date}}return this.getLocalVersion(t)}static mergeText(t,s){if(t===s)return t;const r=t.split(/[.!?]+/).filter(i=>i.trim()),n=s.split(/[.!?]+/).filter(i=>i.trim()),o=new Set([...r.map(i=>i.trim()),...n.map(i=>i.trim())]);return`${Array.from(o).filter(i=>i.length>0).join(". ")}.`}}function Zt(){const[a,t]=c.useState([]),[s,r]=c.useState(null),[n,o]=c.useState(!1),[i,l]=c.useState(!1),[m,f]=c.useState(null),[d,y]=c.useState(null),[g,u]=c.useState(null),b=c.useRef({totalConflicts:0,resolvedConflicts:0,pendingConflicts:0,conflictsByType:{},conflictsBySeverity:{},averageResolutionTime:0});c.useEffect(()=>{const R={totalConflicts:a.length,resolvedConflicts:a.filter(A=>A.status==="resolved").length,pendingConflicts:a.filter(A=>A.status==="pending").length,conflictsByType:{},conflictsBySeverity:{},averageResolutionTime:k()};a.forEach(A=>{R.conflictsByType[A.type]=(R.conflictsByType[A.type]||0)+1,R.conflictsBySeverity[A.severity]=(R.conflictsBySeverity[A.severity]||0)+1}),b.current=R},[a]),c.useEffect(()=>{C();const R=setInterval(()=>{N()},5e3);return()=>{clearInterval(R)}},[]);const C=async()=>{l(!0);try{await j(),await N(),f(null)}catch(R){console.error("Failed to initialize conflict management:",R),f(R instanceof Error?R.message:"Unknown error")}finally{l(!1)}},j=async()=>{try{const R=re.getConflicts(),A=p(R);return t(A),A}catch(R){return console.error("Failed to load conflicts from service:",R),[]}},p=R=>R.map(A=>{const E={id:A.id,type:h(A.conflictType),entityType:A.entityType,entityId:A.entityId,timestamp:A.detectedAt||new Date,sourceDevice:A.sourceDevice||"Unknown",severity:A.severity,status:x(A.status),createdAt:A.detectedAt||new Date,resolvedAt:A.resolvedAt,resolvedBy:A.resolvedBy,resolution:A.resolution?v(A.resolution):void 0};switch(A.entityType){case"card":return{...E,type:"card_content",localVersion:A.localData,remoteVersion:A.cloudData,conflictFields:A.conflictFields||[],suggestions:A.suggestions?.map(O=>({type:O.type,confidence:O.confidence,reason:O.reasoning||O.reason,preview:O.preview}))};case"folder":return{...E,type:"folder_name",localVersion:A.localData,remoteVersion:A.cloudData,affectedCards:A.conflictDetails?.affectedEntities||[]};case"tag":return{...E,type:"tag_rename",localVersion:A.localData,remoteVersion:A.cloudData,affectedCards:A.conflictDetails?.affectedEntities||[]};default:throw new Error(`Unknown entity type: ${A.entityType}`)}}),h=R=>({content:"card_content",version:"card_content",structure:"folder_structure",delete:"tag_delete",field:"card_content"})[R]||"card_content",x=R=>({pending:"pending",resolving:"reviewing",resolved:"resolved",manual_required:"pending"})[R]||"pending",v=R=>({type:R.type,mergedData:R.mergedData,reason:R.reasoning,manualChanges:R.manualChanges}),k=()=>{const R=a.filter(E=>E.status==="resolved"&&E.resolvedAt);return R.length===0?0:R.reduce((E,O)=>E+(O.resolvedAt.getTime()-O.createdAt.getTime()),0)/R.length},N=async()=>{try{const R=re.getStatus();u(R),R.isSyncing===!1&&R.networkStatus?.online&&await w()}catch(R){console.error("Failed to update sync status:",R)}},w=async()=>{try{const R=await j();R.filter(E=>E.status==="pending").length>a.filter(E=>E.status==="pending").length&&t(R)}catch(R){console.error("Failed to detect new conflicts:",R)}},S=c.useCallback(R=>a.find(A=>A.id===R),[a]),D=c.useCallback(()=>a.filter(R=>R.status==="pending"),[a]),B=c.useCallback(()=>a.filter(R=>R.severity==="high"||R.severity==="critical"),[a]),_=c.useCallback(()=>({...b.current}),[]),U=c.useCallback(async(R,A)=>{o(!0),f(null);try{if(await re.resolveConflict(R,A.type,A.mergedData))return t(O=>O.map(H=>H.id===R?{...H,status:"resolved",resolvedAt:new Date,resolvedBy:"user",resolution:A}:H)),r(null),await N(),!0;throw new Error("Failed to resolve conflict via sync service")}catch(E){return console.error("Failed to resolve conflict:",E),f(E instanceof Error?E.message:"Unknown error"),!1}finally{o(!1)}},[]),J=c.useCallback(async R=>{try{if(!a.find(E=>E.id===R))return;t(E=>E.map(O=>O.id===R?{...O,status:"ignored"}:O)),r(null)}catch(A){console.error("Failed to ignore conflict:",A),f(A instanceof Error?A.message:"Unknown error")}},[a]),$=c.useCallback(async(R,A)=>{o(!0),f(null);try{const E=await Promise.allSettled(R.map(M=>re.resolveConflict(M,A.type,A.mergedData))),O=E.filter(M=>M.status==="fulfilled").length,H=E.filter(M=>M.status==="rejected").length;if(O>0&&t(M=>M.map(V=>R.includes(V.id)?{...V,status:"resolved",resolvedAt:new Date,resolvedBy:"user",resolution:A}:V)),H>0)throw new Error(`${H} conflicts failed to resolve`);return await N(),!0}catch(E){return console.error("Failed to batch resolve conflicts:",E),f(E instanceof Error?E.message:"Unknown error"),!1}finally{o(!1)}},[]),X=c.useCallback(R=>{const A=S(R);if(!A)return[];const E=ad.generateSuggestions(A),O=re.getConflict(R)?.suggestions||[];return[...E,...O.map(M=>({type:M.type,confidence:M.confidence,reason:M.reasoning||M.reason,preview:M.preview}))].sort((M,V)=>V.confidence-M.confidence)},[S]),te=c.useCallback(async()=>{l(!0);try{const R=await re.sync({type:"incremental",direction:"bidirectional"}),A=await j(),E=A.filter(O=>O.status==="pending");return t(A),E}catch(R){return console.error("Failed to detect conflicts:",R),f(R instanceof Error?R.message:"Unknown error"),[]}finally{l(!1)}},[]),ee=c.useCallback(async()=>{o(!0);try{const R=await re.autoResolveConflicts();return await j(),await N(),R}catch(R){return console.error("Failed to auto-resolve conflicts:",R),f(R instanceof Error?R.message:"Unknown error"),0}finally{o(!1)}},[]),ue=c.useCallback(async R=>{try{const A=S(R);if(!A)return null;const E=re.getConflict(R);return{...A,syncDetails:E,suggestions:X(R)}}catch(A){return console.error("Failed to get conflict details:",A),null}},[S,X]),P=c.useCallback(async()=>{l(!0);try{await j(),await N(),f(null)}catch(R){console.error("Failed to refresh conflicts:",R),f(R instanceof Error?R.message:"Unknown error")}finally{l(!1)}},[]),G=c.useCallback(()=>{f(null)},[]);return{conflicts:a,selectedConflict:s,setSelectedConflict:r,isResolving:n,isLoading:i,error:m,syncStatus:g,metrics:d,stats:{...b.current},getConflictById:S,getPendingConflicts:D,getHighPriorityConflicts:B,getStats:_,resolveConflict:U,ignoreConflict:J,batchResolveConflicts:$,getSuggestions:X,detectConflicts:te,autoResolveConflicts:ee,getConflictDetails:ue,refreshConflicts:P,clearError:G}}const rd=Wt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Cs=c.forwardRef(({className:a,variant:t,...s},r)=>e.jsx("div",{ref:r,role:"alert",className:T(rd({variant:t}),a),...s}));Cs.displayName="Alert";const mn=c.forwardRef(({className:a,...t},s)=>e.jsx("h5",{ref:s,className:T("mb-1 font-medium leading-none tracking-tight",a),...t}));mn.displayName="AlertTitle";const fn=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:T("text-sm [&_p]:leading-relaxed",a),...t}));fn.displayName="AlertDescription";function nd({className:a,onOpenConflictPanel:t}){const{stats:s,getHighPriorityConflicts:r,detectConflicts:n,setSelectedConflict:o}=Zt(),i=r();if(!(s.pendingConflicts>0))return null;const m=async()=>{await n()},f=y=>{o(y),t?.()},d=y=>{switch(y){case"critical":return"bg-red-500 text-white";case"high":return"bg-orange-500 text-white";case"medium":return"bg-yellow-500 text-white";case"low":return"bg-blue-500 text-white";default:return"bg-gray-500 text-white"}};return e.jsxs("div",{className:T("space-y-2",a),children:[e.jsxs(Cs,{className:"border-orange-200 bg-orange-50",children:[e.jsx(ve,{className:"h-4 w-4 text-orange-600"}),e.jsx(mn,{className:"text-orange-800",children:"检测到数据冲突"}),e.jsxs(fn,{className:"text-orange-700",children:["发现 ",s.pendingConflicts," 个待解决的数据冲突，建议及时处理以避免数据丢失。",i.length>0&&e.jsxs("span",{className:"ml-2 font-medium",children:["其中 ",i.length," 个需要立即处理。"]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:t,className:"text-orange-700 border-orange-300 hover:bg-orange-100",children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),"查看所有冲突"]}),e.jsxs(I,{variant:"ghost",size:"sm",onClick:m,className:"text-orange-600 hover:bg-orange-100",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"刷新检测"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{variant:"secondary",className:"text-orange-700 bg-orange-100",children:["总计: ",s.totalConflicts]}),e.jsxs(K,{variant:"destructive",className:"bg-red-100 text-red-700",children:["待解决: ",s.pendingConflicts]})]})]})]}),i.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-red-700",children:"高优先级冲突"}),e.jsxs(K,{variant:"destructive",className:"text-xs",children:[i.length," 个"]})]}),i.slice(0,3).map(y=>e.jsx(Cs,{className:"border-red-200 bg-red-50 cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>f(y.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{variant:"outline",className:T("text-xs",d(y.severity)),children:y.severity}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:od(y)}),e.jsx("p",{className:"text-xs text-red-600",children:id(y)})]})]}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-100",onClick:g=>{g.stopPropagation(),f(y.id)},children:e.jsx(zs,{className:"h-4 w-4"})})]})},y.id)),i.length>3&&e.jsxs(I,{variant:"ghost",size:"sm",onClick:t,className:"w-full text-red-600 hover:bg-red-100",children:["查看剩余 ",i.length-3," 个高优先级冲突"]})]})]})}function od(a){switch(a.type){case"card_content":return"卡片内容冲突";case"card_style":return"卡片样式冲突";case"card_tags":return"卡片标签冲突";case"card_folder":return"卡片文件夹冲突";case"folder_name":return"文件夹名称冲突";case"folder_structure":return"文件夹结构冲突";case"tag_rename":return"标签重命名冲突";case"tag_delete":return"标签删除冲突";case"tag_color":return"标签颜色冲突";default:return"数据冲突"}}function id(a){switch(a.type){case"card_content":return`卡片 "${a.localVersion.content.frontContent.title}" 在多设备上被同时编辑`;case"folder_name":return`文件夹 "${a.localVersion.name}" 与远程版本名称不一致`;case"tag_rename":return`标签 "${a.localVersion.name}" 重命名冲突`;default:return"数据版本不一致，需要手动解决"}}const se=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:T("rounded-lg border bg-card text-card-foreground shadow-sm",a),...t}));se.displayName="Card";const Fe=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:T("flex flex-col space-y-1.5 p-6",a),...t}));Fe.displayName="CardHeader";const Ie=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:T("text-2xl font-semibold leading-none tracking-tight",a),...t}));Ie.displayName="CardTitle";const hn=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:T("text-sm text-muted-foreground",a),...t}));hn.displayName="CardDescription";const ae=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:T("p-6 pt-0",a),...t}));ae.displayName="CardContent";const ld=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:T("flex items-center p-6 pt-0",a),...t}));ld.displayName="CardFooter";const We=c.forwardRef(({className:a,value:t,...s},r)=>e.jsx(Ja,{ref:r,className:T("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...s,children:e.jsx(Yn,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));We.displayName=Ja.displayName;class at{static instance;metrics=[];alerts=[];observers=[];sessionId;startTime;constructor(){this.sessionId=this.generateSessionId(),this.startTime=performance.now(),this.initializeObservers()}static getInstance(){return at.instance||(at.instance=new at),at.instance}initializeObservers(){"PerformanceObserver"in window&&(this.observePaintTiming(),this.observeLayoutShift(),this.observeInteraction()),this.observeMemoryUsage(),this.observeNetworkPerformance(),this.observeErrors(),this.startPeriodicCollection()}observePaintTiming(){try{const t=new PerformanceObserver(s=>{s.getEntries().forEach(n=>{n.name==="first-paint"?this.updateMetric("firstPaint",n.startTime):n.name==="first-contentful-paint"&&this.updateMetric("firstContentfulPaint",n.startTime)})});t.observe({entryTypes:["paint"]}),this.observers.push(t)}catch(t){console.warn("Failed to observe paint timing:",t)}}observeLayoutShift(){try{const t=new PerformanceObserver(s=>{const r=s.getEntries();let n=0;r.forEach(o=>{o instanceof LayoutShift&&(n+=o.value)}),this.updateMetric("cumulativeLayoutShift",n)});t.observe({entryTypes:["layout-shift"]}),this.observers.push(t)}catch(t){console.warn("Failed to observe layout shift:",t)}}observeInteraction(){try{const t=new PerformanceObserver(s=>{s.getEntries().forEach(n=>{n instanceof PerformanceEventTiming&&(this.updateMetric("interactionTime",n.duration),this.updateMetric("firstInputDelay",n.processingStart-n.startTime))})});t.observe({entryTypes:["first-input","event"]}),this.observers.push(t)}catch(t){console.warn("Failed to observe interactions:",t)}}observeMemoryUsage(){setInterval(()=>{if("memory"in performance){const t=performance.memory;this.updateMetric("memoryUsage",t.usedJSHeapSize),t.jsHeapSizeLimit-t.usedJSHeapSize<t.jsHeapSizeLimit*.1&&this.createAlert({type:"warning",category:"memory",message:"High memory usage detected",severity:"medium",suggestions:["Check for memory leaks","Consider garbage collection"]})}},5e3)}observeNetworkPerformance(){const t=window.fetch;window.fetch=async(...s)=>{const r=performance.now();try{const n=await t(...s),o=performance.now();return this.updateMetric("requestTime",o-r),n}catch(n){const o=performance.now();throw this.updateMetric("requestTime",o-r),n}}}observeErrors(){window.addEventListener("error",t=>{this.createAlert({type:"error",category:"performance",message:`JavaScript error: ${t.message}`,severity:"high",context:{filename:t.filename,lineno:t.lineno,colno:t.colno}})}),window.addEventListener("unhandledrejection",t=>{this.createAlert({type:"error",category:"performance",message:`Unhandled promise rejection: ${t.reason}`,severity:"high"})})}startPeriodicCollection(){setInterval(()=>{this.collectMetrics()},3e4)}collectMetrics(){const t={renderTime:this.calculateRenderTime(),firstPaint:this.getMetric("firstPaint")||0,firstContentfulPaint:this.getMetric("firstContentfulPaint")||0,largestContentfulPaint:this.getLCP(),cumulativeLayoutShift:this.getMetric("cumulativeLayoutShift")||0,firstInputDelay:this.getMetric("firstInputDelay")||0,interactionTime:this.getMetric("interactionTime")||0,clickLatency:this.measureClickLatency(),scrollPerformance:this.measureScrollPerformance(),inputResponsiveness:this.measureInputResponsiveness(),memoryUsage:this.getMemoryUsage(),memoryLeakDetected:this.detectMemoryLeak(),garbageCollectionTime:this.measureGarbageCollection(),networkLatency:this.measureNetworkLatency(),requestTime:this.getMetric("requestTime")||0,resourceLoadTime:this.measureResourceLoadTime(),conflictDetectionTime:this.getMetric("conflictDetectionTime")||0,conflictResolutionTime:this.getMetric("conflictResolutionTime")||0,batchOperationTime:this.getMetric("batchOperationTime")||0,perceivedPerformance:this.calculatePerceivedPerformance(),errorRate:this.calculateErrorRate(),crashRate:this.calculateCrashRate(),userSatisfaction:this.calculateUserSatisfaction(),timestamp:new Date,sessionId:this.sessionId};this.metrics.push(t),this.analyzeMetrics(t)}startConflictDetection(){const t=performance.now();return()=>{const s=performance.now();this.updateMetric("conflictDetectionTime",s-t)}}startConflictResolution(){const t=performance.now();return()=>{const s=performance.now();this.updateMetric("conflictResolutionTime",s-t)}}startBatchOperation(){const t=performance.now();return()=>{const s=performance.now();this.updateMetric("batchOperationTime",s-t)}}trackUserInteraction(t,s,r){this.updateMetric(`${t}Duration`,s),r||this.createAlert({type:"warning",category:"ux",message:`User interaction failed: ${t}`,severity:"medium"})}trackUserSatisfaction(t,s){this.updateMetric("userSatisfaction",t),s&&console.log("User feedback:",s)}analyzeMetrics(t){t.renderTime>100&&this.createAlert({type:"warning",category:"performance",message:"Slow render time detected",severity:"medium",suggestions:["Optimize component rendering","Consider virtualization"]}),t.memoryUsage>100*1024*1024&&this.createAlert({type:"warning",category:"memory",message:"High memory usage detected",severity:"medium",suggestions:["Check for memory leaks","Optimize data structures"]}),t.networkLatency>1e3&&this.createAlert({type:"warning",category:"network",message:"High network latency detected",severity:"medium",suggestions:["Check network connection","Optimize API calls"]}),t.conflictResolutionTime>5e3&&this.createAlert({type:"warning",category:"performance",message:"Slow conflict resolution detected",severity:"medium",suggestions:["Optimize conflict resolution algorithm","Consider caching"]})}generateReport(t=36e5){const s=new Date,r=new Date(s.getTime()-t),n=this.metrics.filter(i=>i.timestamp>=r&&i.timestamp<=s),o=this.calculateUserExperienceMetrics(n);return{period:{start:r,end:s},metrics:n,userExperience:o,alerts:this.alerts.filter(i=>i.timestamp>=r),summary:{averagePerformance:this.calculateAveragePerformance(n),performanceTrend:this.calculatePerformanceTrend(n),criticalIssues:this.alerts.filter(i=>i.severity==="critical").length,recommendations:this.generateRecommendations(n,o)}}}updateMetric(t,s){const r=this.metrics[this.metrics.length-1];r&&(r[t]=s)}getMetric(t){const s=this.metrics[this.metrics.length-1];return s?s[t]:null}calculateRenderTime(){const t=performance.getEntriesByType("navigation")[0];return t?t.loadEventEnd-t.loadEventStart:0}getLCP(){const t=performance.getEntriesByType("largest-contentful-paint")[0];return t?t.startTime:0}measureClickLatency(){return 0}measureScrollPerformance(){return 0}measureInputResponsiveness(){return 0}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize:0}detectMemoryLeak(){return!1}measureGarbageCollection(){return 0}measureNetworkLatency(){return 0}measureResourceLoadTime(){return 0}calculatePerceivedPerformance(){return 85}calculateErrorRate(){return .01}calculateCrashRate(){return .001}calculateUserSatisfaction(){return 85}calculateUserExperienceMetrics(t){return{averageTaskCompletionTime:0,taskSuccessRate:.95,clickCount:0,scrollDepth:0,timeOnPage:0,bounceRate:.1,conflictResolutionSuccess:.9,conflictResolutionAttempts:0,averageResolutionTime:0,userPreferredResolution:"auto",interfaceResponsiveness:85,loadingTime:0,errorEncounterRate:.02,satisfactionScore:85,feedbackCount:0,commonComplaints:[]}}calculateAveragePerformance(t){return t.length===0?0:t.reduce((r,n)=>r+n.perceivedPerformance,0)/t.length}calculatePerformanceTrend(t){if(t.length<2)return"stable";const s=t.slice(-10),r=t.slice(-20,-10),n=s.reduce((i,l)=>i+l.perceivedPerformance,0)/s.length,o=r.reduce((i,l)=>i+l.perceivedPerformance,0)/r.length;return n>o+5?"improving":n<o-5?"declining":"stable"}generateRecommendations(t,s){const r=[];return s.conflictResolutionSuccess<.8&&r.push("Improve conflict resolution algorithms"),s.interfaceResponsiveness<70&&r.push("Optimize UI responsiveness"),s.errorEncounterRate>.05&&r.push("Reduce error rates in user interactions"),r}createAlert(t){const s={...t,id:this.generateAlertId(),timestamp:new Date};this.alerts.push(s),console.warn("Performance Alert:",s)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateAlertId(){return`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getMetrics(){return[...this.metrics]}getAlerts(){return[...this.alerts]}clearMetrics(){this.metrics=[],this.alerts=[]}getRealtimeMetrics(){return{renderTime:this.calculateRenderTime(),memoryUsage:this.getMemoryUsage(),networkLatency:this.measureNetworkLatency(),perceivedPerformance:this.calculatePerceivedPerformance()}}}const xe=at.getInstance();function gn({className:a,showDetails:t=!1,compact:s=!1}){const[r,n]=c.useState(!0),[o,i]=c.useState(!1),[l,m]=c.useState(null),[f,d]=c.useState([]),[y,g]=c.useState({lastSyncTime:null,totalOperations:0,successfulOperations:0,failedOperations:0,averageSyncTime:0,networkLatency:0,serverResponseTime:0,dataTransferRate:0}),[u,b]=c.useState(!1);c.useEffect(()=>{const w=()=>n(!0),S=()=>n(!1);return window.addEventListener("online",w),window.addEventListener("offline",S),n(navigator.onLine),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",S)}},[]),c.useEffect(()=>{const w=async()=>{try{const U=re.getStatus();m(U),i(U.isSyncing),U.lastSyncTime&&g($=>({...$,lastSyncTime:new Date(U.lastSyncTime),totalOperations:U.totalSyncs||0,successfulOperations:U.successfulSyncs||0,failedOperations:U.failedSyncs||0}));const J=xe.getRealtimeMetrics();g($=>({...$,networkLatency:J.networkLatency||0}))}catch(U){console.error("Failed to update sync status:",U)}};w();const S=setInterval(w,2e3),D=()=>{i(!0),C({type:"upload",entity:"批量同步",status:"in_progress",progress:0,startTime:new Date})},B=()=>{i(!1),j("completed"),w()},_=U=>{i(!1),j("failed",U.message)};return re.on("sync:start",D),re.on("sync:complete",B),re.on("sync:error",_),()=>{clearInterval(S),re.off("sync:start",D),re.off("sync:complete",B),re.off("sync:error",_)}},[]);const C=w=>{const S={...w,id:`op_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};d(D=>[S,...D.slice(0,9)]),g(D=>({...D,totalOperations:D.totalOperations+1}))},j=(w,S)=>{d(D=>D.map(B=>B.status==="in_progress"?{...B,status:w,endTime:new Date,error:S,progress:w==="completed"?100:B.progress}:B)),w==="completed"?g(D=>({...D,successfulOperations:D.successfulOperations+1})):w==="failed"&&g(D=>({...D,failedOperations:D.failedOperations+1}))},p=async()=>{try{i(!0),await re.sync({type:"incremental",direction:"bidirectional"})}catch(w){console.error("Manual sync failed:",w)}finally{i(!1)}},h=()=>r?o?"text-yellow-500 animate-pulse":l?.hasConflicts?"text-orange-500":"text-green-500":"text-red-500",x=()=>r?o?e.jsx(Ne,{className:"h-4 w-4 animate-spin"}):l?.hasConflicts?e.jsx(ve,{className:"h-4 w-4"}):e.jsx(Yt,{className:"h-4 w-4"}):e.jsx(Ts,{className:"h-4 w-4"}),v=()=>r?o?"同步中...":l?.hasConflicts?"需要解决冲突":"已同步":"离线",k=w=>{if(!w)return"从未";const D=new Date().getTime()-w.getTime(),B=Math.floor(D/6e4);return B<1?"刚刚":B<60?`${B}分钟前`:B<1440?`${Math.floor(B/60)}小时前`:`${Math.floor(B/1440)}天前`},N=y.totalOperations>0?(y.successfulOperations/y.totalOperations*100).toFixed(1):"0.0";return s?e.jsxs("div",{className:T("flex items-center gap-2 text-sm",a),children:[e.jsxs("div",{className:T("flex items-center gap-1",h()),children:[x(),e.jsx("span",{children:v()})]}),l?.pendingOperations>0&&e.jsxs(K,{variant:"secondary",className:"text-xs",children:[l.pendingOperations," 待同步"]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:p,disabled:o||!r,children:e.jsx(Ne,{className:T("h-3 w-3",o&&"animate-spin")})})]}):e.jsxs(se,{className:T("w-full",a),children:[e.jsxs(Fe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"text-lg",children:"同步状态"}),e.jsxs("div",{className:T("flex items-center gap-1 text-sm",h()),children:[x(),e.jsx("span",{children:v()})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l?.pendingOperations>0&&e.jsxs(K,{variant:"outline",children:[l.pendingOperations," 待同步"]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:p,disabled:o||!r,children:[e.jsx(Ne,{className:T("h-4 w-4 mr-2",o&&"animate-spin")}),"立即同步"]}),t&&e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>b(!u),children:u?"收起":"详情"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"网络状态:"}),e.jsx("span",{className:"ml-2 font-medium",children:r?"在线":"离线"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"最后同步:"}),e.jsx("span",{className:"ml-2 font-medium",children:k(y.lastSyncTime)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"成功率:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[N,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"延迟:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[y.networkLatency,"ms"]})]})]}),o&&f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"同步进度"}),e.jsxs("span",{children:[f.find(w=>w.status==="in_progress")?.progress||0,"%"]})]}),e.jsx(We,{value:f.find(w=>w.status==="in_progress")?.progress||0,className:"h-2"})]})]}),u&&t&&e.jsxs(ae,{className:"space-y-4",children:[e.jsx(st,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(lr,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"操作统计"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"总操作数:"}),e.jsx("span",{children:y.totalOperations})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"成功:"}),e.jsx("span",{className:"text-green-600",children:y.successfulOperations})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"失败:"}),e.jsx("span",{className:"text-red-600",children:y.failedOperations})]})]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ho,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:"性能指标"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"平均同步时间:"}),e.jsxs("span",{children:[y.averageSyncTime,"ms"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"服务器响应:"}),e.jsxs("span",{children:[y.serverResponseTime,"ms"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"传输速率:"}),e.jsxs("span",{children:[y.dataTransferRate,"KB/s"]})]})]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(go,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-medium",children:"同步状态"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"待同步操作:"}),e.jsx("span",{children:l?.pendingOperations||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"冲突数量:"}),e.jsx("span",{children:l?.conflicts?.length||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"同步模式:"}),e.jsx("span",{children:"自动"})]})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"最近操作"}),e.jsx(ze,{className:"h-48 border rounded-md p-2",children:e.jsx("div",{className:"space-y-2",children:f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"暂无操作记录"}):f.map(w=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[w.status==="completed"&&e.jsx(St,{className:"h-3 w-3 text-green-500"}),w.status==="failed"&&e.jsx(kt,{className:"h-3 w-3 text-red-500"}),w.status==="in_progress"&&e.jsx(Tt,{className:"h-3 w-3 text-yellow-500 animate-spin"}),w.status==="pending"&&e.jsx(Tt,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:w.entity}),e.jsx(K,{variant:"outline",className:"text-xs",children:w.type==="upload"?"上传":w.type==="download"?"下载":w.type==="conflict_resolution"?"冲突解决":"合并"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w.status==="in_progress"&&e.jsx(We,{value:w.progress,className:"w-16 h-1"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:k(w.startTime)})]})]},w.id))})})]})]})]})}function cd({isOpen:a,onClose:t,className:s}){const{conflicts:r,setSelectedConflict:n,getStats:o,getPendingConflicts:i,getHighPriorityConflicts:l,resolveConflict:m,ignoreConflict:f,batchResolveConflicts:d,refreshConflicts:y,isResolving:g,isLoading:u,error:b,syncStatus:C}=Zt(),[j,p]=c.useState("all"),[h,x]=c.useState(""),[v,k]=c.useState(new Set),[N,w]=c.useState(new Set),[S,D]=c.useState(!1),[B,_]=c.useState(null),U=o(),J=i(),$=l(),X=L.useMemo(()=>{let E=r;switch(j){case"pending":E=J;break;case"high":E=$;break;case"resolved":E=r.filter(O=>O.status==="resolved");break}if(h){const O=h.toLowerCase();E=E.filter(H=>{switch(H.entityType){case"card":return H.localVersion.content.frontContent.title.toLowerCase().includes(O);case"folder":return H.localVersion.name.toLowerCase().includes(O);case"tag":return H.localVersion.name.toLowerCase().includes(O);default:return!1}})}return E.sort((O,H)=>{const M={critical:4,high:3,medium:2,low:1},V=M[H.severity]-M[O.severity];return V!==0?-V:H.timestamp.getTime()-O.timestamp.getTime()})},[r,j,h,J,$]),te=E=>{k(O=>{const H=new Set(O);return H.has(E)?H.delete(E):H.add(E),H})},ee=E=>{w(O=>{const H=new Set(O);return H.has(E)?H.delete(E):H.add(E),H})},ue=E=>{_(E),D(!0)},P=()=>{N.size===X.length?w(new Set):w(new Set(X.map(E=>E.id)))},G=async E=>{if(N.size===0)return;const O=Array.from(N);await d(O,{type:E,reason:`批量选择${E==="keep_local"?"本地":"远程"}版本`}),w(new Set)},R=E=>{switch(E){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},A=E=>{switch(E){case"resolved":return e.jsx(St,{className:"h-4 w-4 text-green-500"});case"ignored":return e.jsx(kt,{className:"h-4 w-4 text-gray-500"});default:return e.jsx(Tt,{className:"h-4 w-4 text-yellow-500"})}};return a?e.jsx("div",{className:T("fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",s),children:e.jsxs(se,{className:"w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs(Fe,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"h-5 w-5 text-orange-500"}),e.jsx(Ie,{className:"text-xl",children:"冲突管理中心"}),e.jsxs(K,{variant:"outline",className:"ml-2",children:[U.pendingConflicts," 待解决"]})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:t,children:"×"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["总计: ",U.totalConflicts]}),e.jsxs("span",{children:["已解决: ",U.resolvedConflicts]}),e.jsxs("span",{children:["待处理: ",U.pendingConflicts]}),e.jsxs("span",{children:["高优先级: ",$.length]}),C&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${C.isSyncing?"bg-yellow-500 animate-pulse":C.networkStatus?.online?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{children:C.isSyncing?"同步中...":C.networkStatus?.online?"在线":"离线"})]}),C.pendingOperations>0&&e.jsxs("span",{children:["待同步: ",C.pendingOperations]})]})]}),e.jsx(gn,{showDetails:!0,compact:!1,className:"mb-4"}),b&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-red-600",children:b}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>window.location.reload(),children:"重试"})]})})]}),e.jsxs(ae,{className:"flex-1 flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"搜索冲突...",value:h,onChange:E=>x(E.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:j==="all"?"default":"outline",size:"sm",onClick:()=>p("all"),children:"全部"}),e.jsx(I,{variant:j==="pending"?"default":"outline",size:"sm",onClick:()=>p("pending"),children:"待解决"}),e.jsx(I,{variant:j==="high"?"default":"outline",size:"sm",onClick:()=>p("high"),children:"高优先级"}),e.jsx(I,{variant:j==="resolved"?"default":"outline",size:"sm",onClick:()=>p("resolved"),children:"已解决"})]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:y,disabled:u,children:[e.jsx(Ne,{className:`h-4 w-4 mr-2 ${u?"animate-spin":""}`}),"刷新"]})]}),N.size>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["已选择 ",N.size," 个冲突"]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:P,children:N.size===X.length?"取消全选":"全选"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",size:"sm",onClick:()=>G("keep_local"),disabled:g,children:"批量保留本地"}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>G("keep_remote"),disabled:g,children:"批量保留远程"})]})]}),e.jsx(ze,{className:"flex-1",children:e.jsx("div",{className:"space-y-3",children:u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ne,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"加载冲突信息..."})]}):X.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:h?"没有找到匹配的冲突":"暂无冲突"}):X.map(E=>e.jsx(dd,{conflict:E,isExpanded:v.has(E.id),isSelected:N.has(E.id),onToggleExpand:()=>te(E.id),onToggleSelect:()=>ee(E.id),onSelect:()=>n(E.id),onViewDetail:()=>ue(E.id),onResolve:O=>m(E.id,O),onIgnore:()=>f(E.id),getSeverityColor:R,getStatusIcon:A,isResolving:g},E.id))})})]})]})}):null}function dd({conflict:a,isExpanded:t,isSelected:s,onToggleExpand:r,onToggleSelect:n,onSelect:o,onViewDetail:i,onResolve:l,onIgnore:m,getSeverityColor:f,getStatusIcon:d,isResolving:y}){return e.jsx(se,{className:T("transition-all duration-200 cursor-pointer hover:shadow-md",f(a.severity),s&&"ring-2 ring-blue-500"),onClick:o,children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:n,onClick:g=>g.stopPropagation(),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d(a.status),e.jsx(K,{variant:"outline",className:"text-xs",children:a.severity}),e.jsx(K,{variant:"secondary",className:"text-xs",children:ud(a.type)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:sa(a.timestamp)})]}),e.jsx("h4",{className:"font-medium mb-1",children:md(a)}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:fd(a)}),t&&e.jsxs("div",{className:"mt-3 pt-3 border-t space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"来源设备:"}),e.jsx("span",{className:"ml-2",children:a.sourceDevice})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"冲突时间:"}),e.jsx("span",{className:"ml-2",children:sa(a.timestamp)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(I,{variant:"default",size:"sm",onClick:g=>{g.stopPropagation(),i()},children:"查看详情"}),e.jsx(I,{variant:"outline",size:"sm",onClick:g=>{g.stopPropagation(),l({type:"keep_local",reason:"保留本地版本"})},disabled:y,children:"保留本地"}),e.jsx(I,{variant:"outline",size:"sm",onClick:g=>{g.stopPropagation(),l({type:"keep_remote",reason:"保留远程版本"})},disabled:y,children:"保留远程"}),e.jsx(I,{variant:"ghost",size:"sm",onClick:g=>{g.stopPropagation(),m()},children:"忽略"})]})]})]})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:g=>{g.stopPropagation(),r()},className:"ml-2",children:t?e.jsx(ks,{className:"h-4 w-4"}):e.jsx(Gt,{className:"h-4 w-4"})})]})})})}function ud(a){return{card_content:"卡片内容",card_style:"卡片样式",card_tags:"卡片标签",card_folder:"卡片文件夹",folder_name:"文件夹名称",folder_structure:"文件夹结构",tag_rename:"标签重命名",tag_delete:"标签删除",tag_color:"标签颜色"}[a]||a}function md(a){switch(a.entityType){case"card":return a.localVersion.content.frontContent.title;case"folder":return a.localVersion.name;case"tag":return a.localVersion.name;default:return"未知冲突"}}function fd(a){switch(a.type){case"card_content":return"卡片内容在多设备上被同时编辑";case"folder_name":return"文件夹名称与远程版本不一致";case"tag_rename":return"标签重命名冲突";default:return"数据版本不一致"}}function sa(a){const s=new Date().getTime()-a.getTime(),r=Math.floor(s/6e4);return r<1?"刚刚":r<60?`${r}分钟前`:r<1440?`${Math.floor(r/60)}小时前`:`${Math.floor(r/1440)}天前`}const hd=Kn,pn=c.forwardRef(({className:a,...t},s)=>e.jsx(Xa,{ref:s,className:T("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...t}));pn.displayName=Xa.displayName;const jt=c.forwardRef(({className:a,...t},s)=>e.jsx(Qa,{ref:s,className:T("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...t}));jt.displayName=Qa.displayName;const Ct=c.forwardRef(({className:a,...t},s)=>e.jsx(Za,{ref:s,className:T("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...t}));Ct.displayName=Za.displayName;const xn=c.forwardRef(({className:a,...t},s)=>e.jsx("textarea",{className:T("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...t}));xn.displayName="Textarea";function gd({conflictId:a,onClose:t,className:s}){const{getConflictById:r,resolveConflict:n,ignoreConflict:o,getSuggestions:i,isResolving:l}=Zt(),[m,f]=c.useState("compare"),[d,y]=c.useState("local"),[g,u]=c.useState({}),[b,C]=c.useState(!0),j=r(a),p=i(a);if(!j)return e.jsx(se,{className:T("w-full max-w-6xl max-h-[90vh]",s),children:e.jsxs(ae,{className:"p-8 text-center",children:[e.jsx(kt,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"冲突不存在"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"指定的冲突ID未找到或已被解决"}),e.jsx(I,{onClick:t,children:"关闭"})]})});const h=async()=>{let w;switch(d){case"local":w={type:"keep_local",reason:"用户选择保留本地版本"};break;case"remote":w={type:"keep_remote",reason:"用户选择保留远程版本"};break;case"merge":w={type:"merge",reason:"用户选择智能合并",mergedData:x()};break;case"manual":w={type:"manual",reason:"用户手动编辑",mergedData:g,manualChanges:Object.entries(g).map(([D,B])=>({field:D,value:B,source:"custom"}))};break}await n(a,w)&&t()},x=()=>j.entityType==="card"?{content:{frontContent:v(j.localVersion.content.frontContent,j.remoteVersion.content.frontContent),backContent:v(j.localVersion.content.backContent,j.remoteVersion.content.backContent)},style:j.localVersion.style}:j.localVersion,v=(w,S)=>({title:w.title.length>S.title.length?w.title:S.title,text:`${w.text}

${S.text}`,tags:[...new Set([...w.tags,...S.tags])],lastModified:new Date}),N=j.type==="card_content"?[{field:"title",label:"标题",local:j.localVersion.content.frontContent.title,remote:j.remoteVersion.content.frontContent.title},{field:"frontText",label:"正面内容",local:j.localVersion.content.frontContent.text,remote:j.remoteVersion.content.frontContent.text},{field:"backText",label:"背面内容",local:j.localVersion.content.backContent.text,remote:j.remoteVersion.content.backContent.text},{field:"tags",label:"标签",local:j.localVersion.content.frontContent.tags,remote:j.remoteVersion.content.frontContent.tags}]:[];return e.jsxs(se,{className:T("w-full max-w-6xl max-h-[90vh] flex flex-col",s),children:[e.jsxs(Fe,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:T("h-5 w-5",wd(j.severity))}),e.jsxs("div",{children:[e.jsx(Ie,{className:"text-xl",children:pd(j)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:xd(j)})]})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:t,children:"×"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["类型: ",yd(j.type)]}),e.jsxs("span",{children:["优先级: ",j.severity]}),e.jsxs("span",{children:["来源: ",j.sourceDevice]}),e.jsxs("span",{children:["时间: ",Ze(j.timestamp)]}),e.jsx(K,{variant:"outline",children:j.status==="pending"?"待解决":j.status==="resolved"?"已解决":"已忽略"})]})]}),e.jsxs(ae,{className:"flex-1 flex flex-col",children:[e.jsxs(hd,{value:m,onValueChange:f,className:"flex-1 flex flex-col",children:[e.jsxs(pn,{className:"grid w-full grid-cols-4",children:[e.jsx(jt,{value:"compare",children:"对比视图"}),e.jsx(jt,{value:"suggestions",children:"智能建议"}),e.jsx(jt,{value:"history",children:"历史记录"}),e.jsx(jt,{value:"manual",children:"手动合并"})]}),e.jsxs("div",{className:"flex-1 mt-4",children:[e.jsx(Ct,{value:"compare",className:"h-full",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 h-full",children:[e.jsxs(se,{className:"border-green-200",children:[e.jsxs(Fe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ie,{className:"text-base flex items-center gap-2",children:[e.jsx(po,{className:"h-4 w-4 text-green-600"}),"本地版本"]}),e.jsx(K,{variant:"outline",className:"text-green-600 border-green-200",children:"本地设备"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["更新时间: ",Ze(j.localVersion.updatedAt)]})]}),e.jsx(ae,{className:"p-4",children:e.jsx(ze,{className:"h-96",children:aa(j,"local")})})]}),e.jsxs(se,{className:"border-blue-200",children:[e.jsxs(Fe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ie,{className:"text-base flex items-center gap-2",children:[e.jsx(xo,{className:"h-4 w-4 text-blue-600"}),"远程版本"]}),e.jsx(K,{variant:"outline",className:"text-blue-600 border-blue-200",children:j.sourceDevice})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["更新时间: ",Ze(j.remoteVersion.updatedAt)]})]}),e.jsx(ae,{className:"p-4",children:e.jsx(ze,{className:"h-96",children:aa(j,"remote")})})]})]})}),e.jsx(Ct,{value:"suggestions",className:"h-full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yo,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"智能解决建议"})]}),p.length>0?e.jsx("div",{className:"grid gap-3",children:p.map((w,S)=>e.jsx(se,{className:"cursor-pointer hover:shadow-md transition-shadow",children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{variant:w.type==="merge"?"default":"secondary",children:bd(w.type)}),e.jsxs(K,{variant:"outline",children:["置信度: ",Math.round(w.confidence*100),"%"]})]}),e.jsx("p",{className:"text-sm mb-2",children:w.reason}),w.preview&&e.jsxs("div",{className:"text-xs text-muted-foreground bg-gray-50 p-2 rounded",children:["预览: ",JSON.stringify(w.preview)]})]}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>y(w.type),children:"应用建议"})]})})},S))}):e.jsx(se,{children:e.jsxs(ae,{className:"p-8 text-center",children:[e.jsx(kt,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"暂无智能建议，请手动选择解决方案"})]})})]})}),e.jsx(Ct,{value:"history",className:"h-full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"冲突历史"})]}),e.jsx(se,{children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"冲突检测"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ze(j.timestamp)})]}),e.jsx(K,{variant:"destructive",children:"冲突"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"本地版本更新"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ze(j.localVersion.updatedAt)})]}),e.jsx(K,{variant:"outline",children:"本地"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"远程版本更新"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ze(j.remoteVersion.updatedAt)})]}),e.jsx(K,{variant:"outline",children:"远程"})]})]})})})]})}),e.jsx(Ct,{value:"manual",className:"h-full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bt,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"手动合并"}),e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>C(!b),children:[b?e.jsx(ys,{className:"h-4 w-4 mr-1"}):e.jsx(Bt,{className:"h-4 w-4 mr-1"}),b?"隐藏差异":"显示差异"]})]}),e.jsx(ze,{className:"h-96",children:e.jsx("div",{className:"space-y-4",children:N.map(w=>e.jsxs(se,{children:[e.jsx(Fe,{className:"pb-3",children:e.jsx(Ie,{className:"text-base",children:w.label})}),e.jsxs(ae,{className:"space-y-3",children:[b&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"p-2 bg-green-50 rounded text-sm",children:[e.jsx("p",{className:"font-medium text-green-700 mb-1",children:"本地:"}),e.jsx("p",{children:w.local})]}),e.jsxs("div",{className:"p-2 bg-blue-50 rounded text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 mb-1",children:"远程:"}),e.jsx("p",{children:w.remote})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"合并结果:"}),w.field==="tags"?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Array.isArray(w.local)&&w.local.map(S=>e.jsx(K,{variant:"secondary",children:S},S)),Array.isArray(w.remote)&&w.remote.map(S=>e.jsx(K,{variant:"outline",children:S},S))]}):e.jsx(xn,{value:g[w.field]||w.local,onChange:S=>u(D=>({...D,[w.field]:S.target.value})),className:"min-h-[100px]"})]})]})]},w.field))})})]})})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"解决方案:"}),e.jsx("div",{className:"flex gap-2",children:["local","remote","merge","manual"].map(w=>e.jsx(I,{variant:d===w?"default":"outline",size:"sm",onClick:()=>y(w),children:vd(w)},w))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:t,children:"取消"}),e.jsx(I,{variant:"ghost",onClick:()=>o(a),children:"忽略冲突"}),e.jsx(I,{onClick:h,disabled:l,children:l?"解决中...":"应用解决方案"})]})]})})]})]})}function aa(a,t){const s=t==="local"?a.localVersion:a.remoteVersion;return a.entityType==="card"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"正面内容"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h5",{className:"font-semibold mb-2",children:s.content.frontContent.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.content.frontContent.text}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.content.frontContent.tags.map(r=>e.jsx(K,{variant:"secondary",className:"text-xs",children:r},r))})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"背面内容"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h5",{className:"font-semibold mb-2",children:s.content.backContent.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.content.backContent.text}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.content.backContent.tags.map(r=>e.jsx(K,{variant:"secondary",className:"text-xs",children:r},r))})]})]})]}):e.jsx("pre",{className:"text-sm",children:JSON.stringify(s,null,2)})}function pd(a){switch(a.entityType){case"card":return a.localVersion.content.frontContent.title;case"folder":return a.localVersion.name;case"tag":return a.localVersion.name;default:return"未知冲突"}}function xd(a){switch(a.type){case"card_content":return"卡片内容在多设备上被同时编辑，需要选择保留的版本";case"folder_name":return"文件夹名称与远程版本不一致";case"tag_rename":return"标签重命名冲突";default:return"数据版本不一致，需要手动解决"}}function yd(a){return{card_content:"卡片内容",card_style:"卡片样式",card_tags:"卡片标签",card_folder:"卡片文件夹",folder_name:"文件夹名称",folder_structure:"文件夹结构",tag_rename:"标签重命名",tag_delete:"标签删除",tag_color:"标签颜色"}[a]||a}function wd(a){switch(a){case"critical":return"text-red-600";case"high":return"text-orange-600";case"medium":return"text-yellow-600";case"low":return"text-blue-600";default:return"text-gray-600"}}function bd(a){return{keep_local:"保留本地",keep_remote:"保留远程",merge:"智能合并",manual:"手动处理"}[a]||a}function vd(a){return{local:"保留本地",remote:"保留远程",merge:"智能合并",manual:"手动合并"}[a]||a}function Ze(a){const s=new Date().getTime()-a.getTime(),r=Math.floor(s/6e4);return r<1?"刚刚":r<60?`${r}分钟前`:r<1440?`${Math.floor(r/60)}小时前`:`${Math.floor(r/1440)}天前`}function jd({className:a,showLabel:t=!0,showDetails:s=!0,onSync:r}){const[n,o]=c.useState({isOnline:!0,isSyncing:!1,hasConflicts:!1,pendingOperations:0,lastSyncTime:null,conflicts:[]});c.useEffect(()=>{const u=()=>{o(C=>({...C,isOnline:!0}))},b=()=>{o(C=>({...C,isOnline:!1}))};return window.addEventListener("online",u),window.addEventListener("offline",b),o(C=>({...C,isOnline:navigator.onLine})),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",b)}},[]),c.useEffect(()=>{const u=async()=>{try{const h=re.getStatus();o(x=>({...x,isSyncing:h.isSyncing,hasConflicts:h.hasConflicts,pendingOperations:h.pendingOperations||0,lastSyncTime:h.lastSyncTime?new Date(h.lastSyncTime):null,conflicts:h.conflicts||[]}))}catch(h){console.error("Failed to update sync status:",h)}};u();const b=setInterval(u,3e3),C=()=>{o(h=>({...h,isSyncing:!0}))},j=()=>{o(h=>({...h,isSyncing:!1})),u()},p=()=>{o(h=>({...h,isSyncing:!1}))};return re.on("sync:start",C),re.on("sync:complete",j),re.on("sync:error",p),()=>{clearInterval(b),re.off("sync:start",C),re.off("sync:complete",j),re.off("sync:error",p)}},[]);const i=()=>n.isOnline?n.isSyncing?"text-yellow-500 animate-pulse":n.hasConflicts?"text-orange-500":"text-green-500":"text-red-500",l=()=>n.isOnline?n.isSyncing?e.jsx(Ne,{className:"h-4 w-4 animate-spin"}):n.hasConflicts?e.jsx(ve,{className:"h-4 w-4"}):e.jsx(Yt,{className:"h-4 w-4"}):e.jsx(Ts,{className:"h-4 w-4"}),m=()=>n.isOnline?n.isSyncing?"同步中...":n.hasConflicts?"有冲突":"已同步":"离线",f=u=>{if(!u)return"从未";const C=new Date().getTime()-u.getTime(),j=Math.floor(C/6e4);return j<1?"刚刚":j<60?`${j}分钟前`:j<1440?`${Math.floor(j/60)}小时前`:`${Math.floor(j/1440)}天前`},d=async()=>{if(r){r();return}try{await re.sync({type:"incremental",direction:"bidirectional"})}catch(u){console.error("Manual sync failed:",u)}},y=()=>e.jsxs("div",{className:T("flex items-center gap-2",a),children:[e.jsxs("div",{className:T("flex items-center gap-1",i()),children:[l(),t&&e.jsx("span",{className:"text-sm",children:m()})]}),n.pendingOperations>0&&e.jsx(K,{variant:"secondary",className:"text-xs",children:n.pendingOperations}),n.conflicts.length>0&&e.jsx(K,{variant:"destructive",className:"text-xs",children:n.conflicts.length}),e.jsx(I,{variant:"ghost",size:"sm",onClick:d,disabled:n.isSyncing||!n.isOnline,className:"h-6 w-6 p-0",children:e.jsx(Ne,{className:T("h-3 w-3",n.isSyncing&&"animate-spin")})})]}),g=()=>e.jsxs(Nr,{children:[e.jsx(Sr,{asChild:!0,children:e.jsxs("div",{className:T("flex items-center gap-2 cursor-pointer hover:bg-accent rounded-md p-2",a),children:[e.jsxs("div",{className:T("flex items-center gap-1",i()),children:[l(),t&&e.jsx("span",{className:"text-sm font-medium",children:m()})]}),n.pendingOperations>0&&e.jsxs(K,{variant:"outline",className:"text-xs",children:[n.pendingOperations," 待同步"]}),n.conflicts.length>0&&e.jsxs(K,{variant:"destructive",className:"text-xs",children:[n.conflicts.length," 冲突"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:f(n.lastSyncTime)}),e.jsx(I,{variant:"ghost",size:"sm",onClick:u=>{u.stopPropagation(),d()},disabled:n.isSyncing||!n.isOnline,className:"h-6 w-6 p-0 ml-auto",children:e.jsx(Ne,{className:T("h-3 w-3",n.isSyncing&&"animate-spin")})})]})}),e.jsx(_s,{className:"w-96 p-0",align:"end",children:e.jsx(gn,{showDetails:!0,compact:!1})})]});return s?e.jsx(g,{}):e.jsx(y,{})}function Cd(a={}){const{enableMetricsCollection:t=!0,enableUserTracking:s=!0,enableConflictMonitoring:r=!0,reportInterval:n=3e4}=a,o=c.useRef({averageRenderTime:0,averageMemoryUsage:0,averageNetworkLatency:0,conflictResolutionTime:0,userSatisfaction:0,errorRate:0,totalOperations:0,successfulOperations:0}),i=c.useRef([]),l=c.useRef([]);c.useEffect(()=>{if(!t)return;xe.clearMetrics();const S=setInterval(()=>{m()},n);return()=>{clearInterval(S)}},[t,n]);const m=c.useCallback(()=>{const S=xe.getMetrics();if(S.length===0)return;const D=S.slice(-10),B=f(D);o.current={averageRenderTime:B.renderTime,averageMemoryUsage:B.memoryUsage,averageNetworkLatency:B.networkLatency,conflictResolutionTime:B.conflictResolutionTime,userSatisfaction:B.userSatisfaction,errorRate:d(D),totalOperations:D.length,successfulOperations:D.filter(_=>_.errorRate<.05).length},i.current=S},[]),f=c.useCallback(S=>S.length===0?{renderTime:0,memoryUsage:0,networkLatency:0,conflictResolutionTime:0,userSatisfaction:0,errorRate:0}:{renderTime:S.reduce((D,B)=>D+B.renderTime,0)/S.length,memoryUsage:S.reduce((D,B)=>D+B.memoryUsage,0)/S.length,networkLatency:S.reduce((D,B)=>D+B.networkLatency,0)/S.length,conflictResolutionTime:S.reduce((D,B)=>D+B.conflictResolutionTime,0)/S.length,userSatisfaction:S.reduce((D,B)=>D+B.userSatisfaction,0)/S.length,errorRate:S.reduce((D,B)=>D+B.errorRate,0)/S.length},[]),d=c.useCallback(S=>S.reduce((B,_)=>B+_.errorRate,0)/S.length,[]),y=c.useCallback(()=>r?xe.startConflictDetection():()=>{},[r]),g=c.useCallback(()=>r?xe.startConflictResolution():()=>{},[r]),u=c.useCallback(()=>r?xe.startBatchOperation():()=>{},[r]),b=c.useCallback((S,D,B)=>{s&&(xe.trackUserInteraction(S,D,B),l.current.push({action:S,duration:D,success:B,timestamp:new Date}),l.current.length>100&&(l.current=l.current.slice(-100)))},[s]),C=c.useCallback((S,D)=>{s&&xe.trackUserSatisfaction(S,D)},[s]),j=c.useCallback((S=36e5)=>xe.generateReport(S),[]),p=c.useCallback(()=>xe.getRealtimeMetrics(),[]),h=c.useCallback(()=>xe.getAlerts(),[]),x=c.useCallback((S=20)=>l.current.slice(-S),[]),v=c.useCallback(()=>({...o.current}),[]),k=c.useCallback(()=>{xe.clearMetrics(),i.current=[],l.current=[],o.current={averageRenderTime:0,averageMemoryUsage:0,averageNetworkLatency:0,conflictResolutionTime:0,userSatisfaction:0,errorRate:0,totalOperations:0,successfulOperations:0}},[]),N=c.useCallback(()=>{const S=o.current;let D=100;return S.averageRenderTime>100&&(D-=20),S.averageRenderTime>200&&(D-=30),S.averageMemoryUsage>100*1024*1024&&(D-=15),S.averageMemoryUsage>200*1024*1024&&(D-=25),S.averageNetworkLatency>1e3&&(D-=10),S.averageNetworkLatency>2e3&&(D-=20),S.errorRate>.05&&(D-=15),S.errorRate>.1&&(D-=25),S.conflictResolutionTime>5e3&&(D-=10),S.conflictResolutionTime>1e4&&(D-=20),{healthScore:Math.max(0,D),status:D>=80?"good":D>=60?"warning":"critical",issues:w(S)}},[]),w=c.useCallback(S=>{const D=[];return S.averageRenderTime>100&&D.push("渲染时间过长，可能影响用户体验"),S.averageMemoryUsage>100*1024*1024&&D.push("内存使用较高，建议检查内存泄漏"),S.averageNetworkLatency>1e3&&D.push("网络延迟较高，可能影响同步性能"),S.errorRate>.05&&D.push("错误率较高，需要关注错误处理"),S.conflictResolutionTime>5e3&&D.push("冲突解决时间过长，建议优化算法"),D},[]);return{startConflictDetection:y,startConflictResolution:g,startBatchOperation:u,trackUserInteraction:b,trackUserSatisfaction:C,getPerformanceReport:j,getRealtimeMetrics:p,getPerformanceAlerts:h,getUserActionHistory:x,getPerformanceStats:v,clearPerformanceData:k,getPerformanceHealth:N,stats:o.current,isMonitoring:t}}function Nd({className:a,showDetails:t=!0,compact:s=!1,autoRefresh:r=!0}){const[n,o]=c.useState(!1),[i,l]=c.useState("overview"),[m,f]=c.useState(0),{stats:d,getRealtimeMetrics:y,getPerformanceAlerts:g,getUserActionHistory:u,getPerformanceHealth:b,getPerformanceReport:C,isMonitoring:j}=Cd({enableMetricsCollection:!0,enableUserTracking:!0,enableConflictMonitoring:!0,reportInterval:1e4}),[p,h]=c.useState({}),[x,v]=c.useState([]),[k,N]=c.useState([]),[w,S]=c.useState(null),D=()=>{h(y()),v(g()),N(u(20)),S(b()),f($=>$+1)};c.useEffect(()=>{if(!r||!n)return;D();const $=setInterval(D,5e3);return()=>clearInterval($)},[r,n,m]),c.useEffect(()=>{n&&D()},[n]);const B=$=>{if($===0)return"0 B";const X=1024,te=["B","KB","MB","GB"],ee=Math.floor(Math.log($)/Math.log(X));return`${parseFloat(($/Math.pow(X,ee)).toFixed(2))} ${te[ee]}`},_=$=>$<1e3?`${$.toFixed(0)}ms`:$<6e4?`${($/1e3).toFixed(1)}s`:`${($/6e4).toFixed(1)}min`,U=$=>{switch($){case"good":return"text-green-500";case"warning":return"text-yellow-500";case"critical":return"text-red-500";default:return"text-gray-500"}},J=$=>{switch($){case"good":return e.jsx(St,{className:"h-4 w-4 text-green-500"});case"warning":return e.jsx(ve,{className:"h-4 w-4 text-yellow-500"});case"critical":return e.jsx(kt,{className:"h-4 w-4 text-red-500"});default:return e.jsx($s,{className:"h-4 w-4 text-gray-500"})}};return s?e.jsxs("div",{className:T("flex items-center gap-2",a),children:[e.jsxs("div",{className:T("flex items-center gap-1",U(w?.status||"unknown")),children:[J(w?.status||"unknown"),e.jsxs("span",{className:"text-sm font-medium",children:[w?.healthScore||0,"/100"]})]}),x.length>0&&e.jsx(K,{variant:"destructive",className:"text-xs",children:x.length}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>o(!n),children:e.jsx(wo,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:T("flex items-center gap-2 cursor-pointer",a),onClick:()=>o(!n),children:[e.jsxs("div",{className:T("flex items-center gap-1",U(w?.status||"unknown")),children:[J(w?.status||"unknown"),e.jsxs("span",{className:"text-sm font-medium",children:["性能: ",w?.healthScore||0,"/100"]})]}),x.length>0&&e.jsxs(K,{variant:"destructive",className:"text-xs",children:[x.length," 警报"]}),e.jsx(I,{variant:"ghost",size:"sm",children:n?"隐藏":"显示"})]}),n&&e.jsxs(se,{className:"w-full max-w-4xl max-h-[80vh]",children:[e.jsxs(Fe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ie,{className:"text-lg flex items-center gap-2",children:[e.jsx($s,{className:"h-5 w-5"}),"性能监控",e.jsx(K,{variant:j?"default":"secondary",children:j?"监控中":"已停止"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:D,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"刷新"]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>{const $=C();console.log("Performance Report:",$)},children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"报告"]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>o(!1),children:"×"})]})]}),w&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"健康状态:"}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[J(w.status),e.jsxs("span",{className:T("font-medium",U(w.status)),children:[w.healthScore,"/100 (",w.status,")"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"渲染时间:"}),e.jsx("span",{className:"ml-2 font-medium",children:_(p.renderTime||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"内存使用:"}),e.jsx("span",{className:"ml-2 font-medium",children:B(p.memoryUsage||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"网络延迟:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[p.networkLatency||0,"ms"]})]})]})]}),e.jsxs(ae,{children:[e.jsx("div",{className:"flex gap-2 mb-4",children:["overview","metrics","alerts","actions"].map($=>e.jsxs(I,{variant:i===$?"default":"outline",size:"sm",onClick:()=>l($),children:[$==="overview"&&"概览",$==="metrics"&&"指标",$==="alerts"&&"警报",$==="actions"&&"用户行为"]},$))}),e.jsxs(ze,{className:"h-96",children:[i==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ir,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"font-medium",children:"渲染性能"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"平均渲染时间:"}),e.jsx("span",{children:_(d.averageRenderTime)})]}),e.jsx(We,{value:Math.min(100,d.averageRenderTime/100*100),className:"h-2"})]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(lr,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"内存使用"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"内存使用:"}),e.jsx("span",{children:B(d.averageMemoryUsage)})]}),e.jsx(We,{value:Math.min(100,d.averageMemoryUsage/(100*1024*1024)*100),className:"h-2"})]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Yt,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:"网络性能"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"平均延迟:"}),e.jsxs("span",{children:[d.averageNetworkLatency,"ms"]})]}),e.jsx(We,{value:Math.min(100,d.averageNetworkLatency/1e3*100),className:"h-2"})]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(bo,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-medium",children:"用户体验"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"满意度:"}),e.jsxs("span",{children:[d.userSatisfaction.toFixed(1),"%"]})]}),e.jsx(We,{value:d.userSatisfaction,className:"h-2"})]})]})})]}),w?.issues&&w.issues.length>0&&e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ve,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"font-medium",children:"性能问题"})]}),e.jsx("div",{className:"space-y-1 text-sm",children:w.issues.map(($,X)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-orange-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:$})]},X))})]})})]}),i==="metrics"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"实时性能指标"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"渲染时间:"}),e.jsx("span",{children:_(p.renderTime||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"首次绘制:"}),e.jsx("span",{children:_(p.firstPaint||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"内容绘制:"}),e.jsx("span",{children:_(p.firstContentfulPaint||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"最大内容绘制:"}),e.jsx("span",{children:_(p.largestContentfulPaint||0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"内存使用:"}),e.jsx("span",{children:B(p.memoryUsage||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"网络延迟:"}),e.jsxs("span",{children:[p.networkLatency||0,"ms"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"冲突检测时间:"}),e.jsx("span",{children:_(p.conflictDetectionTime||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"冲突解决时间:"}),e.jsx("span",{children:_(p.conflictResolutionTime||0)})]})]})]})]}),i==="alerts"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"性能警报"}),x.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"暂无性能警报"}):e.jsx("div",{className:"space-y-2",children:x.map(($,X)=>e.jsx(se,{className:"border-l-4 border-l-red-500",children:e.jsxs(ae,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"font-medium text-sm",children:$.type}),e.jsx(K,{variant:"outline",className:"text-xs",children:$.severity})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date($.timestamp).toLocaleTimeString()})]}),e.jsx("p",{className:"text-sm mb-2",children:$.message}),$.suggestions&&$.suggestions.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"建议:"}),$.suggestions.map((te,ee)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:["• ",te]},ee))]})]})},X))})]}),i==="actions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"用户行为历史"}),k.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"暂无用户行为记录"}):e.jsx("div",{className:"space-y-2",children:k.map(($,X)=>e.jsx(se,{children:e.jsx(ae,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:$.action}),e.jsx(K,{variant:$.success?"default":"destructive",className:"text-xs",children:$.success?"成功":"失败"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Tt,{className:"h-3 w-3"}),e.jsx("span",{children:new Date($.timestamp).toLocaleTimeString()}),e.jsxs("span",{children:["(",_($.duration),")"]})]})]})})},X))})]})]})]})]})]})}function Sd({className:a}){const[t,s]=c.useState({user:null,session:null,loading:!1,error:null}),{openModal:r}=gr(),{cards:n,filter:o,setFilter:i,viewSettings:l,setViewSettings:m,dispatch:f,getAllTags:d,updateTagsInAllCards:y,getCardsWithTag:g}=Qo(),{folderTree:u,selectedFolderId:b,setSelectedFolderId:C,dispatch:j,getFolderById:p,folders:h}=mr(),{tags:x,popularTags:v,renameTag:k,deleteTagByName:N,getAllTagNames:w}=fr(),{toast:S}=Rc(),[D,B]=c.useState(!1),[_,U]=c.useState(!1),[J,$]=c.useState({gap:16,showLayoutControls:!1}),{stats:X,selectedConflict:te,setSelectedConflict:ee}=Zt(),[ue,P]=c.useState(!1),[G,R]=c.useState(!1);c.useEffect(()=>Le.onAuthStateChange(s),[]);const[A,E]=c.useState(!1),[O,H]=c.useState(!1),[M,V]=c.useState(null),[ie,ke]=c.useState(null),[Ke,je]=c.useState(),[mt,qe]=c.useState(!1),[es,ft]=c.useState(!1),[_t,ht]=c.useState(""),[pe,gt]=c.useState(null),{isDownloading:Ft,showPreview:Ve,previewData:pt,captureScreenshot:Te,confirmDownload:ts,cancelPreview:ss}=Cc({onSuccess:F=>{S({title:"Screenshot saved!",description:`${F}.png has been downloaded successfully.`})},onError:F=>{S({title:"Screenshot failed",description:F.message,variant:"destructive"})}}),me=F=>{f({type:"FLIP_CARD",payload:F})},Me=(F,z)=>{f({type:"UPDATE_CARD",payload:{id:F,updates:z}})},as=async F=>{const z=n.find(q=>q.id===F);if(z){const q=z.isFlipped?z.backContent:z.frontContent,ce=Zi(q.title,q.text);await el(ce)?console.log("Card content copied to clipboard"):console.error("Failed to copy card content")}},rs=async F=>{const z=n.find(le=>le.id===F);if(!z)return;const q=document.querySelector(`[data-card-id="${F}"]`);if(!q){S({title:"Screenshot failed",description:"Could not find card element. Please try again.",variant:"destructive"});return}const de=(z.isFlipped?z.backContent:z.frontContent).title||"Untitled Card";await Te(q,de)},Je=F=>{console.log("Share card:",F)},ns=F=>{f({type:"DELETE_CARD",payload:F})},It=(F,z)=>{const q=n.find(le=>le.id===F);if(!q)return;const ce=q.folderId;if(f({type:"UPDATE_CARD",payload:{id:F,updates:{folderId:z||void 0}}}),ce){const le=p(ce);le&&j({type:"UPDATE_FOLDER",payload:{id:ce,updates:{cardIds:le.cardIds.filter(yn=>yn!==F)}}})}if(z){const le=p(z);le&&j({type:"UPDATE_FOLDER",payload:{id:z,updates:{cardIds:[...le.cardIds,F]}}})}const de=z?p(z)?.name:"Root";S({title:"Card moved",description:`Card has been moved to "${de}".`})},He=()=>{f({type:"CREATE_CARD",payload:{frontContent:{title:"New Card",text:"Click to edit this card...",images:[],tags:[],lastModified:new Date},backContent:{title:"Back Side",text:"Add additional content here...",images:[],tags:[],lastModified:new Date},style:{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"xl",shadow:"md",borderWidth:0},isFlipped:!1,folderId:b||void 0}})},Ee=()=>{je(void 0),V(null),E(!0)},xt=F=>{je(F),V(null),E(!0)},De=F=>{const z=p(F);z&&(V({id:F,name:z.name,color:z.color,icon:z.icon||"Folder"}),je(void 0),E(!0))},Mt=F=>{const z=p(F);if(z){const q=h.filter(ce=>ce.parentId===F);ke({id:F,name:z.name,cardCount:z.cardIds.length,hasSubfolders:q.length>0,subfolderCount:q.length}),H(!0)}},os=F=>{M?(j({type:"UPDATE_FOLDER",payload:{id:M.id,updates:{name:F.name,color:F.color,icon:F.icon}}}),S({title:"Folder updated",description:`"${F.name}" has been updated successfully.`})):(j({type:"CREATE_FOLDER",payload:{name:F.name,color:F.color,icon:F.icon,cardIds:[],parentId:F.parentId,isExpanded:!0}}),S({title:"Folder created",description:`"${F.name}" has been created successfully.`}))},Pt=()=>{ie&&(j({type:"DELETE_FOLDER",payload:ie.id,onDeleteCards:F=>{F.forEach(z=>{f({type:"DELETE_CARD",payload:z})})}}),S({title:"Folder deleted",description:`"${ie.name}" and ${ie.cardCount} cards have been deleted.`}),b===ie.id&&Xe(null))},Lt=F=>{const z=o.tags.includes(F);i({...o,tags:z?o.tags.filter(q=>q!==F):[...o.tags,F]})},Xe=F=>{C(F),i({...o,folderId:F||void 0})},yt=F=>{ht(F),qe(!0)},Ce=F=>{const z=g(F);gt({name:F,cardCount:z.length}),ft(!0)},is=(F,z)=>{k(F,z)?(y(F,z),S({title:"Tag renamed",description:`"${F}" has been renamed to "${z}".`}),qe(!1),ht("")):S({title:"Rename failed",description:"A tag with this name already exists.",variant:"destructive"})},Y=()=>{pe&&N(pe.name)&&(y(pe.name),o.tags.includes(pe.name)&&i({...o,tags:o.tags.filter(z=>z!==pe.name)}),S({title:"Tag deleted",description:`"${pe.name}" has been removed from ${pe.cardCount} cards.`}),ft(!1),gt(null))},Q=(F,z=0)=>F.map(q=>e.jsxs("div",{style:{marginLeft:z*16},children:[e.jsx(ta,{folderId:q.id,folderName:q.name,onRename:De,onDelete:Mt,onCreateSubfolder:xt,children:e.jsxs(I,{variant:b===q.id?"secondary":"ghost",className:"w-full justify-start text-sm mb-1",onClick:()=>Xe(q.id),children:[e.jsx(Oe,{className:"h-4 w-4 mr-2",style:{color:q.color}}),q.name,e.jsx(K,{variant:"secondary",className:"ml-auto",children:q.cardIds.length})]})}),q.children&&q.children.length>0&&q.isExpanded&&e.jsx("div",{className:"ml-4",children:Q(q.children,z+1)})]},q.id)),Z=F=>F.map(z=>e.jsxs("div",{children:[e.jsx(ta,{folderId:z.id,folderName:z.name,onRename:De,onDelete:Mt,onCreateSubfolder:xt,children:e.jsx(I,{variant:b===z.id?"secondary":"ghost",className:"w-full h-10 p-0 mb-1",onClick:()=>Xe(z.id),title:z.name,children:e.jsx(Oe,{className:"h-4 w-4",style:{color:z.color}})})}),z.children&&z.children.length>0&&z.isExpanded&&e.jsx("div",{children:Z(z.children)})]},z.id));return e.jsx(Yi,{children:e.jsxs("div",{className:T("min-h-screen bg-background",a),children:[e.jsx("header",{className:"sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex h-16 items-center justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-gradient-to-br from-violet-500 to-pink-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"CA"})}),e.jsxs("h1",{className:"text-xl font-bold",children:[e.jsx("span",{className:"text-violet-600",children:"Card"}),e.jsx("span",{className:"text-pink-500",children:"All"})]})]}),e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 hidden md:block",children:e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(he,{placeholder:"Search cards...",value:o.searchTerm,onChange:F=>i({...o,searchTerm:F.target.value}),className:"pl-10 rounded-full w-80"})]})}),e.jsx("div",{className:"md:hidden absolute left-1/2 transform -translate-x-1/2",children:e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(he,{placeholder:"Search...",value:o.searchTerm,onChange:F=>i({...o,searchTerm:F.target.value}),className:"pl-10 rounded-full w-60"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[X.pendingConflicts>0&&e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>P(!0),className:"relative text-orange-600 hover:bg-orange-50",children:[e.jsx(ve,{className:"h-4 w-4"}),X.pendingConflicts>0&&e.jsx(K,{variant:"destructive",className:"absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 text-xs",children:X.pendingConflicts>99?"99+":X.pendingConflicts}),e.jsx("span",{className:"sr-only",children:"Conflict Notifications"})]}),e.jsx(jd,{showDetails:!0,showLabel:!1,className:"mr-1"}),e.jsx(Nd,{compact:!0,autoRefresh:!0}),e.jsxs(Nr,{children:[e.jsx(Sr,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",children:e.jsx(vo,{className:"h-4 w-4"})})}),e.jsx(_s,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Layout Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Customize the masonry layout appearance"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ge,{children:["Gap Size: ",J.gap,"px"]}),e.jsx(Cr,{value:[J.gap],onValueChange:([F])=>$(z=>({...z,gap:F})),max:32,min:8,step:4,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{children:"Card Size"}),e.jsx("div",{className:"flex gap-2",children:["small","medium","large"].map(F=>e.jsx(I,{variant:l.cardSize===F?"default":"outline",size:"sm",onClick:()=>m(z=>({...z,cardSize:F})),children:F.charAt(0).toUpperCase()+F.slice(1)},F))})]})]})})]}),e.jsxs(I,{onClick:He,variant:"ghost",size:"sm",className:"text-black font-bold hover:bg-gray-100 rounded-full w-10 h-10 p-0 flex items-center justify-center",children:[e.jsx(zt,{className:"h-6 w-6"}),e.jsx("span",{className:"sr-only",children:"Add Card"})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:r,className:"flex items-center gap-2",children:t.user?e.jsxs(e.Fragment,{children:[e.jsx(Kr,{user:t.user,size:"sm",onClick:r,showHoverEffect:!0}),e.jsx("span",{className:"hidden sm:inline text-sm",children:t.user.username||"User"})]}):e.jsxs(e.Fragment,{children:[e.jsx(jo,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline text-sm",children:"Login"})]})})]})]})}),e.jsxs("main",{className:"flex h-[calc(100vh-4rem)]",children:[e.jsx("div",{className:"absolute top-16 left-0 right-0 z-30 bg-background border-b",children:e.jsx(nd,{onOpenConflictPanel:()=>P(!0)})}),e.jsxs("aside",{className:T("border-r transition-all duration-300 ease-in-out flex flex-col",_?"w-16":"w-72"),children:[e.jsx("div",{className:"p-3 flex items-center justify-end",children:e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>U(!_),className:"h-8 w-8 p-0",children:_?e.jsx(Gt,{className:"h-4 w-4"}):e.jsx(Co,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-3 space-y-4",children:[!_&&e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{className:"w-full justify-start",onClick:He,children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"New Card"]}),e.jsxs(I,{variant:"outline",className:"w-full justify-start",onClick:Ee,children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"New Folder"]})]}),e.jsx(st,{className:"my-4"})]}),_&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"w-full h-10 p-0",onClick:He,title:"New Card",children:e.jsx(zt,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"w-full h-10 p-0",onClick:Ee,title:"New Folder",children:e.jsx(xs,{className:"h-4 w-4"})}),e.jsx(st,{className:"my-4"})]}),e.jsxs("div",{children:[!_&&e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Folders"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(I,{variant:b?"ghost":"secondary",className:T("w-full text-sm",_?"h-10 p-0":"justify-start"),onClick:()=>Xe(null),title:_?"All Cards":void 0,children:[e.jsx(Oe,{className:"h-4 w-4"}),!_&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"ml-2",children:"All Cards"}),e.jsx(K,{variant:"secondary",className:"ml-auto",children:n.length})]})]}),_?Z(u):Q(u)]})]}),e.jsx(st,{}),e.jsxs("div",{children:[!_&&e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Tags"}),o.tags.length>0&&e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>i({...o,tags:[]}),className:"h-6 px-2 text-xs",children:"Clear"})]}),e.jsx("div",{className:"space-y-1",children:v(_?5:10).map(F=>e.jsx(qc,{tagName:F.name,onRename:yt,onDelete:Ce,disabled:_,children:e.jsxs(I,{variant:o.tags.includes(F.name)?"secondary":"ghost",className:T("w-full text-sm",_?"h-10 p-0":"justify-start"),onClick:()=>Lt(F.name),title:_?`${F.name} (Right-click to expand sidebar for tag management)`:F.name,children:[e.jsx(rr,{className:"h-3 w-3",style:{color:F.color}}),!_&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"ml-2",children:F.name}),e.jsx(K,{variant:"secondary",className:"ml-auto",children:F.count})]})]})},F.id))})]}),!_&&(o.tags.length>0||o.searchTerm)&&e.jsxs(e.Fragment,{children:[e.jsx(st,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Active Filters"}),e.jsxs("div",{className:"space-y-2",children:[o.searchTerm&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:['"',o.searchTerm,'"']})]}),o.tags.map(F=>e.jsx(K,{variant:"secondary",className:"mr-1",children:F},F))]})]})]})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-4",children:e.jsx(Xi,{cards:n,onCardFlip:me,onCardUpdate:Me,onCardCopy:as,onCardScreenshot:rs,onCardShare:Je,onCardDelete:ns,onMoveToFolder:It,cardSize:l.cardSize==="small"?"sm":l.cardSize==="large"?"lg":"md",enableVirtualization:n.length>20,gap:J.gap,overscan:3})})})]}),e.jsx(Nc,{isOpen:Ve,onClose:ss,onConfirm:ts,previewUrl:pt?.previewUrl||null,fileName:pt?.fileName||"",isDownloading:Ft}),e.jsx(Wc,{isOpen:A,onClose:()=>{E(!1),V(null),je(void 0)},onConfirm:os,parentId:Ke,initialData:c.useMemo(()=>M?{name:M.name,color:M.color,icon:M.icon}:void 0,[M]),mode:M?"edit":"create"}),e.jsx(Kc,{isOpen:O,onClose:()=>{H(!1),ke(null)},onConfirm:Pt,folderName:ie?.name||"",cardCount:ie?.cardCount||0,hasSubfolders:ie?.hasSubfolders||!1,subfolderCount:ie?.subfolderCount||0}),e.jsx(Jc,{isOpen:mt,onClose:()=>{qe(!1),ht("")},onConfirm:is,tagName:_t,existingTags:w()}),e.jsx(Xc,{isOpen:es,onClose:()=>{ft(!1),gt(null)},onConfirm:Y,tagName:pe?.name||"",cardCount:pe?.cardCount||0}),e.jsx(sd,{}),e.jsx(cd,{isOpen:ue,onClose:()=>P(!1)}),te&&e.jsx(gd,{conflictId:te,onClose:()=>{R(!1),ee(null)}})]})})}const kd={theme:"system",setTheme:()=>null},Td=c.createContext(kd);function Ed({children:a,defaultTheme:t="system",storageKey:s="vite-ui-theme",...r}){const[n,o]=c.useState(()=>localStorage.getItem(s)||t);c.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),n==="system"){const m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(m);return}l.classList.add(n)},[n]);const i={theme:n,setTheme:l=>{localStorage.setItem(s,l),o(l)}};return e.jsx(Td.Provider,{...r,value:i,children:a})}var Dd=a=>{switch(a){case"success":return _d;case"info":return Id;case"warning":return Fd;case"error":return Md;default:return null}},Ad=Array(12).fill(0),Rd=({visible:a,className:t})=>L.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":a},L.createElement("div",{className:"sonner-spinner"},Ad.map((s,r)=>L.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),_d=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Fd=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Id=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Md=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Pd=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},L.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),L.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ld=()=>{let[a,t]=L.useState(document.hidden);return L.useEffect(()=>{let s=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),a},Ns=1,Od=class{constructor(){this.subscribe=a=>(this.subscribers.push(a),()=>{let t=this.subscribers.indexOf(a);this.subscribers.splice(t,1)}),this.publish=a=>{this.subscribers.forEach(t=>t(a))},this.addToast=a=>{this.publish(a),this.toasts=[...this.toasts,a]},this.create=a=>{var t;let{message:s,...r}=a,n=typeof a?.id=="number"||((t=a.id)==null?void 0:t.length)>0?a.id:Ns++,o=this.toasts.find(l=>l.id===n),i=a.dismissible===void 0?!0:a.dismissible;return this.dismissedToasts.has(n)&&this.dismissedToasts.delete(n),o?this.toasts=this.toasts.map(l=>l.id===n?(this.publish({...l,...a,id:n,title:s}),{...l,...a,id:n,dismissible:i,title:s}):l):this.addToast({title:s,...r,dismissible:i,id:n}),n},this.dismiss=a=>(this.dismissedToasts.add(a),a||this.toasts.forEach(t=>{this.subscribers.forEach(s=>s({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:a,dismiss:!0})),a),this.message=(a,t)=>this.create({...t,message:a}),this.error=(a,t)=>this.create({...t,message:a,type:"error"}),this.success=(a,t)=>this.create({...t,type:"success",message:a}),this.info=(a,t)=>this.create({...t,type:"info",message:a}),this.warning=(a,t)=>this.create({...t,type:"warning",message:a}),this.loading=(a,t)=>this.create({...t,type:"loading",message:a}),this.promise=(a,t)=>{if(!t)return;let s;t.loading!==void 0&&(s=this.create({...t,promise:a,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let r=a instanceof Promise?a:a(),n=s!==void 0,o,i=r.then(async m=>{if(o=["resolve",m],L.isValidElement(m))n=!1,this.create({id:s,type:"default",message:m});else if($d(m)&&!m.ok){n=!1;let f=typeof t.error=="function"?await t.error(`HTTP error! status: ${m.status}`):t.error,d=typeof t.description=="function"?await t.description(`HTTP error! status: ${m.status}`):t.description;this.create({id:s,type:"error",message:f,description:d})}else if(t.success!==void 0){n=!1;let f=typeof t.success=="function"?await t.success(m):t.success,d=typeof t.description=="function"?await t.description(m):t.description;this.create({id:s,type:"success",message:f,description:d})}}).catch(async m=>{if(o=["reject",m],t.error!==void 0){n=!1;let f=typeof t.error=="function"?await t.error(m):t.error,d=typeof t.description=="function"?await t.description(m):t.description;this.create({id:s,type:"error",message:f,description:d})}}).finally(()=>{var m;n&&(this.dismiss(s),s=void 0),(m=t.finally)==null||m.call(t)}),l=()=>new Promise((m,f)=>i.then(()=>o[0]==="reject"?f(o[1]):m(o[1])).catch(f));return typeof s!="string"&&typeof s!="number"?{unwrap:l}:Object.assign(s,{unwrap:l})},this.custom=(a,t)=>{let s=t?.id||Ns++;return this.create({jsx:a(s),id:s,...t}),s},this.getActiveToasts=()=>this.toasts.filter(a=>!this.dismissedToasts.has(a.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},fe=new Od,zd=(a,t)=>{let s=t?.id||Ns++;return fe.addToast({title:a,...t,id:s}),s},$d=a=>a&&typeof a=="object"&&"ok"in a&&typeof a.ok=="boolean"&&"status"in a&&typeof a.status=="number",Ud=zd,Bd=()=>fe.toasts,Vd=()=>fe.getActiveToasts();Object.assign(Ud,{success:fe.success,info:fe.info,warning:fe.warning,error:fe.error,custom:fe.custom,message:fe.message,promise:fe.promise,dismiss:fe.dismiss,loading:fe.loading},{getHistory:Bd,getToasts:Vd});function Hd(a,{insertAt:t}={}){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&s.firstChild?s.insertBefore(r,s.firstChild):s.appendChild(r),r.styleSheet?r.styleSheet.cssText=a:r.appendChild(document.createTextNode(a))}Hd(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Ot(a){return a.label!==void 0}var Wd=3,Gd="32px",Yd="16px",ra=4e3,Kd=356,qd=14,Jd=20,Xd=200;function we(...a){return a.filter(Boolean).join(" ")}function Qd(a){let[t,s]=a.split("-"),r=[];return t&&r.push(t),s&&r.push(s),r}var Zd=a=>{var t,s,r,n,o,i,l,m,f,d,y;let{invert:g,toast:u,unstyled:b,interacting:C,setHeights:j,visibleToasts:p,heights:h,index:x,toasts:v,expanded:k,removeToast:N,defaultRichColors:w,closeButton:S,style:D,cancelButtonStyle:B,actionButtonStyle:_,className:U="",descriptionClassName:J="",duration:$,position:X,gap:te,loadingIcon:ee,expandByDefault:ue,classNames:P,icons:G,closeButtonAriaLabel:R="Close toast",pauseWhenPageIsHidden:A}=a,[E,O]=L.useState(null),[H,M]=L.useState(null),[V,ie]=L.useState(!1),[ke,Ke]=L.useState(!1),[je,mt]=L.useState(!1),[qe,es]=L.useState(!1),[ft,_t]=L.useState(!1),[ht,pe]=L.useState(0),[gt,Ft]=L.useState(0),Ve=L.useRef(u.duration||$||ra),pt=L.useRef(null),Te=L.useRef(null),ts=x===0,ss=x+1<=p,me=u.type,Me=u.dismissible!==!1,as=u.className||"",rs=u.descriptionClassName||"",Je=L.useMemo(()=>h.findIndex(Y=>Y.toastId===u.id)||0,[h,u.id]),ns=L.useMemo(()=>{var Y;return(Y=u.closeButton)!=null?Y:S},[u.closeButton,S]),It=L.useMemo(()=>u.duration||$||ra,[u.duration,$]),He=L.useRef(0),Ee=L.useRef(0),xt=L.useRef(0),De=L.useRef(null),[Mt,os]=X.split("-"),Pt=L.useMemo(()=>h.reduce((Y,Q,Z)=>Z>=Je?Y:Y+Q.height,0),[h,Je]),Lt=Ld(),Xe=u.invert||g,yt=me==="loading";Ee.current=L.useMemo(()=>Je*te+Pt,[Je,Pt]),L.useEffect(()=>{Ve.current=It},[It]),L.useEffect(()=>{ie(!0)},[]),L.useEffect(()=>{let Y=Te.current;if(Y){let Q=Y.getBoundingClientRect().height;return Ft(Q),j(Z=>[{toastId:u.id,height:Q,position:u.position},...Z]),()=>j(Z=>Z.filter(F=>F.toastId!==u.id))}},[j,u.id]),L.useLayoutEffect(()=>{if(!V)return;let Y=Te.current,Q=Y.style.height;Y.style.height="auto";let Z=Y.getBoundingClientRect().height;Y.style.height=Q,Ft(Z),j(F=>F.find(z=>z.toastId===u.id)?F.map(z=>z.toastId===u.id?{...z,height:Z}:z):[{toastId:u.id,height:Z,position:u.position},...F])},[V,u.title,u.description,j,u.id]);let Ce=L.useCallback(()=>{Ke(!0),pe(Ee.current),j(Y=>Y.filter(Q=>Q.toastId!==u.id)),setTimeout(()=>{N(u)},Xd)},[u,N,j,Ee]);L.useEffect(()=>{if(u.promise&&me==="loading"||u.duration===1/0||u.type==="loading")return;let Y;return k||C||A&&Lt?(()=>{if(xt.current<He.current){let Q=new Date().getTime()-He.current;Ve.current=Ve.current-Q}xt.current=new Date().getTime()})():Ve.current!==1/0&&(He.current=new Date().getTime(),Y=setTimeout(()=>{var Q;(Q=u.onAutoClose)==null||Q.call(u,u),Ce()},Ve.current)),()=>clearTimeout(Y)},[k,C,u,me,A,Lt,Ce]),L.useEffect(()=>{u.delete&&Ce()},[Ce,u.delete]);function is(){var Y,Q,Z;return G!=null&&G.loading?L.createElement("div",{className:we(P?.loader,(Y=u?.classNames)==null?void 0:Y.loader,"sonner-loader"),"data-visible":me==="loading"},G.loading):ee?L.createElement("div",{className:we(P?.loader,(Q=u?.classNames)==null?void 0:Q.loader,"sonner-loader"),"data-visible":me==="loading"},ee):L.createElement(Rd,{className:we(P?.loader,(Z=u?.classNames)==null?void 0:Z.loader),visible:me==="loading"})}return L.createElement("li",{tabIndex:0,ref:Te,className:we(U,as,P?.toast,(t=u?.classNames)==null?void 0:t.toast,P?.default,P?.[me],(s=u?.classNames)==null?void 0:s[me]),"data-sonner-toast":"","data-rich-colors":(r=u.richColors)!=null?r:w,"data-styled":!(u.jsx||u.unstyled||b),"data-mounted":V,"data-promise":!!u.promise,"data-swiped":ft,"data-removed":ke,"data-visible":ss,"data-y-position":Mt,"data-x-position":os,"data-index":x,"data-front":ts,"data-swiping":je,"data-dismissible":Me,"data-type":me,"data-invert":Xe,"data-swipe-out":qe,"data-swipe-direction":H,"data-expanded":!!(k||ue&&V),style:{"--index":x,"--toasts-before":x,"--z-index":v.length-x,"--offset":`${ke?ht:Ee.current}px`,"--initial-height":ue?"auto":`${gt}px`,...D,...u.style},onDragEnd:()=>{mt(!1),O(null),De.current=null},onPointerDown:Y=>{yt||!Me||(pt.current=new Date,pe(Ee.current),Y.target.setPointerCapture(Y.pointerId),Y.target.tagName!=="BUTTON"&&(mt(!0),De.current={x:Y.clientX,y:Y.clientY}))},onPointerUp:()=>{var Y,Q,Z,F;if(qe||!Me)return;De.current=null;let z=Number(((Y=Te.current)==null?void 0:Y.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),q=Number(((Q=Te.current)==null?void 0:Q.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ce=new Date().getTime()-((Z=pt.current)==null?void 0:Z.getTime()),de=E==="x"?z:q,le=Math.abs(de)/ce;if(Math.abs(de)>=Jd||le>.11){pe(Ee.current),(F=u.onDismiss)==null||F.call(u,u),M(E==="x"?z>0?"right":"left":q>0?"down":"up"),Ce(),es(!0),_t(!1);return}mt(!1),O(null)},onPointerMove:Y=>{var Q,Z,F,z;if(!De.current||!Me||((Q=window.getSelection())==null?void 0:Q.toString().length)>0)return;let q=Y.clientY-De.current.y,ce=Y.clientX-De.current.x,de=(Z=a.swipeDirections)!=null?Z:Qd(X);!E&&(Math.abs(ce)>1||Math.abs(q)>1)&&O(Math.abs(ce)>Math.abs(q)?"x":"y");let le={x:0,y:0};E==="y"?(de.includes("top")||de.includes("bottom"))&&(de.includes("top")&&q<0||de.includes("bottom")&&q>0)&&(le.y=q):E==="x"&&(de.includes("left")||de.includes("right"))&&(de.includes("left")&&ce<0||de.includes("right")&&ce>0)&&(le.x=ce),(Math.abs(le.x)>0||Math.abs(le.y)>0)&&_t(!0),(F=Te.current)==null||F.style.setProperty("--swipe-amount-x",`${le.x}px`),(z=Te.current)==null||z.style.setProperty("--swipe-amount-y",`${le.y}px`)}},ns&&!u.jsx?L.createElement("button",{"aria-label":R,"data-disabled":yt,"data-close-button":!0,onClick:yt||!Me?()=>{}:()=>{var Y;Ce(),(Y=u.onDismiss)==null||Y.call(u,u)},className:we(P?.closeButton,(n=u?.classNames)==null?void 0:n.closeButton)},(o=G?.close)!=null?o:Pd):null,u.jsx||c.isValidElement(u.title)?u.jsx?u.jsx:typeof u.title=="function"?u.title():u.title:L.createElement(L.Fragment,null,me||u.icon||u.promise?L.createElement("div",{"data-icon":"",className:we(P?.icon,(i=u?.classNames)==null?void 0:i.icon)},u.promise||u.type==="loading"&&!u.icon?u.icon||is():null,u.type!=="loading"?u.icon||G?.[me]||Dd(me):null):null,L.createElement("div",{"data-content":"",className:we(P?.content,(l=u?.classNames)==null?void 0:l.content)},L.createElement("div",{"data-title":"",className:we(P?.title,(m=u?.classNames)==null?void 0:m.title)},typeof u.title=="function"?u.title():u.title),u.description?L.createElement("div",{"data-description":"",className:we(J,rs,P?.description,(f=u?.classNames)==null?void 0:f.description)},typeof u.description=="function"?u.description():u.description):null),c.isValidElement(u.cancel)?u.cancel:u.cancel&&Ot(u.cancel)?L.createElement("button",{"data-button":!0,"data-cancel":!0,style:u.cancelButtonStyle||B,onClick:Y=>{var Q,Z;Ot(u.cancel)&&Me&&((Z=(Q=u.cancel).onClick)==null||Z.call(Q,Y),Ce())},className:we(P?.cancelButton,(d=u?.classNames)==null?void 0:d.cancelButton)},u.cancel.label):null,c.isValidElement(u.action)?u.action:u.action&&Ot(u.action)?L.createElement("button",{"data-button":!0,"data-action":!0,style:u.actionButtonStyle||_,onClick:Y=>{var Q,Z;Ot(u.action)&&((Z=(Q=u.action).onClick)==null||Z.call(Q,Y),!Y.defaultPrevented&&Ce())},className:we(P?.actionButton,(y=u?.classNames)==null?void 0:y.actionButton)},u.action.label):null))};function na(){if(typeof window>"u"||typeof document>"u")return"ltr";let a=document.documentElement.getAttribute("dir");return a==="auto"||!a?window.getComputedStyle(document.documentElement).direction:a}function eu(a,t){let s={};return[a,t].forEach((r,n)=>{let o=n===1,i=o?"--mobile-offset":"--offset",l=o?Yd:Gd;function m(f){["top","right","bottom","left"].forEach(d=>{s[`${i}-${d}`]=typeof f=="number"?`${f}px`:f})}typeof r=="number"||typeof r=="string"?m(r):typeof r=="object"?["top","right","bottom","left"].forEach(f=>{r[f]===void 0?s[`${i}-${f}`]=l:s[`${i}-${f}`]=typeof r[f]=="number"?`${r[f]}px`:r[f]}):m(l)}),s}var tu=c.forwardRef(function(a,t){let{invert:s,position:r="bottom-right",hotkey:n=["altKey","KeyT"],expand:o,closeButton:i,className:l,offset:m,mobileOffset:f,theme:d="light",richColors:y,duration:g,style:u,visibleToasts:b=Wd,toastOptions:C,dir:j=na(),gap:p=qd,loadingIcon:h,icons:x,containerAriaLabel:v="Notifications",pauseWhenPageIsHidden:k}=a,[N,w]=L.useState([]),S=L.useMemo(()=>Array.from(new Set([r].concat(N.filter(A=>A.position).map(A=>A.position)))),[N,r]),[D,B]=L.useState([]),[_,U]=L.useState(!1),[J,$]=L.useState(!1),[X,te]=L.useState(d!=="system"?d:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ee=L.useRef(null),ue=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),P=L.useRef(null),G=L.useRef(!1),R=L.useCallback(A=>{w(E=>{var O;return(O=E.find(H=>H.id===A.id))!=null&&O.delete||fe.dismiss(A.id),E.filter(({id:H})=>H!==A.id)})},[]);return L.useEffect(()=>fe.subscribe(A=>{if(A.dismiss){w(E=>E.map(O=>O.id===A.id?{...O,delete:!0}:O));return}setTimeout(()=>{qn.flushSync(()=>{w(E=>{let O=E.findIndex(H=>H.id===A.id);return O!==-1?[...E.slice(0,O),{...E[O],...A},...E.slice(O+1)]:[A,...E]})})})}),[]),L.useEffect(()=>{if(d!=="system"){te(d);return}if(d==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?te("dark"):te("light")),typeof window>"u")return;let A=window.matchMedia("(prefers-color-scheme: dark)");try{A.addEventListener("change",({matches:E})=>{te(E?"dark":"light")})}catch{A.addListener(({matches:O})=>{try{te(O?"dark":"light")}catch(H){console.error(H)}})}},[d]),L.useEffect(()=>{N.length<=1&&U(!1)},[N]),L.useEffect(()=>{let A=E=>{var O,H;n.every(M=>E[M]||E.code===M)&&(U(!0),(O=ee.current)==null||O.focus()),E.code==="Escape"&&(document.activeElement===ee.current||(H=ee.current)!=null&&H.contains(document.activeElement))&&U(!1)};return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[n]),L.useEffect(()=>{if(ee.current)return()=>{P.current&&(P.current.focus({preventScroll:!0}),P.current=null,G.current=!1)}},[ee.current]),L.createElement("section",{ref:t,"aria-label":`${v} ${ue}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},S.map((A,E)=>{var O;let[H,M]=A.split("-");return N.length?L.createElement("ol",{key:A,dir:j==="auto"?na():j,tabIndex:-1,ref:ee,className:l,"data-sonner-toaster":!0,"data-theme":X,"data-y-position":H,"data-lifted":_&&N.length>1&&!o,"data-x-position":M,style:{"--front-toast-height":`${((O=D[0])==null?void 0:O.height)||0}px`,"--width":`${Kd}px`,"--gap":`${p}px`,...u,...eu(m,f)},onBlur:V=>{G.current&&!V.currentTarget.contains(V.relatedTarget)&&(G.current=!1,P.current&&(P.current.focus({preventScroll:!0}),P.current=null))},onFocus:V=>{V.target instanceof HTMLElement&&V.target.dataset.dismissible==="false"||G.current||(G.current=!0,P.current=V.relatedTarget)},onMouseEnter:()=>U(!0),onMouseMove:()=>U(!0),onMouseLeave:()=>{J||U(!1)},onDragEnd:()=>U(!1),onPointerDown:V=>{V.target instanceof HTMLElement&&V.target.dataset.dismissible==="false"||$(!0)},onPointerUp:()=>$(!1)},N.filter(V=>!V.position&&E===0||V.position===A).map((V,ie)=>{var ke,Ke;return L.createElement(Zd,{key:V.id,icons:x,index:ie,toast:V,defaultRichColors:y,duration:(ke=C?.duration)!=null?ke:g,className:C?.className,descriptionClassName:C?.descriptionClassName,invert:s,visibleToasts:b,closeButton:(Ke=C?.closeButton)!=null?Ke:i,interacting:J,position:A,style:C?.style,unstyled:C?.unstyled,classNames:C?.classNames,cancelButtonStyle:C?.cancelButtonStyle,actionButtonStyle:C?.actionButtonStyle,removeToast:R,toasts:N.filter(je=>je.position==V.position),heights:D.filter(je=>je.position==V.position),setHeights:B,expandByDefault:o,gap:p,loadingIcon:h,expanded:_,pauseWhenPageIsHidden:k,swipeDirections:a.swipeDirections})})):null}))});const su=({...a})=>e.jsx(tu,{theme:"light",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...a});function au({open:a,onOpenChange:t}){const[s,r]=c.useState({user:null,session:null,loading:!1,error:null}),[n,o]=c.useState("main"),[i,l]=c.useState(!1),[m,f]=c.useState({email:"",password:"",confirmPassword:"",name:""}),[d,y]=c.useState({}),[g,u]=c.useState(!1);c.useEffect(()=>Le.onAuthStateChange(r),[]);const b=()=>{f({email:"",password:"",confirmPassword:"",name:""}),y({}),u(!1),l(!1)},C=_=>{const U={};return(_==="email-login"||_==="email-signup"||_==="forgot-password")&&(m.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.email)||(U.email="请输入有效的邮箱地址"):U.email="请输入邮箱地址"),(_==="email-login"||_==="email-signup")&&(m.password?m.password.length<6&&(U.password="密码至少需要6个字符"):U.password="请输入密码"),_==="email-signup"&&(m.name||(U.name="请输入姓名"),m.password!==m.confirmPassword&&(U.confirmPassword="两次输入的密码不一致")),y(U),Object.keys(U).length===0},j=async()=>{u(!0);const{error:_}=await Le.signInWithGitHub();_&&console.error("GitHub登录失败:",_),u(!1)},p=async()=>{if(!C("email-login"))return;u(!0);const{error:_}=await Le.signInWithEmail(m.email,m.password);_?y({general:_.message}):(t(!1),b(),o("main")),u(!1)},h=async()=>{if(!C("email-signup"))return;u(!0);const{error:_}=await Le.signUpWithEmail(m.email,m.password,{name:m.name});_?y({general:_.message}):o("check-email"),u(!1)},x=async()=>{if(!C("forgot-password"))return;u(!0);const{error:_}=await Le.resetPassword(m.email);_?y({general:_.message}):o("check-email"),u(!1)},v=async()=>{const{error:_}=await Le.signOut();_&&console.error("登出失败:",_)},k=async()=>{await Jn.performFullSync()};if(s.user)return e.jsx(Ge,{open:a,onOpenChange:t,children:e.jsx(Ue,{className:"sm:max-w-md border-0 shadow-2xl",children:e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsx(se,{className:"border-0 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20",children:e.jsx(ae,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Kr,{user:s.user,size:"lg",className:"h-16 w-16 shadow-lg",showHoverEffect:!1}),e.jsx("div",{className:"absolute -bottom-1 -right-1 h-5 w-5 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.user.username||"用户"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.user.email}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(St,{className:"h-3 w-3 text-green-500"}),e.jsx("span",{className:"text-xs text-green-600",children:"云端同步已启用"})]})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{onClick:k,variant:"outline",className:"w-full h-12 rounded-2xl border-2 hover:bg-blue-50 transition-all duration-200",disabled:s.loading,children:[s.loading?e.jsx(wt,{className:"h-5 w-5 mr-2 animate-spin"}):e.jsx(St,{className:"h-5 w-5 mr-2 text-blue-500"}),"立即同步数据"]}),e.jsx(I,{onClick:v,variant:"ghost",className:"w-full h-12 rounded-2xl hover:bg-red-50 hover:text-red-600 transition-all duration-200",disabled:s.loading,children:"退出登录"})]})]})})});const N=()=>e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"欢迎使用 CardAll"}),e.jsx("p",{className:"text-muted-foreground",children:"选择您的登录方式"})]}),e.jsxs(I,{onClick:j,disabled:g,className:"w-full h-14 rounded-2xl bg-gray-900 hover:bg-gray-800 text-white shadow-lg transition-all duration-200 transform hover:scale-[1.02]",size:"lg",children:[g?e.jsx(wt,{className:"h-5 w-5 mr-3 animate-spin"}):e.jsx(No,{className:"h-5 w-5 mr-3"}),"使用 GitHub 登录"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-4 text-muted-foreground",children:"或"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{onClick:()=>o("email-login"),variant:"outline",className:"w-full h-14 rounded-2xl border-2 hover:bg-blue-50 transition-all duration-200 transform hover:scale-[1.02]",size:"lg",children:[e.jsx(bt,{className:"h-5 w-5 mr-3 text-blue-500"}),"使用邮箱登录"]}),e.jsxs(I,{onClick:()=>o("email-signup"),variant:"ghost",className:"w-full h-12 rounded-2xl hover:bg-green-50 hover:text-green-600 transition-all duration-200",children:[e.jsx(Us,{className:"h-4 w-4 mr-2"}),"创建新账户"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-center space-y-1 pt-4",children:[e.jsx("p",{children:"登录后可享受云端同步功能"}),e.jsx("p",{children:"即使不登录也可正常使用本地功能"})]})]}),w=()=>e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>o("main"),className:"rounded-full p-2",children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"邮箱登录"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"email",children:"邮箱地址"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(he,{id:"email",type:"email",placeholder:"输入您的邮箱地址",value:m.email,onChange:_=>f(U=>({...U,email:_.target.value})),className:"pl-10 h-12 rounded-2xl border-2"})]}),d.email&&e.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),d.email]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"password",children:"密码"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(he,{id:"password",type:i?"text":"password",placeholder:"输入您的密码",value:m.password,onChange:_=>f(U=>({...U,password:_.target.value})),className:"pl-10 pr-10 h-12 rounded-2xl border-2"}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-10 w-10 rounded-xl",onClick:()=>l(!i),children:i?e.jsx(ys,{className:"h-4 w-4"}):e.jsx(Bt,{className:"h-4 w-4"})})]}),d.password&&e.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),d.password]})]}),e.jsx("div",{className:"text-right",children:e.jsx(I,{variant:"link",size:"sm",onClick:()=>o("forgot-password"),className:"text-blue-600 hover:text-blue-700 p-0 h-auto",children:"忘记密码？"})}),d.general&&e.jsxs("div",{className:"text-sm text-red-500 text-center bg-red-50 p-3 rounded-2xl flex items-center justify-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),d.general]}),e.jsxs(I,{onClick:p,disabled:g,className:"w-full h-12 rounded-2xl bg-blue-600 hover:bg-blue-700 transition-all duration-200",children:[g?e.jsx(wt,{className:"h-4 w-4 mr-2 animate-spin"}):null,"登录"]})]})]}),S=()=>e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>o("main"),className:"rounded-full p-2",children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"创建账户"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"name",children:"姓名"}),e.jsxs("div",{className:"relative",children:[e.jsx(Us,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(he,{id:"name",type:"text",placeholder:"输入您的姓名",value:m.name,onChange:_=>f(U=>({...U,name:_.target.value})),className:"pl-10 h-12 rounded-2xl border-2"})]}),d.name&&e.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),d.name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"signup-email",children:"邮箱地址"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(he,{id:"signup-email",type:"email",placeholder:"输入您的邮箱地址",value:m.email,onChange:_=>f(U=>({...U,email:_.target.value})),className:"pl-10 h-12 rounded-2xl border-2"})]}),d.email&&e.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),d.email]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"signup-password",children:"密码"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(he,{id:"signup-password",type:i?"text":"password",placeholder:"设置您的密码（至少6个字符）",value:m.password,onChange:_=>f(U=>({...U,password:_.target.value})),className:"pl-10 pr-10 h-12 rounded-2xl border-2"}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-10 w-10 rounded-xl",onClick:()=>l(!i),children:i?e.jsx(ys,{className:"h-4 w-4"}):e.jsx(Bt,{className:"h-4 w-4"})})]}),d.password&&e.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),d.password]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"confirm-password",children:"确认密码"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(he,{id:"confirm-password",type:i?"text":"password",placeholder:"再次输入密码",value:m.confirmPassword,onChange:_=>f(U=>({...U,confirmPassword:_.target.value})),className:"pl-10 h-12 rounded-2xl border-2"})]}),d.confirmPassword&&e.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),d.confirmPassword]})]}),d.general&&e.jsxs("div",{className:"text-sm text-red-500 text-center bg-red-50 p-3 rounded-2xl flex items-center justify-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),d.general]}),e.jsxs(I,{onClick:h,disabled:g,className:"w-full h-12 rounded-2xl bg-green-600 hover:bg-green-700 transition-all duration-200",children:[g?e.jsx(wt,{className:"h-4 w-4 mr-2 animate-spin"}):null,"创建账户"]}),e.jsx("div",{className:"text-xs text-muted-foreground text-center",children:e.jsx("p",{children:"注册即表示您同意我们的服务条款和隐私政策"})})]})]}),D=()=>e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>o("email-login"),className:"rounded-full p-2",children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"重置密码"})]}),e.jsx("div",{className:"text-center space-y-2",children:e.jsx("p",{className:"text-muted-foreground",children:"输入您的邮箱地址，我们将发送重置密码的链接"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{htmlFor:"reset-email",children:"邮箱地址"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(he,{id:"reset-email",type:"email",placeholder:"输入您的邮箱地址",value:m.email,onChange:_=>f(U=>({...U,email:_.target.value})),className:"pl-10 h-12 rounded-2xl border-2"})]}),d.email&&e.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),d.email]})]}),d.general&&e.jsxs("div",{className:"text-sm text-red-500 text-center bg-red-50 p-3 rounded-2xl flex items-center justify-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),d.general]}),e.jsxs(I,{onClick:x,disabled:g,className:"w-full h-12 rounded-2xl bg-blue-600 hover:bg-blue-700 transition-all duration-200",children:[g?e.jsx(wt,{className:"h-4 w-4 mr-2 animate-spin"}):null,"发送重置链接"]})]})]}),B=()=>e.jsxs("div",{className:"space-y-6 p-2 text-center",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-16 w-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(bt,{className:"h-8 w-8 text-blue-600"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"检查您的邮箱"}),e.jsxs("p",{className:"text-muted-foreground",children:["我们已向 ",e.jsx("span",{className:"font-medium",children:m.email})," 发送了一封邮件"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["请点击邮件中的链接来完成",n==="check-email"?"账户激活":"密码重置"]})]}),e.jsx(I,{onClick:()=>{o("main"),b()},variant:"outline",className:"w-full h-12 rounded-2xl border-2",children:"返回登录"})]});return e.jsx(Ge,{open:a,onOpenChange:_=>{t(_),_||(o("main"),b())},children:e.jsxs(Ue,{className:"sm:max-w-md border-0 shadow-2xl rounded-3xl",children:[n==="main"&&N(),n==="email-login"&&w(),n==="email-signup"&&S(),n==="forgot-password"&&D(),n==="check-email"&&B()]})})}const ru=({onClose:a})=>{const[t,s]=c.useState(null),[r,n]=c.useState(!1),[o,i]=c.useState(!1),[l,m]=c.useState(navigator.onLine);c.useEffect(()=>{const y=()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0)},g=j=>{j.preventDefault(),s(j),setTimeout(()=>{o||n(!0)},3e3)},u=()=>{i(!0),n(!1),s(null),console.log("PWA was installed")},b=()=>m(!0),C=()=>m(!1);return y(),window.addEventListener("beforeinstallprompt",g),window.addEventListener("appinstalled",u),window.addEventListener("online",b),window.addEventListener("offline",C),()=>{window.removeEventListener("beforeinstallprompt",g),window.removeEventListener("appinstalled",u),window.removeEventListener("online",b),window.removeEventListener("offline",C)}},[o]);const f=async()=>{if(t)try{await t.prompt();const{outcome:y}=await t.userChoice;console.log(y==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),s(null),n(!1)}catch(y){console.error("Error during installation:",y)}},d=()=>{n(!1),a?.()};return!r||o?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-sm",children:e.jsxs(se,{className:"shadow-lg border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-white",children:[e.jsxs(Fe,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nt,{className:"h-5 w-5 text-blue-600"}),e.jsx(Ie,{className:"text-lg",children:"安装 CardAll"})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:d,className:"h-6 w-6 p-0",children:e.jsx(Ye,{className:"h-4 w-4"})})]}),e.jsx(hn,{children:"将 CardAll 安装到您的设备上，享受更好的体验"})]}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[l?e.jsx(Yt,{className:"h-4 w-4"}):e.jsx(Ts,{className:"h-4 w-4"}),e.jsx("span",{children:l?"在线使用":"离线可用"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx(So,{className:"h-4 w-4"}),e.jsx("span",{children:"移动优化"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[e.jsx(ko,{className:"h-4 w-4"}),e.jsx("span",{children:"桌面应用"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(nt,{className:"h-4 w-4"}),e.jsx("span",{children:"快速启动"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"安装后您将获得："}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 完全离线功能"}),e.jsx("li",{children:"• 更快的加载速度"}),e.jsx("li",{children:"• 桌面快捷方式"}),e.jsx("li",{children:"• 推送通知支持"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{onClick:f,className:"flex-1 bg-blue-600 hover:bg-blue-700",disabled:!t,children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"立即安装"]}),e.jsx(I,{variant:"outline",onClick:d,className:"px-3",children:"稍后"})]})]})]})})};function nu(){const{isOpen:a,closeModal:t}=gr();return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Xo,{children:e.jsx(Bi,{children:e.jsx(Vi,{children:e.jsx(Sd,{})})})}),e.jsx(ru,{}),e.jsx(au,{open:a,onOpenChange:t}),e.jsx(su,{})]})}function ou(){return e.jsx(Ed,{defaultTheme:"light",storageKey:"cardall-theme",children:e.jsx(Zo,{children:e.jsx(nu,{})})})}ws.createRoot(document.getElementById("root")).render(e.jsx(L.StrictMode,{children:e.jsx(ou,{})}));
