const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sync-B1UcmV1r.js","assets/database-DxqBSE4h.js","assets/vendor-oiyroGFu.js"])))=>i.map(i=>d[i]);
import{j as r,S as Ur,a as Qa,b as Za,P as Wr,C as es,I as ts,c as as,d as ss,R as rs,L as ns,e as os,f as Vr,T as Hr,g as is,V as Gr,h as Kr,i as ls,k as Yr,O as cs,l as qr,m as ds,n as Jr,o as us,D as ms,p as Xr,q as gs,r as Qr,s as Zr,t as en,u as fs,v as hs,w as tn,x as ps,y as an,z as sn,A as ys,B as ws,E as rn,F as xs,G as bs,H as vs,J as Cs,K as Ss,M as js,N as Es,Q as nn,U as on,W as ks,X as ln,Y as Ns,Z as Ds,_ as cn,$ as Rs,a0 as dn,a1 as Ts,a2 as As,a3 as un,a4 as mn,a5 as Is,a6 as gn,a7 as fn,a8 as _s,a9 as hn,aa as Ms,ab as Fs,ac as Os,ad as Ps,ae as Ls,af as pn,ag as $s,ah as yn}from"./radix-CytCvghT.js";import{a as Bt,r as d,R as O,v as wn}from"./vendor-oiyroGFu.js";import{_ as xa}from"./supabase-BInsWgUg.js";import{db as _,initializeDatabase as xn}from"./sync-B1UcmV1r.js";import{t as bn,c as vn,a as zt}from"./utils--BulIq_u.js";import{C as ba,a as Be,b as Bs,S as Cn,I as zs,X as Ye,c as Sn,E as jn,P as En,d as kn,e as ca,f as Nn,g as Us,T as Ws,F as Lt,h as va,i as $e,H as Aa,j as xt,D as rt,k as Ia,l as Vs,m as da,n as Hs,o as Dn,p as Rn,B as Tn,q as An,r as In,Z as Gs,s as _n,L as Mn,t as Fn,u as nt,v as ua,w as Mt,x as On,A as _a,R as ma,y as Pn,W as Ks,U as Ln,z as $n,G as Bn,J as Ft,K as zn,M as Un,N as Wn,O as Vn,Q as Hn,V as Gn}from"./icons-DhmsObv3.js";import{u as Kn,i as Yn,M as qn,a as Jn,b as Xn,c as Qn,d as Zn,e as eo,f as to,g as ao,h as so,j as ro,E as no}from"./editor-BjFnpl3v.js";import"./database-DxqBSE4h.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var ga={},Ma=Bt;ga.createRoot=Ma.createRoot,ga.hydrateRoot=Ma.hydrateRoot;class yt{static PREFIX="cardall_";static VERSION="1.0";static setItem(e,t,a={}){try{const n=this.PREFIX+e,o={version:this.VERSION,timestamp:Date.now(),data:t,meta:{ttl:a.ttl,encrypted:a.encrypt||!1,compressed:a.compress||!1}};if(a.validate){const l=this.validateData(t);if(!l.isValid)return console.warn("Storage validation failed:",l.errors),!1}let i;try{i=this.serializeData(o)}catch(l){return console.error("Data serialization failed:",l),!1}return a.encrypt&&(i=this.encryptData(i)),a.compress&&(i=this.compressData(i)),localStorage.setItem(n,i),!0}catch(n){return console.error("Failed to store data securely:",n),!1}}static getItem(e,t={}){try{const a=this.PREFIX+e,n=localStorage.getItem(a);if(!n)return null;let o=n;t.compress&&(o=this.decompressData(o)),t.encrypt&&(o=this.decryptData(o));const i=this.deserializeData(o);if(i.version!==this.VERSION)return console.warn("Storage data version mismatch"),null;if(i.meta.ttl&&Date.now()-i.timestamp>i.meta.ttl)return console.log("Storage data expired, removing"),this.removeItem(e),null;if(t.validate){const l=this.validateData(i.data);if(!l.isValid)return console.warn("Retrieved data validation failed:",l.errors),null}return i.data}catch(a){return console.error("Failed to retrieve data securely:",a),null}}static removeItem(e){try{const t=this.PREFIX+e;localStorage.removeItem(t)}catch(t){console.error("Failed to remove storage item:",t)}}static clearAppData(){try{Object.keys(localStorage).forEach(t=>{t.startsWith(this.PREFIX)&&localStorage.removeItem(t)})}catch(e){console.error("Failed to clear app data:",e)}}static validateData(e){const t={isValid:!0,errors:[],warnings:[],sanitized:e};return e==null?t:this.hasPrototypePollution(e)?(t.isValid=!1,t.errors.push("Potential prototype pollution detected"),t):(this.hasCircularReference(e)&&(t.warnings.push("Circular reference detected in data"),t.sanitized=this.removeCircularReferences(e)),this.hasDangerousFunctions(e)?(t.isValid=!1,t.errors.push("Dangerous functions detected in data"),t):(this.estimateDataSize(e)>5*1024*1024&&t.warnings.push("Large data size may impact performance"),t))}static hasPrototypePollution(e){if(typeof e!="object"||e===null)return!1;const t=e;return["__proto__","constructor","prototype"].some(n=>n in t)}static hasCircularReference(e,t=new WeakSet){return typeof e!="object"||e===null?!1:t.has(e)?!0:(t.add(e),Array.isArray(e)?e.some(a=>this.hasCircularReference(a,t)):Object.values(e).some(a=>typeof a=="object"&&this.hasCircularReference(a,t)))}static removeCircularReferences(e,t=new WeakSet){if(typeof e!="object"||e===null)return e;if(t.has(e))return"[Circular]";if(t.add(e),Array.isArray(e))return e.map(n=>this.removeCircularReferences(n,t));const a={};for(const[n,o]of Object.entries(e))a[n]=this.removeCircularReferences(o,t);return a}static hasDangerousFunctions(e){if(typeof e!="object"||e===null)return!1;const t=e;if(Object.values(t).some(o=>typeof o=="function"))return!0;const a=["eval","Function","setTimeout","setInterval","document","window","global","process"],n=JSON.stringify(t).toLowerCase();return a.some(o=>n.includes(o.toLowerCase()))}static estimateDataSize(e){return new Blob([JSON.stringify(e)]).size}static serializeData(e){return JSON.stringify(e,(a,n)=>{if(typeof n!="function")return n===void 0?null:n instanceof Date?{__type:"Date",value:n.toISOString()}:n instanceof RegExp?{__type:"RegExp",value:n.toString()}:n})}static deserializeData(e){return JSON.parse(e,(a,n)=>{if(typeof n=="object"&&n!==null){const o=n;if(o.__type==="Date"&&typeof o.value=="string")return new Date(o.value);if(o.__type==="RegExp"&&typeof o.value=="string"){const i=o.value.match(/^\/(.*)\/([gim]*)$/);if(i)return new RegExp(i[1],i[2])}}return n})}static encryptData(e){const t="cardall-secure-key";let a="";for(let n=0;n<e.length;n++){const o=e.charCodeAt(n)^t.charCodeAt(n%t.length);a+=String.fromCharCode(o)}return btoa(a)}static decryptData(e){const t="cardall-secure-key",a=atob(e);let n="";for(let o=0;o<a.length;o++){const i=a.charCodeAt(o)^t.charCodeAt(o%t.length);n+=String.fromCharCode(i)}return n}static compressData(e){return e}static decompressData(e){return e}static getStorageStats(){try{const t=Object.keys(localStorage).filter(o=>o.startsWith(this.PREFIX));let a=0;const n=[];return t.forEach(o=>{const i=localStorage.getItem(o);if(i){const l=new Blob([i]).size;a+=l,n.push({key:o.replace(this.PREFIX,""),size:l,lastModified:Date.now()})}}),{totalSize:a,itemCount:t.length,items:n}}catch(e){return console.error("Failed to get storage stats:",e),{totalSize:0,itemCount:0,items:[]}}}}const W={set:(s,e,t)=>yt.setItem(s,e,t),get:(s,e)=>yt.getItem(s,e),remove:s=>yt.removeItem(s),clear:()=>yt.clearAppData(),getStats:()=>yt.getStorageStats()};class we{static dbCardToCard(e){const{userId:t,syncVersion:a,lastSyncAt:n,pendingSync:o,...i}=e;return{...i,id:i.id||"",createdAt:this.ensureDate(i.createdAt),updatedAt:this.ensureDate(i.updatedAt)}}static cardToDbCard(e,t){return{id:e.id,frontContent:e.frontContent,backContent:e.backContent,style:e.style,isFlipped:e.isFlipped,createdAt:this.ensureDate(e.createdAt),updatedAt:this.ensureDate(e.updatedAt),userId:t,syncVersion:1,pendingSync:!0,lastSyncAt:void 0}}static bulkDbCardsToCards(e){return e.map(t=>this.dbCardToCard(t))}static bulkCardsToDbCards(e,t){return e.map(a=>this.cardToDbCard(a,t))}static ensureDate(e){if(!e)return new Date;if(e instanceof Date)return e;try{return new Date(e)}catch{return new Date}}static validateCard(e){const t=[];return e.id||t.push("Card ID is required"),e.frontContent?.title||t.push("Front content title is required"),e.backContent?.title||t.push("Back content title is required"),e.createdAt||t.push("Created date is required"),e.updatedAt||t.push("Updated date is required"),{valid:t.length===0,errors:t}}static sanitizeCard(e){const t={};return e.id&&(t.id=e.id),e.frontContent&&(t.frontContent={title:String(e.frontContent.title||"").trim(),text:String(e.frontContent.text||"").trim(),images:Array.isArray(e.frontContent.images)?e.frontContent.images:[],tags:Array.isArray(e.frontContent.tags)?e.frontContent.tags.map(a=>String(a).trim()).filter(a=>a.length>0):[],lastModified:e.frontContent.lastModified||new Date}),e.backContent&&(t.backContent={title:String(e.backContent.title||"").trim(),text:String(e.backContent.text||"").trim(),images:Array.isArray(e.backContent.images)?e.backContent.images:[],tags:Array.isArray(e.backContent.tags)?e.backContent.tags.map(a=>String(a).trim()).filter(a=>a.length>0):[],lastModified:e.backContent.lastModified||new Date}),e.style&&(t.style={type:e.style.type||"solid",backgroundColor:e.style.backgroundColor||"#ffffff",fontFamily:e.style.fontFamily||"system-ui",fontSize:e.style.fontSize||"base",fontWeight:e.style.fontWeight||"normal",textColor:e.style.textColor||"#000000",borderRadius:e.style.borderRadius||"md",shadow:e.style.shadow||"none",borderWidth:e.style.borderWidth||0,gradientColors:e.style.gradientColors||void 0,gradientDirection:e.style.gradientDirection||"to-r"}),e.createdAt&&(t.createdAt=this.ensureDate(e.createdAt)),e.updatedAt&&(t.updatedAt=this.ensureDate(e.updatedAt)),t}static loadFromLocalStorage(){try{const e=W.get("cards",{validate:!0,encrypt:!0});if(!e)return[];const t=[];for(const a of e){const n=this.sanitizeCard(a),o=this.validateCard(n);o.valid?t.push(n):console.warn("Invalid card in localStorage:",a,o.errors)}return t}catch(e){return console.error("Failed to load cards from localStorage:",e),[]}}static saveToLocalStorage(e){try{const t=e.map(a=>this.sanitizeCard(a)).filter(a=>this.validateCard(a).valid);W.set("cards",t)}catch(t){throw console.error("Failed to save cards to localStorage:",t),new Error(`Failed to save to localStorage: ${t instanceof Error?t.message:String(t)}`)}}static areCardsEqual(e,t){const a=JSON.stringify(this.sanitizeCard(e)),n=JSON.stringify(this.sanitizeCard(t));return a===n}static detectCardChanges(e,t){const a=new Map(e.map(u=>[u.id,u])),n=new Map(t.map(u=>[u.id,u])),o=[],i=[],l=[];for(const[u,m]of n){const c=a.get(u);c?this.areCardsEqual(c,m)||i.push(m):o.push(m)}for(const[u,m]of a)n.has(u)||l.push(m);return{added:o,updated:i,deleted:l}}static migrateLegacyData(e){try{if(this.isStandardCardFormat(e))return Array.isArray(e)?e:[e];const t=[];if(Array.isArray(e))for(const a of e){const n=this.migrateLegacyCard(a);n&&t.push(n)}else{const a=this.migrateLegacyCard(e);a&&t.push(a)}return t}catch(t){return console.error("Failed to migrate legacy data:",t),[]}}static migrateLegacyCard(e){try{const t={id:e.id||crypto.randomUUID(),frontContent:{title:e.frontTitle||e.title||"",text:e.frontText||e.text||"",images:e.frontImages||e.images||[],tags:e.frontTags||e.tags||[],lastModified:e.lastModified||new Date},backContent:{title:e.backTitle||e.backTitle||"",text:e.backText||e.backText||"",images:e.backImages||[],tags:e.backTags||[],lastModified:e.lastModified||new Date},style:e.style||{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#000000",borderRadius:"md",shadow:"none",borderWidth:0},isFlipped:e.isFlipped||!1,createdAt:this.ensureDate(e.createdAt||e.created||new Date),updatedAt:this.ensureDate(e.updatedAt||e.updated||new Date)},a=this.sanitizeCard(t);return this.validateCard(a).valid?a:null}catch(t){return console.error("Failed to migrate legacy card:",t),null}}static isStandardCardFormat(e){return!e||typeof e!="object"?!1:["id","frontContent","backContent","createdAt","updatedAt"].every(a=>a in e)}static generateCardChecksum(e){const t=this.sanitizeCard(e),a=JSON.stringify(t);let n=0;for(let o=0;o<a.length;o++){const i=a.charCodeAt(o);n=(n<<5)-n+i,n=n&n}return Math.abs(n).toString(16)}static compressCardData(e){const t=e.map(a=>{const n=this.sanitizeCard(a);return{i:n.id,ft:n.frontContent.title,ftx:n.frontContent.text,ftg:n.frontContent.tags,bt:n.backContent.title,btx:n.backContent.text,btg:n.backContent.tags,s:n.style,f:n.isFlipped,ca:n.createdAt.getTime(),ua:n.updatedAt.getTime()}});return JSON.stringify(t)}static decompressCardData(e){try{return JSON.parse(e).map(a=>({id:a.i,frontContent:{title:a.ft||"",text:a.ftx||"",images:[],tags:a.ftg||[],lastModified:new Date},backContent:{title:a.bt||"",text:a.btx||"",images:[],tags:a.btg||[],lastModified:new Date},style:a.s||{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#000000",borderRadius:"md",shadow:"none",borderWidth:0},isFlipped:a.f||!1,createdAt:new Date(a.ca),updatedAt:new Date(a.ua)}))}catch(t){return console.error("Failed to decompress card data:",t),[]}}}const Ca={autoMigration:!0,backupOnMigration:!0,compressionEnabled:!0,cacheEnabled:!0,cacheSize:1e3,syncEnabled:!0,debugMode:!1,performanceMonitoring:!0,maxRetries:3,timeout:3e4};function Ys(s){const e={...Ca,...s},t=[],a=[];return(e.cacheSize<0||e.cacheSize>1e4)&&t.push("cacheSize must be between 0 and 10000"),(e.timeout<1e3||e.timeout>3e5)&&a.push("timeout should be between 1000ms and 300000ms"),(e.maxRetries<0||e.maxRetries>10)&&t.push("maxRetries must be between 0 and 10"),{valid:t.length===0,errors:t,warnings:a,config:e}}function ie(s,e,t){return{code:s,message:e,details:t,timestamp:new Date,stack:new Error().stack}}class fa{static instance=null;static async create(e){if(this.instance)return this.instance;const t=Ys(e||{});if(!t.valid)throw ie("INVALID_CONFIG","Invalid storage configuration",{errors:t.errors});try{const{UniversalStorageAdapter:a}=await xa(async()=>{const{UniversalStorageAdapter:n}=await Promise.resolve().then(()=>io);return{UniversalStorageAdapter:n}},void 0);this.instance=new a(t.config)}catch(a){throw ie("IMPORT_ERROR","Failed to import storage adapter implementation",{importError:a instanceof Error?a.message:String(a)})}return this.instance}static getInstance(){return this.instance}static resetInstance(){this.instance=null}}const oo=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_STORAGE_CONFIG:Ca,StorageAdapterFactory:fa,createStorageError:ie,validateStorageConfig:Ys},Symbol.toStringTag,{value:"Module"}));class Le{name="UniversalStorageAdapter";version="1.0.0";static instance;storageMode="localStorage";config;eventListeners=new Map;STORAGE_MODE_KEY="cardall_storage_mode";MIGRATION_STATUS_KEY="cardall_migration_status";progressCallbacks=new Set;cancelToken=null;constructor(e=Ca){this.config=e,console.log("使用纯本地存储模式"),this.initializeStorageMode(),this.setupEventListeners()}static getInstance(){return Le.instance||(Le.instance=new Le),Le.instance}initializeStorageMode(){try{const e=W.get(this.STORAGE_MODE_KEY);e?this.storageMode=e:(this.storageMode="localStorage",this.saveStorageMode())}catch(e){console.warn("Failed to initialize storage mode:",e),this.storageMode="localStorage"}}saveStorageMode(){try{W.set(this.STORAGE_MODE_KEY,this.storageMode),this.emitEvent({type:"storageModeChanged",timestamp:new Date,data:{mode:this.storageMode}})}catch(e){console.error("Failed to save storage mode:",e)}}getStorageMode(){return this.storageMode}async switchStorageMode(e,t){if(this.storageMode===e)return this.notifyProgress({phase:"completed",percentage:100,message:`Already in ${e} mode`,timestamp:new Date}),{success:!0,message:"Already in requested mode",fromMode:this.storageMode,toMode:e,dataMigrated:!1,rollbackPerformed:!1,validation:{isValid:!0,issues:[]}};const a=this.storageMode,n=Date.now();let o,i=!1,l=!1;const u=[];t?.onProgress&&this.progressCallbacks.add(t.onProgress),this.cancelToken={cancelled:!1};try{this.notifyProgress({phase:"preparing",percentage:5,message:`准备从 ${a} 切换到 ${e}...`,timestamp:new Date}),this.notifyProgress({phase:"validating",percentage:15,message:"验证切换条件...",timestamp:new Date});const m=await this.validatePreSwitchConditions(e);if(!m.isValid)throw this.notifyProgress({phase:"failed",percentage:20,message:`切换前验证失败: ${m.issues.join(", ")}`,details:{issues:m.issues},timestamp:new Date}),new Error(`Pre-switch validation failed: ${m.issues.join(", ")}`);if(this.checkCancellation())throw new Error("Switch cancelled by user");this.config.backupOnMigration&&!t?.skipBackup&&(this.notifyProgress({phase:"backing-up",percentage:30,message:"创建数据备份...",timestamp:new Date}),o=await this.backupData(),this.notifyProgress({phase:"backing-up",percentage:45,message:`备份创建成功: ${o.id}`,details:{backupId:o.id},timestamp:new Date}));const c=e==="indexeddb"&&(await this.hasDataToMigrate()||t?.forceMigration);if(c){this.notifyProgress({phase:"migrating",percentage:50,message:"开始数据迁移...",timestamp:new Date});const S=await this.migrateFromLocalStorage();if(!S.success)throw this.notifyProgress({phase:"failed",percentage:60,message:`数据迁移失败: ${S.errors.join(", ")}`,details:{errors:S.errors},timestamp:new Date}),new Error(`Migration failed: ${S.errors.join(", ")}`);i=!0,this.notifyProgress({phase:"migrating",percentage:70,message:`数据迁移完成: ${S.migratedCards} 张卡片`,details:{migratedCards:S.migratedCards,totalCards:S.totalCards},timestamp:new Date})}if(this.checkCancellation())throw new Error("Switch cancelled by user");this.notifyProgress({phase:"switching",percentage:80,message:`切换存储模式到 ${e}...`,timestamp:new Date}),this.storageMode=e,this.saveStorageMode(),this.notifyProgress({phase:"validating-after",percentage:85,message:"验证切换后数据完整性...",timestamp:new Date});const w=await this.validatePostSwitchConditions(e,a);if(!w.isValid)throw this.notifyProgress({phase:"failed",percentage:90,message:`切换后验证失败: ${w.issues.join(", ")}`,details:{issues:w.issues},timestamp:new Date}),new Error(`Post-switch validation failed: ${w.issues.join(", ")}`);c&&i&&(this.notifyProgress({phase:"cleaning-up",percentage:95,message:"清理旧数据...",timestamp:new Date}),await this.cleanupOldData(a));const y=Date.now()-n;this.notifyProgress({phase:"completed",percentage:100,message:`存储模式切换成功完成，耗时 ${y}ms`,details:{duration:y,dataMigrated:i,fromMode:a,toMode:e},timestamp:new Date}),this.emitEvent({type:"storageModeChanged",timestamp:new Date,data:{fromMode:a,toMode:e,dataMigrated:i,duration:y}});const g={success:!0,message:`Successfully switched from ${a} to ${e}`,fromMode:a,toMode:e,dataMigrated:i,rollbackPerformed:l,duration:y,backup:o,validation:w,progress:u};return this.recordSwitchHistory(g),g}catch(m){if(console.error("Storage mode switch failed:",m),this.notifyProgress({phase:"failed",percentage:0,message:`存储模式切换失败: ${m instanceof Error?m.message:String(m)}`,timestamp:new Date}),o){this.notifyProgress({phase:"rolling-back",percentage:50,message:"正在回滚到原始状态...",timestamp:new Date}),console.log("Attempting rollback...");const y=await this.performRollback(a,o);l=y,y?(this.notifyProgress({phase:"rolled-back",percentage:100,message:"回滚成功",timestamp:new Date}),console.log("Rollback completed successfully")):(this.notifyProgress({phase:"rollback-failed",percentage:100,message:"回滚失败 - 可能需要手动干预",timestamp:new Date}),console.error("Rollback failed - manual intervention may be required"))}else console.log("No backup available, reverting to original mode..."),this.storageMode=a,this.saveStorageMode();const c=m instanceof Error?m.message:String(m);this.emitEvent({type:"error",timestamp:new Date,data:{error:"StorageModeSwitchFailed",details:{fromMode:a,toMode:e,error:c,rollbackPerformed:l}},error:m instanceof Error?m:new Error(c)});const w={success:!1,message:`Failed to switch storage mode: ${c}`,fromMode:a,toMode:e,dataMigrated:i,rollbackPerformed:l,validation:{isValid:!1,issues:[c]},progress:u};throw this.recordSwitchHistory(w),ie("STORAGE_MODE_SWITCH_FAILED",`Failed to switch storage mode: ${c}`,{fromMode:a,toMode:e,error:c,rollbackPerformed:l})}finally{t?.onProgress&&this.progressCallbacks.delete(t.onProgress),this.cancelToken=null}}async setStorageMode(e){try{const t=await this.switchStorageMode(e);if(!t.success)throw new Error(t.message)}catch(t){throw this.storageMode!==e&&(this.storageMode=e==="indexeddb"?"localStorage":"indexeddb",this.saveStorageMode()),t}}cancelStorageModeSwitch(e="用户取消"){this.cancelToken&&(this.cancelToken.cancelled=!0,this.cancelToken.reason=e,this.notifyProgress({phase:"cancelled",percentage:0,message:`操作已取消: ${e}`,timestamp:new Date}))}checkCancellation(){return this.cancelToken?.cancelled||!1}notifyProgress(e){this.progressCallbacks.forEach(t=>{try{t(e)}catch(a){console.warn("Progress callback error:",a)}}),this.emitEvent({type:"storageModeSwitchProgress",timestamp:new Date,data:e})}isSwitchInProgress(){return this.cancelToken!==null}async getStorageModeStats(){try{const e=W.get("storage_switch_history",[])||[],t=e.length,a=e[e.length-1],n=e.filter(w=>w.success===!1).length,o=typeof localStorage<"u",i=await this.isIndexedDBAvailable();let l=0,u=0,m=0,c=0;try{const w=W.get("cards",{validate:!0,encrypt:!0});w&&(l=w.length,m=JSON.stringify(w).length)}catch(w){console.warn("Failed to check localStorage data:",w)}try{if(i){u=await _.cards.count();const w=await _.cards.toArray();c=JSON.stringify(w).length}}catch(w){console.warn("Failed to check IndexedDB data:",w)}return{currentMode:this.storageMode,switchCount:t,lastSwitchTime:a?.timestamp?new Date(a.timestamp):void 0,lastSwitchDuration:a?.duration,failedSwitches:n,availableStorage:{localStorage:o,indexedDB:i},dataDistribution:{localStorageCards:l,indexedDBCards:u,localStorageSize:m,indexedDBSize:c}}}catch(e){throw console.error("Failed to get storage mode stats:",e),ie("GET_STORAGE_STATS_FAILED","Failed to get storage mode statistics",{error:e instanceof Error?e.message:String(e)})}}recordSwitchHistory(e){try{const t=W.get("storage_switch_history",[])||[];t.push({timestamp:new Date().toISOString(),fromMode:e.fromMode,toMode:e.toMode,success:e.success,duration:e.duration,dataMigrated:e.dataMigrated,rollbackPerformed:e.rollbackPerformed,message:e.message}),t.length>50&&t.splice(0,t.length-50),W.set("storage_switch_history",t)}catch(t){console.warn("Failed to record switch history:",t)}}clearSwitchHistory(){try{W.remove("storage_switch_history"),console.log("Storage switch history cleared")}catch(e){console.warn("Failed to clear switch history:",e)}}async getRecommendedStorageMode(){const e=[];try{const t=await this.getStorageModeStats(),a=t.availableStorage.indexedDB,n=t.availableStorage.localStorage;return a?t.dataDistribution.localStorageSize+t.dataDistribution.indexedDBSize>5*1024*1024?{recommendedMode:"indexeddb",reason:"Large data volume detected, IndexedDB is more suitable",confidence:"high",issues:[]}:t.failedSwitches===0||t.failedSwitches/t.switchCount<.2?{recommendedMode:t.currentMode,reason:"Current storage mode is working well",confidence:"medium",issues:[]}:{recommendedMode:"indexeddb",reason:"IndexedDB offers better performance and reliability",confidence:"medium",issues:[]}:{recommendedMode:"localStorage",reason:"IndexedDB is not available in this browser",confidence:"high",issues:["IndexedDB not supported"]}}catch(t){return e.push(`Failed to analyze storage recommendations: ${t instanceof Error?t.message:String(t)}`),{recommendedMode:"localStorage",reason:"Failed to analyze, using safe option",confidence:"low",issues:e}}}async validatePreSwitchConditions(e){const t=[],a=[],n={};try{if(e==="indexeddb"){const l=await this.isIndexedDBAvailable();l||t.push("IndexedDB is not available in this environment"),n.indexedDBAvailable=l}const o=await this.validateDataIntegrity();if(o.isValid||(t.push("Current data integrity check failed"),t.push(...o.issues)),n.currentDataValidation=o,e==="indexeddb"&&await this.hasDataToMigrate()){const l=await this.getCards(),u=JSON.stringify(l).length;if(navigator.storage&&navigator.storage.estimate)try{const m=await navigator.storage.estimate(),c=(m.quota||0)-(m.usage||0);c<u*2&&a.push("Available storage space may be insufficient"),n.storageQuota={total:m.quota,used:m.usage,available:c,required:u}}catch{a.push("Unable to estimate storage space")}}const i=this.checkBrowserCompatibility(e);return i.compatible||t.push(...i.issues),n.browserCompatibility=i,{isValid:t.length===0,issues:t,warnings:a.length>0?a:void 0,details:n}}catch(o){return{isValid:!1,issues:[`Pre-switch validation error: ${o instanceof Error?o.message:String(o)}`],warnings:a.length>0?a:void 0,details:n}}}async validatePostSwitchConditions(e,t){const a=[],n=[],o={};try{const i=Date.now();await this.getCards(),o.dataAccessTime=Date.now()-i;const l=await this.validateDataIntegrity(e);if(l.isValid||(a.push("New mode data integrity check failed"),a.push(...l.issues)),o.newDataValidation=l,t==="localStorage"&&e==="indexeddb"){const m=await this.validateMigrationConsistency();m.isValid||(a.push("Data consistency check failed"),a.push(...m.issues)),o.consistencyCheck=m}const u=await this.validateStoragePerformance(e);return u.warnings.length>0&&n.push(...u.warnings),o.performanceCheck=u,{isValid:a.length===0,issues:a,warnings:n.length>0?n:void 0,details:o}}catch(i){return{isValid:!1,issues:[`Post-switch validation error: ${i instanceof Error?i.message:String(i)}`],warnings:n.length>0?n:void 0,details:o}}}async performRollback(e,t){const a=Date.now();console.log(`Starting enhanced rollback to ${e}...`);try{console.log("Phase 1: Pre-rollback state check...");const n=this.storageMode,o=await this.getStats();console.log(`Current state: ${n}, ${o.totalCards} cards`),console.log("Phase 2: Creating pre-rollback safety backup...");const i=await this.createSafetyBackup();console.log(`Safety backup created: ${i?.id||"N/A"}`),console.log("Phase 3: Setting temporary storage mode...");const l=n;this.storageMode="rollback_temp",this.saveStorageMode(),console.log("Phase 4: Validating backup integrity...");const u=await this.validateBackupIntegrity(t);if(!u.isValid)throw new Error(`Backup integrity validation failed: ${u.issues.join(", ")}`);console.log("Phase 5: Restoring storage mode..."),this.storageMode=e,this.saveStorageMode(),console.log("Phase 6: Restoring data...");const m=await this.enhancedRestoreData(t);if(!m.success)throw new Error(`Data restoration failed: ${m.issues.join(", ")}`);console.log(`Restored ${m.restoredCards} cards`),console.log("Phase 7: Post-rollback validation...");const c=await this.validateDataIntegrity(e);if(!c.isValid&&(console.warn(`Post-rollback validation issues: ${c.issues.join(", ")}`),c.corruptedCards.length>0)){console.log("Attempting data repair...");const y=await this.repairDataIntegrity();if(console.log(`Repair result: ${y.repaired?"SUCCESS":"FAILED"}`),!y.repaired)throw new Error(`Post-rollback data repair failed: ${y.issues.join(", ")}`)}i&&(console.log("Phase 8: Cleaning up safety backup..."),await this.cleanupSafetyBackup(i.id));const w=Date.now()-a;return console.log(`Enhanced rollback completed successfully in ${w}ms`),this.emitEvent({type:"backupRestored",timestamp:new Date,data:{backupId:t.id,rollback:!0,duration:w,restoredCards:m.restoredCards,targetMode:e}}),!0}catch(n){const o=`Rollback failed: ${n instanceof Error?n.message:String(n)}`;console.error(o);try{console.log("Attempting emergency recovery..."),this.storageMode=e,this.saveStorageMode(),this.emitEvent({type:"error",timestamp:new Date,data:{error:"RollbackFailed",details:{targetMode:e,error:o,emergencyRecovery:!0}},error:n instanceof Error?n:new Error(o)})}catch(i){console.error("Emergency recovery also failed:",i)}return!1}}async createSafetyBackup(){try{const e=await this.getCards(),t={timestamp:new Date().toISOString(),version:this.version,purpose:"rollback_safety",cards:e},a=JSON.stringify(t),n=`safety_backup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;W.set(n,t);const o=await this.calculateChecksum(a);return{id:n,data:a,timestamp:new Date,version:this.version,cardCount:e.length,checksum:o}}catch(e){return console.warn("Failed to create safety backup:",e),null}}async validateBackupIntegrity(e){const t=[],a={};try{const n=await this.calculateChecksum(e.data);a.checksumMatch=n===e.checksum,a.backupChecksum=e.checksum,a.currentChecksum=n,n!==e.checksum&&t.push("Backup checksum mismatch - data may be corrupted");try{const i=JSON.parse(e.data);if(a.dataFormatValid=!0,!i.cards||!Array.isArray(i.cards))t.push("Invalid backup data format - missing or invalid cards array"),a.cardsValid=!1;else{a.cardsValid=!0,a.cardCount=i.cards.length;const l=Math.min(5,i.cards.length),u=i.cards.slice(0,l),m=[];for(let c=0;c<u.length;c++){const w=u[c],y=this.validateCardStructure(w);y.length>0&&m.push(`Card at index ${c}: ${y.join(", ")}`)}m.length>0?(t.push(`Card structure issues found: ${m.join("; ")}`),a.structureIssues=m):a.structureValid=!0}}catch(i){t.push(`Backup data parsing failed: ${i instanceof Error?i.message:String(i)}`),a.dataFormatValid=!1}const o=Date.now()-e.timestamp.getTime();return a.backupAgeMs=o,a.backupAgeHours=o/(1e3*60*60),o>24*60*60*1e3&&t.push("Backup is more than 24 hours old"),{isValid:t.length===0,issues:t,details:a}}catch(n){return t.push(`Backup validation failed: ${n instanceof Error?n.message:String(n)}`),{isValid:!1,issues:t,details:a}}}async enhancedRestoreData(e){const t=[];let a=0;try{const n=JSON.parse(e.data);if(!n.cards||!Array.isArray(n.cards))throw new Error("Invalid backup data format");if(console.log("Clearing current data..."),this.storageMode==="indexeddb"&&await _.cards.clear(),W.remove("cards"),console.log(`Restoring ${n.cards.length} cards...`),this.storageMode==="indexeddb"){const i=n.cards.map(l=>this.convertToDbCard(l));try{await _.cards.bulkAdd(i),a=i.length}catch(l){console.warn("Bulk restore failed, trying individual restore..."),t.push(`Bulk restore failed: ${l instanceof Error?l.message:String(l)}`),a=0;for(const u of n.cards)try{const m=this.convertToDbCard(u);await _.cards.add(m),a++}catch(m){t.push(`Failed to restore card ${u.id}: ${m instanceof Error?m.message:String(m)}`)}}}else W.set("cards",n.cards),a=n.cards.length;const o=await this.validateDataIntegrity(this.storageMode);return o.isValid?console.log(`Data integrity check passed for ${o.cardCount} cards`):t.push(...o.issues.map(i=>`Validation: ${i}`)),{success:t.length===0||a>0&&t.length<a*.1,restoredCards:a,issues:t}}catch(n){return t.push(`Enhanced restore failed: ${n instanceof Error?n.message:String(n)}`),{success:!1,restoredCards:a,issues:t}}}async cleanupSafetyBackup(e){try{W.remove(e),console.log(`Safety backup ${e} cleaned up`)}catch(t){console.warn(`Failed to cleanup safety backup ${e}:`,t)}}async cleanupOldData(e){try{if(e==="localStorage"){const t=W.get("cards",{validate:!0,encrypt:!0});t&&t.length>0&&(console.log("Cleaning up localStorage data..."),W.remove("cards"),console.log("localStorage data cleaned up"))}else e==="indexeddb"&&await this.hasIndexedDBData()&&(console.log("Cleaning up IndexedDB data..."),await _.cards.clear(),console.log("IndexedDB data cleaned up"))}catch(t){console.warn("Failed to cleanup old data:",t)}}async validateMigrationConsistency(){const e=[],t=[],a={};try{console.log("Starting migration consistency validation...");const n=await _.cards.count();a.indexedDBCount=n;const o=W.get("cards",{validate:!0,encrypt:!0});if(a.localStorageCards=o?.length||0,o&&o.length>0){n!==o.length&&e.push(`Card count mismatch: IndexedDB has ${n}, localStorage had ${o.length}`);const l=Math.min(10,o.length),u=o.slice(0,l),m={};for(const g of u){const S={id:g.id,title:g.frontContent.title,found:!1,contentMatch:!1,tagsMatch:!1,timestampMatch:!1};try{const E=await _.cards.get(g.id);if(!E){e.push(`Card ${g.id} not found in IndexedDB`),S.found=!1,m[g.id]=S;continue}S.found=!0;const R=this.convertFromDbCard(E),v=R.frontContent.title===g.frontContent.title,h=R.backContent.title===g.backContent.title;S.contentMatch=v&&h;const f=R.frontContent.text===g.frontContent.text&&R.backContent.text===g.backContent.text;S.contentMatch=S.contentMatch&&f;const p=JSON.stringify(R.frontContent.tags.sort())===JSON.stringify(g.frontContent.tags.sort()),x=JSON.stringify(R.backContent.tags.sort())===JSON.stringify(g.backContent.tags.sort());S.tagsMatch=p&&x;const C=R.createdAt.getTime()===g.createdAt.getTime()&&R.updatedAt.getTime()===g.updatedAt.getTime();S.timestampMatch=C,m[g.id]=S,S.found||e.push(`Card ${g.id} missing in IndexedDB`),S.contentMatch||e.push(`Content mismatch for card ${g.id}`),S.tagsMatch||t.push(`Tags mismatch for card ${g.id}`),S.timestampMatch||t.push(`Timestamp mismatch for card ${g.id}`)}catch(E){console.warn(`Error validating card ${g.id}:`,E),e.push(`Validation error for card ${g.id}: ${E instanceof Error?E.message:String(E)}`)}}a.sampleValidation=m;const c=Object.keys(m).length*4,w=Object.values(m).reduce((g,S)=>g+(S.found?1:0)+(S.contentMatch?1:0)+(S.tagsMatch?1:0)+(S.timestampMatch?1:0),0),y=c>0?w/c*100:0;a.consistencyScore=y,y<95&&t.push(`Migration consistency score is ${y.toFixed(1)}%`);try{const g=await _.cards.toArray(),S=new Set,E=new Set;g.forEach(R=>{S.has(R.id)?E.add(R.id):S.add(R.id)}),E.size>0&&e.push(`Found duplicate card IDs: ${Array.from(E).join(", ")}`)}catch(g){t.push(`Could not validate ID uniqueness: ${g instanceof Error?g.message:String(g)}`)}try{const g=await _.cards.toArray(),S=await this.validateDatabaseStructure(g);S.length>0&&e.push(...S)}catch(g){t.push(`Structure validation failed: ${g instanceof Error?g.message:String(g)}`)}}else o===null&&t.push("Original localStorage data not available for comparison");const i=e.length===0;return console.log(`Migration consistency validation completed: ${i?"PASS":"FAIL"}`),i||console.warn(`Found ${e.length} issues and ${t.length} warnings`),{isValid:i,issues:e,warnings:t.length>0?t:void 0,details:a}}catch(n){const o=`Migration consistency check failed: ${n instanceof Error?n.message:String(n)}`;return console.error(o),{isValid:!1,issues:[o],warnings:t.length>0?t:void 0,details:a}}}async validateDatabaseStructure(e){const t=[];try{for(let a=0;a<e.length;a++){const n=e[a],o=["id","frontContent","backContent","createdAt","updatedAt"];for(const i of o)i in n||t.push(`Card at index ${a} missing required field: ${i}`);if(typeof n.id!="string"&&t.push(`Card ${n.id} has invalid ID type`),n.frontContent&&typeof n.frontContent!="object"&&t.push(`Card ${n.id} has invalid frontContent type`),n.backContent&&typeof n.backContent!="object"&&t.push(`Card ${n.id} has invalid backContent type`),n.createdAt)try{new Date(n.createdAt)}catch{t.push(`Card ${n.id} has invalid createdAt format`)}if(n.updatedAt)try{new Date(n.updatedAt)}catch{t.push(`Card ${n.id} has invalid updatedAt format`)}}}catch(a){t.push(`Structure validation error: ${a instanceof Error?a.message:String(a)}`)}return t}async validateStoragePerformance(e){const t=[],a={};try{const n=Date.now();await this.getCards(),a.readTime=Date.now()-n;const o=await this.createCard({frontContent:{title:"Performance Test",text:"Test content",tags:[]},backContent:{title:"Performance Test Back",text:"Test back content",tags:[]},style:{type:"solid"},isFlipped:!1}),i=Date.now();return await this.updateCard(o.id,{frontContent:{...o.frontContent,text:"Updated test content"}}),a.writeTime=Date.now()-i,await this.deleteCard(o.id),e==="indexeddb"&&a.readTime>1e3&&t.push("IndexedDB read performance is slow"),e==="localStorage"&&a.readTime>500&&t.push("LocalStorage read performance is slow"),{warnings:t,metrics:a}}catch(n){return t.push(`Performance validation failed: ${n instanceof Error?n.message:String(n)}`),{warnings:t,metrics:a}}}checkBrowserCompatibility(e){const t=[],a={};try{if(a.localStorageSupported=typeof localStorage<"u",a.indexedDBSupported=typeof indexedDB<"u",a.serviceWorkerSupported="serviceWorker"in navigator,e==="indexeddb"){a.indexedDBSupported||t.push("IndexedDB is not supported in this browser");try{const n=indexedDB.open("test_db",1);a.indexedDBOpenable=!0,n.onsuccess=()=>{n.result.close(),indexedDB.deleteDatabase("test_db")}}catch{a.indexedDBOpenable=!1,t.push("IndexedDB cannot be opened in this browser")}}return e==="localStorage"&&!a.localStorageSupported&&t.push("LocalStorage is not supported in this browser"),{compatible:t.length===0,issues:t,details:a}}catch(n){return{compatible:!1,issues:[`Browser compatibility check failed: ${n instanceof Error?n.message:String(n)}`],details:a}}}async hasDataToMigrate(){if(this.storageMode==="indexeddb")return!1;const e=W.get("cards",{validate:!0,encrypt:!0});return e?e.length>0:!1}async migrateFromLocalStorage(){const e=Date.now();this.emitEvent({type:"migrationStarted",timestamp:new Date});try{if(!await this.hasDataToMigrate()){const l={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:[],duration:Date.now()-e,timestamp:new Date};return this.emitEvent({type:"migrationCompleted",timestamp:new Date,data:l}),l}const a=W.get("cards",{validate:!0,encrypt:!0});if(!a||a.length===0){const l={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:[],duration:Date.now()-e,timestamp:new Date};return this.emitEvent({type:"migrationCompleted",timestamp:new Date,data:l}),l}let n;this.config.backupOnMigration&&(n=await this.backupData());const o=await this.performMigration(a);if(await this.validateMigration(a.length)&&o.success){await this.setStorageMode("indexeddb"),o.errors.length===0&&this.cleanupLocalStorage();const l={...o,totalCards:a.length,duration:Date.now()-e,timestamp:new Date};return this.emitEvent({type:"migrationCompleted",timestamp:new Date,data:l}),l}else{n&&await this.restoreData(n);const l={success:!1,migratedCards:0,totalCards:a.length,errors:["Migration validation failed"],warnings:o.warnings,duration:Date.now()-e,timestamp:new Date};return this.emitEvent({type:"migrationFailed",timestamp:new Date,data:l,error:new Error("Migration validation failed")}),l}}catch(t){const a={success:!1,migratedCards:0,totalCards:0,errors:[t instanceof Error?t.message:"Unknown migration error"],warnings:[],duration:Date.now()-e,timestamp:new Date};return this.emitEvent({type:"migrationFailed",timestamp:new Date,data:a,error:t instanceof Error?t:new Error(String(t))}),a}}async performMigration(e){const t=[],a=[];let n=0;try{const o=e.map(i=>this.convertToDbCard(i));return await _.cards.bulkAdd(o),n=o.length,{success:!0,migratedCards:n,totalCards:e.length,errors:[],warnings:a,duration:0,timestamp:new Date}}catch(o){console.error("Bulk migration failed:",o);for(const l of e)try{const u=this.convertToDbCard(l);await _.cards.add(u),n++}catch(u){console.error(`Failed to migrate card ${l.id}:`,u),t.push(l.id)}const i=t.length===0;return i||a.push(`Some cards failed to migrate: ${t.length} out of ${e.length}`),{success:i,migratedCards:n,totalCards:e.length,errors:t,warnings:a,duration:0,timestamp:new Date}}}async validateMigration(e){try{return await _.cards.count()===e}catch(t){return console.error("Migration validation failed:",t),!1}}cleanupLocalStorage(){try{W.remove("cards")}catch(e){console.warn("Failed to cleanup localStorage:",e)}}async backupData(){const e=await this.getCards(),t={timestamp:new Date().toISOString(),version:this.version,cards:e},a=JSON.stringify(t),n=`backup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;W.set(n,t);const o=await this.calculateChecksum(a),i={id:n,data:a,timestamp:new Date,version:this.version,cardCount:e.length,checksum:o};return this.emitEvent({type:"backupCreated",timestamp:new Date,data:i}),i}async restoreData(e){try{if(await this.calculateChecksum(e.data)!==e.checksum)throw new Error("Backup data integrity check failed");const a=JSON.parse(e.data);if(!a.cards||!Array.isArray(a.cards))throw new Error("Invalid backup data format");if(this.storageMode==="indexeddb"){const n=a.cards.map(o=>this.convertToDbCard(o));await _.cards.clear(),await _.cards.bulkAdd(n)}else W.set("cards",a.cards);return this.emitEvent({type:"backupRestored",timestamp:new Date,data:{backupId:e.id,cardCount:e.cardCount}}),!0}catch(t){return console.error("Restore failed:",t),!1}}async calculateChecksum(e){let t=0;for(let a=0;a<e.length;a++){const n=e.charCodeAt(a);t=(t<<5)-t+n,t=t&t}return Math.abs(t).toString(16)}convertToDbCard(e){return{id:e.id,frontContent:e.frontContent,backContent:e.backContent,style:e.style,createdAt:e.createdAt,updatedAt:e.updatedAt}}convertFromDbCard(e){return{...e,id:e.id||"",isFlipped:!1,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}}async getCards(e){try{if(this.storageMode==="indexeddb"){const a=(await _.cards.toArray()).map(n=>this.convertFromDbCard(n));return e?this.applyFilter(a,e):a}else{const t=W.get("cards",{validate:!0,encrypt:!0})||[];return e?this.applyFilter(t,e):t}}catch(t){throw ie("GET_CARDS_FAILED","Failed to get cards",{error:t instanceof Error?t.message:String(t)})}}applyFilter(e,t){return e.filter(a=>{if(t.searchTerm){const n=t.searchTerm.toLowerCase(),o=a.frontContent.title.toLowerCase().includes(n)||a.backContent.title.toLowerCase().includes(n),i=a.frontContent.text.toLowerCase().includes(n)||a.backContent.text.toLowerCase().includes(n);if(!o&&!i)return!1}if(t.tags&&t.tags.length>0){const n=[...a.frontContent.tags,...a.backContent.tags];if(!t.tags.some(i=>n.includes(i)))return!1}return!0})}async getCardById(e){try{if(this.storageMode==="indexeddb"){const t=await _.cards.get(e);return t?this.convertFromDbCard(t):null}else return(await this.getCards()).find(a=>a.id===e)||null}catch(t){throw ie("GET_CARD_FAILED",`Failed to get card ${e}`,{error:t instanceof Error?t.message:String(t)})}}async createCard(e){const t=new Date,a={...e,id:crypto.randomUUID(),createdAt:t,updatedAt:t};try{if(this.storageMode==="indexeddb"){const n=this.convertToDbCard(a);await _.cards.add(n)}else{const n=await this.getCards();n.push(a),await this.saveCards(n)}return this.emitEvent({type:"cardCreated",timestamp:new Date,data:{card:a}}),a}catch(n){throw ie("CREATE_CARD_FAILED","Failed to create card",{error:n instanceof Error?n.message:String(n)})}}async updateCard(e,t){try{if(this.storageMode==="indexeddb"){const a=await _.cards.get(e);if(!a)throw ie("CARD_NOT_FOUND",`Card ${e} not found`);const n={...a,...t,updatedAt:new Date};return await _.cards.put(n),this.convertFromDbCard(n)}else{const a=await this.getCards(),n=a.findIndex(o=>o.id===e);if(n===-1)throw ie("CARD_NOT_FOUND",`Card ${e} not found`);return a[n]={...a[n],...t,updatedAt:new Date},await this.saveCards(a),a[n]}}catch(a){throw ie("UPDATE_CARD_FAILED",`Failed to update card ${e}`,{error:a instanceof Error?a.message:String(a)})}}async deleteCard(e){try{if(this.storageMode==="indexeddb")await _.cards.delete(e);else{const a=(await this.getCards()).filter(n=>n.id!==e);await this.saveCards(a)}return this.emitEvent({type:"cardDeleted",timestamp:new Date,data:{cardId:e}}),!0}catch(t){throw ie("DELETE_CARD_FAILED",`Failed to delete card ${e}`,{error:t instanceof Error?t.message:String(t)})}}async saveCards(e){try{if(this.storageMode==="indexeddb"){const t=e.map(a=>this.convertToDbCard(a));await _.cards.clear(),await _.cards.bulkAdd(t)}else W.set("cards",e);this.emitEvent({type:"cardsChanged",timestamp:new Date,data:{cardCount:e.length}})}catch(t){throw ie("SAVE_CARDS_FAILED","Failed to save cards",{error:t instanceof Error?t.message:String(t)})}}async createCards(e){const t=new Date,a=e.map(n=>({...n,id:crypto.randomUUID(),createdAt:t,updatedAt:t}));try{if(this.storageMode==="indexeddb"){const n=a.map(o=>this.convertToDbCard(o));await _.cards.bulkAdd(n)}else{const n=await this.getCards();n.push(...a),await this.saveCards(n)}return a}catch(n){throw ie("CREATE_CARDS_FAILED","Failed to create cards",{error:n instanceof Error?n.message:String(n)})}}async updateCards(e){const t=[];try{if(this.storageMode==="indexeddb")for(const{id:a,updates:n}of e){const o=await this.updateCard(a,n);t.push(o)}else{const a=await this.getCards();for(const{id:n,updates:o}of e){const i=a.findIndex(l=>l.id===n);i!==-1&&(a[i]={...a[i],...o,updatedAt:new Date},t.push(a[i]))}await this.saveCards(a)}return t}catch(a){throw ie("UPDATE_CARDS_FAILED","Failed to update cards",{error:a instanceof Error?a.message:String(a)})}}async deleteCards(e){try{if(this.storageMode==="indexeddb")await _.cards.bulkDelete(e);else{const a=(await this.getCards()).filter(n=>!e.includes(n.id));await this.saveCards(a)}return!0}catch(t){throw ie("DELETE_CARDS_FAILED","Failed to delete cards",{error:t instanceof Error?t.message:String(t)})}}async searchCards(e,t){const a={...t,searchTerm:e};return this.getCards(a)}async getCardsByTag(e){const t={searchTerm:"",tags:[e]};return this.getCards(t)}async getCardsByFolder(e){return(await this.getCards()).filter(a=>a.folderId===e)}async getStats(){try{let e=0,t=0,a=0;if(this.storageMode==="indexeddb"){e=await _.cards.count();const i=await _.cards.toArray();a=JSON.stringify(i).length}else{const i=await this.getCards();e=i.length,t=JSON.stringify(i).length}const n=Math.max(t,a);return{totalCards:e,totalFolders:0,totalTags:0,totalSize:n,lastUpdated:new Date,storageMode:this.storageMode,indexedDBSize:a>0?a:void 0,localStorageSize:t>0?t:void 0}}catch(e){throw ie("GET_STATS_FAILED","Failed to get storage stats",{error:e instanceof Error?e.message:String(e)})}}async healthCheck(){const e=[],t=[];let a=100;try{if(await this.getCards(),this.storageMode==="indexeddb")try{await _.cards.count()}catch(n){e.push({level:"error",code:"INDEXEDDB_ACCESS_FAILED",message:"Cannot access IndexedDB",details:{error:n instanceof Error?n.message:String(n)}}),a-=40}try{W.get("test")}catch(n){e.push({level:"warning",code:"LOCALSTORAGE_ACCESS_FAILED",message:"Cannot access localStorage",details:{error:n instanceof Error?n.message:String(n)}}),a-=20}if(this.storageMode==="indexeddb"){const n=await this.getStats();n.totalSize>50*1024*1024&&(e.push({level:"warning",code:"LARGE_STORAGE_SIZE",message:"Storage size is large",details:{size:n.totalSize}}),a-=10,t.push("Consider archiving old cards"))}return{healthy:a>=70,score:Math.max(0,a),issues:e,recommendations:t,timestamp:new Date}}catch(n){return{healthy:!1,score:0,issues:[{level:"error",code:"HEALTH_CHECK_FAILED",message:"Health check failed",details:{error:n instanceof Error?n.message:String(n)}}],recommendations:["Check storage permissions and browser compatibility"],timestamp:new Date}}}getConfig(){return{...this.config}}async isIndexedDBAvailable(){try{if(typeof window>"u")return console.warn("IndexedDB not available: not in browser environment"),!1;if(!("indexedDB"in window))return console.warn("IndexedDB not available: indexedDB not supported in this browser"),!1;if(!window.indexedDB||typeof window.indexedDB.open!="function")return console.warn("IndexedDB not available: IDBFactory interface not available"),!1;try{const e="cardall_availability_test",t=window.indexedDB.open(e,1);return new Promise(a=>{let n;const o=()=>{n&&clearTimeout(n);try{window.indexedDB.deleteDatabase(e)}catch(i){console.debug("Failed to cleanup test database:",i)}};n=window.setTimeout(()=>{console.warn("IndexedDB availability test timed out"),o(),a(!1)},5e3),t.onerror=i=>{console.warn("IndexedDB availability test failed:",i),o(),a(!1)},t.onblocked=()=>{console.warn("IndexedDB availability test blocked"),o(),a(!1)},t.onsuccess=()=>{const i=t.result;try{i.close(),o(),console.debug("IndexedDB availability test passed"),a(!0)}catch(l){console.warn("Failed to close test database:",l),o(),a(!1)}},t.onupgradeneeded=i=>{console.debug("IndexedDB upgrade needed during availability test")}})}catch(e){return console.warn("IndexedDB availability test error:",e),!1}}catch(e){return console.warn("IndexedDB not available:",e),!1}}async hasIndexedDBData(){try{if(!await this.isIndexedDBAvailable())return console.debug("IndexedDB data check: IndexedDB not available"),!1;try{if(!_.isOpen())try{await _.open()}catch(n){return console.warn("Failed to open database for data check:",n),!1}let t;try{t=await _.cards.count(),console.debug(`IndexedDB card count: ${t}`)}catch(n){return console.warn("Failed to get card count:",n),!1}return t>0||await this.checkOtherDataTables()?!0:(console.debug("IndexedDB data check: no data found"),!1)}catch(t){return console.warn("Database operation failed during data check:",t),!1}}catch(e){return console.warn("Failed to check IndexedDB data:",e),!1}}async checkOtherDataTables(){try{try{const e=await _.folders.count();if(e>0)return console.debug(`Found ${e} folders in IndexedDB`),!0}catch(e){console.debug("Failed to check folders:",e)}try{const e=await _.tags.count();if(e>0)return console.debug(`Found ${e} tags in IndexedDB`),!0}catch(e){console.debug("Failed to check tags:",e)}try{const e=await _.images.count();if(e>0)return console.debug(`Found ${e} images in IndexedDB`),!0}catch(e){console.debug("Failed to check images:",e)}try{const e=await _.settings.count();if(e>0)return console.debug(`Found ${e} settings in IndexedDB`),!0}catch(e){console.debug("Failed to check settings:",e)}return!1}catch(e){return console.debug("Error checking other data tables:",e),!1}}async validateDataIntegrity(e){const t=e||this.storageMode,a=[],n=[];try{console.log(`Validating data integrity for ${t}...`);const o=await this.getCards();if(!Array.isArray(o))return a.push("Cards data is not an array"),{isValid:!1,issues:a,cardCount:0,corruptedCards:n};for(const u of o){const m=this.validateCardStructure(u);m.length>0&&(n.push(u.id||"unknown"),a.push(`Card ${u.id||"unknown"} has issues: ${m.join(", ")}`))}if(t==="indexeddb"){const u=await _.cards.toArray();u.length!==o.length&&a.push(`Card count mismatch: IndexedDB has ${u.length}, adapter returned ${o.length}`)}const i=this.validateTimestamps(o);a.push(...i);const l=a.length===0;return console.log(`Data integrity validation completed: ${l?"PASS":"FAIL"}`),l||console.warn(`Found ${a.length} issues`),{isValid:l,issues:a,cardCount:o.length,corruptedCards:n}}catch(o){const i=`Data integrity validation failed: ${o instanceof Error?o.message:String(o)}`;return a.push(i),console.error(i),{isValid:!1,issues:a,cardCount:0,corruptedCards:n}}}validateCardStructure(e){const t=[];return(!e.id||typeof e.id!="string")&&t.push("Missing or invalid id"),!e.frontContent||typeof e.frontContent!="object"?t.push("Missing or invalid frontContent"):((!e.frontContent.title||typeof e.frontContent.title!="string")&&t.push("Missing or invalid frontContent.title"),typeof e.frontContent.text!="string"&&t.push("Invalid frontContent.text type")),!e.backContent||typeof e.backContent!="object"?t.push("Missing or invalid backContent"):((!e.backContent.title||typeof e.backContent.title!="string")&&t.push("Missing or invalid backContent.title"),typeof e.backContent.text!="string"&&t.push("Invalid backContent.text type")),(!e.createdAt||!(e.createdAt instanceof Date))&&t.push("Missing or invalid createdAt"),(!e.updatedAt||!(e.updatedAt instanceof Date))&&t.push("Missing or invalid updatedAt"),e.style&&typeof e.style!="object"&&t.push("Invalid style type"),e.frontContent.tags&&!Array.isArray(e.frontContent.tags)&&t.push("Invalid frontContent.tags type"),e.backContent.tags&&!Array.isArray(e.backContent.tags)&&t.push("Invalid backContent.tags type"),t}validateTimestamps(e){const t=[];for(const a of e){a.createdAt>new Date&&t.push(`Card ${a.id} has creation date in the future`),a.updatedAt>new Date&&t.push(`Card ${a.id} has update date in the future`),a.updatedAt<a.createdAt&&t.push(`Card ${a.id} has update date before creation date`);const n=new Date("2000-01-01");(a.createdAt<n||a.updatedAt<n)&&t.push(`Card ${a.id} has suspiciously old timestamps`)}return t}async repairDataIntegrity(){console.log("Starting data integrity repair...");const e=[],t=[],a=[];try{const n=await this.validateDataIntegrity();if(n.isValid)return console.log("No integrity issues found"),{repaired:!0,repairedCards:0,issues:[],failedRepairs:[]};console.log(`Found ${n.issues.length} issues to repair`);const o=await this.getCards(),i=[];for(const l of o){const u=this.validateCardStructure(l);if(u.length>0){const m=this.repairCard(l);this.validateCardStructure(m).length===0?(i.push(m),e.push(l.id||"unknown"),console.log(`Successfully repaired card ${l.id}`)):(t.push(l.id||"unknown"),a.push(`Failed to repair card ${l.id}: ${u.join(", ")}`))}else i.push(l)}return i.length!==o.length&&(await this.saveCards(i),console.log(`Repaired ${e.length} cards`)),{repaired:t.length===0,repairedCards:e.length,issues:a,failedRepairs:t}}catch(n){const o=`Data repair failed: ${n instanceof Error?n.message:String(n)}`;return console.error(o),{repaired:!1,repairedCards:0,issues:[o],failedRepairs:e}}}repairCard(e){const t={id:e.id||crypto.randomUUID(),frontContent:{title:e.frontContent?.title||"Untitled",text:e.frontContent?.text||"",tags:Array.isArray(e.frontContent?.tags)?e.frontContent.tags:[]},backContent:{title:e.backContent?.title||"Untitled",text:e.backContent?.text||"",tags:Array.isArray(e.backContent?.tags)?e.backContent.tags:[]},style:typeof e.style=="object"?e.style:{type:"solid"},isFlipped:typeof e.isFlipped=="boolean"?e.isFlipped:!1,createdAt:e.createdAt instanceof Date?e.createdAt:new Date,updatedAt:new Date};return t.createdAt>new Date&&(t.createdAt=new Date),t.updatedAt<t.createdAt&&(t.updatedAt=t.createdAt),t}async updateConfig(e){const{validateStorageConfig:t}=await xa(async()=>{const{validateStorageConfig:n}=await Promise.resolve().then(()=>oo);return{validateStorageConfig:n}},void 0),a=t({...this.config,...e});if(!a.valid)throw ie("INVALID_CONFIG","Invalid storage configuration",{errors:a.errors});this.config=a.config}setupEventListeners(){if(this.storageMode==="indexeddb")try{_.cards.hook("creating",(e,t,a)=>{this.emitEvent({type:"cardCreated",timestamp:new Date,data:{cardId:e}})}),_.cards.hook("updating",(e,t,a,n)=>{this.emitEvent({type:"cardUpdated",timestamp:new Date,data:{cardId:t}})}),_.cards.hook("deleting",(e,t,a)=>{this.emitEvent({type:"cardDeleted",timestamp:new Date,data:{cardId:e}})})}catch(e){console.warn("Failed to setup IndexedDB event listeners:",e)}}addEventListener(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}removeEventListener(e,t){const a=this.eventListeners.get(e);if(a){const n=a.indexOf(t);n>-1&&a.splice(n,1)}}emitEvent(e){const t=this.eventListeners.get(e.type);t&&t.forEach(a=>{try{a(e)}catch(n){console.error(`Event listener error for ${e.type}:`,n)}})}}const io=Object.freeze(Object.defineProperty({__proto__:null,UniversalStorageAdapter:Le},Symbol.toStringTag,{value:"Module"}));class Xe{static instance;errorListeners=[];recoveryStrategies=new Map;static getInstance(){return Xe.instance||(Xe.instance=new Xe),Xe.instance}onError(e){return this.errorListeners.push(e),()=>{const t=this.errorListeners.indexOf(e);t>-1&&this.errorListeners.splice(t,1)}}registerRecoveryStrategy(e,t){this.recoveryStrategies.set(e,t)}async handleError(e,t){const a=this.normalizeError(e,t);this.errorListeners.forEach(o=>o(a));const n=this.recoveryStrategies.get(a.type);if(n?.canRecover)try{await n.recover()}catch(o){console.error("错误恢复失败:",o)}return a}normalizeError(e,t){if(e instanceof Error){const a=this.classifyError(e),n=this.getSeverity(a),o=this.isRecoverable(e);return{type:a,message:t?`${t}: ${e.message}`:e.message,details:e.stack,timestamp:new Date,recoverable:o,severity:n,userMessage:this.getUserMessage(a),retryCount:0,maxRetries:this.getMaxRetries(a)}}return{type:"UNKNOWN_ERROR",message:t?`${t}: 未知错误`:"未知错误",details:e,timestamp:new Date,recoverable:!1,severity:"critical",userMessage:"发生了未知错误，请联系技术支持",retryCount:0,maxRetries:0}}classifyError(e){const t=e.message.toLowerCase(),a=e.stack?.toLowerCase()||"";return t.includes("storage")||t.includes("localstorage")||t.includes("indexeddb")?t.includes("quota")||t.includes("exceeded")||t.includes("full")||t.includes("quota exceeded")?"STORAGE_QUOTA_ERROR":t.includes("permission")||t.includes("access denied")||t.includes("security")||t.includes("security error")?"STORAGE_PERMISSION_ERROR":t.includes("corruption")||t.includes("corrupted")||t.includes("invalid data")||t.includes("data error")?"STORAGE_CORRUPTION_ERROR":t.includes("read-only")||t.includes("readonly")||t.includes("blocked")?"STORAGE_PERMISSION_ERROR":"STORAGE_TEMPORARY_ERROR":t.includes("network")||t.includes("fetch")||t.includes("ajax")||t.includes("xhr")?t.includes("offline")||t.includes("no internet")||t.includes("connection")||t.includes("networkerror")?"NETWORK_OFFLINE_ERROR":t.includes("timeout")||t.includes("timed out")||t.includes("timeout error")?"NETWORK_TIMEOUT_ERROR":t.includes("server")||t.includes("500")||t.includes("502")||t.includes("503")||t.includes("504")||t.includes("bad gateway")||t.includes("cors")||t.includes("cross-origin")||t.includes("origin")?"NETWORK_SERVER_ERROR":"NETWORK_ERROR":t.includes("validation")||t.includes("invalid")||t.includes("schema")||t.includes("type error")?t.includes("structure")||t.includes("format")||t.includes("unexpected token")||t.includes("syntax error")?"VALIDATION_STRUCTURE_ERROR":t.includes("required")||t.includes("missing")||t.includes("undefined")||t.includes("null")?"VALIDATION_DATA_ERROR":"VALIDATION_ERROR":t.includes("migration")||t.includes("migrate")||t.includes("upgrade")?t.includes("legacy")||t.includes("old version")||t.includes("version mismatch")?"MIGRATION_LEGACY_ERROR":t.includes("version")||t.includes("compatibility")||t.includes("incompatible")?"MIGRATION_VERSION_ERROR":"MIGRATION_ERROR":t.includes("initialization")||t.includes("init")||t.includes("setup")||t.includes("configuration")?"INITIALIZATION_ERROR":a.includes("indexeddb")||a.includes("idb")?t.includes("version")||t.includes("upgrade")?"MIGRATION_VERSION_ERROR":"STORAGE_TEMPORARY_ERROR":t.includes("database")||t.includes("db")||t.includes("transaction")?t.includes("constraint")||t.includes("unique")?"VALIDATION_DATA_ERROR":"STORAGE_TEMPORARY_ERROR":t.includes("memory")||t.includes("heap")||t.includes("out of memory")?"STORAGE_QUOTA_ERROR":t.includes("file")||t.includes("directory")||t.includes("filesystem")?"STORAGE_TEMPORARY_ERROR":"UNKNOWN_ERROR"}isRecoverable(e){const t=e.message.toLowerCase(),n=["quota","permission","access denied","security","critical","readonly","blocked","insufficient","not supported"].some(o=>t.includes(o));return t.includes("temporary")||t.includes("transient")||t.includes("network")&&!t.includes("offline")||t.includes("timeout")?!0:!n}getSeverity(e){switch(e){case"STORAGE_QUOTA_ERROR":case"STORAGE_PERMISSION_ERROR":case"VALIDATION_STRUCTURE_ERROR":case"MIGRATION_VERSION_ERROR":case"UNKNOWN_ERROR":return"critical";case"INITIALIZATION_ERROR":case"STORAGE_CORRUPTION_ERROR":case"NETWORK_SERVER_ERROR":return"high";case"VALIDATION_DATA_ERROR":case"MIGRATION_LEGACY_ERROR":case"MIGRATION_ERROR":return"medium";case"STORAGE_TEMPORARY_ERROR":case"NETWORK_OFFLINE_ERROR":case"NETWORK_TIMEOUT_ERROR":case"NETWORK_ERROR":case"VALIDATION_ERROR":return"low";default:return"low"}}getUserMessage(e){switch(e){case"STORAGE_QUOTA_ERROR":return"存储空间已满。请清理一些旧的卡片或使用浏览器的存储管理功能释放空间。";case"STORAGE_PERMISSION_ERROR":return"无法访问存储。请检查浏览器隐私设置，确保允许网站使用本地存储。";case"STORAGE_CORRUPTION_ERROR":return"检测到数据损坏。系统正在自动修复，请稍候...";case"STORAGE_TEMPORARY_ERROR":return"存储暂时不可用。系统正在重试，请稍等片刻...";case"NETWORK_OFFLINE_ERROR":return"网络连接已断开。请检查您的网络连接，连接后系统会自动同步。";case"NETWORK_TIMEOUT_ERROR":return"网络响应超时。请检查网络连接并稍后重试。";case"NETWORK_SERVER_ERROR":return"服务器暂时不可用。请稍后重试，或联系技术支持。";case"VALIDATION_STRUCTURE_ERROR":return"数据格式有问题。系统正在尝试自动修复...";case"VALIDATION_DATA_ERROR":return"数据内容验证失败。系统正在清理无效数据...";case"MIGRATION_LEGACY_ERROR":return"旧版本数据迁移失败。部分数据可能需要手动重新输入。";case"MIGRATION_VERSION_ERROR":return"版本兼容性问题。请更新应用到最新版本。";case"INITIALIZATION_ERROR":return"系统初始化失败。请刷新页面重试，如持续出现问题请清除浏览器数据。";case"UNKNOWN_ERROR":return"发生了未知错误。请刷新页面重试，如问题持续请联系技术支持。";case"NETWORK_ERROR":return"网络连接出现问题。请检查网络设置后重试。";case"VALIDATION_ERROR":return"数据验证出现问题。系统正在处理...";case"MIGRATION_ERROR":return"数据迁移过程中出现问题。系统正在尝试解决...";default:return"发生了错误，请稍后重试。"}}getMaxRetries(e){switch(e){case"STORAGE_TEMPORARY_ERROR":case"NETWORK_TIMEOUT_ERROR":case"NETWORK_OFFLINE_ERROR":case"NETWORK_ERROR":return 5;case"STORAGE_CORRUPTION_ERROR":case"VALIDATION_DATA_ERROR":case"NETWORK_SERVER_ERROR":return 3;case"VALIDATION_STRUCTURE_ERROR":case"MIGRATION_LEGACY_ERROR":case"MIGRATION_ERROR":case"INITIALIZATION_ERROR":return 2;case"STORAGE_QUOTA_ERROR":case"STORAGE_PERMISSION_ERROR":case"MIGRATION_VERSION_ERROR":return 1;case"UNKNOWN_ERROR":case"VALIDATION_ERROR":return 2;default:return 0}}}const Qt=async()=>{try{const s=`_storage_test_${Date.now()}`;if(localStorage.setItem(s,"test"),localStorage.removeItem(s),"indexedDB"in window){const e=indexedDB.open("_storage_test_db",1);await new Promise((t,a)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>a(e.error)}),indexedDB.deleteDatabase("_storage_test_db")}return!0}catch(s){return console.error("存储可用性检查失败:",s),!1}},Fa=async()=>{try{const s="card_error_history",e=localStorage.getItem(s);if(e){const n=JSON.parse(e).slice(-20);localStorage.setItem(s,JSON.stringify(n))}const t=Object.keys(localStorage).filter(a=>a.startsWith("_temp_")||a.startsWith("_cache_"));t.forEach(a=>localStorage.removeItem(a)),console.log(`清理了 ${t.length} 个临时项`)}catch(s){throw console.error("存储空间清理失败:",s),s}},Oa=async()=>{try{const s=localStorage.getItem("cards");if(s){const t=JSON.parse(s).map(a=>({id:a.id,frontContent:{title:a.frontContent.title,text:a.frontContent.text,tags:a.frontContent.tags,lastModified:a.frontContent.lastModified},backContent:{title:a.backContent.title,text:a.backContent.text,tags:a.backContent.tags,lastModified:a.backContent.lastModified},style:a.style,createdAt:a.createdAt,updatedAt:a.updatedAt}));localStorage.setItem("cards",JSON.stringify(t))}console.log("数据压缩完成")}catch(s){throw console.error("数据压缩失败:",s),s}},lo=async()=>{try{const s=localStorage.getItem("cards");if(!s)return[];const e=JSON.parse(s);if(!Array.isArray(e))return[];const t=e.map(a=>{const n={id:a.id||Date.now().toString(),frontContent:{title:a.frontContent?.title||"未命名卡片",text:a.frontContent?.text||"",images:a.frontContent?.images||[],tags:a.frontContent?.tags||[],lastModified:a.frontContent?.lastModified?new Date(a.frontContent.lastModified):new Date},backContent:{title:a.backContent?.title||"背面",text:a.backContent?.text||"",images:a.backContent?.images||[],tags:a.backContent?.tags||[],lastModified:a.backContent?.lastModified?new Date(a.backContent.lastModified):new Date},style:a.style||{type:"solid",backgroundColor:"#f8fafc",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"xl",shadow:"md",borderWidth:0},isFlipped:a.isFlipped||!1,createdAt:a.createdAt?new Date(a.createdAt):new Date,updatedAt:a.updatedAt?new Date(a.updatedAt):new Date};return a.folderId&&(n.folderId=a.folderId),n});return localStorage.setItem("cards",JSON.stringify(t)),t}catch(s){return console.error("localStorage数据修复失败:",s),[]}},co=async()=>{try{return"indexedDB"in window?new Promise((s,e)=>{const t=indexedDB.open("CardAllDB",1);t.onsuccess=()=>{const a=t.result,i=a.transaction(["cards"],"readonly").objectStore("cards").getAll();i.onsuccess=()=>{const l=i.result||[];a.close(),s(l)},i.onerror=()=>{a.close(),e(i.error)}},t.onerror=()=>{e(t.error)}}):[]}catch(s){return console.error("IndexedDB数据恢复失败:",s),[]}},uo=async()=>{try{if("caches"in window){const e=await(await caches.open("cardall-data")).match("/cards-data");if(e)return(await e.json()).cards||[]}return[]}catch(s){return console.error("浏览器缓存恢复失败:",s),[]}},De=s=>{try{return s&&typeof s.id=="string"&&s.frontContent&&typeof s.frontContent.title=="string"&&s.backContent&&typeof s.backContent.title=="string"&&s.style&&s.createdAt&&s.updatedAt}catch{return!1}},Zt=async s=>s.map(e=>{const t={id:e.id||Date.now().toString(),frontContent:{title:e.frontContent?.title||"修复的卡片",text:e.frontContent?.text||"",images:Array.isArray(e.frontContent?.images)?e.frontContent.images:[],tags:Array.isArray(e.frontContent?.tags)?e.frontContent.tags:[],lastModified:e.frontContent?.lastModified?new Date(e.frontContent.lastModified):new Date},backContent:{title:e.backContent?.title||"背面",text:e.backContent?.text||"",images:Array.isArray(e.backContent?.images)?e.backContent.images:[],tags:Array.isArray(e.backContent?.tags)?e.backContent.tags:[],lastModified:e.backContent?.lastModified?new Date(e.backContent.lastModified):new Date},style:e.style||{type:"solid",backgroundColor:"#f8fafc",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"xl",shadow:"md",borderWidth:0},isFlipped:typeof e.isFlipped=="boolean"?e.isFlipped:!1,createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:new Date};return e.folderId&&(t.folderId=e.folderId),t}),ea=async()=>{try{const s=Date.now(),e=await fetch("/api/health",{method:"HEAD",cache:"no-cache"}),t=Date.now()-s;return{success:e.ok,latency:t}}catch{try{const e=Date.now(),t=await fetch("/",{method:"HEAD",cache:"no-cache"}),a=Date.now()-e;return{success:t.ok,latency:a}}catch{return{success:!1}}}},mo=async()=>{try{const s=await fetch("/api/status",{method:"GET",headers:{"Content-Type":"application/json"}});return s.ok?{success:!0,message:(await s.json()).message||"服务器正常"}:{success:!1,message:`服务器响应错误: ${s.status}`}}catch{return{success:!1,message:"无法连接到服务器"}}},go=[{id:"1",frontContent:{title:"React Best Practices",text:"Key principles for writing maintainable React code including component composition, state management, and performance optimization.",images:[],tags:["react","frontend","best-practices"],lastModified:new Date},backContent:{title:"Implementation Details",text:"Use functional components with hooks, implement proper error boundaries, optimize with React.memo and useMemo for expensive calculations.",images:[],tags:["react","frontend","best-practices"],lastModified:new Date},style:{type:"solid",backgroundColor:"#f8fafc",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"xl",shadow:"md",borderWidth:0},isFlipped:!1,createdAt:new Date("2024-01-15"),updatedAt:new Date("2024-01-15")},{id:"2",frontContent:{title:"TypeScript Tips",text:"Advanced TypeScript patterns for better type safety and developer experience in large applications.",images:[],tags:["typescript","types","development"],lastModified:new Date},backContent:{title:"Advanced Patterns",text:"Utility types, conditional types, mapped types, and template literal types for complex type transformations.",images:[],tags:["typescript","types","development"],lastModified:new Date},style:{type:"gradient",gradientColors:["#667eea","#764ba2"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"xl",shadow:"lg",borderWidth:0},isFlipped:!1,createdAt:new Date("2024-01-16"),updatedAt:new Date("2024-01-16")}];function fo(){const[s,e]=d.useState([]),[t,a]=d.useState(!1),[n,o]=d.useState({searchTerm:"",tags:[]}),[i,l]=d.useState({layout:"grid",cardSize:"medium",showTags:!0,showDates:!1,sortBy:"updated",sortOrder:"desc"}),[u,m]=d.useState([]),[c,w]=d.useState(null),[y,g]=d.useState([]),[S,E]=d.useState(!1),[R,v]=d.useState(!1),[h,f]=d.useState(null),p=Xe.getInstance(),x=Le.getInstance();d.useEffect(()=>{const T=p.onError(b=>{if(w(b),g(A=>[...A.slice(-9),b]),b.userMessage)switch(b.severity){case"critical":console.error("严重错误:",b.userMessage);break;case"high":console.warn("高级别错误:",b.userMessage);break;case"medium":console.warn("中等级别错误:",b.userMessage);break;case"low":console.info("低级别错误:",b.userMessage);break}});p.registerRecoveryStrategy("STORAGE_TEMPORARY_ERROR",{canRecover:!0,maxRetries:3,retryDelay:1e3,recover:async()=>{console.log("尝试恢复临时存储错误...");try{if(!await Qt())throw new Error("存储不可用");await Fa(),await new Promise(A=>setTimeout(A,1e3))}catch(b){throw console.error("临时存储恢复失败:",b),b}},fallback:()=>{console.log("临时存储恢复失败，使用空数据"),e([])},shouldUseMock:!1}),p.registerRecoveryStrategy("STORAGE_CORRUPTION_ERROR",{canRecover:!0,maxRetries:2,retryDelay:500,recover:async()=>{console.log("尝试修复数据损坏...");try{let b=[];const A=await lo();if(A.length>0&&(b=A),b.length===0){const q=await co();q.length>0&&(b=q)}if(b.length===0){const q=await uo();q.length>0&&(b=q)}if(b.length>0)e(b),console.log(`成功恢复 ${b.length} 张卡片`);else throw new Error("无法从任何来源恢复数据")}catch(b){throw console.error("数据修复失败:",b),b}},fallback:()=>{console.log("数据修复失败，使用空数据"),e([])},shouldUseMock:!1}),p.registerRecoveryStrategy("VALIDATION_DATA_ERROR",{canRecover:!0,maxRetries:2,retryDelay:300,recover:async()=>{console.log("尝试修复数据验证错误...");try{const b=s.filter(A=>!De(A));if(b.length>0){console.log(`发现 ${b.length} 张无效卡片，尝试修复...`);const A=await Zt(b);e(q=>q.map(se=>A.find(de=>de.id===se.id)||se)),console.log(`成功修复 ${A.length} 张卡片`)}}catch(b){throw console.error("数据验证修复失败:",b),b}},fallback:()=>{console.log("数据验证修复失败，移除无效卡片"),e(b=>b.filter(A=>De(A)))},shouldUseMock:!1}),p.registerRecoveryStrategy("NETWORK_TIMEOUT_ERROR",{canRecover:!0,maxRetries:3,retryDelay:2e3,recover:async()=>{console.log("网络超时恢复策略...");try{if(!navigator.onLine)throw new Error("网络离线");if(!(await ea()).success)throw new Error("网络连接测试失败");console.log("网络连接已恢复")}catch(b){throw console.error("网络恢复失败:",b),b}},shouldUseMock:!1}),p.registerRecoveryStrategy("NETWORK_OFFLINE_ERROR",{canRecover:!0,maxRetries:3,retryDelay:3e3,recover:async()=>{console.log("网络离线恢复策略...");try{let b=0;const A=10;for(;b<A;){if(navigator.onLine&&(await ea()).success){console.log("网络连接已恢复");return}b++,await new Promise(q=>setTimeout(q,1e3))}throw new Error("网络连接未在预期时间内恢复")}catch(b){throw console.error("网络离线恢复失败:",b),b}},shouldUseMock:!1}),p.registerRecoveryStrategy("STORAGE_QUOTA_ERROR",{canRecover:!0,maxRetries:1,retryDelay:1e3,recover:async()=>{console.log("存储配额错误恢复策略...");try{await Fa(),await Oa(),console.log("存储空间清理完成")}catch(b){throw console.error("存储配额恢复失败:",b),b}},fallback:()=>{console.log("存储空间不足，建议清理数据或使用云端同步"),alert("存储空间不足，请清理一些数据或使用云端同步功能")},shouldUseMock:!1}),p.registerRecoveryStrategy("INITIALIZATION_ERROR",{canRecover:!0,maxRetries:2,retryDelay:1e3,recover:async()=>{console.log("初始化错误恢复策略...");try{await x.reinitialize(),await C(),console.log("初始化恢复成功")}catch(b){throw console.error("初始化恢复失败:",b),b}},shouldUseMock:!1}),p.registerRecoveryStrategy("NETWORK_SERVER_ERROR",{canRecover:!0,maxRetries:3,retryDelay:2e3,recover:async()=>{console.log("服务器错误恢复策略...");try{if(await new Promise(A=>setTimeout(A,2e3)),!(await mo()).success)throw new Error("服务器仍然不可用");console.log("服务器连接已恢复")}catch(b){throw console.error("服务器恢复失败:",b),b}},shouldUseMock:!1});const k=async b=>{console.log("存储数据变更:",b),b.type==="cardsChanged"&&b.data?.externalChange&&(console.log("检测到外部数据变更，重新加载..."),await C()),b.type==="cardsChanged"&&f(new Date)};return x.addEventListener("cardsChanged",k),x.addEventListener("cardCreated",k),x.addEventListener("cardUpdated",k),x.addEventListener("cardDeleted",k),()=>{T(),x.removeEventListener("cardsChanged",k),x.removeEventListener("cardCreated",k),x.removeEventListener("cardUpdated",k),x.removeEventListener("cardDeleted",k)}},[x]);const C=d.useCallback(async()=>{E(!0);try{let T=[],k=0;const b=3;for(;k<b;)try{T=await x.getCards();break}catch(A){if(k++,k===b)throw A;console.warn(`第 ${k} 次加载失败，等待重试...`),await new Promise(q=>setTimeout(q,1e3*k))}if(T.length>0){const A=T.filter(De);A.length!==T.length&&console.warn(`发现 ${T.length-A.length} 张无效卡片，已过滤`),e(A),console.log(`成功加载 ${A.length} 张有效卡片 (使用 ${x.getStorageMode()} 存储模式)`)}else console.log("没有找到数据，使用空数组"),e([]);a(!0)}catch(T){console.error("加载数据失败:",T),await p.handleError(T,"加载卡片数据失败");try{console.log("尝试回退到DataConverterAdapter...");const k=we.loadFromLocalStorage();if(k.length>0){const b=k.filter(De);e(b),console.log(`回退加载成功：${b.length} 张有效卡片`)}else e([])}catch(k){console.error("回退加载也失败:",k),await p.handleError(k,"回退加载失败"),e([])}a(!0)}finally{E(!1)}},[p]),D=d.useCallback(async()=>{if(!(!c||!c.recoverable)){E(!0),v(!0);try{const T=p.recoveryStrategies.get(c.type);if(T?.canRecover){const k=T.maxRetries||c.maxRetries||1,b=T.retryDelay||1e3;let A=null;for(let q=1;q<=k;q++)try{console.log(`尝试恢复 ${c.type} - 第 ${q} 次`),await T.recover(),await C(),w(null),console.log(`错误恢复成功：${c.type}`);break}catch(se){if(A=se,console.error(`恢复失败，第 ${q} 次尝试:`,se),q<k){const ce=b*Math.pow(2,q-1);console.log(`等待 ${ce}ms 后重试...`),await new Promise(de=>setTimeout(de,ce))}}A&&T.fallback&&(console.log("所有恢复尝试失败，执行fallback策略"),T.fallback()),c&&T.shouldUseMock&&s.length===0&&(console.warn("所有恢复策略失败，使用mock数据作为最后手段"),e(go),w(null))}else console.warn(`错误类型 ${c.type} 没有可用的恢复策略`)}catch(T){console.error("错误恢复过程中发生异常:",T);const k=p.recoveryStrategies.get(c.type)?.fallback;k&&k()}finally{E(!1)}}},[c,p,s.length,C]),j=d.useCallback(()=>{const T=s.filter(k=>{if(n.searchTerm){const b=n.searchTerm.toLowerCase(),A=k.frontContent.title.toLowerCase().includes(b)||k.backContent.title.toLowerCase().includes(b),q=k.frontContent.text.toLowerCase().includes(b)||k.backContent.text.toLowerCase().includes(b),se=[...k.frontContent.tags,...k.backContent.tags].some(ce=>ce.toLowerCase().includes(b));if(!A&&!q&&!se)return!1}if(n.tags.length>0){const b=[...k.frontContent.tags,...k.backContent.tags];if(!n.tags.some(A=>b.includes(A)))return!1}if(n.folderId&&k.folderId!==n.folderId)return!1;if(n.dateRange){const b=new Date(k.updatedAt);if(b<n.dateRange.start||b>n.dateRange.end)return!1}return!(n.styleType&&k.style.type!==n.styleType||n.hasImages!==void 0&&(k.frontContent.images.length>0||k.backContent.images.length>0)!==n.hasImages)});return T.sort((k,b)=>{let A=0;switch(i.sortBy){case"created":A=new Date(k.createdAt).getTime()-new Date(b.createdAt).getTime();break;case"updated":A=new Date(k.updatedAt).getTime()-new Date(b.updatedAt).getTime();break;case"title":A=k.frontContent.title.localeCompare(b.frontContent.title);break;default:A=0}return i.sortOrder==="desc"?-A:A}),T},[s,n,i]),N=d.useCallback(T=>{e(k=>{switch(T.type){case"CREATE_CARD":{const b={...T.payload,id:Date.now().toString(),createdAt:new Date,updatedAt:new Date};return[...k,b]}case"UPDATE_CARD":return k.map(b=>b.id===T.payload.id?{...b,...T.payload.updates,updatedAt:new Date}:b);case"DELETE_CARD":return k.filter(b=>b.id!==T.payload);case"SELECT_CARD":return m(b=>b.includes(T.payload)?b.filter(A=>A!==T.payload):[...b,T.payload]),k;case"DESELECT_ALL":return m([]),k;case"DUPLICATE_CARD":{const b=k.find(q=>q.id===T.payload);if(!b)return k;const A={...b,id:Date.now().toString(),createdAt:new Date,updatedAt:new Date};return[...k,A]}case"MOVE_TO_FOLDER":return k.map(A=>A.id===T.payload.cardId?{...A,folderId:T.payload.folderId,updatedAt:new Date}:A);default:return k}})},[]),P=d.useCallback(T=>s.find(k=>k.id===T),[s]),$=d.useCallback(()=>s.filter(T=>u.includes(T.id)),[s,u]),Z=d.useCallback(()=>{const T=new Set;return s.forEach(k=>{k.frontContent.tags.forEach(b=>T.add(b)),k.backContent.tags.forEach(b=>T.add(b))}),Array.from(T).sort()},[s]),Q=d.useCallback(T=>{},[]),L=d.useCallback((T,k)=>{e(b=>b.map(A=>{const q=de=>k?de.map(fe=>fe===T?k:fe):de.filter(fe=>fe!==T),se=q(A.frontContent.tags),ce=q(A.backContent.tags);return JSON.stringify(se)!==JSON.stringify(A.frontContent.tags)||JSON.stringify(ce)!==JSON.stringify(A.backContent.tags)?{...A,frontContent:{...A.frontContent,tags:se,lastModified:new Date},backContent:{...A.backContent,tags:ce,lastModified:new Date},updatedAt:new Date}:A}))},[]),ne=d.useCallback(T=>s.filter(k=>k.frontContent.tags.includes(T)||k.backContent.tags.includes(T)),[s]);d.useEffect(()=>{if(t)return;(async()=>{E(!0);try{const k=await x.getCards();if(k.length>0){const b=k.map(A=>({...A,isFlipped:!1}));e(b),console.log(`成功加载 ${k.length} 张卡片 (使用 ${x.getStorageMode()} 存储模式)`)}else try{console.log("尝试从localStorage加载数据...");const b=we.loadFromLocalStorage();if(b.length>0){const A=b.map(q=>({...q,isFlipped:!1}));e(A),console.log(`从localStorage加载 ${b.length} 张卡片`),await x.saveCards(A),console.log("数据已迁移到UniversalStorageAdapter")}else console.log("没有找到数据，使用空数组"),e([])}catch(b){console.warn("从localStorage加载失败:",b),e([])}a(!0)}catch(k){console.error("加载卡片数据失败:",k),await p.handleError(k,"加载卡片数据失败"),await D()}finally{E(!1)}})()},[t,p,D,x]),d.useEffect(()=>{if(!t||S)return;const T=setTimeout(async()=>{try{const k=s.filter(se=>!De(se));if(k.length>0){console.warn(`发现 ${k.length} 张无效卡片，保存前尝试修复...`);const se=await Zt(k);se.length>0&&e(ce=>ce.map(de=>se.find(gt=>gt.id===de.id)||de))}const b=s.map(se=>({...se,isFlipped:!1}));let A=0;const q=2;for(;A<q;)try{await x.saveCards(b),console.log(`自动保存成功：${b.length} 张卡片 (使用 ${x.getStorageMode()} 存储模式)`);break}catch(se){if(A++,A===q)throw se;console.warn(`第 ${A} 次保存失败，等待重试...`),await new Promise(ce=>setTimeout(ce,500*A))}}catch(k){console.error("保存卡片到持久化存储失败:",k),await p.handleError(k,"保存卡片数据失败");try{console.log("尝试回退到DataConverterAdapter..."),we.saveToLocalStorage(cardsForSave),console.log("回退保存成功")}catch(b){console.error("回退保存也失败:",b),await p.handleError(b,"回退保存失败")}}},2e3);return()=>clearTimeout(T)},[s,t,S,p,x]);const te={performPreventiveChecks:async()=>{try{if(!await Qt())return console.warn("存储空间检查失败，可能即将出现问题"),!1;navigator.onLine&&((await ea()).success||console.warn("网络连接不稳定，可能影响数据同步"));const k=s.filter(b=>!De(b));return k.length>0&&console.warn(`发现 ${k.length} 张无效卡片，建议修复`),!0}catch(T){return console.error("预防性检查失败:",T),!1}},analyzeErrorTrends:()=>{const T=y.slice(-10),k=y.slice(-20,-10);if(T.length===0)return{trend:"improving",suggestions:["错误率正常，继续保持"]};const b=new Map;T.forEach(de=>{const fe=b.get(de.type)||0;b.set(de.type,fe+1)});const A=[];b.forEach((de,fe)=>{if(de>2)switch(fe){case"STORAGE_TEMPORARY_ERROR":A.push("频繁的存储临时错误，建议检查存储设备");break;case"NETWORK_TIMEOUT_ERROR":A.push("网络超时频繁，建议检查网络连接");break;case"VALIDATION_DATA_ERROR":A.push("数据验证错误增多，建议检查数据源");break}});const q=T.length,se=k.length;let ce="stable";return q<se?ce="improving":q>se&&(ce="worsening"),A.length===0&&A.push("系统运行正常，继续保持"),{trend:ce,suggestions:A}},runMaintenanceTasks:async()=>{try{console.log("开始运行维护任务..."),y.length>50&&(g(b=>b.slice(-30)),console.log("清理了错误历史记录")),await Qt()||(await Oa(),console.log("执行了数据压缩"));const k=s.filter(b=>!De(b));if(k.length>0){const b=await Zt(k);b.length>0&&console.log(`修复了 ${b.length} 张无效卡片`)}console.log("维护任务完成")}catch(T){console.error("维护任务执行失败:",T)}}},[J,me]=d.useState(new Set),F=d.useCallback(T=>(me(k=>new Set(k).add(T)),()=>{me(k=>{const b=new Set(k);return b.delete(T),b})}),[]),U=d.useCallback((T,k)=>{J.forEach(b=>{try{b(T,k)}catch(A){console.error("数据变更监听器执行失败:",A)}})},[J]),ae=d.useCallback(async(T=!1)=>{if(!T&&t&&s.length>0)return s;E(!0);try{let k=[];try{k=await x.getCards(),k.length>0&&console.log(`从UniversalStorageAdapter加载 ${k.length} 张卡片`)}catch(A){console.warn("UniversalStorageAdapter加载失败，尝试回退:",A)}if(k.length===0)try{const A=we.loadFromLocalStorage();A.length>0&&(k=A,console.log(`从localStorage加载 ${A.length} 张卡片`),await x.saveCards(A))}catch(A){console.warn("localStorage加载失败:",A)}const b=k.filter(De);return b.length!==k.length&&console.warn(`过滤了 ${k.length-b.length} 张无效卡片`),e(b),a(!0),U("cardsLoaded",{cardCount:b.length}),b}catch(k){return console.error("加载卡片失败:",k),await p.handleError(k,"loadCards失败"),e([]),a(!0),[]}finally{E(!1)}},[t,s.length,x,p,U]),V=d.useCallback(async(T=s)=>{try{const k=T.filter(q=>!De(q));k.length>0&&console.warn(`保存前发现 ${k.length} 张无效卡片`);const b=T.filter(De);return await x.saveCards(b)?(console.log(`成功保存 ${b.length} 张卡片`),U("cardsSaved",{cardCount:b.length}),!0):!1}catch(k){console.error("保存卡片失败:",k),await p.handleError(k,"saveCards失败");try{return we.saveToLocalStorage(T),console.log("回退保存成功"),!0}catch(b){return console.error("回退保存失败:",b),!1}}},[s,x,p,U]),Y=d.useCallback(async(T,k)=>{E(!0);try{console.log(`开始批量操作: ${k}`);for(let b=0;b<T.length;b++)try{await T[b]()}catch(A){throw console.error(`批量操作第 ${b+1} 步失败:`,A),A}return await V(),console.log(`批量操作完成: ${k}`),U("batchOperationCompleted",{description:k,operationCount:T.length}),!0}catch(b){return console.error(`批量操作失败: ${k}`,b),await p.handleError(b,`批量操作失败: ${k}`),!1}finally{E(!1)}},[V,p,U]);d.useEffect(()=>{if(!t)return;const T=setInterval(async()=>{try{await te.runMaintenanceTasks()}catch(b){console.error("定期维护任务失败:",b)}},5*60*1e3),k=setInterval(async()=>{try{await te.performPreventiveChecks()}catch(b){console.error("预防性检查失败:",b)}},30*1e3);return()=>{clearInterval(T),clearInterval(k)}},[t,te]);const X=d.useCallback(async()=>{if(!c||!c.recoverable)return!1;console.log("开始增强的错误恢复流程..."),E(!0);try{const T=p.recoveryStrategies.get(c.type);return T?.canRecover?(await T.recover(),await C(),w(null),console.log("错误恢复成功"),!0):!1}catch(T){return console.error("错误恢复失败:",T),!1}finally{E(!1)}},[c,p,C]),oe=d.useCallback(()=>{if(!c)return null;switch(c.severity){case"critical":return{level:"critical",message:"严重错误，需要立即关注"};case"high":return{level:"high",message:"高级别错误，建议尽快处理"};case"medium":return{level:"medium",message:"中等级别错误，可以稍后处理"};case"low":return{level:"low",message:"低级别错误，可以忽略"};default:return null}},[c]),B=d.useCallback(()=>c?c.userMessage||c.message:null,[c]),H=d.useCallback(()=>{},[]);return{cards:j(),allCards:s,filter:n,setFilter:o,viewSettings:i,setViewSettings:l,selectedCardIds:u,dispatch:N,flipCard:Q,getCardById:P,getSelectedCards:$,getAllTags:Z,updateTagsInAllCards:L,getCardsWithTag:ne,isInitialized:t,error:c,errorHistory:y,isLoading:S,recoveryAttempted:R,recoverFromError:D,reloadData:C,clearError:()=>w(null),clearErrorHistory:()=>g([]),lastSyncTime:h,getUserErrorMessage:B,getErrorSeverityInfo:oe,errorPrevention:te,loadCards:ae,saveCards:V,onDataChange:F,performBatchOperation:Y,enhancedRecoverFromError:X,useMockDataForDevelopment:H}}class ho{config;directoryHandle=null;isSupported;constructor(){this.config={baseDirectory:"CardAll",imageDirectory:"images",tempDirectory:"temp",cacheDirectory:"cache"},this.isSupported="showDirectoryPicker"in window}isFileSystemAccessSupported(){return this.isSupported}async requestDirectoryAccess(){if(!this.isSupported)return console.warn("File System Access API not supported, using fallback storage"),this.saveStorageStrategy("indexeddb"),!1;try{return this.directoryHandle=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"}),await this.ensureDirectoryStructure(),this.saveStorageStrategy("filesystem"),!0}catch(e){return e.name==="AbortError"?console.log("User cancelled directory selection, using fallback storage"):console.error("Failed to access directory:",e),this.saveStorageStrategy("indexeddb"),!1}}async saveStorageStrategy(e){try{await _.settings.put({key:"storageStrategy",value:e,updatedAt:new Date,scope:"global"})}catch(t){console.error("Failed to save storage strategy:",t)}}async getStorageStrategy(){try{return(await _.settings.get("storageStrategy"))?.value||"indexeddb"}catch{return"indexeddb"}}async ensureDirectoryStructure(){if(this.directoryHandle)try{await this.getOrCreateDirectory(this.config.imageDirectory),await this.getOrCreateDirectory(this.config.tempDirectory),await this.getOrCreateDirectory(this.config.cacheDirectory),console.log("Directory structure created successfully")}catch(e){console.error("Failed to create directory structure:",e)}}async getOrCreateDirectory(e){if(!this.directoryHandle)throw new Error("No directory handle available");try{return await this.directoryHandle.getDirectoryHandle(e)}catch{return await this.directoryHandle.getDirectoryHandle(e,{create:!0})}}async getOrCreateNestedDirectory(e){if(!this.directoryHandle)throw new Error("No directory handle available");const t=e.split("/");let a=this.directoryHandle;for(const n of t)if(n)try{a=await a.getDirectoryHandle(n)}catch{a=await a.getDirectoryHandle(n,{create:!0})}return a}generateImagePath(e,t){const a=t||"uncategorized";return`${this.config.imageDirectory}/${a}/${e}`}async saveImage(e,t,a){const n=`img_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=`${n}.webp`,l=`${this.generateImagePath(t,a)}/${o}`;try{const u=await this.processImage(e),m=await this.getImageMetadata(e,u);this.isSupported&&this.directoryHandle?await this.saveToFileSystem(l,u):await this.saveToIndexedDB(l,u);const c={id:n,cardId:t,fileName:o,filePath:l,metadata:m,createdAt:new Date,syncVersion:1,pendingSync:!0};return await _.images.add(c),{id:n,fileName:o,filePath:l,metadata:m}}catch(u){throw console.error("Failed to save image:",u),u}}async processImage(e){return new Promise((t,a)=>{const n=document.createElement("canvas"),o=n.getContext("2d"),i=new Image;i.onload=()=>{try{let{width:m,height:c}=i;if(m>1920||c>1080){const w=Math.min(1920/m,1080/c);m*=w,c*=w}n.width=m,n.height=c,o?.drawImage(i,0,0,m,c),n.toBlob(w=>{w?t(w):a(new Error("Failed to convert image"))},"image/webp",.8)}catch(l){a(l)}},i.onerror=()=>a(new Error("Failed to load image")),i.src=URL.createObjectURL(e)})}async getImageMetadata(e,t){return new Promise(a=>{const n=new Image;n.onload=()=>{a({originalName:e.name,size:t.size,width:n.width,height:n.height,format:"webp",compressed:!0})},n.src=URL.createObjectURL(t)})}async saveToFileSystem(e,t){if(!this.directoryHandle)throw new Error("No directory handle available");const a=e.split("/"),n=a.pop(),o=a.join("/"),u=await(await(await this.getOrCreateNestedDirectory(o)).getFileHandle(n,{create:!0})).createWritable();await u.write(t),await u.close()}async saveToIndexedDB(e,t){await t.arrayBuffer();const a=await this.blobToBase64(t);localStorage.setItem(`cardall_file_${e}`,a)}blobToBase64(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=a,n.readAsDataURL(e)})}async getImage(e){try{return this.isSupported&&this.directoryHandle?await this.getFromFileSystem(e):await this.getFromIndexedDB(e)}catch(t){throw console.error("Failed to get image:",t),t}}async getFromFileSystem(e){if(!this.directoryHandle)throw new Error("No directory handle available");const t=e.split("/"),a=t.pop(),n=t.join("/"),l=await(await(await this.getOrCreateNestedDirectory(n)).getFileHandle(a)).getFile();return URL.createObjectURL(l)}async getFromIndexedDB(e){const t=localStorage.getItem(`cardall_file_${e}`);if(!t)throw new Error("Image not found in storage");return t}async deleteImage(e){try{this.isSupported&&this.directoryHandle?await this.deleteFromFileSystem(e):await this.deleteFromIndexedDB(e),await _.images.where("filePath").equals(e).delete()}catch(t){throw console.error("Failed to delete image:",t),t}}async deleteFromFileSystem(e){if(this.directoryHandle)try{const t=e.split("/"),a=t.pop(),n=t.join("/");await(await this.getOrCreateNestedDirectory(n)).removeEntry(a)}catch(t){console.warn("Failed to delete file from filesystem:",t)}}async deleteFromIndexedDB(e){localStorage.removeItem(`cardall_file_${e}`)}async getStorageStats(){const e=await _.images.toArray(),t=e.reduce((a,n)=>a+n.metadata.size,0);return{totalImages:e.length,totalSize:t,storageMode:this.isSupported&&this.directoryHandle?"filesystem":"indexeddb"}}}const He=new ho,po=s=>{const e={...s};return{...e,id:e.id||"",createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}},ta=()=>null;function yo(){const[s,e]=d.useState([]),[t,a]=d.useState({searchTerm:"",tags:[]}),[n,o]=d.useState({layout:"grid",cardSize:"medium",showTags:!0,showDates:!1,sortBy:"updated",sortOrder:"desc"}),[i,l]=d.useState([]),[u,m]=d.useState(!0),c=d.useCallback(async()=>{try{m(!0);const p=(await _.cards.toArray()).map(po);e(p)}catch(f){console.error("Failed to load cards:",f)}finally{m(!1)}},[]);d.useEffect(()=>{c()},[c]),d.useEffect(()=>{const f=_.cards.hook("creating",(C,D,j)=>{console.log("Card creating:",C)}),p=_.cards.hook("updating",(C,D,j,N)=>{console.log("Card updating:",D)}),x=_.cards.hook("deleting",(C,D,j)=>{console.log("Card deleting:",C)});return()=>{f?.unsubscribe(),p?.unsubscribe(),x?.unsubscribe()}},[]);const w=d.useCallback(()=>{const f=s.filter(p=>{if(t.searchTerm){const x=t.searchTerm.toLowerCase(),C=p.frontContent.title.toLowerCase().includes(x)||p.backContent.title.toLowerCase().includes(x),D=p.frontContent.text.toLowerCase().includes(x)||p.backContent.text.toLowerCase().includes(x),j=[...p.frontContent.tags,...p.backContent.tags].some(N=>N.toLowerCase().includes(x));if(!C&&!D&&!j)return!1}if(t.tags.length>0){const x=[...p.frontContent.tags,...p.backContent.tags];if(!t.tags.some(C=>x.includes(C)))return!1}if(t.folderId&&p.folderId!==t.folderId)return!1;if(t.dateRange){const x=new Date(p.updatedAt);if(x<t.dateRange.start||x>t.dateRange.end)return!1}return!(t.styleType&&p.style.type!==t.styleType||t.hasImages!==void 0&&(p.frontContent.images.length>0||p.backContent.images.length>0)!==t.hasImages)});return f.sort((p,x)=>{let C=0;switch(n.sortBy){case"created":C=new Date(p.createdAt).getTime()-new Date(x.createdAt).getTime();break;case"updated":C=new Date(p.updatedAt).getTime()-new Date(x.updatedAt).getTime();break;case"title":C=p.frontContent.title.localeCompare(x.frontContent.title);break;default:C=0}return n.sortOrder==="desc"?-C:C}),f},[s,t,n]),y=d.useCallback(async f=>{const p=ta();try{switch(f.type){case"CREATE_CARD":{const x=crypto.randomUUID(),C={...f.payload,id:x,userId:p,createdAt:new Date,updatedAt:new Date,syncVersion:1,pendingSync:!0};await _.cards.add(C),await c();break}case"UPDATE_CARD":{const x={...f.payload.updates,userId:p,updatedAt:new Date,syncVersion:1,pendingSync:!0};await _.cards.update(f.payload.id,x),await c();break}case"DELETE_CARD":{const x=await _.cards.get(f.payload);if(x){const C=[...x.frontContent.images,...x.backContent.images];for(const D of C)if(D.url&&!D.url.startsWith("data:"))try{await He.deleteImage(D.url)}catch(j){console.warn("Failed to delete image:",j)}}await _.cards.delete(f.payload),await c();break}case"FLIP_CARD":{const x=await _.cards.get(f.payload);if(x){const C={isFlipped:!x.isFlipped,updatedAt:new Date,syncVersion:(x.syncVersion||0)+1,pendingSync:!0};await _.cards.update(f.payload,C),await c()}break}case"SELECT_CARD":l(x=>x.includes(f.payload)?x.filter(C=>C!==f.payload):[...x,f.payload]);break;case"DESELECT_ALL":l([]);break;case"DUPLICATE_CARD":{const x=await _.cards.get(f.payload);if(x){const C=crypto.randomUUID(),D={...x,id:C,userId:p,createdAt:new Date,updatedAt:new Date,syncVersion:1,pendingSync:!0};await _.cards.add(D),await c()}break}case"MOVE_TO_FOLDER":{const x={folderId:f.payload.folderId,userId:p,updatedAt:new Date,syncVersion:1,pendingSync:!0};await _.cards.update(f.payload.cardId,x),await c();break}default:console.warn("Unknown card action:",f)}}catch(x){throw console.error("Card operation failed:",x),x}},[c]),g=d.useCallback(f=>s.find(p=>p.id===f),[s]),S=d.useCallback(()=>s.filter(f=>i.includes(f.id)),[s,i]),E=d.useCallback(()=>{const f=new Set;return s.forEach(p=>{p.frontContent.tags.forEach(x=>f.add(x)),p.backContent.tags.forEach(x=>f.add(x))}),Array.from(f).sort()},[s]),R=d.useCallback(async(f,p)=>{const x=ta();try{const C=await _.cards.filter(D=>D.frontContent.tags.includes(f)||D.backContent.tags.includes(f)).toArray();for(const D of C){const j=Z=>p?Z.map(Q=>Q===f?p:Q):Z.filter(Q=>Q!==f),N=j(D.frontContent.tags),P=j(D.backContent.tags),$={frontContent:{...D.frontContent,tags:N,lastModified:new Date},backContent:{...D.backContent,tags:P,lastModified:new Date},userId:x,updatedAt:new Date,syncVersion:(D.syncVersion||0)+1,pendingSync:!0};await _.cards.update(D.id,$)}await c()}catch(C){throw console.error("Failed to update tags in cards:",C),C}},[c]),v=d.useCallback(f=>s.filter(p=>p.frontContent.tags.includes(f)||p.backContent.tags.includes(f)),[s]),h=d.useCallback(async(f,p)=>{const x=ta();try{const C=await _.cards.get(p);if(!C)throw new Error("Card not found");const D=await He.saveImage(f,p,C.folderId),j={id:D.id,url:D.filePath,alt:f.name,width:D.metadata.width,height:D.metadata.height,aspectRatio:D.metadata.width/D.metadata.height},N=C.isFlipped?"backContent":"frontContent",P=[...C[N].images,j];return await _.cards.update(p,$=>{N==="frontContent"?$.frontContent={...$.frontContent,images:P,lastModified:new Date}:$.backContent={...$.backContent,images:P,lastModified:new Date},$.userId=x,$.updatedAt=new Date,$.syncVersion=($.syncVersion||0)+1,$.pendingSync=!0}),await c(),j}catch(C){throw console.error("Failed to upload image:",C),C}},[c]);return{cards:w(),allCards:s,filter:t,setFilter:a,viewSettings:n,setViewSettings:o,selectedCardIds:i,isLoading:u,dispatch:y,getCardById:g,getSelectedCards:S,getAllTags:E,updateTagsInAllCards:R,getCardsWithTag:v,handleImageUpload:h,loadCards:c}}class _e{static instance=null;MIGRATION_STATUS_KEY="cardall_migration_status";BACKUP_PREFIX="cardall_backup_";static getInstance(){return _e.instance||(_e.instance=new _e),_e.instance}async needsMigration(){try{return!(this.getMigrationStatus()?.completed||!W.get("cards")||await _.cards.count()>0)}catch(e){return console.error("Failed to check migration status:",e),!1}}async migrate(e={}){const{createBackup:t=!0,validateData:a=!0,cleanupAfterSuccess:n=!0,progressCallback:o}=e,i=Date.now();try{if(!await this.needsMigration()){const y={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:[],duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"completed",progress:100,message:"No migration needed"}),y}this.reportProgress(o,{stage:"starting",progress:0,message:"Starting migration..."}),this.setMigrationStatus({started:!0,startTime:new Date,stage:"starting"}),this.reportProgress(o,{stage:"loading",progress:10,message:"Loading data from localStorage..."});const u=this.loadLocalStorageData();if(u.length===0){const y={success:!0,migratedCards:0,totalCards:0,errors:[],warnings:["No data found in localStorage"],duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"completed",progress:100,message:"No data to migrate"}),y}let m;if(t&&(this.reportProgress(o,{stage:"backup",progress:20,message:"Creating backup..."}),m=await this.createBackup(u)),a){this.reportProgress(o,{stage:"validation",progress:30,message:"Validating data integrity..."});const y=this.validateMigrationData(u);if(!y.valid)throw ie("VALIDATION_FAILED","Data validation failed",{errors:y.errors})}this.reportProgress(o,{stage:"migration",progress:50,message:`Migrating ${u.length} cards...`});const c=await this.performMigration(u,(y,g)=>{this.reportProgress(o,{stage:"migration",progress:50+y*.4,message:g})});if(a){this.reportProgress(o,{stage:"verification",progress:90,message:"Verifying migration results..."});const y=await this.verifyMigrationResults(u.length);if(!y.success)throw ie("VERIFICATION_FAILED","Migration verification failed",{details:y.errors})}n&&c.errors.length===0&&(this.reportProgress(o,{stage:"cleanup",progress:95,message:"Cleaning up original data..."}),this.cleanupLocalStorage()),this.setMigrationStatus({completed:!0,completedAt:new Date,success:!0,migratedCards:c.migratedCards,totalCards:u.length});const w={success:c.success,migratedCards:c.migratedCards,totalCards:u.length,errors:c.errors,warnings:c.warnings,duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"completed",progress:100,message:`Migration completed successfully: ${c.migratedCards}/${u.length} cards migrated`}),w}catch(l){this.setMigrationStatus({completed:!0,completedAt:new Date,success:!1,error:l instanceof Error?l.message:String(l)});const u={success:!1,migratedCards:0,totalCards:0,errors:[l instanceof Error?l.message:"Unknown migration error"],warnings:[],duration:Date.now()-i,timestamp:new Date};return this.reportProgress(o,{stage:"error",progress:0,message:`Migration failed: ${l instanceof Error?l.message:"Unknown error"}`}),u}}loadLocalStorageData(){try{return we.loadFromLocalStorage()}catch(e){throw ie("LOAD_DATA_FAILED","Failed to load data from localStorage",{error:e instanceof Error?e.message:String(e)})}}async createBackup(e){try{return await(await fa.create()).backupData()}catch(t){throw ie("BACKUP_FAILED","Failed to create backup",{error:t instanceof Error?t.message:String(t)})}}validateMigrationData(e){const t=[];return Array.isArray(e)?(e.forEach((a,n)=>{const o=we.validateCard(a);o.valid||t.push(`Card at index ${n}: ${o.errors.join(", ")}`)}),{valid:t.length===0,errors:t}):(t.push("Data is not an array"),{valid:!1,errors:t})}async performMigration(e,t){const a=[],n=[];let o=0;try{const i=we.bulkCardsToDbCards(e);return t&&t(.1,"Starting batch migration..."),await _.cards.bulkAdd(i),o=i.length,t&&t(1,"Batch migration completed"),{migratedCards:o,errors:a,warnings:n}}catch(i){console.warn("Bulk migration failed, trying individual migration:",i);const l=e.length;for(let m=0;m<e.length;m++){const c=e[m];try{const w=we.cardToDbCard(c);if(await _.cards.add(w),o++,t){const y=(m+1)/l;t(y,`Migrated card ${m+1}/${l}: ${c.frontContent.title}`)}}catch(w){console.error(`Failed to migrate card ${c.id}:`,w),a.push(c.id)}}return a.length===0||n.push(`Some cards failed to migrate: ${a.length} out of ${l}`),{migratedCards:o,errors:a,warnings:n}}}async verifyMigrationResults(e){const t=[];try{const a=await _.cards.count();if(a!==e&&t.push(`Record count mismatch: expected ${e}, got ${a}`),a>0){const n=await _.cards.limit(10).toArray();for(const o of n){const i=we.dbCardToCard(o),l=we.validateCard(i);l.valid||t.push(`Data integrity issue with card ${i.id}: ${l.errors.join(", ")}`)}}return{success:t.length===0,errors:t}}catch(a){return t.push(`Verification failed: ${a instanceof Error?a.message:String(a)}`),{success:!1,errors:t}}}cleanupLocalStorage(){try{W.remove("cards")}catch(e){console.warn("Failed to cleanup localStorage:",e)}}async rollback(){try{const e=this.getAvailableBackups();if(e.length===0)throw ie("NO_BACKUP","No backup available for rollback");const t=e[0];return await(await fa.create()).restoreData(t)?(this.setMigrationStatus({rolledBack:!0,rolledBackAt:new Date,backupId:t.id}),await _.cards.clear(),!0):!1}catch(e){throw ie("ROLLBACK_FAILED","Failed to rollback migration",{error:e instanceof Error?e.message:String(e)})}}getAvailableBackups(){const e=[];try{for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a&&a.startsWith(this.BACKUP_PREFIX))try{const n=W.get(a);n&&e.push({id:a,data:JSON.stringify(n),timestamp:new Date(n.timestamp),version:n.version||"1.0.0",cardCount:n.cards?.length||0,checksum:""})}catch(n){console.warn(`Failed to parse backup ${a}:`,n)}}}catch(t){console.error("Failed to get available backups:",t)}return e.sort((t,a)=>a.timestamp.getTime()-t.timestamp.getTime())}getMigrationStatus(){try{return W.get(this.MIGRATION_STATUS_KEY)}catch{return null}}setMigrationStatus(e){try{const t=this.getMigrationStatus()||{};W.set(this.MIGRATION_STATUS_KEY,{...t,...e})}catch(t){console.error("Failed to set migration status:",t)}}reportProgress(e,t){if(e)try{e(t)}catch(a){console.error("Progress callback error:",a)}}async getMigrationStats(){try{const e=this.getMigrationStatus(),t=this.getAvailableBackups();return{migrationNeeded:await this.needsMigration(),migrationCompleted:e?.completed||!1,migrationSuccessful:e?.success||!1,lastMigrationTime:e?.completedAt||null,availableBackups:t.length,localStorageCardCount:await this.getLocalStorageCardCount(),indexedDBCardCount:await _.cards.count()}}catch(e){throw ie("GET_STATS_FAILED","Failed to get migration stats",{error:e instanceof Error?e.message:String(e)})}}async getLocalStorageCardCount(){try{return we.loadFromLocalStorage().length}catch{return 0}}}_e.getInstance();async function wo(){const s=new Le;try{const e=await s.isIndexedDBAvailable();let t=!1,a=0;if(e&&(t=await s.hasIndexedDBData(),t))try{const i=await xa(()=>import("./sync-B1UcmV1r.js"),__vite__mapDeps([0,1,2])).then(l=>l.db);if(i&&i.isOpen()){a=await i.cards.count();const[l,u,m]=await Promise.all([i.folders.count().catch(()=>0),i.tags.count().catch(()=>0),i.images.count().catch(()=>0)]);a+=l+u+m,console.debug(`IndexedDB data count: ${a} (cards: ${await i.cards.count()}, folders: ${l}, tags: ${u}, images: ${m})`)}}catch(i){console.debug("Failed to get IndexedDB data count:",i)}let n=!1,o=0;try{const i=localStorage.getItem("cards");if(i){const u=JSON.parse(i);Array.isArray(u)&&u.length>0&&(n=!0,o=u.length,console.debug(`localStorage data count: ${o}`))}const l=["folders","tags","settings"];for(const u of l){const m=localStorage.getItem(u);if(m)try{const c=JSON.parse(m);Array.isArray(c)&&c.length>0&&(n=!0,o+=c.length)}catch(c){console.debug(`Failed to parse localStorage ${u}:`,c)}}}catch(i){console.debug("Failed to check localStorage data:",i)}if(!e)return console.debug("IndexedDB not available, using localStorage"),"localStorage";if(t&&!n)return console.debug("Only IndexedDB has data, using IndexedDB"),"indexeddb";if(!t&&n)return console.debug("Only localStorage has data, using localStorage"),"localStorage";if(t&&n)return a>o?(console.debug(`Both have data, IndexedDB has more (${a} > ${o}), using IndexedDB`),"indexeddb"):o>a?(console.debug(`Both have data, localStorage has more (${o} > ${a}), using localStorage`),"localStorage"):(console.debug("Both have equal data, preferring IndexedDB"),"indexeddb");try{const i=localStorage.getItem("preferredStorageMode");if(i==="indexeddb"&&e)return console.debug("User prefers IndexedDB, using IndexedDB"),"indexeddb";if(i==="localStorage")return console.debug("User prefers localStorage, using localStorage"),"localStorage"}catch(i){console.debug("Failed to get user preference:",i)}return e?(console.debug("Default: IndexedDB available, using IndexedDB"),"indexeddb"):(console.debug("Default: using localStorage"),"localStorage")}catch(e){return console.error("Error determining storage mode:",e),"localStorage"}}function xo(){const[s,e]=d.useState({mode:"localStorage",isReady:!1}),t=fo(),a=yo();d.useEffect(()=>{(async()=>{try{e(w=>({...w,mode:"migrating",isReady:!1}));const u=_e.getInstance();await u.needsMigration()&&await u.migrate({createBackup:!0,validateData:!0,cleanupAfterSuccess:!0,progressCallback:w=>{e(y=>({...y,migrationProgress:{stage:w.stage,progress:w.progress,message:w.message}}))}});const c=await wo();e({mode:c,isReady:!0})}catch(u){console.error("Failed to initialize adapter:",u),e({mode:"localStorage",isReady:!0})}})()},[]);const n=s.mode==="indexeddb"?a:t,o=d.useCallback(async()=>{e(l=>({...l,mode:"migrating",isReady:!1}));try{const u=await _e.getInstance().migrate({createBackup:!0,validateData:!0,cleanupAfterSuccess:!0,progressCallback:m=>{e(c=>({...c,migrationProgress:{stage:m.stage,progress:m.progress,message:m.message}}))}});e(u?{mode:"indexeddb",isReady:!0}:{mode:"localStorage",isReady:!0})}catch(l){console.error("Migration retry failed:",l),e({mode:"localStorage",isReady:!0})}},[]),i=d.useCallback(async()=>{try{await _e.getInstance().rollback()&&e({mode:"localStorage",isReady:!0})}catch(l){console.error("Rollback failed:",l)}},[]);return{...n,adapterState:s,storageMode:s.mode,isReady:s.isReady,migrationProgress:s.migrationProgress,retryMigration:o,rollbackMigration:i,isUsingLocalStorage:s.mode==="localStorage",isUsingIndexedDB:s.mode==="indexeddb",isMigrating:s.mode==="migrating"}}const aa=[{id:"folder-1",name:"Development",color:"#3b82f6",icon:"Code",cardIds:["1"],isExpanded:!0,createdAt:new Date("2024-01-10"),updatedAt:new Date("2024-01-15")},{id:"folder-2",name:"Design Resources",color:"#8b5cf6",icon:"Palette",cardIds:[],isExpanded:!1,createdAt:new Date("2024-01-12"),updatedAt:new Date("2024-01-12")},{id:"folder-3",name:"Learning Notes",color:"#10b981",icon:"BookOpen",cardIds:["2"],parentId:"folder-1",isExpanded:!0,createdAt:new Date("2024-01-14"),updatedAt:new Date("2024-01-16")}];function bo(){const[s,e]=d.useState(()=>{try{return W.get("folders_state_backup",{validate:!0,encrypt:!0})||[]}catch{return[]}}),[t,a]=d.useState(!1),[n,o]=d.useState(null),[i,l]=d.useState(!0),u=d.useCallback(()=>{const h=s.filter(p=>!p.parentId),f=p=>p.map(x=>{const C=f(s.filter(N=>N.parentId===x.id)),D=C.length>0,j=x.isExpanded!==void 0?x.isExpanded:!!D;return{...x,isExpanded:j,children:C}});return f(h)},[s]),m=d.useCallback(h=>{console.log("🎯 Folder Action dispatched:",h.type,h.payload),e(f=>{try{switch(h.type){case"CREATE_FOLDER":console.log("➕ Creating new folder...");const p={...h.payload,id:`folder-${Date.now()}`,cardIds:[],createdAt:new Date,updatedAt:new Date};return console.log("✅ New folder created:",p.id,p.name),[...f,p];case"UPDATE_FOLDER":console.log("📝 Updating folder:",h.payload.id);const x=f.map(j=>j.id===h.payload.id?{...j,...h.payload.updates,updatedAt:new Date}:j);return console.log("✅ Folder updated:",h.payload.id),x;case"DELETE_FOLDER":if(console.log("🗑️ Deleting folder:",h.payload),f.find(j=>j.id===h.payload)){const j=Q=>{const L=f.filter(J=>J.parentId===Q),ne=L.map(J=>J.id),te=L.flatMap(J=>j(J.id));return[...ne,...te]},N=j(h.payload),P=[h.payload,...N],$=f.filter(Q=>P.includes(Q.id)).flatMap(Q=>Q.cardIds);console.log("📋 Folders to delete:",P.length),console.log("📋 Cards to delete:",$.length),"onDeleteCards"in h&&h.onDeleteCards&&$.length>0&&(console.log("🔄 Triggering card deletion callback..."),h.onDeleteCards($));const Z=f.filter(Q=>!P.includes(Q.id));return console.log("✅ Folder deleted successfully. Remaining folders:",Z.length),Z}return console.warn("⚠️ Folder to delete not found:",h.payload),f.filter(j=>j.id!==h.payload);case"TOGGLE_FOLDER":console.log("🔄 Toggling folder expansion:",h.payload);const D=f.map(j=>j.id===h.payload?{...j,isExpanded:j.isExpanded!==void 0?!j.isExpanded:!0,updatedAt:new Date,syncVersion:(j.syncVersion||1)+1,pendingSync:!0}:j);return console.log("✅ Folder toggled:",h.payload),D;default:return console.warn("⚠️ Unknown folder action:",h.type),f}}catch(p){return console.error("❌ Error in folder dispatch:",p),f}})},[]),c=d.useCallback(h=>s.find(f=>f.id===h),[s]),w=d.useCallback(h=>{const f=[];let p=c(h);for(;p;)f.unshift(p),p=p.parentId?c(p.parentId):null;return f},[s,c]),y=d.useCallback((h,f)=>{m({type:"UPDATE_FOLDER",payload:{id:f,updates:{cardIds:[...c(f)?.cardIds||[],h]}}})},[m,c]),g=d.useCallback((h,f)=>{const p=c(f);p&&m({type:"UPDATE_FOLDER",payload:{id:f,updates:{cardIds:p.cardIds.filter(x=>x!==h)}}})},[m,c]),S=d.useCallback((h,f,p)=>{f&&g(h,f),p&&y(h,p)},[y,g]),E=d.useCallback((h,f)=>{if(h===f)return!1;let p=f;for(;p;){if(p===h)return!1;p=c(p)?.parentId??null}return!0},[c]),R=d.useCallback(async()=>{try{if(s.length===0)return console.log("📋 没有文件夹数据，跳过一致性检查"),l(!0),!0;console.log("🔍 开始检查文件夹数据一致性...");const h=await _.folders.toArray(),f=new Set(h.map(N=>N.id)),p=new Set(s.map(N=>N.id));console.log("📊 数据统计:"),console.log("  - 内存中文件夹:",s.length),console.log("  - IndexedDB中文件夹:",h.length);let x=!0;s.length>0&&h.length===0&&console.warn("⚠️ 内存中有数据但IndexedDB为空，可能正在同步中");const C=s.filter(N=>!f.has(N.id)),D=h.filter(N=>!p.has(N.id));if(C.length>0&&(console.warn("❌ 发现IndexedDB中缺失的文件夹:",C.map(N=>N.id)),x=!1),D.length>0&&D.length>3&&(console.warn("⚠️ 发现IndexedDB中多余的文件夹:",D.map(N=>N.id)),x=!1),s.length>0){const N=s.filter(P=>!P.syncVersion||P.pendingSync===void 0);if(N.length>0){console.warn("⚠️ 发现缺少同步字段的文件夹:",N.map($=>$.id));const P=s.map($=>({...$,syncVersion:$.syncVersion||1,pendingSync:$.pendingSync||!1,userId:$.userId||"default"}));JSON.stringify(P)!==JSON.stringify(s)&&(e(P),console.log("✅ 自动修复同步字段完成"))}}if(W.get("folder_data_needs_restore",{validate:!0})&&s.length===0){console.log("🔄 发现需要恢复的文件夹数据，且当前无数据");const N=W.get("folders_backup",{validate:!0,encrypt:!0});if(N&&N.length>0){console.log("💾 从备份恢复文件夹数据:",N.length),e(N),W.remove("folder_data_needs_restore"),W.remove("folders_backup");try{await _.folders.clear(),await _.folders.bulkAdd(N),console.log("✅ 恢复的文件夹数据已保存到IndexedDB"),x=!0}catch(P){console.error("❌ 恢复数据保存失败:",P)}}}return l(x),console.log("🎯 文件夹数据一致性检查完成:",x?"✅ 一致":"❌ 不一致"),x}catch(h){return console.error("❌ 数据一致性检查失败:",h),l(!1),!1}},[s]),v=d.useCallback(async()=>{try{return console.log("开始强制修复文件夹数据..."),W.set("folders_repair_backup",s,{validate:!0,encrypt:!0}),await _.folders.clear(),await _.folders.bulkAdd(s),W.remove("folder_data_needs_restore"),W.remove("folders_backup"),W.set("folder_migration_complete",!0,{validate:!0}),console.log("文件夹数据强制修复完成"),l(!0),!0}catch(h){return console.error("强制修复文件夹数据失败:",h),!1}},[s]);return d.useEffect(()=>{(async()=>{if(t){console.log("📁 文件夹数据已初始化，跳过加载");return}try{console.log("🔄 开始加载文件夹数据...");let f=[];if(s.length>0)console.log("📋 使用内存中的文件夹数据:",s.length),f=s;else try{const p=await _.folders.toArray();if(console.log("📊 从 IndexedDB 查找到文件夹:",p.length),p.length>0)f=p.map(x=>{const D=p.filter(j=>j.parentId===x.id).length>0;return{...x,cardIds:x.cardIds||[],syncVersion:x.syncVersion||1,pendingSync:x.pendingSync||!1,userId:x.userId||"default",isExpanded:x.isExpanded!==void 0?x.isExpanded:!!D}}),console.log("✅ 使用 IndexedDB 中的文件夹数据"),e(f);else{if(W.get("folder_migration_complete",{validate:!0})){console.log("🔄 迁移已完成但无数据，可能数据被清空，保持空状态"),a(!0);return}console.log("🎯 首次使用，初始化默认文件夹数据"),f=aa.map(C=>({...C,syncVersion:1,pendingSync:!1,userId:"default",isExpanded:C.isExpanded!==void 0?C.isExpanded:!0})),await _.folders.clear(),await _.folders.bulkAdd(f),W.set("folder_migration_complete",!0,{validate:!0}),console.log("✅ 默认文件夹数据已保存到 IndexedDB"),e(f)}}catch(p){console.error("❌ 从 IndexedDB 加载失败:",p);try{const x=W.get("folders_state_backup",{validate:!0,encrypt:!0});x&&x.length>0?(console.log("💾 从localStorage备份恢复文件夹数据:",x.length),f=x.map(C=>({...C,isExpanded:C.isExpanded!==void 0?C.isExpanded:!0})),e(f)):(f=aa.map(C=>({...C,syncVersion:1,pendingSync:!1,userId:"default",isExpanded:C.isExpanded!==void 0?C.isExpanded:!0})),console.log("🚨 使用默认文件夹数据作为应急方案"),e(f))}catch(x){console.error("❌ 从备份恢复失败:",x),f=aa.map(C=>({...C,syncVersion:1,pendingSync:!1,userId:"default",isExpanded:C.isExpanded!==void 0?C.isExpanded:!0})),e(f)}}a(!0),console.log("🎉 文件夹数据加载完成，共",f.length,"个文件夹"),setTimeout(async()=>{try{await R()||(console.warn("⚠️ 数据一致性检查失败，尝试修复..."),await v()),console.log("📁 文件夹数据加载完成，解耦同步服务将自动处理云端同步")}catch(p){console.error("❌ 后台数据处理失败:",p)}},1e3)}catch(f){console.error("❌ 加载文件夹数据失败:",f),a(!0)}})()},[t]),d.useEffect(()=>{if(!t){console.log("⏳ 数据初始化未完成，跳过保存操作");return}if(s.length===0){console.log("📋 没有文件夹数据，跳过保存操作");return}const f=setTimeout(async()=>{try{console.log("💾 开始保存文件夹数据到IndexedDB...");const p=await _.folders.toArray(),x=new Set(p.map(j=>j.id)),C=new Set(s.map(j=>j.id));if(p.length>0&&s.length===0){console.warn("⚠️ 检测到数据可能被清空，跳过保存以避免覆盖");return}const D=s.map(j=>{const P=s.filter($=>$.parentId===j.id).length>0;return{...j,syncVersion:j.syncVersion||1,pendingSync:j.pendingSync||!1,userId:j.userId||"default",isExpanded:j.isExpanded!==void 0?j.isExpanded:!!P,updatedAt:new Date}});await _.transaction("rw",_.folders,async()=>{if(C.size>0){const P=p.filter($=>!C.has($.id));P.length>0&&(await _.folders.bulkDelete(P.map($=>$.id)),console.log("🗑️ 删除已不存在的文件夹:",P.length))}const j=D.filter(P=>x.has(P.id));for(const P of j)await _.folders.update(P.id,P);console.log("📝 更新现有文件夹:",j.length);const N=D.filter(P=>!x.has(P.id));N.length>0&&(await _.folders.bulkAdd(N),console.log("➕ 添加新文件夹:",N.length))});try{W.set("folders_state_backup",s,{validate:!0,encrypt:!0}),console.log("💾 文件夹状态已备份到localStorage")}catch(j){console.warn("⚠️ 备份到localStorage失败:",j)}console.log("✅ 文件夹数据保存成功，共",D.length,"个文件夹"),setTimeout(async()=>{try{const j=await _.folders.toArray();console.log("🔍 验证保存结果: IndexedDB中现有",j.length,"个文件夹"),j.length!==D.length&&console.warn("⚠️ 保存的数据数量不匹配"),await R()||console.warn("⚠️ 保存后数据一致性检查失败")}catch(j){console.error("❌ 验证保存结果失败:",j)}},500)}catch(p){console.error("❌ 保存文件夹数据到IndexedDB失败:",p),console.warn("🔄 尝试重新保存文件夹数据...");try{const x=s.map(D=>{const N=s.filter(P=>P.parentId===D.id).length>0;return{...D,syncVersion:D.syncVersion||1,pendingSync:D.pendingSync||!1,userId:D.userId||"default",isExpanded:D.isExpanded!==void 0?D.isExpanded:!!N,updatedAt:new Date}});if((await _.folders.toArray()).length>0&&s.length>0){for(const D of x)await _.folders.put(D);console.log("✅ 文件夹数据更新保存成功")}else await _.folders.clear(),await _.folders.bulkAdd(x),console.log("✅ 文件夹数据重新保存成功")}catch(x){console.error("❌ 重新保存文件夹数据失败:",x),console.warn("💾 将文件夹数据临时保存到localStorage"),W.set("folders_backup",s,{validate:!0,encrypt:!0}),W.set("folder_data_needs_restore",!0,{validate:!0}),console.error("🚨 文件夹数据保存失败，已创建备份")}}},500);return()=>clearTimeout(f)},[s.length,t,s]),d.useEffect(()=>{const h=setInterval(async()=>{i&&await R()},3e4);return()=>clearInterval(h)},[i,R]),{folders:s,folderTree:u(),selectedFolderId:n,setSelectedFolderId:o,dispatch:m,getFolderById:c,getFolderPath:w,addCardToFolder:y,removeCardFromFolder:g,moveCardBetweenFolders:S,canMoveFolder:E,isConsistent:i,checkDataConsistency:R,forceDataRepair:v}}const vo=[{id:"tag-1",name:"react",color:"#3b82f6",count:1,createdAt:new Date("2024-01-15")},{id:"tag-2",name:"frontend",color:"#8b5cf6",count:1,createdAt:new Date("2024-01-15")},{id:"tag-3",name:"best-practices",color:"#10b981",count:1,createdAt:new Date("2024-01-15")},{id:"tag-4",name:"typescript",color:"#f59e0b",count:1,createdAt:new Date("2024-01-16")},{id:"tag-5",name:"types",color:"#ef4444",count:1,createdAt:new Date("2024-01-16")},{id:"tag-6",name:"development",color:"#06b6d4",count:1,createdAt:new Date("2024-01-16")}],Je=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#8b5a2b","#6b7280","#ec4899","#84cc16","#f97316","#6366f1"];function Co(){const[s,e]=d.useState(vo),[t,a]=d.useState([]),n=d.useCallback(()=>s.filter(v=>!t.includes(v.id)),[s,t]),o=d.useCallback(v=>{const h=[...n()].sort((f,p)=>p.count-f.count);return v?h.slice(0,v):h},[n]),i=d.useCallback(v=>{e(h=>{switch(v.type){case"CREATE_TAG":const f=h.find(x=>x.name.toLowerCase()===v.payload.name.toLowerCase());if(f)return h.map(x=>x.id===f.id?{...x,count:x.count+1}:x);const p={...v.payload,id:`tag-${Date.now()}`,count:1,color:v.payload.color||Je[h.length%Je.length],createdAt:new Date};return[...h,p];case"UPDATE_TAG":return h.map(x=>x.id===v.payload.id?{...x,...v.payload.updates}:x);case"DELETE_TAG":return h.filter(x=>x.id!==v.payload);case"TOGGLE_TAG_VISIBILITY":return a(x=>x.includes(v.payload)?x.filter(C=>C!==v.payload):[...x,v.payload]),h;default:return h}})},[]),l=d.useCallback(v=>s.find(h=>h.id===v),[s]),u=d.useCallback(v=>s.find(h=>h.name.toLowerCase()===v.toLowerCase()),[s]),m=d.useCallback((v,h)=>{const f=u(v);return f||(i({type:"CREATE_TAG",payload:{name:v,color:h||Je[s.length%Je.length]}}),null)},[i,u,s.length]),c=d.useCallback((v,h)=>{const f=u(v);if(f){const p=Math.max(0,f.count+h);i(p===0?{type:"DELETE_TAG",payload:f.id}:{type:"UPDATE_TAG",payload:{id:f.id,updates:{count:p}}})}},[i,u]),w=d.useCallback(v=>{const h=v.reduce((C,D)=>(C[D]=(C[D]||0)+1,C),{}),f=s.map(C=>({...C,count:h[C.name]||0})),p=new Set(s.map(C=>C.name));Object.entries(h).forEach(([C,D])=>{if(!p.has(C)){const j={id:`tag-${Date.now()}-${Math.random()}`,name:C,color:Je[f.length%Je.length],count:D,createdAt:new Date};f.push(j)}});const x=f.filter(C=>C.count>0);e(x)},[s]),y=d.useCallback(v=>{if(!v.trim())return n();const h=v.toLowerCase();return n().filter(f=>f.name.toLowerCase().includes(h))},[n]),g=d.useCallback((v,h=5)=>v.trim()?y(v).slice(0,h):o(h),[y,o]),S=d.useCallback((v,h)=>{const f=u(v);if(!f)return!1;const p=u(h);return p&&p.id!==f.id?!1:(i({type:"UPDATE_TAG",payload:{id:f.id,updates:{name:h.trim()}}}),!0)},[i,u]),E=d.useCallback(v=>{const h=u(v);return h?(i({type:"DELETE_TAG",payload:h.id}),!0):!1},[i,u]),R=d.useCallback(()=>s.map(v=>v.name),[s]);return d.useEffect(()=>{const v=setTimeout(()=>{W.set("tags",s,{validate:!0,encrypt:!0}),W.set("hidden-tags",t,{validate:!0,encrypt:!0})},1e3);return()=>clearTimeout(v)},[s,t]),d.useEffect(()=>{const v=W.get("tags",{validate:!0,encrypt:!0});v&&e(v);const h=W.get("hidden-tags",{validate:!0,encrypt:!0});h&&a(h)},[]),{tags:n(),allTags:s,hiddenTags:t,popularTags:o,dispatch:i,getTagById:l,getTagByName:u,createTagIfNotExists:m,updateTagCount:c,syncTagsWithCards:w,searchTags:y,getTagSuggestions:g,renameTag:S,deleteTagByName:E,getAllTagNames:R}}const ha={enableDebugMode:!1,defaultStorageMode:"indexeddb",version:"1.0.0",appName:"CardAll"},qs=d.createContext(null);function So({children:s}){const e=xo(),t=bo(),a=Co(),n=O.useMemo(()=>{if(!e.isReady||e.isMigrating)return[];const i=[];return e.allCards.forEach(l=>{i.push(...l.frontContent.tags,...l.backContent.tags)}),i},[e.allCards,e.isReady,e.isMigrating]);O.useEffect(()=>{n.length>0&&a.syncTagsWithCards(n)},[n,a.syncTagsWithCards]);const o={cards:e,folders:t,tags:a,appConfig:ha};return r.jsx(qs.Provider,{value:o,children:s})}function Sa(){const s=d.useContext(qs);if(!s)throw new Error("useCardAll must be used within a CardAllProvider");return s}function jo(){return Sa().cards}function Js(){return Sa().folders}function Xs(){return Sa().tags}function M(...s){return bn(vn(s))}const ja=zt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),G=d.forwardRef(({className:s,variant:e,size:t,asChild:a=!1,...n},o)=>{const i=a?Ur:"button";return r.jsx(i,{className:M(ja({variant:e,size:t,className:s})),ref:o,...n})});G.displayName="Button";const Eo=Vr,ko=Hr,No=d.forwardRef(({className:s,inset:e,children:t,...a},n)=>r.jsxs(Qa,{ref:n,className:M("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",s),...a,children:[t,r.jsx(ba,{className:"ml-auto"})]}));No.displayName=Qa.displayName;const Do=d.forwardRef(({className:s,...e},t)=>r.jsx(Za,{ref:t,className:M("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...e}));Do.displayName=Za.displayName;const Qs=d.forwardRef(({className:s,sideOffset:e=4,...t},a)=>r.jsx(Wr,{children:r.jsx(es,{ref:a,sideOffset:e,className:M("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}));Qs.displayName=es.displayName;const Ie=d.forwardRef(({className:s,inset:e,...t},a)=>r.jsx(ts,{ref:a,className:M("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",s),...t}));Ie.displayName=ts.displayName;const Ro=d.forwardRef(({className:s,children:e,checked:t,...a},n)=>r.jsxs(as,{ref:n,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...a,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(ss,{children:r.jsx(Be,{className:"h-4 w-4"})})}),e]}));Ro.displayName=as.displayName;const To=d.forwardRef(({className:s,children:e,...t},a)=>r.jsxs(rs,{ref:a,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(ss,{children:r.jsx(Bs,{className:"h-2 w-2 fill-current"})})}),e]}));To.displayName=rs.displayName;const Ao=d.forwardRef(({className:s,inset:e,...t},a)=>r.jsx(ns,{ref:a,className:M("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",s),...t}));Ao.displayName=ns.displayName;const pa=d.forwardRef(({className:s,...e},t)=>r.jsx(os,{ref:t,className:M("-mx-1 my-1 h-px bg-muted",s),...e}));pa.displayName=os.displayName;const sa=[{emoji:"😀",name:"grinning"},{emoji:"😃",name:"smiley"},{emoji:"😄",name:"smile"},{emoji:"😁",name:"grin"},{emoji:"😆",name:"laughing"},{emoji:"😅",name:"sweat_smile"},{emoji:"🤣",name:"rofl"},{emoji:"😂",name:"joy"},{emoji:"🙂",name:"slightly_smiling_face"},{emoji:"🙃",name:"upside_down_face"},{emoji:"😉",name:"wink"},{emoji:"😊",name:"blush"},{emoji:"😇",name:"innocent"},{emoji:"🥰",name:"smiling_face_with_hearts"},{emoji:"😍",name:"heart_eyes"},{emoji:"🤩",name:"star_struck"},{emoji:"😘",name:"kissing_heart"},{emoji:"😗",name:"kissing"},{emoji:"😚",name:"kissing_closed_eyes"},{emoji:"😙",name:"kissing_smiling_eyes"},{emoji:"🥲",name:"smiling_face_with_tear"},{emoji:"😋",name:"yum"},{emoji:"😛",name:"stuck_out_tongue"},{emoji:"😜",name:"stuck_out_tongue_winking_eye"},{emoji:"🤪",name:"zany_face"},{emoji:"😝",name:"stuck_out_tongue_closed_eyes"},{emoji:"🤑",name:"money_mouth_face"},{emoji:"🤗",name:"hugs"},{emoji:"🤭",name:"hand_over_mouth"},{emoji:"🤫",name:"shushing_face"},{emoji:"🤔",name:"thinking"},{emoji:"🤐",name:"zipper_mouth_face"},{emoji:"🤨",name:"raised_eyebrow"},{emoji:"😐",name:"neutral_face"},{emoji:"😑",name:"expressionless"},{emoji:"😶",name:"no_mouth"},{emoji:"😏",name:"smirk"},{emoji:"😒",name:"unamused"},{emoji:"🙄",name:"roll_eyes"},{emoji:"😬",name:"grimacing"},{emoji:"🤥",name:"lying_face"},{emoji:"😔",name:"pensive"},{emoji:"😪",name:"sleepy"},{emoji:"🤤",name:"drooling_face"},{emoji:"😴",name:"sleeping"},{emoji:"😷",name:"mask"},{emoji:"🤒",name:"face_with_thermometer"},{emoji:"🤕",name:"face_with_head_bandage"},{emoji:"🤢",name:"nauseated_face"},{emoji:"🤮",name:"vomiting_face"},{emoji:"🤧",name:"sneezing_face"},{emoji:"🥵",name:"hot_face"},{emoji:"🥶",name:"cold_face"},{emoji:"🥴",name:"woozy_face"},{emoji:"😵",name:"dizzy_face"},{emoji:"🤯",name:"exploding_head"},{emoji:"🤠",name:"cowboy_hat_face"},{emoji:"🥳",name:"partying_face"},{emoji:"🥸",name:"disguised_face"},{emoji:"😎",name:"sunglasses"},{emoji:"🤓",name:"nerd_face"},{emoji:"🧐",name:"monocle_face"},{emoji:"😕",name:"confused"},{emoji:"😟",name:"worried"},{emoji:"🙁",name:"slightly_frowning_face"},{emoji:"☹️",name:"frowning_face"},{emoji:"😮",name:"open_mouth"},{emoji:"😯",name:"hushed"},{emoji:"😲",name:"astonished"},{emoji:"😳",name:"flushed"},{emoji:"🥺",name:"pleading_face"},{emoji:"😦",name:"frowning"},{emoji:"😧",name:"anguished"},{emoji:"😨",name:"fearful"},{emoji:"😰",name:"cold_sweat"},{emoji:"😥",name:"disappointed_relieved"},{emoji:"😢",name:"cry"},{emoji:"😭",name:"sob"},{emoji:"😱",name:"scream"},{emoji:"😖",name:"confounded"},{emoji:"😣",name:"persevere"},{emoji:"😞",name:"disappointed"},{emoji:"😓",name:"sweat"},{emoji:"😩",name:"weary"},{emoji:"😫",name:"tired_face"},{emoji:"🥱",name:"yawning_face"},{emoji:"😤",name:"triumph"},{emoji:"😡",name:"rage"},{emoji:"😠",name:"angry"},{emoji:"🤬",name:"cursing_face"},{emoji:"😈",name:"smiling_imp"},{emoji:"👿",name:"imp"},{emoji:"💀",name:"skull"},{emoji:"☠️",name:"skull_and_crossbones"},{emoji:"💩",name:"poop"},{emoji:"🤡",name:"clown_face"},{emoji:"👹",name:"ogre"},{emoji:"👺",name:"goblin"},{emoji:"👻",name:"ghost"},{emoji:"👽",name:"alien"},{emoji:"👾",name:"space_invader"},{emoji:"🤖",name:"robot"},{emoji:"😺",name:"smiley_cat"},{emoji:"😸",name:"smile_cat"},{emoji:"😹",name:"joy_cat"},{emoji:"😻",name:"heart_eyes_cat"},{emoji:"😼",name:"smirk_cat"},{emoji:"😽",name:"kissing_cat"},{emoji:"🙀",name:"scream_cat"},{emoji:"😿",name:"crying_cat_face"},{emoji:"😾",name:"pouting_cat"},{emoji:"👋",name:"wave"},{emoji:"🤚",name:"raised_back_of_hand"},{emoji:"🖐️",name:"raised_hand_with_fingers_splayed"},{emoji:"✋",name:"hand"},{emoji:"🖖",name:"vulcan_salute"},{emoji:"👌",name:"ok_hand"},{emoji:"🤌",name:"pinched_fingers"},{emoji:"🤏",name:"pinching_hand"},{emoji:"✌️",name:"v"},{emoji:"🤞",name:"crossed_fingers"},{emoji:"🤟",name:"love_you_gesture"},{emoji:"🤘",name:"metal"},{emoji:"🤙",name:"call_me_hand"},{emoji:"👈",name:"point_left"},{emoji:"👉",name:"point_right"},{emoji:"👆",name:"point_up_2"},{emoji:"🖕",name:"middle_finger"},{emoji:"👇",name:"point_down"},{emoji:"☝️",name:"point_up"},{emoji:"👍",name:"thumbsup"},{emoji:"👎",name:"thumbsdown"},{emoji:"✊",name:"fist"},{emoji:"👊",name:"facepunch"},{emoji:"🤛",name:"fist_left"},{emoji:"🤜",name:"fist_right"},{emoji:"👏",name:"clap"},{emoji:"🙌",name:"raised_hands"},{emoji:"👐",name:"open_hands"},{emoji:"🤲",name:"palms_up_together"},{emoji:"🤝",name:"handshake"},{emoji:"🙏",name:"pray"},{emoji:"❤️",name:"heart"},{emoji:"🧡",name:"orange_heart"},{emoji:"💛",name:"yellow_heart"},{emoji:"💚",name:"green_heart"},{emoji:"💙",name:"blue_heart"},{emoji:"💜",name:"purple_heart"},{emoji:"🖤",name:"black_heart"},{emoji:"🤍",name:"white_heart"},{emoji:"🤎",name:"brown_heart"},{emoji:"💔",name:"broken_heart"},{emoji:"❣️",name:"heavy_heart_exclamation"},{emoji:"💕",name:"two_hearts"},{emoji:"💞",name:"revolving_hearts"},{emoji:"💓",name:"heartbeat"},{emoji:"💗",name:"heartpulse"},{emoji:"💖",name:"sparkling_heart"},{emoji:"💘",name:"cupid"},{emoji:"💝",name:"gift_heart"},{emoji:"💟",name:"heart_decoration"},{emoji:"☮️",name:"peace_symbol"},{emoji:"✝️",name:"latin_cross"},{emoji:"☪️",name:"star_and_crescent"},{emoji:"🕉️",name:"om"},{emoji:"☸️",name:"wheel_of_dharma"},{emoji:"✡️",name:"star_of_david"},{emoji:"🔯",name:"six_pointed_star"},{emoji:"🕎",name:"menorah"},{emoji:"☯️",name:"yin_yang"},{emoji:"☦️",name:"orthodox_cross"},{emoji:"🛐",name:"place_of_worship"},{emoji:"⛎",name:"ophiuchus"},{emoji:"♈",name:"aries"},{emoji:"♉",name:"taurus"},{emoji:"♊",name:"gemini"},{emoji:"♋",name:"cancer"},{emoji:"♌",name:"leo"},{emoji:"♍",name:"virgo"},{emoji:"♎",name:"libra"},{emoji:"♏",name:"scorpius"},{emoji:"♐",name:"sagittarius"},{emoji:"♑",name:"capricorn"},{emoji:"♒",name:"aquarius"},{emoji:"♓",name:"pisces"},{emoji:"🆔",name:"id"},{emoji:"⚡",name:"zap"},{emoji:"💥",name:"boom"},{emoji:"💫",name:"dizzy"},{emoji:"💦",name:"sweat_drops"},{emoji:"💨",name:"dash"},{emoji:"🕳️",name:"hole"},{emoji:"💣",name:"bomb"},{emoji:"💬",name:"speech_balloon"},{emoji:"👁️‍🗨️",name:"eye_speech_bubble"},{emoji:"🗨️",name:"left_speech_bubble"},{emoji:"🗯️",name:"right_anger_bubble"},{emoji:"💭",name:"thought_balloon"},{emoji:"💤",name:"zzz"}];function Io({onEmojiSelect:s,onClose:e,query:t="",position:a}){const[n,o]=d.useState(sa);d.useEffect(()=>{if(t&&t.trim()){const c=t.toLowerCase().trim(),w=sa.filter(y=>y.name.toLowerCase().includes(c)||y.emoji.includes(t)||y.name.toLowerCase().startsWith(c));o(w.slice(0,20))}else o(sa.slice(0,40))},[t]);const i=c=>{s(c),e()},l=c=>{c.key==="Escape"&&e()},u=()=>{if(!a)return{};const c=window.innerWidth,w=window.innerHeight,y=320,g=240;let S=a.x,E=a.y;return S+y>c&&(S=c-y-20),E+g>w&&(E=a.y-g-10),{left:Math.max(10,S),top:Math.max(10,E)}},m=r.jsxs("div",{className:"fixed bg-white border border-border rounded-lg shadow-xl p-3 w-80",style:{...u(),zIndex:2147483647},onKeyDown:l,children:[t&&r.jsxs("div",{className:"text-xs text-blue-600 mb-2 font-medium",children:['"',t,'"']}),r.jsx("div",{className:"grid grid-cols-10 gap-1 max-h-52 overflow-y-auto",children:n.map((c,w)=>r.jsx(G,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50 text-lg transition-colors",onClick:()=>i(c.emoji),title:c.name,children:c.emoji},`${c.emoji}-${w}`))}),n.length===0&&t&&r.jsx("div",{className:"text-center text-muted-foreground text-sm py-6",children:"No emojis found"})]});return Bt.createPortal(m,document.body)}function _o({content:s,placeholder:e="Start typing...",onUpdate:t,onSave:a,onCancel:n,className:o,autoFocus:i=!1}){const[l,u]=d.useState(!1),[m,c]=d.useState(""),[w,y]=d.useState(null),g=d.useRef(null),S=Kn({extensions:[Yn.configure({strike:!1,code:!1,blockquote:!1}),qn.configure({html:!0,transformPastedText:!0,transformCopiedText:!1}),Jn,Xn.configure({nested:!0}),Qn.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 underline hover:text-blue-800 cursor-pointer",target:"_blank",rel:"noopener noreferrer"},protocols:["http","https","ftp","mailto"],validate:h=>/^https?:\/\//.test(h)}),Zn.configure({HTMLAttributes:{class:"border-l-4 border-gray-300 pl-4 italic"}}),eo.configure({HTMLAttributes:{class:"inline-code"}}),to.configure({HTMLAttributes:{class:"code-block"}}),ao.configure({HTMLAttributes:{class:"line-through"}}),so.configure({inline:!0,allowBase64:!0,HTMLAttributes:{class:"rounded-md max-w-full h-auto"}}),ro.configure({placeholder:e})],content:s,onUpdate:({editor:h})=>{t(h.getHTML())},editorProps:{attributes:{class:"tiptap-editor text-sm leading-relaxed focus:outline-none min-h-[100px] w-full"},handleKeyDown:(h,f)=>{if(f.key==="/"&&!l){const{selection:p}=h.state,{from:x}=p,C=h.state.doc.resolve(x),D=C.parent.textBetween(0,C.parentOffset);if(!D.trim()||D.endsWith(" ")){const N=h.coordsAtPos(x);return y({x:N.left,y:N.bottom+5}),u(!0),c(""),f.preventDefault(),!0}}if(l){if(f.key==="Escape")return u(!1),c(""),!0;if(f.key==="Backspace")return m.length>0?c(p=>p.slice(0,-1)):u(!1),!0;if(f.key.length===1&&!f.ctrlKey&&!f.metaKey&&f.key!==" ")return c(p=>p+f.key),!0;if(f.key===" ")return u(!1),c(""),!0}return!1}}}),E=d.useCallback(()=>{const h=document.createElement("input");h.type="file",h.accept="image/*",h.onchange=f=>{const p=f.target.files?.[0];if(p&&S){const x=new FileReader;x.onload=C=>{const D=C.target?.result;S.chain().focus().setImage({src:D}).run()},x.readAsDataURL(p)}},h.click()},[S]);d.useEffect(()=>{if(!S)return;const h=p=>{const x=p.clipboardData?.items;if(x)for(let C=0;C<x.length;C++){const D=x[C];if(D.type.indexOf("image")!==-1){p.preventDefault();const j=D.getAsFile();if(j){const N=new FileReader;N.onload=P=>{const $=P.target?.result;S.chain().focus().setImage({src:$}).run()},N.readAsDataURL(j)}}}},f=S.view.dom;return f.addEventListener("paste",h),()=>{f.removeEventListener("paste",h)}},[S]);const R=d.useCallback(h=>{S&&S.chain().focus().insertContent(h).run(),u(!1),c("")},[S]),v=d.useCallback(()=>{u(!1),c("")},[]);return d.useEffect(()=>{if(!S)return;const h=p=>{p.key==="Escape"?l?(u(!1),c("")):n():p.key==="Enter"&&(p.ctrlKey||p.metaKey)&&a()},f=S.view.dom;return f.addEventListener("keydown",h),()=>{f.removeEventListener("keydown",h)}},[S,a,n,l]),d.useEffect(()=>{S&&i&&S.commands.focus()},[S,i]),S?r.jsxs("div",{className:M("relative z-20",o),ref:g,children:[r.jsxs("div",{className:"relative p-2 -m-2",children:[r.jsx(no,{editor:S,className:"min-h-[100px]"}),r.jsxs("div",{className:"absolute top-0 right-0 flex gap-1 opacity-60 hover:opacity-100 transition-opacity",children:[r.jsx(G,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 bg-white/90 hover:bg-white shadow-sm rounded",onClick:()=>u(!l),title:"Insert Emoji (Press / to open)",children:r.jsx(Cn,{className:"h-3 w-3"})}),r.jsx(G,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 bg-white/90 hover:bg-white shadow-sm rounded",onClick:E,title:"Insert Image",children:r.jsx(zs,{className:"h-3 w-3"})})]})]}),l&&r.jsx(Io,{onEmojiSelect:R,onClose:v,query:m,position:w||void 0}),r.jsxs("div",{className:"flex justify-end gap-2 mt-2 pt-2 border-t border-border/30",children:[r.jsxs(G,{size:"sm",variant:"ghost",onClick:n,className:"h-7 px-3 text-xs",children:[r.jsx(Ye,{className:"h-3 w-3 mr-1"}),"Cancel"]}),r.jsxs(G,{size:"sm",onClick:a,className:"h-7 px-3 text-xs",children:[r.jsx(Be,{className:"h-3 w-3 mr-1"}),"Accept"]})]}),S&&r.jsxs("div",{className:"absolute top-0 right-0 text-xs text-muted-foreground bg-white/90 px-2 py-1 rounded shadow-sm opacity-0 hover:opacity-100 transition-opacity pointer-events-none z-10 max-w-xs",children:["**bold** *italic* # heading - list ",">"," quote `code` ~~strike~~ [link](url) [] task / emoji"]})]}):null}function Mo({content:s,onUpdate:e,onSave:t,onCancel:a,className:n,autoFocus:o=!1}){const[i,l]=d.useState(s),u=d.useRef(null);d.useEffect(()=>{l(s)},[s]),d.useEffect(()=>{o&&u.current&&(u.current.focus(),u.current.select())},[o]);const m=w=>{l(w.target.value),e(w.target.value)},c=w=>{w.key==="Enter"?t():w.key==="Escape"&&a()};return r.jsxs("div",{className:M("relative",n),children:[r.jsx("input",{ref:u,type:"text",value:i,onChange:m,onKeyDown:c,className:"w-full bg-transparent border-none outline-none text-lg font-semibold resize-none pr-16",placeholder:"Card title..."}),r.jsxs("div",{className:"absolute right-0 top-0 flex gap-1",children:[r.jsx(G,{size:"sm",variant:"ghost",onClick:a,className:"h-6 w-6 p-0 bg-white/80 hover:bg-white shadow-sm",children:r.jsx(Ye,{className:"h-3 w-3"})}),r.jsx(G,{size:"sm",onClick:t,className:"h-6 w-6 p-0 bg-white/80 hover:bg-white shadow-sm",children:r.jsx(Be,{className:"h-3 w-3"})})]})]})}const Fo=s=>{const e=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#8b5a2b","#6b7280","#ec4899","#84cc16","#f97316","#6366f1"];let t=0;for(let a=0;a<s.length;a++)t=s.charCodeAt(a)+((t<<5)-t);return e[Math.abs(t)%e.length]},Oo=({tags:s,className:e,maxTags:t=5,size:a="sm"})=>{if(!s||s.length===0)return null;const n=s.slice(0,t),o=s.length-t,i={sm:"text-xs px-2 py-1",md:"text-sm px-2.5 py-1.5",lg:"text-base px-3 py-2"};return r.jsxs("div",{className:M("flex flex-wrap gap-1.5 mt-3",e),children:[n.map((l,u)=>r.jsx("span",{className:M("inline-flex items-center rounded-full font-medium text-white","shadow-sm transition-all duration-200 hover:scale-105",i[a]),style:{backgroundColor:Fo(l),fontSize:a==="sm"?"0.75rem":a==="md"?"0.875rem":"1rem"},children:l},`${l}-${u}`)),o>0&&r.jsxs("span",{className:M("inline-flex items-center rounded-full bg-gray-500 text-white font-medium",i[a]),children:["+",o]})]})};function Po({card:s,onFlip:e,onUpdate:t,onCopy:a,onScreenshot:n,onShare:o,onDelete:i,onStyleChange:l,onTagsChange:u,onMoveToFolder:m,className:c,size:w="md"}){const[y,g]=d.useState(!1),[S,E]=d.useState(!1),[R,v]=d.useState(null),[h,f]=d.useState(null),[p,x]=d.useState(!1),[C,D]=d.useState(!1),j=d.useRef(null),N=C?s.backContent:s.frontContent,P={sm:"w-full",md:"w-full",lg:"w-full"},$={sm:"p-3",md:"p-4",lg:"p-5"},Z=()=>{const{style:B}=s,H={borderRadius:"1rem",fontFamily:B.fontFamily,fontSize:B.fontSize==="sm"?"0.875rem":B.fontSize==="lg"?"1.125rem":"1rem",fontWeight:B.fontWeight,color:B.textColor,borderWidth:B.borderWidth||0,borderColor:B.borderColor};let T="";return B.type==="gradient"&&B.gradientColors?(H.background=`linear-gradient(135deg, ${B.gradientColors.join(", ")})`,B.gradientColors.includes("#8a2be2")&&B.gradientColors.includes("#00ffff")?(T="gradient-wave-animation",H.position="relative"):B.gradientColors.includes("#ee7752")&&B.gradientColors.includes("#23d5ab")?T="moving-gradient-animation":B.gradientColors.includes("#667eea")&&(T="gradient-mesh-animation")):B.type==="glass"?(H.background=B.backgroundColor||"rgba(255, 255, 255, 0.15)",H.backdropFilter="blur(20px) saturate(180%)",H.WebkitBackdropFilter="blur(20px) saturate(180%)",H.border=`1px solid ${B.borderColor||"rgba(255, 255, 255, 0.18)"}`,T="glass-morphism"):B.backgroundColor&&B.backgroundColor.includes("linear-gradient")?(H.background=B.backgroundColor,H.backgroundSize="400% 400%",B.backgroundColor.includes("#667eea")&&(T="gradient-mesh-animation")):(H.backgroundColor=B.backgroundColor,B.backgroundColor==="#1a1a2e"&&B.borderColor==="#4361ee"?T="pulse-border-animation":B.backgroundColor==="#0f172a"&&(T="glow-hover-animation")),{style:H,shadowClass:{sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg",xl:"shadow-xl",none:"","2xl":"shadow-2xl",glass:"shadow-lg"}[B.shadow||"md"]||"shadow-md",specialClasses:T}},{style:Q,shadowClass:L,specialClasses:ne}=Z(),te=d.useCallback(B=>{B.stopPropagation(),B.preventDefault(),!p&&(x(!0),D(!C),e(s.id),setTimeout(()=>{x(!1)},600))},[s.id,e,p,C]),J=B=>{B.stopPropagation(),F("content")},me=B=>{F(B)},F=B=>{f(N),v(B),E(!0)},U=(B,H)=>{h&&f({...h,[B]:H,lastModified:new Date})},ae=()=>{if(h){const H={[C?"backContent":"frontContent"]:h};t(s.id,H)}E(!1),v(null),f(null)},V=()=>{E(!1),v(null),f(null)},Y=B=>{U("title",B.target.value)},X=B=>{U("text",B.target.value)},oe=B=>{B.key==="Escape"&&V(),B.key==="Enter"&&B.ctrlKey&&ae()};return r.jsx("div",{className:M("relative group",c),"data-card-id":s.id,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:r.jsx("div",{className:"flip-card-container",style:{perspective:"1000px",width:"100%",minHeight:"fit-content"},children:r.jsxs("div",{ref:j,className:M("flip-card-inner relative transition-all duration-700 ease-in-out",P[w]),style:{minHeight:"fit-content",width:"100%",transformStyle:"preserve-3d",transform:C?"rotateY(180deg)":"rotateY(0deg)"},children:[r.jsx("div",{className:M("flip-card-face flip-card-front w-full flex flex-col transition-all duration-300 relative",L,ne,$[w]),style:{...Q,borderRadius:Q.borderRadius,backfaceVisibility:"hidden",position:C?"absolute":"relative",opacity:C?0:1},children:r.jsx(Pa,{content:h||s.frontContent,isEditing:S&&!C,editingField:R,onTitleChange:Y,onTextChange:X,onTempContentUpdate:U,onSaveEdit:ae,onCancelEdit:V,onDoubleClick:me,onKeyDown:oe,sideLabel:"Front",isHovered:y,onEdit:J,onFlip:te,onCopy:()=>a(s.id),onScreenshot:()=>n(s.id),onShare:()=>o(s.id),onDelete:()=>i(s.id),onStyleChange:l?()=>l(s.id):void 0,onTagsChange:u?()=>u(s.id):void 0,onMoveToFolder:m,card:s,isFlipping:p,isCurrentlyFlipped:C})}),r.jsx("div",{className:M("flip-card-face flip-card-back w-full flex flex-col transition-all duration-300 relative",L,ne,$[w]),style:{...Q,borderRadius:Q.borderRadius,backfaceVisibility:"hidden",transform:"rotateY(180deg)",position:C?"relative":"absolute",top:C?"auto":"0",opacity:C?1:0},children:r.jsx(Pa,{content:h||s.backContent,isEditing:S&&C,editingField:R,onTitleChange:Y,onTextChange:X,onTempContentUpdate:U,onSaveEdit:ae,onCancelEdit:V,onDoubleClick:me,onKeyDown:oe,sideLabel:"Back",isHovered:y,onEdit:J,onFlip:te,onCopy:()=>a(s.id),onScreenshot:()=>n(s.id),onShare:()=>o(s.id),onDelete:()=>i(s.id),onStyleChange:l?()=>l(s.id):void 0,onTagsChange:u?()=>u(s.id):void 0,onMoveToFolder:m,card:s,isFlipping:p,isCurrentlyFlipped:C})})]})})})}function Lo({images:s}){const e=s.slice(0,4),t=e.length,a=o=>{switch(o){case 1:return"flex justify-center";case 2:return"grid grid-cols-2 gap-2";case 3:return"grid grid-cols-2 gap-2";case 4:default:return"grid grid-cols-2 gap-2"}},n=(o,i)=>{const l="relative aspect-video rounded-md overflow-hidden bg-muted transition-all duration-200 hover:scale-[1.02]";return o===1?`${l} max-w-xs w-full`:o===3&&i===2?`${l} col-span-2 max-w-xs mx-auto`:l};return r.jsx("div",{className:a(t),children:e.map((o,i)=>r.jsx("div",{className:n(t,i),children:r.jsx("img",{src:o.url,alt:o.alt||`Image ${i+1}`,className:"w-full h-full object-cover transition-transform duration-200",loading:"lazy"})},i))})}function Pa({content:s,isEditing:e,editingField:t,onTempContentUpdate:a,onSaveEdit:n,onCancelEdit:o,onDoubleClick:i,isHovered:l,onEdit:u,onFlip:m,onCopy:c,onScreenshot:w,onShare:y,onDelete:g,onStyleChange:S,onTagsChange:E,onMoveToFolder:R,isFlipping:v,isCurrentlyFlipped:h,_onTitleChange:f,_onTextChange:p,_onKeyDown:x,_sideLabel:C,_card:D}){return r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsx("div",{className:"flex-1 mr-2",children:e&&t==="title"?r.jsx(Mo,{content:s.title,onUpdate:j=>a("title",j),onSave:n,onCancel:o,autoFocus:!0}):r.jsx("h3",{className:"text-lg font-semibold text-left cursor-pointer hover:bg-black/5 rounded px-1 py-0.5 -mx-1 transition-colors",onDoubleClick:()=>i("title"),children:s.title||"Untitled Card"})}),r.jsxs("div",{className:M("flex gap-1 transition-all duration-200 flex-shrink-0",l||e?"opacity-100":"opacity-60"),children:[r.jsx(G,{size:"sm",variant:"ghost",className:M("h-7 w-7 p-0 rounded-md hover:bg-black/10 transition-all duration-200",v&&"animate-pulse"),onClick:m,title:`Flip to ${h?"Front":"Back"}`,disabled:v,children:r.jsx(Sn,{className:M("h-3.5 w-3.5 transition-transform duration-200",v&&"scale-110")})}),r.jsxs(Eo,{children:[r.jsx(ko,{asChild:!0,children:r.jsx(G,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 rounded-md hover:bg-black/10 transition-all duration-200",onClick:j=>j.stopPropagation(),children:r.jsx(jn,{className:"h-3.5 w-3.5"})})}),r.jsxs(Qs,{align:"end",className:"w-48",children:[r.jsxs(Ie,{onClick:u,children:[r.jsx(En,{className:"h-4 w-4 mr-2"}),"Edit Content"]}),r.jsxs(Ie,{onClick:c,children:[r.jsx(kn,{className:"h-4 w-4 mr-2"}),"Copy Text"]}),r.jsxs(Ie,{onClick:w,children:[r.jsx(ca,{className:"h-4 w-4 mr-2"}),"Screenshot"]}),r.jsxs(Ie,{onClick:y,children:[r.jsx(Nn,{className:"h-4 w-4 mr-2"}),"Share"]}),r.jsx(pa,{}),S&&r.jsxs(Ie,{onClick:S,children:[r.jsx(Us,{className:"h-4 w-4 mr-2"}),"Change Style"]}),E&&r.jsxs(Ie,{onClick:E,children:[r.jsx(Ws,{className:"h-4 w-4 mr-2"}),"Manage Tags"]}),R&&r.jsxs(Ie,{onClick:R,children:[r.jsx(Lt,{className:"h-4 w-4 mr-2"}),"Move to Folder"]}),r.jsx(pa,{}),r.jsxs(Ie,{onClick:g,className:"text-destructive focus:text-destructive",children:[r.jsx(va,{className:"h-4 w-4 mr-2"}),"Delete Card"]})]})]})]})]}),s.images.length>0&&r.jsxs("div",{className:"mb-3 flex-shrink-0",children:[r.jsx(Lo,{images:s.images}),s.images.length>4&&r.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-center",children:["+",s.images.length-4," more images"]})]}),r.jsx("div",{className:"flex-1 mb-3 relative z-10",children:e&&t==="content"?r.jsx(_o,{content:s.text,placeholder:"Add your content here...",onUpdate:j=>a("text",j),onSave:n,onCancel:o,autoFocus:!0}):r.jsx("div",{className:"text-sm leading-relaxed text-left cursor-pointer hover:bg-black/5 rounded p-2 -m-2 transition-colors min-h-[100px] tiptap-editor relative z-10",onDoubleClick:j=>{j.target.tagName!=="A"&&i("content")},onClick:j=>{const N=j.target;if(N.tagName==="A"){j.stopPropagation();const P=N.getAttribute("href");P&&window.open(P,"_blank","noopener,noreferrer")}},children:r.jsx("div",{className:"whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:s.text||'<span class="text-muted-foreground">Click to add content...</span>'}})})}),r.jsxs("div",{className:"mt-auto",children:[r.jsx(Oo,{tags:s.tags,size:"sm"}),s.images.length>0&&r.jsx("div",{className:"flex items-center justify-end text-xs text-muted-foreground mt-2",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(zs,{className:"h-3 w-3"}),r.jsx("span",{children:s.images.length})]})})]})]})}const xe=({title:s="Sample Card",content:e="This is a preview of how your card will look with this style.",style:t,isSelected:a=!1,onClick:n,className:o})=>{console.log("Rendering StylePreviewCard (Simplified):",{title:s,isSelected:a,style:t});const i=()=>{const l={minHeight:"60px",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"8px",borderRadius:"8px",cursor:"pointer",border:a?"2px solid #3b82f6":"1px solid #e5e7eb",position:"relative",fontSize:"10px",textAlign:"center",boxShadow:a?"0 4px 12px rgba(59, 130, 246, 0.3)":"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",backgroundColor:"#ffffff"};if(typeof t=="object"&&t!==null){if("background"in t||"backgroundColor"in t)return{...l,...t,cursor:"pointer",border:a?"3px solid #3b82f6":t.border||"2px solid #e5e7eb",boxShadow:a?"0 4px 12px rgba(59, 130, 246, 0.3)":t.boxShadow||"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"};if("type"in t){if(t.type==="solid")return{...l,backgroundColor:t.backgroundColor||"#ffffff",color:t.textColor||"#374151"};if(t.type==="gradient"&&t.gradientColors){const m=`linear-gradient(${t.gradientDirection||"to bottom right"}, ${t.gradientColors.join(", ")})`;return{...l,background:m,color:t.textColor||"#ffffff"}}}}return l};return r.jsxs("div",{style:i(),onClick:n,className:o,children:[r.jsx("div",{style:{fontWeight:"600",marginBottom:"2px",fontSize:"11px"},children:s}),r.jsx("div",{style:{fontSize:"9px",opacity:.8,lineHeight:"1.1"},children:e})]})},$o=({isSelected:s,onClick:e,className:t})=>{const a={background:"#ffffff",color:"#1f2937",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"400",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",border:"1px solid #e5e7eb"};return r.jsx(xe,{title:"Classic White",content:"Clean and professional",style:a,isSelected:s,onClick:e,className:t})},Bo={id:"classic-white",name:"Classic White",category:"business",description:"Clean and professional white background with subtle shadows",style:{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"2xl",shadow:"md",borderWidth:1,borderColor:"#e5e7eb"},previewComponent:$o},zo=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(135deg, #1f2937 0%, #111827 50%, #030712 100%)",color:"#f9fafb",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.1)"};return r.jsx(xe,{title:"Deep Dark",content:"Bold and mysterious",style:a,isSelected:s,onClick:e,className:t})},Uo={id:"deep-dark",name:"Deep Dark",category:"personality",description:"Bold dark gradient with mysterious depth",style:{type:"gradient",gradientColors:["#1f2937","#111827","#030712"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#f9fafb",borderRadius:"2xl",shadow:"2xl",borderWidth:1,borderColor:"rgba(255, 255, 255, 0.1)"},previewComponent:zo},Wo=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #c084fc 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"20px",boxShadow:"0 20px 25px -5px rgba(139, 92, 246, 0.25), 0 10px 10px -5px rgba(139, 92, 246, 0.1)",border:"none"};return r.jsx(xe,{title:"Elegant Purple",content:"Artistic and inspiring",style:a,isSelected:s,onClick:e,className:t})},Vo={id:"elegant-purple",name:"Elegant Purple",category:"creative",description:"Artistic purple gradient with elegant curves and shadows",style:{type:"gradient",gradientColors:["#8b5cf6","#a855f7","#c084fc"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:Wo},Ho=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"16px",boxShadow:"0 20px 25px -5px rgba(16, 185, 129, 0.2), 0 10px 10px -5px rgba(16, 185, 129, 0.1)",border:"none"};return r.jsx(xe,{title:"Fresh Green",content:"Natural and harmonious",style:a,isSelected:s,onClick:e,className:t})},Go={id:"fresh-green",name:"Fresh Green",category:"natural",description:"Natural green gradient with organic harmony",style:{type:"gradient",gradientColors:["#10b981","#059669","#047857"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:Ho},Ko=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)",backgroundSize:"400% 400%",animation:"gradientShift 8s ease infinite",color:"#ffffff",fontFamily:'"Inter", system-ui, -apple-system, sans-serif',fontSize:"14px",fontWeight:"500",borderRadius:"12px",boxShadow:"0 8px 32px rgba(102, 126, 234, 0.3), 0 4px 16px rgba(118, 75, 162, 0.2)",border:"none",position:"relative",overflow:"hidden"},n={position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",pointerEvents:"none"};return r.jsxs("div",{style:{position:"relative"},children:[r.jsx(xe,{title:"Gradient Mesh",content:"Dynamic gradient background",style:a,isSelected:s,onClick:e,className:t}),r.jsx("div",{style:n}),r.jsx("style",{jsx:!0,children:`
        @keyframes gradientShift {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }
      `})]})},Yo={id:"gradient-mesh",name:"Gradient Mesh",category:"creative",description:"Dynamic gradient background with animated mesh effect",style:{type:"solid",backgroundColor:"linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)",fontFamily:"Inter",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"xl",borderWidth:0,borderColor:"transparent"},previewComponent:Ko},qo=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(90deg, #fb923c 0%, #8b5cf6 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(251, 146, 60, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"none"};return r.jsx(xe,{title:"Gradient Sunset",content:"Vibrant and expressive",style:a,isSelected:s,onClick:e,className:t})},Jo={id:"gradient-sunset",name:"Gradient Sunset",category:"personality",description:"Warm orange to violet gradient with magical sunset vibes",style:{type:"gradient",gradientColors:["#fb923c","#8b5cf6"],gradientDirection:"to-r",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:qo},Xo=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(135deg, #8a2be2 0%, #4b0082 25%, #9370db 50%, #00ffff 75%, #00bfff 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(138, 43, 226, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"none",position:"relative",overflow:"hidden"};return r.jsx("div",{className:"relative",children:r.jsx(xe,{title:"Gradient Wave",content:"Dynamic wave effect",style:a,isSelected:s,onClick:e,className:`${t} gradient-wave-animation`})})},Qo={id:"gradient-wave",name:"Gradient Wave",category:"creative",description:"Purple to cyan gradient with dynamic wave effect",style:{type:"gradient",gradientColors:["#8a2be2","#4b0082","#9370db","#00ffff","#00bfff"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:Xo},Zo=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"16px",boxShadow:"0 10px 15px -3px rgba(59, 130, 246, 0.3), 0 4px 6px -2px rgba(59, 130, 246, 0.1)",border:"none"};return r.jsx(xe,{title:"Modern Blue",content:"Contemporary gradient design",style:a,isSelected:s,onClick:e,className:t})},ei={id:"modern-blue",name:"Modern Blue",category:"business",description:"Contemporary blue gradient with professional appeal",style:{type:"gradient",gradientColors:["#3b82f6","#1d4ed8","#1e40af"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"lg",borderWidth:0},previewComponent:Zo},ti=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab)",backgroundSize:"400% 400%",color:"#ffffff",fontFamily:'"Poppins", system-ui, sans-serif',fontSize:"14px",fontWeight:"600",borderRadius:"16px",boxShadow:"0 15px 30px -10px rgba(0, 0, 0, 0.25)",border:"none",position:"relative",overflow:"hidden"};return r.jsx("div",{className:"relative",children:r.jsx(xe,{title:"Moving Gradient",content:"Flowing color effect",style:a,isSelected:s,onClick:e,className:`${t} moving-gradient-animation`})})},ai={id:"moving-gradient",name:"Moving Gradient",category:"creative",description:"Colorful gradient with flowing animation effect",style:{type:"gradient",gradientColors:["#ee7752","#e73c7e","#23a6d5","#23d5ab"],gradientDirection:"to-br",fontFamily:"Poppins",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"xl",shadow:"xl",borderWidth:0},previewComponent:ti},si=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(90deg, #34d399 0%, #0d9488 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"20px",boxShadow:"0 10px 15px -3px rgba(52, 211, 153, 0.3), 0 4px 6px -2px rgba(13, 148, 136, 0.1)",border:"1px solid rgba(52, 211, 153, 0.3)"};return r.jsx(xe,{title:"Ocean Breeze",content:"Fresh and refreshing",style:a,isSelected:s,onClick:e,className:t})},ri={id:"ocean-breeze",name:"Ocean Breeze",category:"natural",description:"Fresh emerald to teal gradient with tropical vibes",style:{type:"gradient",gradientColors:["#34d399","#0d9488"],gradientDirection:"to-r",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"lg",borderWidth:1,borderColor:"rgba(52, 211, 153, 0.3)"},previewComponent:si},ni=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(90deg, #fda4af 0%, #f87171 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"500",borderRadius:"20px",boxShadow:"0 10px 15px -3px rgba(253, 164, 175, 0.3), 0 4px 6px -2px rgba(248, 113, 113, 0.1)",border:"1px solid rgba(253, 164, 175, 0.3)"};return r.jsx(xe,{title:"Soft Pink",content:"Gentle and soothing",style:a,isSelected:s,onClick:e,className:t})},oi={id:"soft-pink",name:"Soft Pink",category:"natural",description:"Warm pink to red gradient with romantic tones",style:{type:"gradient",gradientColors:["#fda4af","#f87171"],gradientDirection:"to-r",fontFamily:"system-ui",fontSize:"base",fontWeight:"medium",textColor:"#ffffff",borderRadius:"2xl",shadow:"lg",borderWidth:1,borderColor:"rgba(253, 164, 175, 0.3)"},previewComponent:ni},ii=({isSelected:s,onClick:e,className:t})=>{const a={background:"linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%)",color:"#ffffff",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",fontWeight:"600",borderRadius:"18px",boxShadow:"0 25px 50px -12px rgba(255, 126, 95, 0.25), 0 0 0 1px rgba(255, 126, 95, 0.1)",border:"none"};return r.jsx(xe,{title:"Warm Orange",content:"Energetic and vibrant",style:a,isSelected:s,onClick:e,className:t})},li={id:"warm-orange",name:"Warm Orange",category:"creative",description:"Energetic warm orange gradient with peachy tones",style:{type:"gradient",gradientColors:["#ff7e5f","#feb47b"],gradientDirection:"to-br",fontFamily:"system-ui",fontSize:"base",fontWeight:"semibold",textColor:"#ffffff",borderRadius:"2xl",shadow:"2xl",borderWidth:0},previewComponent:ii};class Qe{static instance;presets=new Map;categories=new Map;constructor(){this.initializeCategories()}static getInstance(){return Qe.instance||(Qe.instance=new Qe),Qe.instance}initializeCategories(){["business","creative","natural","personality"].forEach(t=>{this.categories.set(t,[])})}register(e){this.presets.set(e.id,e);const t=this.categories.get(e.category)||[];t.push(e),this.categories.set(e.category,t)}unregister(e){const t=this.presets.get(e);if(t){this.presets.delete(e);const n=(this.categories.get(t.category)||[]).filter(o=>o.id!==e);this.categories.set(t.category,n)}}getByCategory(e){return this.categories.get(e)||[]}getById(e){return this.presets.get(e)}getAll(){return Array.from(this.presets.values())}getAllByOrder(){const e=[];return["business","creative","natural","personality"].forEach(a=>{const n=this.getByCategory(a);e.push(...n)}),e}getCategoryCount(e){return this.categories.get(e)?.length||0}getTotalCount(){return this.presets.size}clear(){this.presets.clear(),this.initializeCategories()}}const Ea=Qe.getInstance(),ci=()=>Ea.getAllByOrder();class Ze{static instance;STORAGE_KEYS={USER_PREFERENCES:"cardall_style_preferences",RECENT_STYLES:"cardall_recent_styles",DEFAULT_STYLE:"cardall_default_style"};constructor(){}static getInstance(){return Ze.instance||(Ze.instance=new Ze),Ze.instance}saveUserPreference(e,t){try{const a=this.getUserPreferences();a[e]={styleId:t,appliedAt:new Date().toISOString()},localStorage.setItem(this.STORAGE_KEYS.USER_PREFERENCES,JSON.stringify(a)),this.addToRecentStyles(t)}catch(a){console.error("Failed to save user style preference:",a)}}getUserPreference(e){try{return this.getUserPreferences()[e]?.styleId||null}catch(t){return console.error("Failed to get user style preference:",t),null}}getRecentStyles(e=10){try{const t=localStorage.getItem(this.STORAGE_KEYS.RECENT_STYLES);return t?JSON.parse(t).slice(0,e):[]}catch(t){return console.error("Failed to get recent styles:",t),[]}}clearPreferences(){try{localStorage.removeItem(this.STORAGE_KEYS.USER_PREFERENCES),localStorage.removeItem(this.STORAGE_KEYS.RECENT_STYLES)}catch(e){console.error("Failed to clear style preferences:",e)}}setDefaultStyle(e){try{localStorage.setItem(this.STORAGE_KEYS.DEFAULT_STYLE,e)}catch(t){console.error("Failed to set default style:",t)}}getDefaultStyle(){try{return localStorage.getItem(this.STORAGE_KEYS.DEFAULT_STYLE)}catch(e){return console.error("Failed to get default style:",e),null}}getUserPreferences(){try{const e=localStorage.getItem(this.STORAGE_KEYS.USER_PREFERENCES);return e?JSON.parse(e):{}}catch(e){return console.error("Failed to parse user preferences:",e),{}}}addToRecentStyles(e){try{const a=this.getRecentStyles().filter(o=>o!==e),n=[e,...a].slice(0,10);localStorage.setItem(this.STORAGE_KEYS.RECENT_STYLES,JSON.stringify(n))}catch(t){console.error("Failed to update recent styles:",t)}}getStyleUsageStats(){try{const e=this.getUserPreferences(),t={};return Object.values(e).forEach(({styleId:a})=>{t[a]=(t[a]||0)+1}),t}catch(e){return console.error("Failed to get style usage stats:",e),{}}}getMostUsedStyles(e=5){try{const t=this.getStyleUsageStats();return Object.entries(t).sort(([,a],[,n])=>n-a).slice(0,e).map(([a])=>a)}catch(t){return console.error("Failed to get most used styles:",t),[]}}}const La=Ze.getInstance(),di=()=>{const s=[Bo,ei,Vo,li,Go,oi,ri,Uo,Jo,Yo,Qo,ai];s.forEach(e=>{Ea.register(e)}),console.log(`Registered ${s.length} card style presets`)};di();const ui=({isOpen:s,onClose:e,context:t})=>{const[a,n]=d.useState(null),[o,i]=d.useState([]);d.useEffect(()=>{const m=ci();console.log("Loaded style presets:",m.length,m),i(m);const c=La.getUserPreference(t.targetCardId);c&&n(c)},[t.targetCardId]);const l=m=>{const c=Ea.getById(m);c&&(n(m),t.onStyleApply(c.style),La.saveUserPreference(t.targetCardId,m))},u=()=>{n(null),e()};return s?r.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.1)",backdropFilter:"blur(2px)"},children:[r.jsx("div",{className:"absolute inset-0",onClick:u}),r.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl border border-gray-200 p-6 w-full max-w-md sm:max-w-2xl lg:max-w-4xl",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Card Styles"}),r.jsx("button",{onClick:u,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:r.jsx(Ye,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 mb-6",style:{minHeight:"300px",maxHeight:"70vh",overflowY:"auto"},children:o.map(m=>{const c=m.previewComponent;return console.log("Rendering preset:",m.id,m.name,c),r.jsxs("div",{className:"relative",children:[r.jsx(c,{isSelected:a===m.id,onClick:()=>l(m.id),className:"w-full"}),r.jsxs("div",{className:"mt-2 text-center",children:[r.jsx("div",{className:"text-xs font-medium text-gray-700 truncate",children:m.name}),r.jsx("div",{className:"text-xs text-gray-500 capitalize",children:m.category})]})]},m.id)})}),r.jsxs("div",{className:"text-xs text-gray-400 text-center mb-2",children:["Loaded ",o.length," presets"]}),r.jsx("div",{className:"text-xs text-gray-500 text-center",children:"Click any style to apply it instantly to your card"})]})]}):null},Zs=d.createContext(void 0),mi=()=>{const s=d.useContext(Zs);if(!s)throw new Error("useStylePanel must be used within a StylePanelProvider");return s},gi=({children:s})=>{const[e,t]=d.useState({isOpen:!1,context:null}),a=i=>{t({isOpen:!0,context:i})},n=()=>{t({isOpen:!1,context:null})},o={openStylePanel:a,closeStylePanel:n,isOpen:e.isOpen};return r.jsxs(Zs.Provider,{value:o,children:[s,typeof window<"u"&&e.isOpen&&e.context&&Bt.createPortal(r.jsx(ui,{isOpen:e.isOpen,onClose:n,context:e.context}),document.body)]})},er=d.createContext(void 0);function fi({children:s}){const[e,t]=d.useState(!1),[a,n]=d.useState(null),[o,i]=d.useState([]),[l,u]=d.useState(null),w={isOpen:e,currentCardId:a,currentCardTags:o,onTagsChange:l,openTagPanel:y=>{n(y.targetCardId),i(y.currentTags),u(()=>y.onTagsApply),t(!0)},closeTagPanel:()=>{t(!1),n(null),i([]),u(null)}};return r.jsx(er.Provider,{value:w,children:s})}function tr(){const s=d.useContext(er);if(s===void 0)throw new Error("useTagPanel must be used within a TagPanelProvider");return s}const Ke=d.forwardRef(({className:s,type:e,...t},a)=>r.jsx("input",{type:e,className:M("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...t}));Ke.displayName="Input";const ka=d.forwardRef(({className:s,children:e,...t},a)=>r.jsxs(is,{ref:a,className:M("relative overflow-hidden",s),...t,children:[r.jsx(Gr,{className:"h-full w-full rounded-[inherit]",children:e}),r.jsx(ar,{}),r.jsx(Kr,{})]}));ka.displayName=is.displayName;const ar=d.forwardRef(({className:s,orientation:e="vertical",...t},a)=>r.jsx(ls,{ref:a,orientation:e,className:M("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:r.jsx(Yr,{className:"relative flex-1 rounded-full bg-border"})}));ar.displayName=ls.displayName;const hi=zt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ue({className:s,variant:e,...t}){return r.jsx("div",{className:M(hi({variant:e}),s),...t})}const jt=Xr,pi=qr,sr=d.forwardRef(({className:s,...e},t)=>r.jsx(cs,{ref:t,className:M("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...e}));sr.displayName=cs.displayName;const ct=d.forwardRef(({className:s,children:e,...t},a)=>r.jsxs(pi,{children:[r.jsx(sr,{}),r.jsxs(ds,{ref:a,className:M("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[e,r.jsxs(Jr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(Ye,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ct.displayName=ds.displayName;const dt=({className:s,...e})=>r.jsx("div",{className:M("flex flex-col space-y-1.5 text-center sm:text-left",s),...e});dt.displayName="DialogHeader";const ut=({className:s,...e})=>r.jsx("div",{className:M("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...e});ut.displayName="DialogFooter";const mt=d.forwardRef(({className:s,...e},t)=>r.jsx(us,{ref:t,className:M("text-lg font-semibold leading-none tracking-tight",s),...e}));mt.displayName=us.displayName;const Ut=d.forwardRef(({className:s,...e},t)=>r.jsx(ms,{ref:t,className:M("text-sm text-muted-foreground",s),...e}));Ut.displayName=ms.displayName;function yi({isOpen:s,onClose:e,currentCardId:t,currentFolderId:a,onFolderSelect:n}){const{folders:o,getFolderById:i}=Js(),[l,u]=d.useState(""),[m,c]=d.useState(a);d.useEffect(()=>{s&&(c(a),u(""))},[s,a]);const w=o.filter(v=>v.name.toLowerCase().includes(l.toLowerCase())),y=a?i(a):null,g=v=>{c(v)},S=()=>{n&&n(m),e()},E=()=>{c(a),e()},R=m!==a;return r.jsx(jt,{open:s,onOpenChange:e,children:r.jsxs(ct,{className:"sm:max-w-md",children:[r.jsx(dt,{children:r.jsxs(mt,{className:"flex items-center gap-2",children:[r.jsx($e,{className:"h-5 w-5"}),"Move Card to Folder"]})}),r.jsxs("div",{className:"space-y-4",children:[y&&r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[r.jsx(Lt,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Currently in:"}),r.jsx(ue,{variant:"secondary",children:y.name})]}),!y&&r.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[r.jsx(Aa,{className:"h-4 w-4 text-muted-foreground"}),r.jsx("span",{className:"text-sm text-muted-foreground",children:"Currently in: Root"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(xt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),r.jsx(Ke,{placeholder:"Search folders...",value:l,onChange:v=>u(v.target.value),className:"pl-10"})]}),r.jsx(ka,{className:"h-64 w-full border rounded-md",children:r.jsxs("div",{className:"p-2 space-y-1",children:[r.jsxs("div",{className:M("flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors",m===null?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>g(null),children:[r.jsx(Aa,{className:"h-4 w-4 flex-shrink-0"}),r.jsx("span",{className:"flex-1",children:"Root"}),m===null&&r.jsx(Be,{className:"h-4 w-4 flex-shrink-0"}),a===null&&r.jsx(ue,{variant:"outline",className:"text-xs",children:"Current"})]}),w.map(v=>r.jsxs("div",{className:M("flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors",m===v.id?"bg-primary text-primary-foreground":"hover:bg-muted",a===v.id&&"opacity-60"),onClick:()=>g(v.id),children:[r.jsx($e,{className:"h-4 w-4 flex-shrink-0"}),r.jsx("span",{className:"flex-1",children:v.name}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ue,{variant:"outline",className:"text-xs",children:v.cardIds.length}),m===v.id&&r.jsx(Be,{className:"h-4 w-4 flex-shrink-0"}),a===v.id&&r.jsx(ue,{variant:"outline",className:"text-xs",children:"Current"})]})]},v.id)),w.length===0&&l&&r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[r.jsx($e,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"text-sm",children:"No folders found"})]})]})})]}),r.jsxs(ut,{children:[r.jsx(G,{variant:"outline",onClick:E,children:"Cancel"}),r.jsx(G,{onClick:S,disabled:!R,children:R?"Move Card":"No Change"})]})]})})}const rr=d.createContext(void 0);function wi({children:s}){const[e,t]=d.useState(!1),[a,n]=d.useState(null),[o,i]=d.useState(null),[l,u]=d.useState(null),m=y=>{n(y.targetCardId),i(y.currentFolderId||null),u(()=>y.onFolderApply),t(!0)},c=()=>{t(!1),n(null),i(null),u(null)},w={isOpen:e,currentCardId:a,currentFolderId:o,onFolderSelect:l,openFolderPanel:m,closeFolderPanel:c};return r.jsxs(rr.Provider,{value:w,children:[s,typeof window<"u"&&e&&a&&Bt.createPortal(r.jsx(yi,{isOpen:e,onClose:c,currentCardId:a,currentFolderId:o,onFolderSelect:l}),document.body)]})}function xi(){const s=d.useContext(rr);if(s===void 0)throw new Error("useFolderPanel must be used within a FolderPanelProvider");return s}function bi({card:s,onFlip:e,onUpdate:t,onCopy:a,onScreenshot:n,onShare:o,onDelete:i,onMoveToFolder:l,className:u,size:m="md"}){const{openStylePanel:c}=mi(),{openTagPanel:w}=tr(),{openFolderPanel:y}=xi(),g=()=>{c({targetCardId:s.id,currentStyle:s.style,onStyleApply:R=>{t(s.id,{style:R,updatedAt:new Date})},onPanelClose:()=>{}})},S=()=>{const R=s.isFlipped?s.backContent:s.frontContent,v=s.isFlipped?"backContent":"frontContent";w({targetCardId:s.id,currentTags:R.tags,onTagsApply:h=>{t(s.id,{[v]:{...R,tags:h,lastModified:new Date},updatedAt:new Date})},onPanelClose:()=>{}})},E=()=>{l&&y({targetCardId:s.id,currentFolderId:s.folderId,onFolderApply:R=>l(s.id,R),onPanelClose:()=>{}})};return r.jsx(Po,{card:s,onFlip:e,onUpdate:t,onCopy:a,onScreenshot:n,onShare:o,onDelete:i,onStyleChange:g,onTagsChange:S,onMoveToFolder:l?E:void 0,className:u,size:m})}function vi({items:s,gap:e=16,minColumnWidth:t=280,maxColumns:a=5,breakpoints:n={sm:640,md:768,lg:1024,xl:1280,"2xl":1536}}){const o=d.useRef(null),[i,l]=d.useState(new Map),[u,m]=d.useState(0),[c,w]=d.useState({columns:1,gap:e,containerWidth:0}),y=d.useCallback(v=>{if(v===0)return 1;let h=a;v<n.sm?h=1:v<n.md?h=2:v<n.lg?h=3:v<n.xl&&(h=4);const f=v-e,p=Math.floor(f/(t+e));return Math.min(Math.max(1,p),h)},[e,t,a,n]),g=d.useCallback((v,h,f,p)=>{if(h===0||f===0)return{positions:new Map,totalHeight:0};const x=p*(h-1),C=f-x,D=Math.floor(C/h),j=new Array(h).fill(0),N=new Map;v.forEach($=>{const Z=j.indexOf(Math.min(...j)),Q=Z*(D+p),L=j[Z];N.set($.id,{x:Q,y:L,width:D,height:$.height}),j[Z]+=$.height+p});const P=Math.max(...j)-p;return{positions:N,totalHeight:P}},[]),S=d.useCallback(v=>{const h=v[0];if(!h)return;const f=h.contentRect.width,p=y(f);w(x=>({...x,columns:p,containerWidth:f}))},[y]);d.useEffect(()=>{const v=o.current;if(!v)return;const h=new ResizeObserver(f=>{S(f)});return h.observe(v),()=>{h.disconnect()}},[S]),d.useEffect(()=>{if(s.length===0||c.containerWidth===0){l(new Map),m(0);return}const{positions:v,totalHeight:h}=g(s,c.columns,c.containerWidth,e);l(v),m(h)},[s,c,e,g]);const E=d.useCallback(v=>i.get(v),[i]),R=d.useCallback((v,h)=>{const f=s.findIndex(D=>D.id===v);if(f===-1)return;const p=[...s];p[f]={...p[f],height:h};const{positions:x,totalHeight:C}=g(p,c.columns,c.containerWidth,e);l(x),m(C)},[s,c,e,g]);return{containerRef:o,positions:i,containerHeight:u,config:c,getItemPosition:E,updateItemHeight:R}}function Ci({cards:s,onCardFlip:e,onCardUpdate:t,onCardCopy:a,onCardScreenshot:n,onCardShare:o,onCardDelete:i,onMoveToFolder:l,onCardStyleChange:u,cardSize:m="md",className:c,gap:w=16,enableVirtualization:y=!0,overscan:g=5}){const[S,E]=d.useState(new Map),[R,v]=d.useState(!1),[h,f]=d.useState(0),[p,x]=d.useState(0),C=d.useRef(new Map),D=d.useRef(null),j=d.useMemo(()=>[...s].sort((F,U)=>new Date(U.createdAt).getTime()-new Date(F.createdAt).getTime()),[s]),N=d.useCallback(F=>{const ae={sm:.8,md:1,lg:1.3}[m],V=200*ae,Y=Math.min(Math.ceil(F.frontContent.title.length/25),3)*24*ae,X=Math.min(Math.ceil(F.frontContent.text.length/40),8)*18*ae,oe=F.frontContent.images.length>0?120*ae:0,B=F.frontContent.tags.length>0?32*ae:0,H=32*ae;return Math.round(V+Y+X+oe+B+H)},[m]),P=d.useMemo(()=>j.map(F=>({id:F.id,height:S.get(F.id)||N(F)})),[j,S,N]),$=d.useMemo(()=>({sm:{minColumnWidth:240,maxColumns:5},md:{minColumnWidth:280,maxColumns:4},lg:{minColumnWidth:320,maxColumns:3}})[m],[m]),{containerRef:Z,positions:Q,containerHeight:L,updateItemHeight:ne}=vi({items:P,gap:w,...$,breakpoints:{sm:640,md:768,lg:1024,xl:1280,"2xl":1536}}),te=d.useMemo(()=>{if(!y||!D.current)return j;const F=D.current.clientHeight,U=h-g*100,ae=h+F+g*100;return j.filter(V=>{const Y=Q.get(V.id);return Y?Y.y+Y.height>=U&&Y.y<=ae:!0})},[j,Q,h,y,g]);d.useCallback(F=>{y&&f(F.currentTarget.scrollTop)},[y]);const J=d.useCallback(F=>{const U=C.current.get(F);if(!U)return;const ae=new ResizeObserver(V=>{const Y=V[0];if(Y){const X=Y.contentRect.height,oe=S.get(F);Math.abs(X-(oe||0))>3&&(E(B=>{const H=new Map(B);return H.set(F,X),H}),ne(F,X))}});return ae.observe(U),()=>ae.disconnect()},[S,ne]);d.useEffect(()=>{if(!R&&j.length>0){const F=new Map;j.forEach(U=>{F.set(U.id,N(U))}),E(F),v(!0)}},[j,N,R]),d.useEffect(()=>{const F=[];return te.forEach(U=>{const ae=J(U.id);ae&&F.push(ae)}),()=>{F.forEach(U=>U())}},[te,J]);const me=d.useCallback((F,U)=>{U?C.current.set(F,U):C.current.delete(F)},[]);return d.useEffect(()=>{D.current&&x(D.current.clientHeight)},[]),j.length===0?r.jsx("div",{className:"flex-1 flex items-center justify-center p-12",children:r.jsxs("div",{className:"text-center space-y-4",children:[r.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-muted flex items-center justify-center",children:r.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-lg",children:"+"})})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"No cards yet"}),r.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Create your first knowledge card to get started. Click the + button to begin."})]})]})}):r.jsx("div",{ref:Z,className:M("relative w-full",c),style:{height:L},children:te.map(F=>{const U=Q.get(F.id);return U?r.jsx("div",{ref:ae=>me(F.id,ae),className:"absolute transition-all duration-300 ease-out",style:{transform:`translate3d(${U.x}px, ${U.y}px, 0)`,width:U.width,willChange:"transform"},children:r.jsx(bi,{card:F,onFlip:e,onUpdate:t,onCopy:a,onScreenshot:n,onShare:o,onDelete:i,onMoveToFolder:l,size:m,className:"w-full"})},F.id):null})})}const nr=d.forwardRef(({className:s,...e},t)=>r.jsxs(gs,{ref:t,className:M("relative flex w-full touch-none select-none items-center",s),...e,children:[r.jsx(Qr,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:r.jsx(Zr,{className:"absolute h-full bg-primary"})}),r.jsx(en,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));nr.displayName=gs.displayName;const Si=zt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ge=d.forwardRef(({className:s,...e},t)=>r.jsx(fs,{ref:t,className:M(Si(),s),...e}));Ge.displayName=fs.displayName;const wt=d.forwardRef(({className:s,orientation:e="horizontal",decorative:t=!0,...a},n)=>r.jsx(hs,{ref:n,decorative:t,orientation:e,className:M("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...a}));wt.displayName=hs.displayName;const ji=an,Ei=sn,or=d.forwardRef(({className:s,align:e="center",sideOffset:t=4,...a},n)=>r.jsx(tn,{children:r.jsx(ps,{ref:n,align:e,sideOffset:t,className:M("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));or.displayName=ps.displayName;function $a(s){if(!s)return"";try{const e=new DOMParser().parseFromString(s,"text/html");e.querySelectorAll("img").forEach(i=>i.remove()),e.querySelectorAll("br").forEach(i=>{i.replaceWith(`
`)}),e.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, li, blockquote").forEach(i=>{i.insertAdjacentText("afterend",`
`)});let o=e.body.textContent||e.body.innerText||"";return o=o.replace(/[ \t]+/g," ").replace(/[ \t]*\n[ \t]*/g,`
`).replace(/\n{3,}/g,`

`).trim(),o}catch(e){return console.warn("Failed to parse HTML, falling back to regex cleanup:",e),s.replace(/<img[^>]*>/gi,"").replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(p|div|h[1-6]|li|blockquote)[^>]*>/gi,`
`).replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/[ \t]+/g," ").replace(/[ \t]*\n[ \t]*/g,`
`).replace(/\n{3,}/g,`

`).trim()}}function ki(s,e){const t=$a(s),a=$a(e);return`${t}

${a}`}async function Ni(s){try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(s),!0;{const e=document.createElement("textarea");e.value=s,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const t=document.execCommand("copy");return document.body.removeChild(e),t}}catch(e){return console.error("Failed to copy text to clipboard:",e),!1}}function Di(s,e){return s[13]=1,s[14]=e>>8,s[15]=e&255,s[16]=e>>8,s[17]=e&255,s}const ir=112,lr=72,cr=89,dr=115;let ra;function Ri(){const s=new Int32Array(256);for(let e=0;e<256;e++){let t=e;for(let a=0;a<8;a++)t=t&1?3988292384^t>>>1:t>>>1;s[e]=t}return s}function Ti(s){let e=-1;ra||(ra=Ri());for(let t=0;t<s.length;t++)e=ra[(e^s[t])&255]^e>>>8;return e^-1}function Ai(s){const e=s.length-1;for(let t=e;t>=4;t--)if(s[t-4]===9&&s[t-3]===ir&&s[t-2]===lr&&s[t-1]===cr&&s[t]===dr)return t-3;return 0}function Ii(s,e,t=!1){const a=new Uint8Array(13);e*=39.3701,a[0]=ir,a[1]=lr,a[2]=cr,a[3]=dr,a[4]=e>>>24,a[5]=e>>>16,a[6]=e>>>8,a[7]=e&255,a[8]=a[4],a[9]=a[5],a[10]=a[6],a[11]=a[7],a[12]=1;const n=Ti(a),o=new Uint8Array(4);if(o[0]=n>>>24,o[1]=n>>>16,o[2]=n>>>8,o[3]=n&255,t){const i=Ai(s);return s.set(a,i),s.set(o,i+13),s}else{const i=new Uint8Array(4);i[0]=0,i[1]=0,i[2]=0,i[3]=9;const l=new Uint8Array(54);return l.set(s,0),l.set(i,33),l.set(a,37),l.set(o,50),l}}const _i="AAlwSFlz",Mi="AAAJcEhZ",Fi="AAAACXBI";function Oi(s){let e=s.indexOf(_i);return e===-1&&(e=s.indexOf(Mi)),e===-1&&(e=s.indexOf(Fi)),e}const ur="[modern-screenshot]",ze=typeof window<"u",Pi=ze&&"Worker"in window,Li=ze&&"atob"in window,$i=ze&&"btoa"in window,Na=ze?window.navigator?.userAgent:"",mr=Na.includes("Chrome"),$t=Na.includes("AppleWebKit")&&!mr,Da=Na.includes("Firefox"),Bi=s=>s&&"__CONTEXT__"in s,zi=s=>s.constructor.name==="CSSFontFaceRule",Ui=s=>s.constructor.name==="CSSImportRule",Re=s=>s.nodeType===1,Et=s=>typeof s.className=="object",gr=s=>s.tagName==="image",Wi=s=>s.tagName==="use",vt=s=>Re(s)&&typeof s.style<"u"&&!Et(s),Vi=s=>s.nodeType===8,Hi=s=>s.nodeType===3,lt=s=>s.tagName==="IMG",Wt=s=>s.tagName==="VIDEO",Gi=s=>s.tagName==="CANVAS",Ki=s=>s.tagName==="TEXTAREA",Yi=s=>s.tagName==="INPUT",qi=s=>s.tagName==="STYLE",Ji=s=>s.tagName==="SCRIPT",Xi=s=>s.tagName==="SELECT",Qi=s=>s.tagName==="SLOT",Zi=s=>s.tagName==="IFRAME",el=(...s)=>console.warn(ur,...s);function tl(s){const e=s?.createElement?.("canvas");return e&&(e.height=e.width=1),!!e&&"toDataURL"in e&&!!e.toDataURL("image/webp").includes("image/webp")}const ya=s=>s.startsWith("data:");function fr(s,e){if(s.match(/^[a-z]+:\/\//i))return s;if(ze&&s.match(/^\/\//))return window.location.protocol+s;if(s.match(/^[a-z]+:/i)||!ze)return s;const t=Vt().implementation.createHTMLDocument(),a=t.createElement("base"),n=t.createElement("a");return t.head.appendChild(a),t.body.appendChild(n),e&&(a.href=e),n.href=s,n.href}function Vt(s){return(s&&Re(s)?s?.ownerDocument:s)??window.document}const Ht="http://www.w3.org/2000/svg";function al(s,e,t){const a=Vt(t).createElementNS(Ht,"svg");return a.setAttributeNS(null,"width",s.toString()),a.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"viewBox",`0 0 ${s} ${e}`),a}function sl(s,e){let t=new XMLSerializer().serializeToString(s);return e&&(t=t.replace(/[\u0000-\u0008\v\f\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`}function rl(s,e){return new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>a(n.error),n.onabort=()=>a(new Error(`Failed read blob to ${e}`)),n.readAsDataURL(s)})}const nl=s=>rl(s,"dataUrl");function ot(s,e){const t=Vt(e).createElement("img");return t.decoding="sync",t.loading="eager",t.src=s,t}function Ct(s,e){return new Promise(t=>{const{timeout:a,ownerDocument:n,onError:o,onWarn:i}=e??{},l=typeof s=="string"?ot(s,Vt(n)):s;let u=null,m=null;function c(){t(l),u&&clearTimeout(u),m?.()}if(a&&(u=setTimeout(c,a)),Wt(l)){const w=l.currentSrc||l.src;if(!w)return l.poster?Ct(l.poster,e).then(t):c();if(l.readyState>=2)return c();const y=c,g=S=>{i?.("Failed video load",w,S),o?.(S),c()};m=()=>{l.removeEventListener("loadeddata",y),l.removeEventListener("error",g)},l.addEventListener("loadeddata",y,{once:!0}),l.addEventListener("error",g,{once:!0})}else{const w=gr(l)?l.href.baseVal:l.currentSrc||l.src;if(!w)return c();const y=async()=>{if(lt(l)&&"decode"in l)try{await l.decode()}catch(S){i?.("Failed to decode image, trying to render anyway",l.dataset.originalSrc||w,S)}c()},g=S=>{i?.("Failed image load",l.dataset.originalSrc||w,S),c()};if(lt(l)&&l.complete)return y();m=()=>{l.removeEventListener("load",y),l.removeEventListener("error",g)},l.addEventListener("load",y,{once:!0}),l.addEventListener("error",g,{once:!0})}})}async function ol(s,e){vt(s)&&(lt(s)||Wt(s)?await Ct(s,e):await Promise.all(["img","video"].flatMap(t=>Array.from(s.querySelectorAll(t)).map(a=>Ct(a,e)))))}const hr=function(){let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)}();function pr(s){return s?.split(",").map(e=>e.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}let Ba=0;function il(s){const e=`${ur}[#${Ba}]`;return Ba++,{time:t=>s&&console.time(`${e} ${t}`),timeEnd:t=>s&&console.timeEnd(`${e} ${t}`),warn:(...t)=>s&&el(...t)}}function ll(s){return{cache:s?"no-cache":"force-cache"}}async function Gt(s,e){return Bi(s)?s:cl(s,{...e,autoDestruct:!0})}async function cl(s,e){const{scale:t=1,workerUrl:a,workerNumber:n=1}=e||{},o=!!e?.debug,i=e?.features??!0,l=s.ownerDocument??(ze?window.document:void 0),u=s.ownerDocument?.defaultView??(ze?window:void 0),m=new Map,c={width:0,height:0,quality:1,type:"image/png",scale:t,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:o,fetch:{requestInit:ll(e?.fetch?.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1,...e?.fetch},fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:n,onCloneEachNode:null,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1,...e,__CONTEXT__:!0,log:il(o),node:s,ownerDocument:l,ownerWindow:u,dpi:t===1?null:96*t,svgStyleElement:yr(l),svgDefsElement:l?.createElementNS(Ht,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:Pi&&a&&n?n:0})].map(()=>{try{const g=new Worker(a);return g.onmessage=async S=>{const{url:E,result:R}=S.data;R?m.get(E)?.resolve?.(R):m.get(E)?.reject?.(new Error(`Error receiving message from worker: ${E}`))},g.onmessageerror=S=>{const{url:E}=S.data;m.get(E)?.reject?.(new Error(`Error receiving message from worker: ${E}`))},g}catch(g){return c.log.warn("Failed to new Worker",g),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:`${[tl(l)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:m,drawImageCount:0,tasks:[],features:i,isEnable:g=>g==="restoreScrollPosition"?typeof i=="boolean"?!1:i[g]??!1:typeof i=="boolean"?i:i[g]??!0,shadowRoots:[]};c.log.time("wait until load"),await ol(s,{timeout:c.timeout,onWarn:c.log.warn}),c.log.timeEnd("wait until load");const{width:w,height:y}=dl(s,c);return c.width=w,c.height=y,c}function yr(s){if(!s)return;const e=s.createElement("style"),t=e.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return e.appendChild(t),e}function dl(s,e){let{width:t,height:a}=e;if(Re(s)&&(!t||!a)){const n=s.getBoundingClientRect();t=t||n.width||Number(s.getAttribute("width"))||0,a=a||n.height||Number(s.getAttribute("height"))||0}return{width:t,height:a}}async function ul(s,e){const{log:t,timeout:a,drawImageCount:n,drawImageInterval:o}=e;t.time("image to canvas");const i=await Ct(s,{timeout:a,onWarn:e.log.warn}),{canvas:l,context2d:u}=ml(s.ownerDocument,e),m=()=>{try{u?.drawImage(i,0,0,l.width,l.height)}catch(c){e.log.warn("Failed to drawImage",c)}};if(m(),e.isEnable("fixSvgXmlDecode"))for(let c=0;c<n;c++)await new Promise(w=>{setTimeout(()=>{u?.clearRect(0,0,l.width,l.height),m(),w()},c+o)});return e.drawImageCount=0,t.timeEnd("image to canvas"),l}function ml(s,e){const{width:t,height:a,scale:n,backgroundColor:o,maximumCanvasSize:i}=e,l=s.createElement("canvas");l.width=Math.floor(t*n),l.height=Math.floor(a*n),l.style.width=`${t}px`,l.style.height=`${a}px`,i&&(l.width>i||l.height>i)&&(l.width>i&&l.height>i?l.width>l.height?(l.height*=i/l.width,l.width=i):(l.width*=i/l.height,l.height=i):l.width>i?(l.height*=i/l.width,l.width=i):(l.width*=i/l.height,l.height=i));const u=l.getContext("2d");return u&&o&&(u.fillStyle=o,u.fillRect(0,0,l.width,l.height)),{canvas:l,context2d:u}}function wr(s,e){if(s.ownerDocument)try{const o=s.toDataURL();if(o!=="data:,")return ot(o,s.ownerDocument)}catch(o){e.log.warn("Failed to clone canvas",o)}const t=s.cloneNode(!1),a=s.getContext("2d"),n=t.getContext("2d");try{return a&&n&&n.putImageData(a.getImageData(0,0,s.width,s.height),0,0),t}catch(o){e.log.warn("Failed to clone canvas",o)}return t}function gl(s,e){try{if(s?.contentDocument?.body)return Ra(s.contentDocument.body,e)}catch(t){e.log.warn("Failed to clone iframe",t)}return s.cloneNode(!1)}function fl(s){const e=s.cloneNode(!1);return s.currentSrc&&s.currentSrc!==s.src&&(e.src=s.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager"),e}async function hl(s,e){if(s.ownerDocument&&!s.currentSrc&&s.poster)return ot(s.poster,s.ownerDocument);const t=s.cloneNode(!1);t.crossOrigin="anonymous",s.currentSrc&&s.currentSrc!==s.src&&(t.src=s.currentSrc);const a=t.ownerDocument;if(a){let n=!0;if(await Ct(t,{onError:()=>n=!1,onWarn:e.log.warn}),!n)return s.poster?ot(s.poster,s.ownerDocument):t;t.currentTime=s.currentTime,await new Promise(i=>{t.addEventListener("seeked",i,{once:!0})});const o=a.createElement("canvas");o.width=s.offsetWidth,o.height=s.offsetHeight;try{const i=o.getContext("2d");i&&i.drawImage(t,0,0,o.width,o.height)}catch(i){return e.log.warn("Failed to clone video",i),s.poster?ot(s.poster,s.ownerDocument):t}return wr(o,e)}return t}function pl(s,e){return Gi(s)?wr(s,e):Zi(s)?gl(s,e):lt(s)?fl(s):Wt(s)?hl(s,e):s.cloneNode(!1)}function yl(s){let e=s.sandbox;if(!e){const{ownerDocument:t}=s;try{t&&(e=t.createElement("iframe"),e.id=`__SANDBOX__${hr()}`,e.width="0",e.height="0",e.style.visibility="hidden",e.style.position="fixed",t.body.appendChild(e),e.srcdoc='<!DOCTYPE html><meta charset="UTF-8"><title></title><body>',s.sandbox=e)}catch(a){s.log.warn("Failed to getSandBox",a)}}return e}const wl=["width","height","-webkit-text-fill-color"],xl=["stroke","fill"];function xr(s,e,t){const{defaultComputedStyles:a}=t,n=s.nodeName.toLowerCase(),o=Et(s)&&n!=="svg",i=o?xl.map(E=>[E,s.getAttribute(E)]).filter(([,E])=>E!==null):[],l=[o&&"svg",n,i.map((E,R)=>`${E}=${R}`).join(","),e].filter(Boolean).join(":");if(a.has(l))return a.get(l);const m=yl(t)?.contentWindow;if(!m)return new Map;const c=m?.document;let w,y;o?(w=c.createElementNS(Ht,"svg"),y=w.ownerDocument.createElementNS(w.namespaceURI,n),i.forEach(([E,R])=>{y.setAttributeNS(null,E,R)}),w.appendChild(y)):w=y=c.createElement(n),y.textContent=" ",c.body.appendChild(w);const g=m.getComputedStyle(y,e),S=new Map;for(let E=g.length,R=0;R<E;R++){const v=g.item(R);wl.includes(v)||S.set(v,g.getPropertyValue(v))}return c.body.removeChild(w),a.set(l,S),S}function br(s,e,t){const a=new Map,n=[],o=new Map;if(t)for(const l of t)i(l);else for(let l=s.length,u=0;u<l;u++){const m=s.item(u);i(m)}for(let l=n.length,u=0;u<l;u++)o.get(n[u])?.forEach((m,c)=>a.set(c,m));function i(l){const u=s.getPropertyValue(l),m=s.getPropertyPriority(l),c=l.lastIndexOf("-"),w=c>-1?l.substring(0,c):void 0;if(w){let y=o.get(w);y||(y=new Map,o.set(w,y)),y.set(l,[u,m])}e.get(l)===u&&!m||(w?n.push(w):a.set(l,[u,m]))}return a}function bl(s,e,t,a){const{ownerWindow:n,includeStyleProperties:o,currentParentNodeStyle:i}=a,l=e.style,u=n.getComputedStyle(s),m=xr(s,null,a);i?.forEach((w,y)=>{m.delete(y)});const c=br(u,m,o);c.delete("transition-property"),c.delete("all"),c.delete("d"),c.delete("content"),t&&(c.delete("margin-top"),c.delete("margin-right"),c.delete("margin-bottom"),c.delete("margin-left"),c.delete("margin-block-start"),c.delete("margin-block-end"),c.delete("margin-inline-start"),c.delete("margin-inline-end"),c.set("box-sizing",["border-box",""])),c.get("background-clip")?.[0]==="text"&&e.classList.add("______background-clip--text"),mr&&(c.has("font-kerning")||c.set("font-kerning",["normal",""]),(c.get("overflow-x")?.[0]==="hidden"||c.get("overflow-y")?.[0]==="hidden")&&c.get("text-overflow")?.[0]==="ellipsis"&&s.scrollWidth===s.clientWidth&&c.set("text-overflow",["clip",""]));for(let w=l.length,y=0;y<w;y++)l.removeProperty(l.item(y));return c.forEach(([w,y],g)=>{l.setProperty(g,w,y)}),c}function vl(s,e){(Ki(s)||Yi(s)||Xi(s))&&e.setAttribute("value",s.value)}const Cl=[":before",":after"],Sl=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function jl(s,e,t,a,n){const{ownerWindow:o,svgStyleElement:i,svgStyles:l,currentNodeStyle:u}=a;if(!i||!o)return;function m(c){const w=o.getComputedStyle(s,c);let y=w.getPropertyValue("content");if(!y||y==="none")return;n?.(y),y=y.replace(/(')|(")|(counter\(.+\))/g,"");const g=[hr()],S=xr(s,c,a);u?.forEach((f,p)=>{S.delete(p)});const E=br(w,S,a.includeStyleProperties);E.delete("content"),E.delete("-webkit-locale"),E.get("background-clip")?.[0]==="text"&&e.classList.add("______background-clip--text");const R=[`content: '${y}';`];if(E.forEach(([f,p],x)=>{R.push(`${x}: ${f}${p?" !important":""};`)}),R.length===1)return;try{e.className=[e.className,...g].join(" ")}catch(f){a.log.warn("Failed to copyPseudoClass",f);return}const v=R.join(`
  `);let h=l.get(v);h||(h=[],l.set(v,h)),h.push(`.${g[0]}:${c}`)}Cl.forEach(m),t&&Sl.forEach(m)}const za=new Set(["symbol"]);async function Ua(s,e,t,a,n){if(Re(t)&&(qi(t)||Ji(t))||a.filter&&!a.filter(t))return;za.has(e.nodeName)||za.has(t.nodeName)?a.currentParentNodeStyle=void 0:a.currentParentNodeStyle=a.currentNodeStyle;const o=await Ra(t,a,!1,n);a.isEnable("restoreScrollPosition")&&El(s,o),e.appendChild(o)}async function Wa(s,e,t,a){let n=s.firstChild;Re(s)&&s.shadowRoot&&(n=s.shadowRoot?.firstChild,t.shadowRoots.push(s.shadowRoot));for(let o=n;o;o=o.nextSibling)if(!Vi(o))if(Re(o)&&Qi(o)&&typeof o.assignedNodes=="function"){const i=o.assignedNodes();for(let l=0;l<i.length;l++)await Ua(s,e,i[l],t,a)}else await Ua(s,e,o,t,a)}function El(s,e){if(!vt(s)||!vt(e))return;const{scrollTop:t,scrollLeft:a}=s;if(!t&&!a)return;const{transform:n}=e.style,o=new DOMMatrix(n),{a:i,b:l,c:u,d:m}=o;o.a=1,o.b=0,o.c=0,o.d=1,o.translateSelf(-a,-t),o.a=i,o.b=l,o.c=u,o.d=m,e.style.transform=o.toString()}function kl(s,e){const{backgroundColor:t,width:a,height:n,style:o}=e,i=s.style;if(t&&i.setProperty("background-color",t,"important"),a&&i.setProperty("width",`${a}px`,"important"),n&&i.setProperty("height",`${n}px`,"important"),o)for(const l in o)i[l]=o[l]}const Nl=/^[\w-:]+$/;async function Ra(s,e,t=!1,a){const{ownerDocument:n,ownerWindow:o,fontFamilies:i,onCloneEachNode:l}=e;if(n&&Hi(s))return a&&/\S/.test(s.data)&&a(s.data),n.createTextNode(s.data);if(n&&o&&Re(s)&&(vt(s)||Et(s))){const m=await pl(s,e);if(e.isEnable("removeAbnormalAttributes")){const E=m.getAttributeNames();for(let R=E.length,v=0;v<R;v++){const h=E[v];Nl.test(h)||m.removeAttribute(h)}}const c=e.currentNodeStyle=bl(s,m,t,e);t&&kl(m,e);let w=!1;if(e.isEnable("copyScrollbar")){const E=[c.get("overflow-x")?.[0],c.get("overflow-y")?.[0]];w=E.includes("scroll")||(E.includes("auto")||E.includes("overlay"))&&(s.scrollHeight>s.clientHeight||s.scrollWidth>s.clientWidth)}const y=c.get("text-transform")?.[0],g=pr(c.get("font-family")?.[0]),S=g?E=>{y==="uppercase"?E=E.toUpperCase():y==="lowercase"?E=E.toLowerCase():y==="capitalize"&&(E=E[0].toUpperCase()+E.substring(1)),g.forEach(R=>{let v=i.get(R);v||i.set(R,v=new Set),E.split("").forEach(h=>v.add(h))})}:void 0;return jl(s,m,w,e,S),vl(s,m),Wt(s)||await Wa(s,m,e,S),await l?.(m),m}const u=s.cloneNode(!1);return await Wa(s,u,e),await l?.(u),u}function Dl(s){if(s.ownerDocument=void 0,s.ownerWindow=void 0,s.svgStyleElement=void 0,s.svgDefsElement=void 0,s.svgStyles.clear(),s.defaultComputedStyles.clear(),s.sandbox){try{s.sandbox.remove()}catch(e){s.log.warn("Failed to destroyContext",e)}s.sandbox=void 0}s.workers=[],s.fontFamilies.clear(),s.fontCssTexts.clear(),s.requests.clear(),s.tasks=[],s.shadowRoots=[]}function Rl(s){const{url:e,timeout:t,responseType:a,...n}=s,o=new AbortController,i=t?setTimeout(()=>o.abort(),t):void 0;return fetch(e,{signal:o.signal,...n}).then(l=>{if(!l.ok)throw new Error("Failed fetch, not 2xx response",{cause:l});switch(a){case"arrayBuffer":return l.arrayBuffer();case"dataUrl":return l.blob().then(nl);case"text":default:return l.text()}}).finally(()=>clearTimeout(i))}function St(s,e){const{url:t,requestType:a="text",responseType:n="text",imageDom:o}=e;let i=t;const{timeout:l,acceptOfImage:u,requests:m,fetchFn:c,fetch:{requestInit:w,bypassingCache:y,placeholderImage:g},font:S,workers:E,fontFamilies:R}=s;a==="image"&&($t||Da)&&s.drawImageCount++;let v=m.get(t);if(!v){y&&y instanceof RegExp&&y.test(i)&&(i+=(/\?/.test(i)?"&":"?")+new Date().getTime());const h=a.startsWith("font")&&S&&S.minify,f=new Set;h&&a.split(";")[1].split(",").forEach(D=>{R.has(D)&&R.get(D).forEach(j=>f.add(j))});const p=h&&f.size,x={url:i,timeout:l,responseType:p?"arrayBuffer":n,headers:a==="image"?{accept:u}:void 0,...w};v={type:a,resolve:void 0,reject:void 0,response:null},v.response=(async()=>{if(c&&a==="image"){const C=await c(t);if(C)return C}return!$t&&t.startsWith("http")&&E.length?new Promise((C,D)=>{E[m.size&E.length-1].postMessage({rawUrl:t,...x}),v.resolve=C,v.reject=D}):Rl(x)})().catch(C=>{if(m.delete(t),a==="image"&&g)return s.log.warn("Failed to fetch image base64, trying to use placeholder image",i),typeof g=="string"?g:g(o);throw C}),m.set(t,v)}return v.response}async function vr(s,e,t,a){if(!Cr(s))return s;for(const[n,o]of Tl(s,e))try{const i=await St(t,{url:o,requestType:a?"image":"text",responseType:"dataUrl"});s=s.replace(Al(n),`$1${i}$3`)}catch(i){t.log.warn("Failed to fetch css data url",n,i)}return s}function Cr(s){return/url\((['"]?)([^'"]+?)\1\)/.test(s)}const Sr=/url\((['"]?)([^'"]+?)\1\)/g;function Tl(s,e){const t=[];return s.replace(Sr,(a,n,o)=>(t.push([o,fr(o,e)]),a)),t.filter(([a])=>!ya(a))}function Al(s){const e=s.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}const Il=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function _l(s,e){return Il.map(t=>{const a=s.getPropertyValue(t);return!a||a==="none"?null:(($t||Da)&&e.drawImageCount++,vr(a,null,e,!0).then(n=>{!n||a===n||s.setProperty(t,n,s.getPropertyPriority(t))}))}).filter(Boolean)}function Ml(s,e){if(lt(s)){const t=s.currentSrc||s.src;if(!ya(t))return[St(e,{url:t,imageDom:s,requestType:"image",responseType:"dataUrl"}).then(a=>{a&&(s.srcset="",s.dataset.originalSrc=t,s.src=a||"")})];($t||Da)&&e.drawImageCount++}else if(Et(s)&&!ya(s.href.baseVal)){const t=s.href.baseVal;return[St(e,{url:t,imageDom:s,requestType:"image",responseType:"dataUrl"}).then(a=>{a&&(s.dataset.originalSrc=t,s.href.baseVal=a||"")})]}return[]}function Fl(s,e){const{ownerDocument:t,svgDefsElement:a}=e,n=s.getAttribute("href")??s.getAttribute("xlink:href");if(!n)return[];const[o,i]=n.split("#");if(i){const l=`#${i}`,u=e.shadowRoots.reduce((m,c)=>m??c.querySelector(`svg ${l}`),t?.querySelector(`svg ${l}`));if(o&&s.setAttribute("href",l),a?.querySelector(l))return[];if(u)return a?.appendChild(u.cloneNode(!0)),[];if(o)return[St(e,{url:o,responseType:"text"}).then(m=>{a?.insertAdjacentHTML("beforeend",m)})]}return[]}function jr(s,e){const{tasks:t}=e;Re(s)&&((lt(s)||gr(s))&&t.push(...Ml(s,e)),Wi(s)&&t.push(...Fl(s,e))),vt(s)&&t.push(..._l(s.style,e)),s.childNodes.forEach(a=>{jr(a,e)})}async function Ol(s,e){const{ownerDocument:t,svgStyleElement:a,fontFamilies:n,fontCssTexts:o,tasks:i,font:l}=e;if(!(!t||!a||!n.size))if(l&&l.cssText){const u=Ha(l.cssText,e);a.appendChild(t.createTextNode(`${u}
`))}else{const u=Array.from(t.styleSheets).filter(c=>{try{return"cssRules"in c&&!!c.cssRules.length}catch(w){return e.log.warn(`Error while reading CSS rules from ${c.href}`,w),!1}});await Promise.all(u.flatMap(c=>Array.from(c.cssRules).map(async(w,y)=>{if(Ui(w)){let g=y+1;const S=w.href;let E="";try{E=await St(e,{url:S,requestType:"text",responseType:"text"})}catch(v){e.log.warn(`Error fetch remote css import from ${S}`,v)}const R=E.replace(Sr,(v,h,f)=>v.replace(f,fr(f,S)));for(const v of Ll(R))try{c.insertRule(v,v.startsWith("@import")?g+=1:c.cssRules.length)}catch(h){e.log.warn("Error inserting rule from remote css import",{rule:v,error:h})}}}))),u.flatMap(c=>Array.from(c.cssRules)).filter(c=>zi(c)&&Cr(c.style.getPropertyValue("src"))&&pr(c.style.getPropertyValue("font-family"))?.some(w=>n.has(w))).forEach(c=>{const w=c,y=o.get(w.cssText);y?a.appendChild(t.createTextNode(`${y}
`)):i.push(vr(w.cssText,w.parentStyleSheet?w.parentStyleSheet.href:null,e).then(g=>{g=Ha(g,e),o.set(w.cssText,g),a.appendChild(t.createTextNode(`${g}
`))}))})}}const Pl=/(\/\*[\s\S]*?\*\/)/g,Va=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function Ll(s){if(s==null)return[];const e=[];let t=s.replace(Pl,"");for(;;){const o=Va.exec(t);if(!o)break;e.push(o[0])}t=t.replace(Va,"");const a=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,n=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let o=a.exec(t);if(o)n.lastIndex=a.lastIndex;else if(o=n.exec(t),o)a.lastIndex=n.lastIndex;else break;e.push(o[0])}return e}const $l=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Bl=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Ha(s,e){const{font:t}=e,a=t?t?.preferredFormat:void 0;return a?s.replace(Bl,n=>{for(;;){const[o,,i]=$l.exec(n)||[];if(!i)return"";if(i===a)return`src: ${o};`}}):s}async function zl(s,e){const t=await Gt(s,e);if(Re(t.node)&&Et(t.node))return t.node;const{ownerDocument:a,log:n,tasks:o,svgStyleElement:i,svgDefsElement:l,svgStyles:u,font:m,progress:c,autoDestruct:w,onCloneNode:y,onEmbedNode:g,onCreateForeignObjectSvg:S}=t;n.time("clone node");const E=await Ra(t.node,t,!0);if(i&&a){let p="";u.forEach((x,C)=>{p+=`${x.join(`,
`)} {
  ${C}
}
`}),i.appendChild(a.createTextNode(p))}n.timeEnd("clone node"),await y?.(E),m!==!1&&Re(E)&&(n.time("embed web font"),await Ol(E,t),n.timeEnd("embed web font")),n.time("embed node"),jr(E,t);const R=o.length;let v=0;const h=async()=>{for(;;){const p=o.pop();if(!p)break;try{await p}catch(x){t.log.warn("Failed to run task",x)}c?.(++v,R)}};c?.(v,R),await Promise.all([...Array.from({length:4})].map(h)),n.timeEnd("embed node"),await g?.(E);const f=Ul(E,t);return l&&f.insertBefore(l,f.children[0]),i&&f.insertBefore(i,f.children[0]),w&&Dl(t),await S?.(f),f}function Ul(s,e){const{width:t,height:a}=e,n=al(t,a,s.ownerDocument),o=n.ownerDocument.createElementNS(n.namespaceURI,"foreignObject");return o.setAttributeNS(null,"x","0%"),o.setAttributeNS(null,"y","0%"),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.append(s),n.appendChild(o),n}async function Wl(s,e){const t=await Gt(s,e),a=await zl(t),n=sl(a,t.isEnable("removeControlCharacter"));t.autoDestruct||(t.svgStyleElement=yr(t.ownerDocument),t.svgDefsElement=t.ownerDocument?.createElementNS(Ht,"defs"),t.svgStyles.clear());const o=ot(n,a.ownerDocument);return await ul(o,t)}async function Vl(s,e){const t=await Gt(s,e),{log:a,quality:n,type:o,dpi:i}=t,l=await Wl(t);a.time("canvas to data url");let u=l.toDataURL(o,n);if(["image/png","image/jpeg"].includes(o)&&i&&Li&&$i){const[m,c]=u.split(",");let w=0,y=!1;if(o==="image/png"){const f=Oi(c);f>=0?(w=Math.ceil((f+28)/3)*4,y=!0):w=33/3*4}else o==="image/jpeg"&&(w=18/3*4);const g=c.substring(0,w),S=c.substring(w),E=window.atob(g),R=new Uint8Array(E.length);for(let f=0;f<R.length;f++)R[f]=E.charCodeAt(f);const v=o==="image/png"?Ii(R,i,y):Di(R,i),h=window.btoa(String.fromCharCode(...v));u=[m,",",h,S].join("")}return a.timeEnd("canvas to data url"),u}async function Hl(s,e){return Vl(await Gt(s,{...e,type:"image/png"}))}function Gl(s,e=30){if(!s||s.trim()==="")return"untitled-card";let t=s.replace(/[^\w\s\u4e00-\u9fff\u3400-\u4dbf\u20000-\u2a6df\u2a700-\u2b73f\u2b740-\u2b81f\u2b820-\u2ceaf\uf900-\ufaff\u3300-\u33ff-]/g,"").replace(/\s+/g," ").trim();return t?(t.length>e&&(t=t.substring(0,e).trim()),t):"untitled-card"}async function Kl(s,e={}){const{quality:t=1,pixelRatio:a=2,backgroundColor:n="transparent",includeStyles:o=!0}=e;try{const i=await Hl(s,{quality:t,pixelRatio:a,backgroundColor:n,style:o?void 0:{},filter:u=>{if(u instanceof HTMLElement){const m=u.classList;return!m.contains("tooltip")&&!m.contains("dropdown-menu")&&!m.contains("popover")}return!0}});return await(await fetch(i)).blob()}catch(i){throw console.error("Screenshot capture failed:",i),new Error("Failed to capture screenshot")}}function Yl(s,e){const t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`${e}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}async function ql(s,e,t={}){const a=Gl(e);return{blob:await Kl(s,{quality:1,pixelRatio:2,backgroundColor:"transparent",...t}),fileName:a}}function Jl(s={}){const[e,t]=d.useState(!1),[a,n]=d.useState(!1),[o,i]=d.useState(null),[l,u]=d.useState(!1),[m,c]=d.useState(null),w=d.useCallback(async(E,R)=>{t(!0),c(null);try{const{blob:v,fileName:h}=await ql(E,R),f=URL.createObjectURL(v);i({blob:v,fileName:h,previewUrl:f}),u(!0)}catch(v){const h=v instanceof Error?v:new Error("Screenshot failed");c(h.message),s.onError?.(h)}finally{t(!1)}},[s]),y=d.useCallback(async()=>{if(o){n(!0);try{await new Promise(E=>setTimeout(E,500)),Yl(o.blob,o.fileName),s.onSuccess?.(o.fileName),u(!1),setTimeout(()=>{o.previewUrl&&URL.revokeObjectURL(o.previewUrl),i(null)},100)}catch(E){const R=E instanceof Error?E:new Error("Download failed");c(R.message),s.onError?.(R)}finally{n(!1)}}},[o,s]),g=d.useCallback(()=>{u(!1),setTimeout(()=>{o?.previewUrl&&URL.revokeObjectURL(o.previewUrl),i(null)},100)},[o]),S=d.useCallback(()=>{c(null)},[]);return{isCapturing:e,isDownloading:a,showPreview:l,previewData:o,error:m,captureScreenshot:w,confirmDownload:y,cancelPreview:g,clearError:S}}function Xl({isOpen:s,onClose:e,onConfirm:t,previewUrl:a,fileName:n,isDownloading:o=!1}){const[i,l]=d.useState(!1),u=()=>{l(!0),setTimeout(()=>{t(),l(!1)},800)};return r.jsx(jt,{open:s,onOpenChange:e,children:r.jsxs(ct,{className:"max-w-2xl max-h-[90vh] overflow-hidden",children:[r.jsx(dt,{children:r.jsxs(mt,{className:"flex items-center gap-2",children:[r.jsx(ca,{className:"h-5 w-5"}),"Screenshot Preview"]})}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(ue,{variant:"secondary",className:"font-mono text-xs",children:[n,".png"]}),r.jsx(ue,{variant:"outline",className:"text-xs",children:"High Quality"})]})}),r.jsx("div",{className:"relative bg-checkered rounded-lg overflow-hidden border",children:a?r.jsxs("div",{className:"relative",children:[r.jsx("img",{src:a,alt:"Screenshot preview",className:M("w-full h-auto max-h-[60vh] object-contain transition-all duration-300",i&&"scale-95 opacity-80")}),i&&r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-600/20 flex items-center justify-center",children:r.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-full p-6 shadow-lg animate-pulse",children:r.jsxs("div",{className:"relative",children:[r.jsx(rt,{className:"h-8 w-8 text-blue-600 animate-bounce"}),r.jsx(Ia,{className:"h-4 w-4 text-purple-500 absolute -top-1 -right-1 animate-spin"})]})})})]}):r.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:r.jsxs("div",{className:"text-center space-y-2",children:[r.jsx(ca,{className:"h-12 w-12 mx-auto opacity-50"}),r.jsx("p",{children:"Loading preview..."})]})})}),o&&r.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"}),"Preparing download..."]})]}),r.jsxs(ut,{className:"gap-2",children:[r.jsxs(G,{variant:"outline",onClick:e,disabled:i||o,children:[r.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Cancel"]}),r.jsx(G,{onClick:u,disabled:i||o||!a,className:M("relative overflow-hidden",i&&"bg-gradient-to-r from-blue-500 to-purple-600"),children:i?r.jsxs(r.Fragment,{children:[r.jsx(Ia,{className:"h-4 w-4 mr-2 animate-spin"}),"Downloading..."]}):r.jsxs(r.Fragment,{children:[r.jsx(rt,{className:"h-4 w-4 mr-2"}),"Download PNG"]})})]})]})})}const Ql=`
.bg-checkered {
  background-image: 
    linear-gradient(45deg, #f1f5f9 25%, transparent 25%), 
    linear-gradient(-45deg, #f1f5f9 25%, transparent 25%), 
    linear-gradient(45deg, transparent 75%, #f1f5f9 75%), 
    linear-gradient(-45deg, transparent 75%, #f1f5f9 75%);
  background-size: 20px 20px;
  background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
}
`;if(typeof document<"u"){const s=document.createElement("style");s.textContent=Ql,document.head.appendChild(s)}const Zl=1,ec=1e6;let na=0;function tc(){return na=(na+1)%Number.MAX_SAFE_INTEGER,na.toString()}const oa=new Map,Ga=s=>{if(oa.has(s))return;const e=setTimeout(()=>{oa.delete(s),bt({type:"REMOVE_TOAST",toastId:s})},ec);oa.set(s,e)},ac=(s,e)=>{switch(e.type){case"ADD_TOAST":return{...s,toasts:[e.toast,...s.toasts].slice(0,Zl)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?Ga(t):s.toasts.forEach(a=>{Ga(a.id)}),{...s,toasts:s.toasts.map(a=>a.id===t||t===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return e.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==e.toastId)}}},Ot=[];let Pt={toasts:[]};function bt(s){Pt=ac(Pt,s),Ot.forEach(e=>{e(Pt)})}function sc({...s}){const e=tc(),t=n=>bt({type:"UPDATE_TOAST",toast:{...n,id:e}}),a=()=>bt({type:"DISMISS_TOAST",toastId:e});return bt({type:"ADD_TOAST",toast:{...s,id:e,open:!0,onOpenChange:n=>{n||a()}}}),{id:e,dismiss:a,update:t}}function rc(){const[s,e]=d.useState(Pt);return d.useEffect(()=>(Ot.push(e),()=>{const t=Ot.indexOf(e);t>-1&&Ot.splice(t,1)}),[s]),{...s,toast:sc,dismiss:t=>bt({type:"DISMISS_TOAST",toastId:t})}}const Er=nn,kr=on,nc=d.forwardRef(({className:s,inset:e,children:t,...a},n)=>r.jsxs(ys,{ref:n,className:M("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e&&"pl-8",s),...a,children:[t,r.jsx(ba,{className:"ml-auto h-4 w-4"})]}));nc.displayName=ys.displayName;const oc=d.forwardRef(({className:s,...e},t)=>r.jsx(ws,{ref:t,className:M("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...e}));oc.displayName=ws.displayName;const Ta=d.forwardRef(({className:s,...e},t)=>r.jsx(rn,{children:r.jsx(xs,{ref:t,className:M("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...e})}));Ta.displayName=xs.displayName;const it=d.forwardRef(({className:s,inset:e,...t},a)=>r.jsx(bs,{ref:a,className:M("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e&&"pl-8",s),...t}));it.displayName=bs.displayName;const ic=d.forwardRef(({className:s,children:e,checked:t,...a},n)=>r.jsxs(vs,{ref:n,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...a,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Cs,{children:r.jsx(Be,{className:"h-4 w-4"})})}),e]}));ic.displayName=vs.displayName;const lc=d.forwardRef(({className:s,children:e,...t},a)=>r.jsxs(Ss,{ref:a,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Cs,{children:r.jsx(Bs,{className:"h-2 w-2 fill-current"})})}),e]}));lc.displayName=Ss.displayName;const cc=d.forwardRef(({className:s,inset:e,...t},a)=>r.jsx(js,{ref:a,className:M("px-2 py-1.5 text-sm font-semibold text-foreground",e&&"pl-8",s),...t}));cc.displayName=js.displayName;const Nr=d.forwardRef(({className:s,...e},t)=>r.jsx(Es,{ref:t,className:M("-mx-1 my-1 h-px bg-border",s),...e}));Nr.displayName=Es.displayName;function Ka({children:s,folderId:e,folderName:t,onRename:a,onDelete:n,onCreateSubfolder:o,disabled:i=!1}){return i?r.jsx(r.Fragment,{children:s}):r.jsxs(Er,{children:[r.jsx(kr,{asChild:!0,children:s}),r.jsxs(Ta,{className:"w-48",children:[r.jsxs(it,{onClick:()=>a(e),children:[r.jsx(Vs,{className:"h-4 w-4 mr-2"}),"Rename Folder"]}),r.jsxs(it,{onClick:()=>o(e),children:[r.jsx(da,{className:"h-4 w-4 mr-2"}),"New Subfolder"]}),r.jsx(Nr,{}),r.jsxs(it,{onClick:()=>n(e),className:"text-destructive focus:text-destructive",children:[r.jsx(va,{className:"h-4 w-4 mr-2"}),"Delete Folder"]})]})]})}const dc=gn,uc=fn,Dr=d.forwardRef(({className:s,children:e,...t},a)=>r.jsxs(ks,{ref:a,className:M("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[e,r.jsx(ln,{asChild:!0,children:r.jsx(Hs,{className:"h-4 w-4 opacity-50"})})]}));Dr.displayName=ks.displayName;const Rr=d.forwardRef(({className:s,...e},t)=>r.jsx(Ns,{ref:t,className:M("flex cursor-default items-center justify-center py-1",s),...e,children:r.jsx(Dn,{className:"h-4 w-4"})}));Rr.displayName=Ns.displayName;const Tr=d.forwardRef(({className:s,...e},t)=>r.jsx(Ds,{ref:t,className:M("flex cursor-default items-center justify-center py-1",s),...e,children:r.jsx(Hs,{className:"h-4 w-4"})}));Tr.displayName=Ds.displayName;const Ar=d.forwardRef(({className:s,children:e,position:t="popper",...a},n)=>r.jsx(cn,{children:r.jsxs(Rs,{ref:n,className:M("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...a,children:[r.jsx(Rr,{}),r.jsx(dn,{className:M("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),r.jsx(Tr,{})]})}));Ar.displayName=Rs.displayName;const mc=d.forwardRef(({className:s,...e},t)=>r.jsx(Ts,{ref:t,className:M("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...e}));mc.displayName=Ts.displayName;const Ir=d.forwardRef(({className:s,children:e,...t},a)=>r.jsxs(As,{ref:a,className:M("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(un,{children:r.jsx(Be,{className:"h-4 w-4"})})}),r.jsx(mn,{children:e})]}));Ir.displayName=As.displayName;const gc=d.forwardRef(({className:s,...e},t)=>r.jsx(Is,{ref:t,className:M("-mx-1 my-1 h-px bg-muted",s),...e}));gc.displayName=Is.displayName;const fc=[{value:"#3b82f6",label:"Blue"},{value:"#8b5cf6",label:"Purple"},{value:"#10b981",label:"Green"},{value:"#f59e0b",label:"Orange"},{value:"#ef4444",label:"Red"},{value:"#06b6d4",label:"Cyan"},{value:"#84cc16",label:"Lime"},{value:"#f97316",label:"Orange"}],ia=[{value:"Folder",label:"Folder",icon:$e},{value:"Code",label:"Code",icon:Rn},{value:"Palette",label:"Design",icon:Us},{value:"BookOpen",label:"Learning",icon:Tn},{value:"Star",label:"Favorites",icon:An},{value:"Heart",label:"Personal",icon:In},{value:"Zap",label:"Quick",icon:Gs},{value:"Target",label:"Goals",icon:_n},{value:"Lightbulb",label:"Ideas",icon:Mn},{value:"Coffee",label:"Work",icon:Fn}];function hc({isOpen:s,onClose:e,onConfirm:t,parentId:a,initialData:n,mode:o="create"}){const[i,l]=d.useState(""),[u,m]=d.useState("#3b82f6"),[c,w]=d.useState("Folder");d.useEffect(()=>{s&&(n?(l(n.name),m(n.color),w(n.icon)):(l(""),m("#3b82f6"),w("Folder")))},[s]),d.useEffect(()=>{s&&n&&(l(n.name),m(n.color),w(n.icon))},[n,s]);const y=S=>{S.preventDefault(),i.trim()&&(t({name:i.trim(),color:u,icon:c,parentId:a}),e())},g=ia.find(S=>S.value===c)?.icon||$e;return r.jsx(jt,{open:s,onOpenChange:e,children:r.jsxs(ct,{className:"sm:max-w-md",children:[r.jsxs(dt,{children:[r.jsx(mt,{children:o==="create"?"Create New Folder":"Edit Folder"}),r.jsx(Ut,{children:o==="create"?"Create a new folder to organize your cards.":"Update folder details."})]}),r.jsxs("form",{onSubmit:y,className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(Ge,{htmlFor:"folder-name",children:"Folder Name"}),r.jsx(Ke,{id:"folder-name",value:i,onChange:S=>l(S.target.value),placeholder:"Enter folder name...",autoFocus:!0})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Ge,{children:"Color"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:fc.map(S=>r.jsx("button",{type:"button",onClick:()=>m(S.value),className:`w-8 h-8 rounded-full border-2 transition-all ${u===S.value?"border-foreground scale-110":"border-muted hover:scale-105"}`,style:{backgroundColor:S.value},title:S.label},S.value))})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Ge,{children:"Icon"}),r.jsxs(dc,{value:c,onValueChange:w,children:[r.jsx(Dr,{children:r.jsx(uc,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[O.createElement(g,{className:"h-4 w-4",style:{color:u}}),ia.find(S=>S.value===c)?.label]})})}),r.jsx(Ar,{children:ia.map(S=>{const E=S.icon;return r.jsx(Ir,{value:S.value,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(E,{className:"h-4 w-4"}),S.label]})},S.value)})})]})]}),a&&r.jsx("div",{className:"flex items-center gap-2",children:r.jsx(ue,{variant:"secondary",children:"Subfolder"})}),r.jsxs(ut,{children:[r.jsx(G,{type:"button",variant:"outline",onClick:e,children:"Cancel"}),r.jsx(G,{type:"submit",disabled:!i.trim(),children:o==="create"?"Create Folder":"Save Changes"})]})]})]})})}const pc=pn,yc=hn,_r=d.forwardRef(({className:s,...e},t)=>r.jsx(_s,{className:M("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...e,ref:t}));_r.displayName=_s.displayName;const Mr=d.forwardRef(({className:s,...e},t)=>r.jsxs(yc,{children:[r.jsx(_r,{}),r.jsx(Ms,{ref:t,className:M("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...e})]}));Mr.displayName=Ms.displayName;const Fr=({className:s,...e})=>r.jsx("div",{className:M("flex flex-col space-y-2 text-center sm:text-left",s),...e});Fr.displayName="AlertDialogHeader";const Or=({className:s,...e})=>r.jsx("div",{className:M("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...e});Or.displayName="AlertDialogFooter";const Pr=d.forwardRef(({className:s,...e},t)=>r.jsx(Fs,{ref:t,className:M("text-lg font-semibold",s),...e}));Pr.displayName=Fs.displayName;const Lr=d.forwardRef(({className:s,...e},t)=>r.jsx(Os,{ref:t,className:M("text-sm text-muted-foreground",s),...e}));Lr.displayName=Os.displayName;const $r=d.forwardRef(({className:s,...e},t)=>r.jsx(Ps,{ref:t,className:M(ja(),s),...e}));$r.displayName=Ps.displayName;const Br=d.forwardRef(({className:s,...e},t)=>r.jsx(Ls,{ref:t,className:M(ja({variant:"outline"}),"mt-2 sm:mt-0",s),...e}));Br.displayName=Ls.displayName;function wc({isOpen:s,onClose:e,onConfirm:t,folderName:a,cardCount:n,hasSubfolders:o=!1,subfolderCount:i=0}){const l=()=>{t(),e()};return r.jsx(pc,{open:s,onOpenChange:e,children:r.jsxs(Mr,{children:[r.jsxs(Fr,{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(nt,{className:"h-5 w-5 text-destructive"}),r.jsx(Pr,{children:"Delete Folder"})]}),r.jsxs(Lr,{className:"space-y-3",children:[r.jsxs("p",{children:["Are you sure you want to delete the folder ",r.jsxs("strong",{children:['"',a,'"']}),"?"]}),r.jsxs("div",{className:"bg-destructive/10 p-3 rounded-lg space-y-2",children:[r.jsx("p",{className:"text-sm font-medium text-destructive",children:"This action will permanently delete:"}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[n>0&&r.jsxs(ue,{variant:"destructive",children:[n," card",n!==1?"s":""]}),o&&i>0&&r.jsxs(ue,{variant:"destructive",children:[i," subfolder",i!==1?"s":""]})]})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone."})]})]}),r.jsxs(Or,{children:[r.jsx(Br,{children:"Cancel"}),r.jsx($r,{onClick:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Forever"})]})]})})}function xc({children:s,tagName:e,onRename:t,onDelete:a,disabled:n=!1}){const o=()=>{n||t(e)},i=()=>{n||a(e)};return n?r.jsx(r.Fragment,{children:s}):r.jsxs(Er,{children:[r.jsx(kr,{asChild:!0,children:s}),r.jsxs(Ta,{className:"w-48",children:[r.jsxs(it,{onClick:o,className:"flex items-center gap-2",children:[r.jsx(Vs,{className:"h-4 w-4"}),"Rename Tag"]}),r.jsxs(it,{onClick:i,className:"flex items-center gap-2 text-destructive focus:text-destructive",children:[r.jsx(va,{className:"h-4 w-4"}),"Delete Tag"]})]})]})}function bc({isOpen:s,onClose:e,onConfirm:t,tagName:a,existingTags:n}){const[o,i]=d.useState(""),[l,u]=d.useState("");d.useEffect(()=>{s&&(i(a),u(""))},[s,a]);const m=y=>{const g=y.trim();return g?g===a?"Please enter a different name":n.includes(g)?"A tag with this name already exists":g.length>50?"Tag name must be less than 50 characters":"":"Tag name cannot be empty"},c=()=>{const y=o.trim(),g=m(y);if(g){u(g);return}t(a,y),e()},w=y=>{y.key==="Enter"&&c()};return r.jsx(jt,{open:s,onOpenChange:e,children:r.jsxs(ct,{className:"sm:max-w-md",children:[r.jsxs(dt,{children:[r.jsx(mt,{children:"Rename Tag"}),r.jsxs(Ut,{children:['Enter a new name for the tag "',a,'". This will update all cards using this tag.']})]}),r.jsx("div",{className:"space-y-4 py-4",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx(Ge,{htmlFor:"tag-name",children:"Tag Name"}),r.jsx(Ke,{id:"tag-name",value:o,onChange:y=>{i(y.target.value),l&&u("")},onKeyPress:w,placeholder:"Enter tag name...",autoFocus:!0}),l&&r.jsxs("div",{className:"flex items-center gap-2 text-sm text-destructive",children:[r.jsx(ua,{className:"h-4 w-4"}),l]})]})}),r.jsxs(ut,{children:[r.jsx(G,{variant:"outline",onClick:e,children:"Cancel"}),r.jsx(G,{onClick:c,disabled:!!l||!o.trim(),children:"Rename Tag"})]})]})})}function vc({isOpen:s,onClose:e,onConfirm:t,tagName:a,cardCount:n}){return r.jsx(jt,{open:s,onOpenChange:e,children:r.jsxs(ct,{className:"sm:max-w-md",children:[r.jsxs(dt,{children:[r.jsxs(mt,{className:"flex items-center gap-2",children:[r.jsx(nt,{className:"h-5 w-5 text-destructive"}),"Delete Tag"]}),r.jsxs(Ut,{children:['Are you sure you want to delete the tag "',a,'"?']})]}),r.jsx("div",{className:"py-4",children:r.jsxs("div",{className:"rounded-lg bg-destructive/10 p-4 border border-destructive/20",children:[r.jsx("p",{className:"text-sm text-destructive font-medium mb-2",children:"This action cannot be undone."}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:["This tag will be removed from ",r.jsx("strong",{children:n})," ",n===1?"card":"cards","."]})]})}),r.jsxs(ut,{children:[r.jsx(G,{variant:"outline",onClick:e,children:"Cancel"}),r.jsx(G,{variant:"destructive",onClick:t,children:"Delete Tag"})]})]})})}const Cc=({tag:s,isSelected:e,onClick:t,className:a,showCount:n=!0})=>r.jsxs("button",{onClick:()=>t(s),className:M("relative flex items-center justify-between px-3 py-2 rounded-xl border transition-all duration-300 ease-out","hover:shadow-lg hover:shadow-black/10 active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-blue-500/30","backdrop-blur-sm group",e?"bg-gradient-to-r from-blue-500 to-blue-600 border-blue-500 text-white shadow-md shadow-blue-500/25":"bg-white/80 border-gray-200/60 text-gray-700 hover:bg-white hover:border-gray-300/80",a),style:{boxShadow:e?"0 4px 20px -4px rgba(59, 130, 246, 0.3), 0 0 0 1px rgba(59, 130, 246, 0.1)":void 0},children:[r.jsxs("div",{className:"flex items-center gap-2.5 flex-1 min-w-0",children:[r.jsx("div",{className:M("w-2 h-2 rounded-full flex-shrink-0 transition-all duration-300",e?"bg-white/90 shadow-sm":"shadow-sm"),style:{backgroundColor:e?"rgba(255, 255, 255, 0.9)":s.color,boxShadow:e?"0 1px 3px rgba(0, 0, 0, 0.1)":`0 1px 3px ${s.color}40`}}),r.jsx("span",{className:M("text-sm font-medium truncate transition-all duration-300",e?"text-white":"text-gray-700 group-hover:text-gray-900"),children:s.name}),e&&r.jsx(Be,{className:"w-3.5 h-3.5 text-white/90 flex-shrink-0 animate-in fade-in-0 zoom-in-95 duration-200"})]}),n&&r.jsx("span",{className:M("text-xs font-medium px-2 py-0.5 rounded-full ml-2 flex-shrink-0 transition-all duration-300",e?"text-blue-600 bg-white/90 shadow-sm":"text-gray-500 bg-gray-100/80 group-hover:bg-gray-200/80 group-hover:text-gray-600"),children:s.count})]}),Sc=({tags:s,selectedTags:e,onTagClick:t,className:a,emptyMessage:n="No tags found"})=>s.length===0?r.jsx("div",{className:M("text-center py-8 text-gray-500",a),children:r.jsx("p",{className:"text-sm",children:n})}):r.jsx("div",{className:M("grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",a),children:s.map(o=>r.jsx(Cc,{tag:o,isSelected:e.includes(o.name),onClick:t},o.id))}),jc=({onSearch:s,onCreateTag:e,searchResults:t,searchQuery:a,className:n})=>{const[o,i]=d.useState(a);d.useEffect(()=>{i(a)},[a]);const l=c=>{const w=c.target.value;i(w),s(w)},u=()=>{o.trim()&&(e(o.trim()),i(""),s(""))},m=o.trim()&&t.length===0&&!t.some(c=>c.name.toLowerCase()===o.toLowerCase());return r.jsxs("div",{className:M("space-y-3",n),children:[r.jsxs("div",{className:"relative",children:[r.jsx(xt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx(Ke,{placeholder:"Search tags or create new...",value:o,onChange:l,className:"pl-11 pr-4 py-3 rounded-2xl border-gray-200/60 bg-gray-50/50 backdrop-blur-sm focus:bg-white focus:border-blue-300 transition-all duration-300"})]}),m&&r.jsxs(G,{onClick:u,variant:"outline",className:"w-full justify-start text-left rounded-xl border-dashed border-2 border-gray-300 hover:border-blue-400 hover:bg-blue-50/50 transition-all duration-300 py-3",children:[r.jsx(Mt,{className:"h-4 w-4 mr-2 text-blue-500"}),r.jsxs("span",{className:"text-gray-700",children:['Create tag "',r.jsx("span",{className:"font-medium text-blue-600",children:o}),'"']})]})]})},Ec=({isOpen:s,onClose:e,currentCardTags:t,onTagsChange:a})=>{const{tags:n,searchTags:o,dispatch:i,createTagIfNotExists:l}=Xs(),[u,m]=d.useState(""),[c,w]=d.useState([]),[y,g]=d.useState(t);d.useEffect(()=>{if(u.trim()){const h=o(u);w(h)}else{const h=[...n].sort((f,p)=>p.count-f.count);w(h)}},[u,n,o]),d.useEffect(()=>{g(t)},[t]);const S=h=>{m(h)},E=h=>{i({type:"CREATE_TAG",payload:{name:h,color:"#3b82f6"}});const f=[...y,h];g(f),a(f),m("")},R=h=>{const f=y.includes(h.name);let p;f?p=y.filter(x=>x!==h.name):p=[...y,h.name],g(p),a(p)},v=()=>{m(""),e()};return s?r.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.15)",backdropFilter:"blur(8px)"},children:[r.jsx("div",{className:"absolute inset-0",onClick:v}),r.jsxs("div",{className:"relative bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200/50 p-6 w-full max-w-sm sm:max-w-md lg:max-w-2xl max-h-[85vh] flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Manage Tags"}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Select tags for this card"})]}),r.jsx("button",{onClick:v,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:r.jsx(Ye,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx(jc,{onSearch:S,onCreateTag:E,searchResults:c,searchQuery:u,className:"mb-4"}),y.length>0&&r.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100/50",children:[r.jsxs("p",{className:"text-sm font-medium text-blue-700 mb-3",children:["Selected tags (",y.length,"):"]}),r.jsx("div",{className:"flex flex-wrap gap-1.5",children:y.map(h=>r.jsx("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-sm",children:h},h))})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx(Sc,{tags:c,selectedTags:y,onTagClick:R,emptyMessage:u?`No tags found for "${u}"`:"No tags available"})}),r.jsx("div",{className:"text-xs text-gray-400 text-center mt-4 pt-4 border-t border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-300"}),r.jsx("span",{children:"Click tags to add/remove them from this card"}),r.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-300"})]})})]})]}):null},kc=()=>{const{isOpen:s,currentCardTags:e,onTagsChange:t,closeTagPanel:a}=tr();return!s||!t?null:r.jsx(Ec,{isOpen:s,onClose:a,currentCardTags:e,onTagsChange:t})},ke=d.forwardRef(({className:s,...e},t)=>r.jsx("div",{ref:t,className:M("rounded-lg border bg-card text-card-foreground shadow-sm",s),...e}));ke.displayName="Card";const Kt=d.forwardRef(({className:s,...e},t)=>r.jsx("div",{ref:t,className:M("flex flex-col space-y-1.5 p-6",s),...e}));Kt.displayName="CardHeader";const Yt=d.forwardRef(({className:s,...e},t)=>r.jsx("div",{ref:t,className:M("text-2xl font-semibold leading-none tracking-tight",s),...e}));Yt.displayName="CardTitle";const zr=d.forwardRef(({className:s,...e},t)=>r.jsx("div",{ref:t,className:M("text-sm text-muted-foreground",s),...e}));zr.displayName="CardDescription";const Ne=d.forwardRef(({className:s,...e},t)=>r.jsx("div",{ref:t,className:M("p-6 pt-0",s),...e}));Ne.displayName="CardContent";const Nc=d.forwardRef(({className:s,...e},t)=>r.jsx("div",{ref:t,className:M("flex items-center p-6 pt-0",s),...e}));Nc.displayName="CardFooter";const et=d.forwardRef(({className:s,value:e,...t},a)=>r.jsx($s,{ref:a,className:M("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...t,children:r.jsx(yn,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})}));et.displayName=$s.displayName;class tt{static instance;metrics=[];alerts=[];observers=[];sessionId;startTime;constructor(){this.sessionId=this.generateSessionId(),this.startTime=performance.now(),this.initializeObservers()}static getInstance(){return tt.instance||(tt.instance=new tt),tt.instance}initializeObservers(){"PerformanceObserver"in window&&(this.observePaintTiming(),this.observeLayoutShift(),this.observeInteraction()),this.observeMemoryUsage(),this.observeNetworkPerformance(),this.observeErrors(),this.startPeriodicCollection()}observePaintTiming(){try{const e=new PerformanceObserver(t=>{t.getEntries().forEach(n=>{n.name==="first-paint"?this.updateMetric("firstPaint",n.startTime):n.name==="first-contentful-paint"&&this.updateMetric("firstContentfulPaint",n.startTime)})});e.observe({entryTypes:["paint"]}),this.observers.push(e)}catch(e){console.warn("Failed to observe paint timing:",e)}}observeLayoutShift(){try{const e=new PerformanceObserver(t=>{const a=t.getEntries();let n=0;a.forEach(o=>{o instanceof LayoutShift&&(n+=o.value)}),this.updateMetric("cumulativeLayoutShift",n)});e.observe({entryTypes:["layout-shift"]}),this.observers.push(e)}catch(e){console.warn("Failed to observe layout shift:",e)}}observeInteraction(){try{const e=new PerformanceObserver(t=>{t.getEntries().forEach(n=>{n instanceof PerformanceEventTiming&&(this.updateMetric("interactionTime",n.duration),this.updateMetric("firstInputDelay",n.processingStart-n.startTime))})});e.observe({entryTypes:["first-input","event"]}),this.observers.push(e)}catch(e){console.warn("Failed to observe interactions:",e)}}observeMemoryUsage(){setInterval(()=>{if("memory"in performance){const e=performance.memory;this.updateMetric("memoryUsage",e.usedJSHeapSize),e.jsHeapSizeLimit-e.usedJSHeapSize<e.jsHeapSizeLimit*.1&&this.createAlert({type:"warning",category:"memory",message:"High memory usage detected",severity:"medium",suggestions:["Check for memory leaks","Consider garbage collection"]})}},5e3)}observeNetworkPerformance(){const e=window.fetch;window.fetch=async(...t)=>{const a=performance.now();try{const n=await e(...t),o=performance.now();return this.updateMetric("requestTime",o-a),n}catch(n){const o=performance.now();throw this.updateMetric("requestTime",o-a),n}}}observeErrors(){window.addEventListener("error",e=>{this.createAlert({type:"error",category:"performance",message:`JavaScript error: ${e.message}`,severity:"high",context:{filename:e.filename,lineno:e.lineno,colno:e.colno}})}),window.addEventListener("unhandledrejection",e=>{this.createAlert({type:"error",category:"performance",message:`Unhandled promise rejection: ${e.reason}`,severity:"high"})})}startPeriodicCollection(){setInterval(()=>{this.collectMetrics()},3e4)}collectMetrics(){const e={renderTime:this.calculateRenderTime(),firstPaint:this.getMetric("firstPaint")||0,firstContentfulPaint:this.getMetric("firstContentfulPaint")||0,largestContentfulPaint:this.getLCP(),cumulativeLayoutShift:this.getMetric("cumulativeLayoutShift")||0,firstInputDelay:this.getMetric("firstInputDelay")||0,interactionTime:this.getMetric("interactionTime")||0,clickLatency:this.measureClickLatency(),scrollPerformance:this.measureScrollPerformance(),inputResponsiveness:this.measureInputResponsiveness(),memoryUsage:this.getMemoryUsage(),memoryLeakDetected:this.detectMemoryLeak(),garbageCollectionTime:this.measureGarbageCollection(),networkLatency:this.measureNetworkLatency(),requestTime:this.getMetric("requestTime")||0,resourceLoadTime:this.measureResourceLoadTime(),conflictDetectionTime:this.getMetric("conflictDetectionTime")||0,conflictResolutionTime:this.getMetric("conflictResolutionTime")||0,batchOperationTime:this.getMetric("batchOperationTime")||0,perceivedPerformance:this.calculatePerceivedPerformance(),errorRate:this.calculateErrorRate(),crashRate:this.calculateCrashRate(),userSatisfaction:this.calculateUserSatisfaction(),timestamp:new Date,sessionId:this.sessionId};this.metrics.push(e),this.analyzeMetrics(e)}startConflictDetection(){const e=performance.now();return()=>{const t=performance.now();this.updateMetric("conflictDetectionTime",t-e)}}startConflictResolution(){const e=performance.now();return()=>{const t=performance.now();this.updateMetric("conflictResolutionTime",t-e)}}startBatchOperation(){const e=performance.now();return()=>{const t=performance.now();this.updateMetric("batchOperationTime",t-e)}}trackUserInteraction(e,t,a){this.updateMetric(`${e}Duration`,t),a||this.createAlert({type:"warning",category:"ux",message:`User interaction failed: ${e}`,severity:"medium"})}trackUserSatisfaction(e,t){this.updateMetric("userSatisfaction",e),t&&console.log("User feedback:",t)}analyzeMetrics(e){e.renderTime>100&&this.createAlert({type:"warning",category:"performance",message:"Slow render time detected",severity:"medium",suggestions:["Optimize component rendering","Consider virtualization"]}),e.memoryUsage>100*1024*1024&&this.createAlert({type:"warning",category:"memory",message:"High memory usage detected",severity:"medium",suggestions:["Check for memory leaks","Optimize data structures"]}),e.networkLatency>1e3&&this.createAlert({type:"warning",category:"network",message:"High network latency detected",severity:"medium",suggestions:["Check network connection","Optimize API calls"]}),e.conflictResolutionTime>5e3&&this.createAlert({type:"warning",category:"performance",message:"Slow conflict resolution detected",severity:"medium",suggestions:["Optimize conflict resolution algorithm","Consider caching"]})}generateReport(e=36e5){const t=new Date,a=new Date(t.getTime()-e),n=this.metrics.filter(i=>i.timestamp>=a&&i.timestamp<=t),o=this.calculateUserExperienceMetrics(n);return{period:{start:a,end:t},metrics:n,userExperience:o,alerts:this.alerts.filter(i=>i.timestamp>=a),summary:{averagePerformance:this.calculateAveragePerformance(n),performanceTrend:this.calculatePerformanceTrend(n),criticalIssues:this.alerts.filter(i=>i.severity==="critical").length,recommendations:this.generateRecommendations(n,o)}}}updateMetric(e,t){const a=this.metrics[this.metrics.length-1];a&&(a[e]=t)}getMetric(e){const t=this.metrics[this.metrics.length-1];return t?t[e]:null}calculateRenderTime(){const e=performance.getEntriesByType("navigation")[0];return e?e.loadEventEnd-e.loadEventStart:0}getLCP(){const e=performance.getEntriesByType("largest-contentful-paint")[0];return e?e.startTime:0}measureClickLatency(){return 0}measureScrollPerformance(){return 0}measureInputResponsiveness(){return 0}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize:0}detectMemoryLeak(){return!1}measureGarbageCollection(){return 0}measureNetworkLatency(){return 0}measureResourceLoadTime(){return 0}calculatePerceivedPerformance(){return 85}calculateErrorRate(){return .01}calculateCrashRate(){return .001}calculateUserSatisfaction(){return 85}calculateUserExperienceMetrics(e){return{averageTaskCompletionTime:0,taskSuccessRate:.95,clickCount:0,scrollDepth:0,timeOnPage:0,bounceRate:.1,conflictResolutionSuccess:.9,conflictResolutionAttempts:0,averageResolutionTime:0,userPreferredResolution:"auto",interfaceResponsiveness:85,loadingTime:0,errorEncounterRate:.02,satisfactionScore:85,feedbackCount:0,commonComplaints:[]}}calculateAveragePerformance(e){return e.length===0?0:e.reduce((a,n)=>a+n.perceivedPerformance,0)/e.length}calculatePerformanceTrend(e){if(e.length<2)return"stable";const t=e.slice(-10),a=e.slice(-20,-10),n=t.reduce((i,l)=>i+l.perceivedPerformance,0)/t.length,o=a.reduce((i,l)=>i+l.perceivedPerformance,0)/a.length;return n>o+5?"improving":n<o-5?"declining":"stable"}generateRecommendations(e,t){const a=[];return t.conflictResolutionSuccess<.8&&a.push("Improve conflict resolution algorithms"),t.interfaceResponsiveness<70&&a.push("Optimize UI responsiveness"),t.errorEncounterRate>.05&&a.push("Reduce error rates in user interactions"),a}createAlert(e){const t={...e,id:this.generateAlertId(),timestamp:new Date};this.alerts.push(t),console.warn("Performance Alert:",t)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateAlertId(){return`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getMetrics(){return[...this.metrics]}getAlerts(){return[...this.alerts]}clearMetrics(){this.metrics=[],this.alerts=[]}getRealtimeMetrics(){return{renderTime:this.calculateRenderTime(),memoryUsage:this.getMemoryUsage(),networkLatency:this.measureNetworkLatency(),perceivedPerformance:this.calculatePerceivedPerformance()}}}const je=tt.getInstance();function Dc(s={}){const{enableMetricsCollection:e=!0,enableUserTracking:t=!0,enableConflictMonitoring:a=!0,reportInterval:n=3e4}=s,o=d.useRef({averageRenderTime:0,averageMemoryUsage:0,averageNetworkLatency:0,conflictResolutionTime:0,userSatisfaction:0,errorRate:0,totalOperations:0,successfulOperations:0}),i=d.useRef([]),l=d.useRef([]);d.useEffect(()=>{if(!e)return;je.clearMetrics();const j=setInterval(()=>{u()},n);return()=>{clearInterval(j)}},[e,n]);const u=d.useCallback(()=>{const j=je.getMetrics();if(j.length===0)return;const N=j.slice(-10),P=m(N);o.current={averageRenderTime:P.renderTime,averageMemoryUsage:P.memoryUsage,averageNetworkLatency:P.networkLatency,conflictResolutionTime:P.conflictResolutionTime,userSatisfaction:P.userSatisfaction,errorRate:c(N),totalOperations:N.length,successfulOperations:N.filter($=>$.errorRate<.05).length},i.current=j},[]),m=d.useCallback(j=>j.length===0?{renderTime:0,memoryUsage:0,networkLatency:0,conflictResolutionTime:0,userSatisfaction:0,errorRate:0}:{renderTime:j.reduce((N,P)=>N+P.renderTime,0)/j.length,memoryUsage:j.reduce((N,P)=>N+P.memoryUsage,0)/j.length,networkLatency:j.reduce((N,P)=>N+P.networkLatency,0)/j.length,conflictResolutionTime:j.reduce((N,P)=>N+P.conflictResolutionTime,0)/j.length,userSatisfaction:j.reduce((N,P)=>N+P.userSatisfaction,0)/j.length,errorRate:j.reduce((N,P)=>N+P.errorRate,0)/j.length},[]),c=d.useCallback(j=>j.reduce((P,$)=>P+$.errorRate,0)/j.length,[]),w=d.useCallback(()=>a?je.startConflictDetection():()=>{},[a]),y=d.useCallback(()=>a?je.startConflictResolution():()=>{},[a]),g=d.useCallback(()=>a?je.startBatchOperation():()=>{},[a]),S=d.useCallback((j,N,P)=>{t&&(je.trackUserInteraction(j,N,P),l.current.push({action:j,duration:N,success:P,timestamp:new Date}),l.current.length>100&&(l.current=l.current.slice(-100)))},[t]),E=d.useCallback((j,N)=>{t&&je.trackUserSatisfaction(j,N)},[t]),R=d.useCallback((j=36e5)=>je.generateReport(j),[]),v=d.useCallback(()=>je.getRealtimeMetrics(),[]),h=d.useCallback(()=>je.getAlerts(),[]),f=d.useCallback((j=20)=>l.current.slice(-j),[]),p=d.useCallback(()=>({...o.current}),[]),x=d.useCallback(()=>{je.clearMetrics(),i.current=[],l.current=[],o.current={averageRenderTime:0,averageMemoryUsage:0,averageNetworkLatency:0,conflictResolutionTime:0,userSatisfaction:0,errorRate:0,totalOperations:0,successfulOperations:0}},[]),C=d.useCallback(()=>{const j=o.current;let N=100;return j.averageRenderTime>100&&(N-=20),j.averageRenderTime>200&&(N-=30),j.averageMemoryUsage>100*1024*1024&&(N-=15),j.averageMemoryUsage>200*1024*1024&&(N-=25),j.averageNetworkLatency>1e3&&(N-=10),j.averageNetworkLatency>2e3&&(N-=20),j.errorRate>.05&&(N-=15),j.errorRate>.1&&(N-=25),j.conflictResolutionTime>5e3&&(N-=10),j.conflictResolutionTime>1e4&&(N-=20),{healthScore:Math.max(0,N),status:N>=80?"good":N>=60?"warning":"critical",issues:D(j)}},[]),D=d.useCallback(j=>{const N=[];return j.averageRenderTime>100&&N.push("渲染时间过长，可能影响用户体验"),j.averageMemoryUsage>100*1024*1024&&N.push("内存使用较高，建议检查内存泄漏"),j.averageNetworkLatency>1e3&&N.push("网络延迟较高，可能影响同步性能"),j.errorRate>.05&&N.push("错误率较高，需要关注错误处理"),j.conflictResolutionTime>5e3&&N.push("冲突解决时间过长，建议优化算法"),N},[]);return{startConflictDetection:w,startConflictResolution:y,startBatchOperation:g,trackUserInteraction:S,trackUserSatisfaction:E,getPerformanceReport:R,getRealtimeMetrics:v,getPerformanceAlerts:h,getUserActionHistory:f,getPerformanceStats:p,clearPerformanceData:x,getPerformanceHealth:C,stats:o.current,isMonitoring:e}}function Rc({className:s,showDetails:e=!0,compact:t=!1,autoRefresh:a=!0}){const[n,o]=d.useState(!1),[i,l]=d.useState("overview"),[u,m]=d.useState(0),{stats:c,getRealtimeMetrics:w,getPerformanceAlerts:y,getUserActionHistory:g,getPerformanceHealth:S,getPerformanceReport:E,isMonitoring:R}=Dc({enableMetricsCollection:!0,enableUserTracking:!0,enableConflictMonitoring:!0,reportInterval:1e4}),[v,h]=d.useState({}),[f,p]=d.useState([]),[x,C]=d.useState([]),[D,j]=d.useState(null),N=()=>{h(w()),p(y()),C(g(20)),j(S()),m(L=>L+1)};d.useEffect(()=>{if(!a||!n)return;N();const L=setInterval(N,5e3);return()=>clearInterval(L)},[a,n,u]),d.useEffect(()=>{n&&N()},[n]);const P=L=>{if(L===0)return"0 B";const ne=1024,te=["B","KB","MB","GB"],J=Math.floor(Math.log(L)/Math.log(ne));return`${parseFloat((L/Math.pow(ne,J)).toFixed(2))} ${te[J]}`},$=L=>L<1e3?`${L.toFixed(0)}ms`:L<6e4?`${(L/1e3).toFixed(1)}s`:`${(L/6e4).toFixed(1)}min`,Z=L=>{switch(L){case"good":return"text-green-500";case"warning":return"text-yellow-500";case"critical":return"text-red-500";default:return"text-gray-500"}},Q=L=>{switch(L){case"good":return r.jsx(Ft,{className:"h-4 w-4 text-green-500"});case"warning":return r.jsx(nt,{className:"h-4 w-4 text-yellow-500"});case"critical":return r.jsx(Bn,{className:"h-4 w-4 text-red-500"});default:return r.jsx(_a,{className:"h-4 w-4 text-gray-500"})}};return t?r.jsxs("div",{className:M("flex items-center gap-2",s),children:[r.jsxs("div",{className:M("flex items-center gap-1",Z(D?.status||"unknown")),children:[Q(D?.status||"unknown"),r.jsxs("span",{className:"text-sm font-medium",children:[D?.healthScore||0,"/100"]})]}),f.length>0&&r.jsx(ue,{variant:"destructive",className:"text-xs",children:f.length}),r.jsx(G,{variant:"ghost",size:"sm",onClick:()=>o(!n),children:r.jsx(On,{className:"h-4 w-4"})})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:M("flex items-center gap-2 cursor-pointer",s),onClick:()=>o(!n),children:[r.jsxs("div",{className:M("flex items-center gap-1",Z(D?.status||"unknown")),children:[Q(D?.status||"unknown"),r.jsxs("span",{className:"text-sm font-medium",children:["性能: ",D?.healthScore||0,"/100"]})]}),f.length>0&&r.jsxs(ue,{variant:"destructive",className:"text-xs",children:[f.length," 警报"]}),r.jsx(G,{variant:"ghost",size:"sm",children:n?"隐藏":"显示"})]}),n&&r.jsxs(ke,{className:"w-full max-w-4xl max-h-[80vh]",children:[r.jsxs(Kt,{className:"pb-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(Yt,{className:"text-lg flex items-center gap-2",children:[r.jsx(_a,{className:"h-5 w-5"}),"性能监控",r.jsx(ue,{variant:R?"default":"secondary",children:R?"监控中":"已停止"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(G,{variant:"outline",size:"sm",onClick:N,children:[r.jsx(ma,{className:"h-4 w-4 mr-2"}),"刷新"]}),r.jsxs(G,{variant:"outline",size:"sm",onClick:()=>{const L=E();console.log("Performance Report:",L)},children:[r.jsx(rt,{className:"h-4 w-4 mr-2"}),"报告"]}),r.jsx(G,{variant:"ghost",size:"sm",onClick:()=>o(!1),children:"×"})]})]}),D&&r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"健康状态:"}),r.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[Q(D.status),r.jsxs("span",{className:M("font-medium",Z(D.status)),children:[D.healthScore,"/100 (",D.status,")"]})]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"渲染时间:"}),r.jsx("span",{className:"ml-2 font-medium",children:$(v.renderTime||0)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"内存使用:"}),r.jsx("span",{className:"ml-2 font-medium",children:P(v.memoryUsage||0)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-muted-foreground",children:"网络延迟:"}),r.jsxs("span",{className:"ml-2 font-medium",children:[v.networkLatency||0,"ms"]})]})]})]}),r.jsxs(Ne,{children:[r.jsx("div",{className:"flex gap-2 mb-4",children:["overview","metrics","alerts","actions"].map(L=>r.jsxs(G,{variant:i===L?"default":"outline",size:"sm",onClick:()=>l(L),children:[L==="overview"&&"概览",L==="metrics"&&"指标",L==="alerts"&&"警报",L==="actions"&&"用户行为"]},L))}),r.jsxs(ka,{className:"h-96",children:[i==="overview"&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(ke,{children:r.jsxs(Ne,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Gs,{className:"h-4 w-4 text-yellow-500"}),r.jsx("span",{className:"font-medium",children:"渲染性能"})]}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"平均渲染时间:"}),r.jsx("span",{children:$(c.averageRenderTime)})]}),r.jsx(et,{value:Math.min(100,c.averageRenderTime/100*100),className:"h-2"})]})]})}),r.jsx(ke,{children:r.jsxs(Ne,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Pn,{className:"h-4 w-4 text-blue-500"}),r.jsx("span",{className:"font-medium",children:"内存使用"})]}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"内存使用:"}),r.jsx("span",{children:P(c.averageMemoryUsage)})]}),r.jsx(et,{value:Math.min(100,c.averageMemoryUsage/(100*1024*1024)*100),className:"h-2"})]})]})}),r.jsx(ke,{children:r.jsxs(Ne,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Ks,{className:"h-4 w-4 text-green-500"}),r.jsx("span",{className:"font-medium",children:"网络性能"})]}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"平均延迟:"}),r.jsxs("span",{children:[c.averageNetworkLatency,"ms"]})]}),r.jsx(et,{value:Math.min(100,c.averageNetworkLatency/1e3*100),className:"h-2"})]})]})}),r.jsx(ke,{children:r.jsxs(Ne,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Ln,{className:"h-4 w-4 text-purple-500"}),r.jsx("span",{className:"font-medium",children:"用户体验"})]}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"满意度:"}),r.jsxs("span",{children:[c.userSatisfaction.toFixed(1),"%"]})]}),r.jsx(et,{value:c.userSatisfaction,className:"h-2"})]})]})})]}),D?.issues&&D.issues.length>0&&r.jsx(ke,{children:r.jsxs(Ne,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(nt,{className:"h-4 w-4 text-orange-500"}),r.jsx("span",{className:"font-medium",children:"性能问题"})]}),r.jsx("div",{className:"space-y-1 text-sm",children:D.issues.map((L,ne)=>r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("div",{className:"w-1 h-1 bg-orange-500 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{children:L})]},ne))})]})})]}),i==="metrics"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-medium",children:"实时性能指标"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"渲染时间:"}),r.jsx("span",{children:$(v.renderTime||0)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"首次绘制:"}),r.jsx("span",{children:$(v.firstPaint||0)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"内容绘制:"}),r.jsx("span",{children:$(v.firstContentfulPaint||0)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"最大内容绘制:"}),r.jsx("span",{children:$(v.largestContentfulPaint||0)})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"内存使用:"}),r.jsx("span",{children:P(v.memoryUsage||0)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"网络延迟:"}),r.jsxs("span",{children:[v.networkLatency||0,"ms"]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"冲突检测时间:"}),r.jsx("span",{children:$(v.conflictDetectionTime||0)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"冲突解决时间:"}),r.jsx("span",{children:$(v.conflictResolutionTime||0)})]})]})]})]}),i==="alerts"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-medium",children:"性能警报"}),f.length===0?r.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"暂无性能警报"}):r.jsx("div",{className:"space-y-2",children:f.map((L,ne)=>r.jsx(ke,{className:"border-l-4 border-l-red-500",children:r.jsxs(Ne,{className:"p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(nt,{className:"h-4 w-4 text-red-500"}),r.jsx("span",{className:"font-medium text-sm",children:L.type}),r.jsx(ue,{variant:"outline",className:"text-xs",children:L.severity})]}),r.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(L.timestamp).toLocaleTimeString()})]}),r.jsx("p",{className:"text-sm mb-2",children:L.message}),L.suggestions&&L.suggestions.length>0&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"text-xs font-medium",children:"建议:"}),L.suggestions.map((te,J)=>r.jsxs("div",{className:"text-xs text-muted-foreground",children:["• ",te]},J))]})]})},ne))})]}),i==="actions"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-medium",children:"用户行为历史"}),x.length===0?r.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"暂无用户行为记录"}):r.jsx("div",{className:"space-y-2",children:x.map((L,ne)=>r.jsx(ke,{children:r.jsx(Ne,{className:"p-3",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-medium text-sm",children:L.action}),r.jsx(ue,{variant:L.success?"default":"destructive",className:"text-xs",children:L.success?"成功":"失败"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[r.jsx($n,{className:"h-3 w-3"}),r.jsx("span",{children:new Date(L.timestamp).toLocaleTimeString()}),r.jsxs("span",{children:["(",$(L.duration),")"]})]})]})})},ne))})]})]})]})]})]})}function Tc({className:s}){const{cards:e,filter:t,setFilter:a,viewSettings:n,setViewSettings:o,dispatch:i,flipCard:l,getAllTags:u,updateTagsInAllCards:m,getCardsWithTag:c}=jo(),{folderTree:w,selectedFolderId:y,setSelectedFolderId:g,dispatch:S,getFolderById:E,folders:R}=Js(),{tags:v,popularTags:h,renameTag:f,deleteTagByName:p,getAllTagNames:x}=Xs(),{toast:C}=rc(),[D,j]=d.useState(!1),[N,P]=d.useState(!1),[$,Z]=d.useState({gap:16,showLayoutControls:!1}),[Q,L]=d.useState(!1),[ne,te]=d.useState(!1),[J,me]=d.useState(null),[F,U]=d.useState(null),[ae,V]=d.useState(),[Y,X]=d.useState(!1),[oe,B]=d.useState(!1),[H,T]=d.useState(""),[k,b]=d.useState(null),{isDownloading:A,showPreview:q,previewData:se,captureScreenshot:ce,confirmDownload:de,cancelPreview:fe}=Jl({onSuccess:I=>{C({title:"Screenshot saved!",description:`${I}.png has been downloaded successfully.`})},onError:I=>{C({title:"Screenshot failed",description:I.message,variant:"destructive"})}}),gt=I=>{l?l(I):i({type:"FLIP_CARD",payload:I})},ft=(I,z)=>{i({type:"UPDATE_CARD",payload:{id:I,updates:z}})},qt=async I=>{const z=e.find(ee=>ee.id===I);if(z){const ee=z.isFlipped?z.backContent:z.frontContent,ye=ki(ee.title,ee.text);await Ni(ye)?console.log("Card content copied to clipboard"):console.error("Failed to copy card content")}},kt=async I=>{const z=e.find(be=>be.id===I);if(!z)return;const ee=document.querySelector(`[data-card-id="${I}"]`);if(!ee){C({title:"Screenshot failed",description:"Could not find card element. Please try again.",variant:"destructive"});return}const pe=(z.isFlipped?z.backContent:z.frontContent).title||"Untitled Card";await ce(ee,pe)},Ue=I=>{console.log("Share card:",I)},Nt=I=>{i({type:"DELETE_CARD",payload:I})},Te=(I,z)=>{const ee=e.find(be=>be.id===I);if(!ee)return;const ye=ee.folderId;if(i({type:"UPDATE_CARD",payload:{id:I,updates:{folderId:z||void 0}}}),ye){const be=E(ye);be&&S({type:"UPDATE_FOLDER",payload:{id:ye,updates:{cardIds:be.cardIds.filter(K=>K!==I)}}})}if(z){const be=E(z);be&&S({type:"UPDATE_FOLDER",payload:{id:z,updates:{cardIds:[...be.cardIds,I]}}})}const pe=z?E(z)?.name:"Root";C({title:"Card moved",description:`Card has been moved to "${pe}".`})},ht=()=>{i({type:"CREATE_CARD",payload:{frontContent:{title:"New Card",text:"Click to edit this card...",images:[],tags:[],lastModified:new Date},backContent:{title:"Back Side",text:"Add additional content here...",images:[],tags:[],lastModified:new Date},style:{type:"solid",backgroundColor:"#ffffff",fontFamily:"system-ui",fontSize:"base",fontWeight:"normal",textColor:"#1f2937",borderRadius:"xl",shadow:"md",borderWidth:0},isFlipped:!1,folderId:y||void 0}})},Dt=()=>{V(void 0),me(null),L(!0)},ge=I=>{V(I),me(null),L(!0)},Ae=I=>{const z=E(I);z&&(me({id:I,name:z.name,color:z.color,icon:z.icon||"Folder"}),V(void 0),L(!0))},Rt=I=>{const z=E(I);if(z){const ee=R.filter(ye=>ye.parentId===I);U({id:I,name:z.name,cardCount:z.cardIds.length,hasSubfolders:ee.length>0,subfolderCount:ee.length}),te(!0)}},Jt=I=>{J?(S({type:"UPDATE_FOLDER",payload:{id:J.id,updates:{name:I.name,color:I.color,icon:I.icon}}}),C({title:"Folder updated",description:`"${I.name}" has been updated successfully.`})):(S({type:"CREATE_FOLDER",payload:{name:I.name,color:I.color,icon:I.icon,cardIds:[],parentId:I.parentId,isExpanded:!0}}),C({title:"Folder created",description:`"${I.name}" has been created successfully.`}))},qe=()=>{F&&(S({type:"DELETE_FOLDER",payload:F.id,onDeleteCards:I=>{I.forEach(z=>{i({type:"DELETE_CARD",payload:z})})}}),C({title:"Folder deleted",description:`"${F.name}" and ${F.cardCount} cards have been deleted.`}),y===F.id&&We(null))},Xt=I=>{const z=t.tags.includes(I);a({...t,tags:z?t.tags.filter(ee=>ee!==I):[...t.tags,I]})},We=I=>{g(I),a({...t,folderId:I||void 0})},pt=I=>{T(I),X(!0)},Me=I=>{const z=c(I);b({name:I,cardCount:z.length}),B(!0)},Tt=(I,z)=>{f(I,z)?(m(I,z),C({title:"Tag renamed",description:`"${I}" has been renamed to "${z}".`}),X(!1),T("")):C({title:"Rename failed",description:"A tag with this name already exists.",variant:"destructive"})},Fe=()=>{k&&p(k.name)&&(m(k.name),t.tags.includes(k.name)&&a({...t,tags:t.tags.filter(z=>z!==k.name)}),C({title:"Tag deleted",description:`"${k.name}" has been removed from ${k.cardCount} cards.`}),B(!1),b(null))},At=(I,z=0)=>I.map(ee=>r.jsxs("div",{style:{marginLeft:z*16},children:[r.jsx(Ka,{folderId:ee.id,folderName:ee.name,onRename:Ae,onDelete:Rt,onCreateSubfolder:ge,children:r.jsxs(G,{variant:y===ee.id?"secondary":"ghost",className:"w-full justify-start text-sm mb-1",onClick:()=>We(ee.id),children:[r.jsx($e,{className:"h-4 w-4 mr-2",style:{color:ee.color}}),ee.name,r.jsx(ue,{variant:"secondary",className:"ml-auto",children:ee.cardIds.length})]})}),ee.children&&ee.children.length>0&&ee.isExpanded&&r.jsx("div",{className:"ml-4",children:At(ee.children,z+1)})]},ee.id)),It=I=>I.map(z=>r.jsxs("div",{children:[r.jsx(Ka,{folderId:z.id,folderName:z.name,onRename:Ae,onDelete:Rt,onCreateSubfolder:ge,children:r.jsx(G,{variant:y===z.id?"secondary":"ghost",className:"w-full h-10 p-0 mb-1",onClick:()=>We(z.id),title:z.name,children:r.jsx($e,{className:"h-4 w-4",style:{color:z.color}})})}),z.children&&z.children.length>0&&z.isExpanded&&r.jsx("div",{children:It(z.children)})]},z.id));return r.jsx(wi,{children:r.jsxs("div",{className:M("min-h-screen bg-background",s),children:[r.jsx("header",{className:"sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:r.jsxs("div",{className:"container flex h-16 items-center justify-between px-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"h-8 w-8 rounded-lg bg-gradient-to-br from-violet-500 to-pink-500 flex items-center justify-center",children:r.jsx("span",{className:"text-white font-bold text-sm",children:"CA"})}),r.jsxs("h1",{className:"text-xl font-bold",children:[r.jsx("span",{className:"text-violet-600",children:"Card"}),r.jsx("span",{className:"text-pink-500",children:"All"})]})]}),r.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 hidden md:block",children:r.jsxs("div",{className:"relative",children:[r.jsx(xt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),r.jsx(Ke,{placeholder:"Search cards...",value:t.searchTerm,onChange:I=>a({...t,searchTerm:I.target.value}),className:"pl-10 rounded-full w-80"})]})}),r.jsx("div",{className:"md:hidden absolute left-1/2 transform -translate-x-1/2",children:r.jsxs("div",{className:"relative",children:[r.jsx(xt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),r.jsx(Ke,{placeholder:"Search...",value:t.searchTerm,onChange:I=>a({...t,searchTerm:I.target.value}),className:"pl-10 rounded-full w-60"})]})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Rc,{compact:!0,autoRefresh:!0}),r.jsxs(ji,{children:[r.jsx(Ei,{asChild:!0,children:r.jsx(G,{variant:"ghost",size:"sm",children:r.jsx(zn,{className:"h-4 w-4"})})}),r.jsx(or,{className:"w-80",align:"end",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium",children:"Layout Settings"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Customize the masonry layout appearance"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs(Ge,{children:["Gap Size: ",$.gap,"px"]}),r.jsx(nr,{value:[$.gap],onValueChange:([I])=>Z(z=>({...z,gap:I})),max:32,min:8,step:4,className:"w-full"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Ge,{children:"Card Size"}),r.jsx("div",{className:"flex gap-2",children:["small","medium","large"].map(I=>r.jsx(G,{variant:n.cardSize===I?"default":"outline",size:"sm",onClick:()=>o(z=>({...z,cardSize:I})),children:I.charAt(0).toUpperCase()+I.slice(1)},I))})]})]})})]}),r.jsxs(G,{onClick:ht,variant:"ghost",size:"sm",className:"text-black font-bold hover:bg-gray-100 rounded-full w-10 h-10 p-0 flex items-center justify-center",children:[r.jsx(Mt,{className:"h-6 w-6"}),r.jsx("span",{className:"sr-only",children:"Add Card"})]})]})]})}),r.jsxs("main",{className:"flex h-[calc(100vh-4rem)]",children:[r.jsxs("aside",{className:M("border-r transition-all duration-300 ease-in-out flex flex-col",N?"w-16":"w-72"),children:[r.jsx("div",{className:"p-3 flex items-center justify-end",children:r.jsx(G,{variant:"ghost",size:"sm",onClick:()=>P(!N),className:"h-8 w-8 p-0",children:N?r.jsx(ba,{className:"h-4 w-4"}):r.jsx(Un,{className:"h-4 w-4"})})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsxs("div",{className:"p-3 space-y-4",children:[!N&&r.jsxs("div",{children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs(G,{className:"w-full justify-start",onClick:ht,children:[r.jsx(Mt,{className:"h-4 w-4 mr-2"}),"New Card"]}),r.jsxs(G,{variant:"outline",className:"w-full justify-start",onClick:Dt,children:[r.jsx(da,{className:"h-4 w-4 mr-2"}),"New Folder"]})]}),r.jsx(wt,{className:"my-4"})]}),N&&r.jsxs("div",{className:"space-y-2",children:[r.jsx(G,{variant:"ghost",size:"sm",className:"w-full h-10 p-0",onClick:ht,title:"New Card",children:r.jsx(Mt,{className:"h-4 w-4"})}),r.jsx(G,{variant:"ghost",size:"sm",className:"w-full h-10 p-0",onClick:Dt,title:"New Folder",children:r.jsx(da,{className:"h-4 w-4"})}),r.jsx(wt,{className:"my-4"})]}),r.jsxs("div",{children:[!N&&r.jsx("h3",{className:"text-sm font-medium mb-3",children:"Folders"}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs(G,{variant:y?"ghost":"secondary",className:M("w-full text-sm",N?"h-10 p-0":"justify-start"),onClick:()=>We(null),title:N?"All Cards":void 0,children:[r.jsx($e,{className:"h-4 w-4"}),!N&&r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"ml-2",children:"All Cards"}),r.jsx(ue,{variant:"secondary",className:"ml-auto",children:e.length})]})]}),N?It(w):At(w)]})]}),r.jsx(wt,{}),r.jsxs("div",{children:[!N&&r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:"text-sm font-medium",children:"Tags"}),t.tags.length>0&&r.jsx(G,{variant:"ghost",size:"sm",onClick:()=>a({...t,tags:[]}),className:"h-6 px-2 text-xs",children:"Clear"})]}),r.jsx("div",{className:"space-y-1",children:h(N?5:10).map(I=>r.jsx(xc,{tagName:I.name,onRename:pt,onDelete:Me,disabled:N,children:r.jsxs(G,{variant:t.tags.includes(I.name)?"secondary":"ghost",className:M("w-full text-sm",N?"h-10 p-0":"justify-start"),onClick:()=>Xt(I.name),title:N?`${I.name} (Right-click to expand sidebar for tag management)`:I.name,children:[r.jsx(Ws,{className:"h-3 w-3",style:{color:I.color}}),!N&&r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"ml-2",children:I.name}),r.jsx(ue,{variant:"secondary",className:"ml-auto",children:I.count})]})]})},I.id))})]}),!N&&(t.tags.length>0||t.searchTerm)&&r.jsxs(r.Fragment,{children:[r.jsx(wt,{}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-medium mb-3",children:"Active Filters"}),r.jsxs("div",{className:"space-y-2",children:[t.searchTerm&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(xt,{className:"h-3 w-3"}),r.jsxs("span",{className:"text-xs text-muted-foreground",children:['"',t.searchTerm,'"']})]}),t.tags.map(I=>r.jsx(ue,{variant:"secondary",className:"mr-1",children:I},I))]})]})]})]})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx("div",{className:"p-4",children:r.jsx(Ci,{cards:e,onCardFlip:gt,onCardUpdate:ft,onCardCopy:qt,onCardScreenshot:kt,onCardShare:Ue,onCardDelete:Nt,onMoveToFolder:Te,cardSize:n.cardSize==="small"?"sm":n.cardSize==="large"?"lg":"md",enableVirtualization:e.length>20,gap:$.gap,overscan:3})})})]}),r.jsx(Xl,{isOpen:q,onClose:fe,onConfirm:de,previewUrl:se?.previewUrl||null,fileName:se?.fileName||"",isDownloading:A}),r.jsx(hc,{isOpen:Q,onClose:()=>{L(!1),me(null),V(void 0)},onConfirm:Jt,parentId:ae,initialData:d.useMemo(()=>J?{name:J.name,color:J.color,icon:J.icon}:void 0,[J]),mode:J?"edit":"create"}),r.jsx(wc,{isOpen:ne,onClose:()=>{te(!1),U(null)},onConfirm:qe,folderName:F?.name||"",cardCount:F?.cardCount||0,hasSubfolders:F?.hasSubfolders||!1,subfolderCount:F?.subfolderCount||0}),r.jsx(bc,{isOpen:Y,onClose:()=>{X(!1),T("")},onConfirm:Tt,tagName:H,existingTags:x()}),r.jsx(vc,{isOpen:oe,onClose:()=>{B(!1),b(null)},onConfirm:Fe,tagName:k?.name||"",cardCount:k?.cardCount||0}),r.jsx(kc,{})]})})}const Ac={theme:"system",setTheme:()=>null},Ic=d.createContext(Ac);function _c({children:s,defaultTheme:e="system",storageKey:t="vite-ui-theme",...a}){const[n,o]=d.useState(()=>localStorage.getItem(t)||e);d.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),n==="system"){const u=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(u);return}l.classList.add(n)},[n]);const i={theme:n,setTheme:l=>{localStorage.setItem(t,l),o(l)}};return r.jsx(Ic.Provider,{...a,value:i,children:s})}var Mc=s=>{switch(s){case"success":return Pc;case"info":return $c;case"warning":return Lc;case"error":return Bc;default:return null}},Fc=Array(12).fill(0),Oc=({visible:s,className:e})=>O.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":s},O.createElement("div",{className:"sonner-spinner"},Fc.map((t,a)=>O.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),Pc=O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},O.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Lc=O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},O.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),$c=O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},O.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Bc=O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},O.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),zc=O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},O.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),O.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Uc=()=>{let[s,e]=O.useState(document.hidden);return O.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),s},wa=1,Wc=class{constructor(){this.subscribe=s=>(this.subscribers.push(s),()=>{let e=this.subscribers.indexOf(s);this.subscribers.splice(e,1)}),this.publish=s=>{this.subscribers.forEach(e=>e(s))},this.addToast=s=>{this.publish(s),this.toasts=[...this.toasts,s]},this.create=s=>{var e;let{message:t,...a}=s,n=typeof s?.id=="number"||((e=s.id)==null?void 0:e.length)>0?s.id:wa++,o=this.toasts.find(l=>l.id===n),i=s.dismissible===void 0?!0:s.dismissible;return this.dismissedToasts.has(n)&&this.dismissedToasts.delete(n),o?this.toasts=this.toasts.map(l=>l.id===n?(this.publish({...l,...s,id:n,title:t}),{...l,...s,id:n,dismissible:i,title:t}):l):this.addToast({title:t,...a,dismissible:i,id:n}),n},this.dismiss=s=>(this.dismissedToasts.add(s),s||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:s,dismiss:!0})),s),this.message=(s,e)=>this.create({...e,message:s}),this.error=(s,e)=>this.create({...e,message:s,type:"error"}),this.success=(s,e)=>this.create({...e,type:"success",message:s}),this.info=(s,e)=>this.create({...e,type:"info",message:s}),this.warning=(s,e)=>this.create({...e,type:"warning",message:s}),this.loading=(s,e)=>this.create({...e,type:"loading",message:s}),this.promise=(s,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:s,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let a=s instanceof Promise?s:s(),n=t!==void 0,o,i=a.then(async u=>{if(o=["resolve",u],O.isValidElement(u))n=!1,this.create({id:t,type:"default",message:u});else if(Hc(u)&&!u.ok){n=!1;let m=typeof e.error=="function"?await e.error(`HTTP error! status: ${u.status}`):e.error,c=typeof e.description=="function"?await e.description(`HTTP error! status: ${u.status}`):e.description;this.create({id:t,type:"error",message:m,description:c})}else if(e.success!==void 0){n=!1;let m=typeof e.success=="function"?await e.success(u):e.success,c=typeof e.description=="function"?await e.description(u):e.description;this.create({id:t,type:"success",message:m,description:c})}}).catch(async u=>{if(o=["reject",u],e.error!==void 0){n=!1;let m=typeof e.error=="function"?await e.error(u):e.error,c=typeof e.description=="function"?await e.description(u):e.description;this.create({id:t,type:"error",message:m,description:c})}}).finally(()=>{var u;n&&(this.dismiss(t),t=void 0),(u=e.finally)==null||u.call(e)}),l=()=>new Promise((u,m)=>i.then(()=>o[0]==="reject"?m(o[1]):u(o[1])).catch(m));return typeof t!="string"&&typeof t!="number"?{unwrap:l}:Object.assign(t,{unwrap:l})},this.custom=(s,e)=>{let t=e?.id||wa++;return this.create({jsx:s(t),id:t,...e}),t},this.getActiveToasts=()=>this.toasts.filter(s=>!this.dismissedToasts.has(s.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},he=new Wc,Vc=(s,e)=>{let t=e?.id||wa++;return he.addToast({title:s,...e,id:t}),t},Hc=s=>s&&typeof s=="object"&&"ok"in s&&typeof s.ok=="boolean"&&"status"in s&&typeof s.status=="number",Gc=Vc,Kc=()=>he.toasts,Yc=()=>he.getActiveToasts();Object.assign(Gc,{success:he.success,info:he.info,warning:he.warning,error:he.error,custom:he.custom,message:he.message,promise:he.promise,dismiss:he.dismiss,loading:he.loading},{getHistory:Kc,getToasts:Yc});function qc(s,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",e==="top"&&t.firstChild?t.insertBefore(a,t.firstChild):t.appendChild(a),a.styleSheet?a.styleSheet.cssText=s:a.appendChild(document.createTextNode(s))}qc(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function _t(s){return s.label!==void 0}var Jc=3,Xc="32px",Qc="16px",Ya=4e3,Zc=356,ed=14,td=20,ad=200;function Ee(...s){return s.filter(Boolean).join(" ")}function sd(s){let[e,t]=s.split("-"),a=[];return e&&a.push(e),t&&a.push(t),a}var rd=s=>{var e,t,a,n,o,i,l,u,m,c,w;let{invert:y,toast:g,unstyled:S,interacting:E,setHeights:R,visibleToasts:v,heights:h,index:f,toasts:p,expanded:x,removeToast:C,defaultRichColors:D,closeButton:j,style:N,cancelButtonStyle:P,actionButtonStyle:$,className:Z="",descriptionClassName:Q="",duration:L,position:ne,gap:te,loadingIcon:J,expandByDefault:me,classNames:F,icons:U,closeButtonAriaLabel:ae="Close toast",pauseWhenPageIsHidden:V}=s,[Y,X]=O.useState(null),[oe,B]=O.useState(null),[H,T]=O.useState(!1),[k,b]=O.useState(!1),[A,q]=O.useState(!1),[se,ce]=O.useState(!1),[de,fe]=O.useState(!1),[gt,ft]=O.useState(0),[qt,kt]=O.useState(0),Ue=O.useRef(g.duration||L||Ya),Nt=O.useRef(null),Te=O.useRef(null),ht=f===0,Dt=f+1<=v,ge=g.type,Ae=g.dismissible!==!1,Rt=g.className||"",Jt=g.descriptionClassName||"",qe=O.useMemo(()=>h.findIndex(K=>K.toastId===g.id)||0,[h,g.id]),Xt=O.useMemo(()=>{var K;return(K=g.closeButton)!=null?K:j},[g.closeButton,j]),We=O.useMemo(()=>g.duration||L||Ya,[g.duration,L]),pt=O.useRef(0),Me=O.useRef(0),Tt=O.useRef(0),Fe=O.useRef(null),[At,It]=ne.split("-"),I=O.useMemo(()=>h.reduce((K,re,le)=>le>=qe?K:K+re.height,0),[h,qe]),z=Uc(),ee=g.invert||y,ye=ge==="loading";Me.current=O.useMemo(()=>qe*te+I,[qe,I]),O.useEffect(()=>{Ue.current=We},[We]),O.useEffect(()=>{T(!0)},[]),O.useEffect(()=>{let K=Te.current;if(K){let re=K.getBoundingClientRect().height;return kt(re),R(le=>[{toastId:g.id,height:re,position:g.position},...le]),()=>R(le=>le.filter(ve=>ve.toastId!==g.id))}},[R,g.id]),O.useLayoutEffect(()=>{if(!H)return;let K=Te.current,re=K.style.height;K.style.height="auto";let le=K.getBoundingClientRect().height;K.style.height=re,kt(le),R(ve=>ve.find(Ce=>Ce.toastId===g.id)?ve.map(Ce=>Ce.toastId===g.id?{...Ce,height:le}:Ce):[{toastId:g.id,height:le,position:g.position},...ve])},[H,g.title,g.description,R,g.id]);let pe=O.useCallback(()=>{b(!0),ft(Me.current),R(K=>K.filter(re=>re.toastId!==g.id)),setTimeout(()=>{C(g)},ad)},[g,C,R,Me]);O.useEffect(()=>{if(g.promise&&ge==="loading"||g.duration===1/0||g.type==="loading")return;let K;return x||E||V&&z?(()=>{if(Tt.current<pt.current){let re=new Date().getTime()-pt.current;Ue.current=Ue.current-re}Tt.current=new Date().getTime()})():Ue.current!==1/0&&(pt.current=new Date().getTime(),K=setTimeout(()=>{var re;(re=g.onAutoClose)==null||re.call(g,g),pe()},Ue.current)),()=>clearTimeout(K)},[x,E,g,ge,V,z,pe]),O.useEffect(()=>{g.delete&&pe()},[pe,g.delete]);function be(){var K,re,le;return U!=null&&U.loading?O.createElement("div",{className:Ee(F?.loader,(K=g?.classNames)==null?void 0:K.loader,"sonner-loader"),"data-visible":ge==="loading"},U.loading):J?O.createElement("div",{className:Ee(F?.loader,(re=g?.classNames)==null?void 0:re.loader,"sonner-loader"),"data-visible":ge==="loading"},J):O.createElement(Oc,{className:Ee(F?.loader,(le=g?.classNames)==null?void 0:le.loader),visible:ge==="loading"})}return O.createElement("li",{tabIndex:0,ref:Te,className:Ee(Z,Rt,F?.toast,(e=g?.classNames)==null?void 0:e.toast,F?.default,F?.[ge],(t=g?.classNames)==null?void 0:t[ge]),"data-sonner-toast":"","data-rich-colors":(a=g.richColors)!=null?a:D,"data-styled":!(g.jsx||g.unstyled||S),"data-mounted":H,"data-promise":!!g.promise,"data-swiped":de,"data-removed":k,"data-visible":Dt,"data-y-position":At,"data-x-position":It,"data-index":f,"data-front":ht,"data-swiping":A,"data-dismissible":Ae,"data-type":ge,"data-invert":ee,"data-swipe-out":se,"data-swipe-direction":oe,"data-expanded":!!(x||me&&H),style:{"--index":f,"--toasts-before":f,"--z-index":p.length-f,"--offset":`${k?gt:Me.current}px`,"--initial-height":me?"auto":`${qt}px`,...N,...g.style},onDragEnd:()=>{q(!1),X(null),Fe.current=null},onPointerDown:K=>{ye||!Ae||(Nt.current=new Date,ft(Me.current),K.target.setPointerCapture(K.pointerId),K.target.tagName!=="BUTTON"&&(q(!0),Fe.current={x:K.clientX,y:K.clientY}))},onPointerUp:()=>{var K,re,le,ve;if(se||!Ae)return;Fe.current=null;let Ce=Number(((K=Te.current)==null?void 0:K.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Oe=Number(((re=Te.current)==null?void 0:re.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ve=new Date().getTime()-((le=Nt.current)==null?void 0:le.getTime()),Se=Y==="x"?Ce:Oe,Pe=Math.abs(Se)/Ve;if(Math.abs(Se)>=td||Pe>.11){ft(Me.current),(ve=g.onDismiss)==null||ve.call(g,g),B(Y==="x"?Ce>0?"right":"left":Oe>0?"down":"up"),pe(),ce(!0),fe(!1);return}q(!1),X(null)},onPointerMove:K=>{var re,le,ve,Ce;if(!Fe.current||!Ae||((re=window.getSelection())==null?void 0:re.toString().length)>0)return;let Oe=K.clientY-Fe.current.y,Ve=K.clientX-Fe.current.x,Se=(le=s.swipeDirections)!=null?le:sd(ne);!Y&&(Math.abs(Ve)>1||Math.abs(Oe)>1)&&X(Math.abs(Ve)>Math.abs(Oe)?"x":"y");let Pe={x:0,y:0};Y==="y"?(Se.includes("top")||Se.includes("bottom"))&&(Se.includes("top")&&Oe<0||Se.includes("bottom")&&Oe>0)&&(Pe.y=Oe):Y==="x"&&(Se.includes("left")||Se.includes("right"))&&(Se.includes("left")&&Ve<0||Se.includes("right")&&Ve>0)&&(Pe.x=Ve),(Math.abs(Pe.x)>0||Math.abs(Pe.y)>0)&&fe(!0),(ve=Te.current)==null||ve.style.setProperty("--swipe-amount-x",`${Pe.x}px`),(Ce=Te.current)==null||Ce.style.setProperty("--swipe-amount-y",`${Pe.y}px`)}},Xt&&!g.jsx?O.createElement("button",{"aria-label":ae,"data-disabled":ye,"data-close-button":!0,onClick:ye||!Ae?()=>{}:()=>{var K;pe(),(K=g.onDismiss)==null||K.call(g,g)},className:Ee(F?.closeButton,(n=g?.classNames)==null?void 0:n.closeButton)},(o=U?.close)!=null?o:zc):null,g.jsx||d.isValidElement(g.title)?g.jsx?g.jsx:typeof g.title=="function"?g.title():g.title:O.createElement(O.Fragment,null,ge||g.icon||g.promise?O.createElement("div",{"data-icon":"",className:Ee(F?.icon,(i=g?.classNames)==null?void 0:i.icon)},g.promise||g.type==="loading"&&!g.icon?g.icon||be():null,g.type!=="loading"?g.icon||U?.[ge]||Mc(ge):null):null,O.createElement("div",{"data-content":"",className:Ee(F?.content,(l=g?.classNames)==null?void 0:l.content)},O.createElement("div",{"data-title":"",className:Ee(F?.title,(u=g?.classNames)==null?void 0:u.title)},typeof g.title=="function"?g.title():g.title),g.description?O.createElement("div",{"data-description":"",className:Ee(Q,Jt,F?.description,(m=g?.classNames)==null?void 0:m.description)},typeof g.description=="function"?g.description():g.description):null),d.isValidElement(g.cancel)?g.cancel:g.cancel&&_t(g.cancel)?O.createElement("button",{"data-button":!0,"data-cancel":!0,style:g.cancelButtonStyle||P,onClick:K=>{var re,le;_t(g.cancel)&&Ae&&((le=(re=g.cancel).onClick)==null||le.call(re,K),pe())},className:Ee(F?.cancelButton,(c=g?.classNames)==null?void 0:c.cancelButton)},g.cancel.label):null,d.isValidElement(g.action)?g.action:g.action&&_t(g.action)?O.createElement("button",{"data-button":!0,"data-action":!0,style:g.actionButtonStyle||$,onClick:K=>{var re,le;_t(g.action)&&((le=(re=g.action).onClick)==null||le.call(re,K),!K.defaultPrevented&&pe())},className:Ee(F?.actionButton,(w=g?.classNames)==null?void 0:w.actionButton)},g.action.label):null))};function qa(){if(typeof window>"u"||typeof document>"u")return"ltr";let s=document.documentElement.getAttribute("dir");return s==="auto"||!s?window.getComputedStyle(document.documentElement).direction:s}function nd(s,e){let t={};return[s,e].forEach((a,n)=>{let o=n===1,i=o?"--mobile-offset":"--offset",l=o?Qc:Xc;function u(m){["top","right","bottom","left"].forEach(c=>{t[`${i}-${c}`]=typeof m=="number"?`${m}px`:m})}typeof a=="number"||typeof a=="string"?u(a):typeof a=="object"?["top","right","bottom","left"].forEach(m=>{a[m]===void 0?t[`${i}-${m}`]=l:t[`${i}-${m}`]=typeof a[m]=="number"?`${a[m]}px`:a[m]}):u(l)}),t}var od=d.forwardRef(function(s,e){let{invert:t,position:a="bottom-right",hotkey:n=["altKey","KeyT"],expand:o,closeButton:i,className:l,offset:u,mobileOffset:m,theme:c="light",richColors:w,duration:y,style:g,visibleToasts:S=Jc,toastOptions:E,dir:R=qa(),gap:v=ed,loadingIcon:h,icons:f,containerAriaLabel:p="Notifications",pauseWhenPageIsHidden:x}=s,[C,D]=O.useState([]),j=O.useMemo(()=>Array.from(new Set([a].concat(C.filter(V=>V.position).map(V=>V.position)))),[C,a]),[N,P]=O.useState([]),[$,Z]=O.useState(!1),[Q,L]=O.useState(!1),[ne,te]=O.useState(c!=="system"?c:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),J=O.useRef(null),me=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),F=O.useRef(null),U=O.useRef(!1),ae=O.useCallback(V=>{D(Y=>{var X;return(X=Y.find(oe=>oe.id===V.id))!=null&&X.delete||he.dismiss(V.id),Y.filter(({id:oe})=>oe!==V.id)})},[]);return O.useEffect(()=>he.subscribe(V=>{if(V.dismiss){D(Y=>Y.map(X=>X.id===V.id?{...X,delete:!0}:X));return}setTimeout(()=>{wn.flushSync(()=>{D(Y=>{let X=Y.findIndex(oe=>oe.id===V.id);return X!==-1?[...Y.slice(0,X),{...Y[X],...V},...Y.slice(X+1)]:[V,...Y]})})})}),[]),O.useEffect(()=>{if(c!=="system"){te(c);return}if(c==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?te("dark"):te("light")),typeof window>"u")return;let V=window.matchMedia("(prefers-color-scheme: dark)");try{V.addEventListener("change",({matches:Y})=>{te(Y?"dark":"light")})}catch{V.addListener(({matches:X})=>{try{te(X?"dark":"light")}catch(oe){console.error(oe)}})}},[c]),O.useEffect(()=>{C.length<=1&&Z(!1)},[C]),O.useEffect(()=>{let V=Y=>{var X,oe;n.every(B=>Y[B]||Y.code===B)&&(Z(!0),(X=J.current)==null||X.focus()),Y.code==="Escape"&&(document.activeElement===J.current||(oe=J.current)!=null&&oe.contains(document.activeElement))&&Z(!1)};return document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)},[n]),O.useEffect(()=>{if(J.current)return()=>{F.current&&(F.current.focus({preventScroll:!0}),F.current=null,U.current=!1)}},[J.current]),O.createElement("section",{ref:e,"aria-label":`${p} ${me}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},j.map((V,Y)=>{var X;let[oe,B]=V.split("-");return C.length?O.createElement("ol",{key:V,dir:R==="auto"?qa():R,tabIndex:-1,ref:J,className:l,"data-sonner-toaster":!0,"data-theme":ne,"data-y-position":oe,"data-lifted":$&&C.length>1&&!o,"data-x-position":B,style:{"--front-toast-height":`${((X=N[0])==null?void 0:X.height)||0}px`,"--width":`${Zc}px`,"--gap":`${v}px`,...g,...nd(u,m)},onBlur:H=>{U.current&&!H.currentTarget.contains(H.relatedTarget)&&(U.current=!1,F.current&&(F.current.focus({preventScroll:!0}),F.current=null))},onFocus:H=>{H.target instanceof HTMLElement&&H.target.dataset.dismissible==="false"||U.current||(U.current=!0,F.current=H.relatedTarget)},onMouseEnter:()=>Z(!0),onMouseMove:()=>Z(!0),onMouseLeave:()=>{Q||Z(!1)},onDragEnd:()=>Z(!1),onPointerDown:H=>{H.target instanceof HTMLElement&&H.target.dataset.dismissible==="false"||L(!0)},onPointerUp:()=>L(!1)},C.filter(H=>!H.position&&Y===0||H.position===V).map((H,T)=>{var k,b;return O.createElement(rd,{key:H.id,icons:f,index:T,toast:H,defaultRichColors:w,duration:(k=E?.duration)!=null?k:y,className:E?.className,descriptionClassName:E?.descriptionClassName,invert:t,visibleToasts:S,closeButton:(b=E?.closeButton)!=null?b:i,interacting:Q,position:V,style:E?.style,unstyled:E?.unstyled,classNames:E?.classNames,cancelButtonStyle:E?.cancelButtonStyle,actionButtonStyle:E?.actionButtonStyle,removeToast:ae,toasts:C.filter(A=>A.position==H.position),heights:N.filter(A=>A.position==H.position),setHeights:P,expandByDefault:o,gap:v,loadingIcon:h,expanded:$,pauseWhenPageIsHidden:x,swipeDirections:s.swipeDirections})})):null}))});const id=({...s})=>r.jsx(od,{theme:"light",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s}),ld=({onClose:s})=>{const[e,t]=d.useState(null),[a,n]=d.useState(!1),[o,i]=d.useState(!1),[l,u]=d.useState(navigator.onLine);d.useEffect(()=>{const w=()=>{window.matchMedia("(display-mode: standalone)").matches&&i(!0)},y=R=>{R.preventDefault(),t(R),setTimeout(()=>{o||n(!0)},3e3)},g=()=>{i(!0),n(!1),t(null),console.log("PWA was installed")},S=()=>u(!0),E=()=>u(!1);return w(),window.addEventListener("beforeinstallprompt",y),window.addEventListener("appinstalled",g),window.addEventListener("online",S),window.addEventListener("offline",E),()=>{window.removeEventListener("beforeinstallprompt",y),window.removeEventListener("appinstalled",g),window.removeEventListener("online",S),window.removeEventListener("offline",E)}},[o]);const m=async()=>{if(e)try{await e.prompt();const{outcome:w}=await e.userChoice;console.log(w==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),t(null),n(!1)}catch(w){console.error("Error during installation:",w)}},c=()=>{n(!1),s?.()};return!a||o?null:r.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-sm",children:r.jsxs(ke,{className:"shadow-lg border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-white",children:[r.jsxs(Kt,{className:"pb-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(rt,{className:"h-5 w-5 text-blue-600"}),r.jsx(Yt,{className:"text-lg",children:"安装 CardAll"})]}),r.jsx(G,{variant:"ghost",size:"sm",onClick:c,className:"h-6 w-6 p-0",children:r.jsx(Ye,{className:"h-4 w-4"})})]}),r.jsx(zr,{children:"将 CardAll 安装到您的设备上，享受更好的体验"})]}),r.jsxs(Ne,{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[l?r.jsx(Ks,{className:"h-4 w-4"}):r.jsx(Wn,{className:"h-4 w-4"}),r.jsx("span",{children:l?"在线使用":"离线可用"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[r.jsx(Vn,{className:"h-4 w-4"}),r.jsx("span",{children:"移动优化"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[r.jsx(Hn,{className:"h-4 w-4"}),r.jsx("span",{children:"桌面应用"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[r.jsx(rt,{className:"h-4 w-4"}),r.jsx("span",{children:"快速启动"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium text-sm",children:"安装后您将获得："}),r.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[r.jsx("li",{children:"• 完全离线功能"}),r.jsx("li",{children:"• 更快的加载速度"}),r.jsx("li",{children:"• 桌面快捷方式"}),r.jsx("li",{children:"• 推送通知支持"})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(G,{onClick:m,className:"flex-1 bg-blue-600 hover:bg-blue-700",disabled:!e,children:[r.jsx(rt,{className:"h-4 w-4 mr-2"}),"立即安装"]}),r.jsx(G,{variant:"outline",onClick:c,className:"px-3",children:"稍后"})]})]})]})})},cd=zt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),at=d.forwardRef(({className:s,variant:e,...t},a)=>r.jsx("div",{ref:a,role:"alert",className:M(cd({variant:e}),s),...t}));at.displayName="Alert";const dd=d.forwardRef(({className:s,...e},t)=>r.jsx("h5",{ref:t,className:M("mb-1 font-medium leading-none tracking-tight",s),...e}));dd.displayName="AlertTitle";const st=d.forwardRef(({className:s,...e},t)=>r.jsx("div",{ref:t,className:M("text-sm [&_p]:leading-relaxed",s),...e}));st.displayName="AlertDescription";function ud({initializationError:s}){return r.jsxs("div",{className:"min-h-screen bg-background",children:[s&&r.jsx("div",{className:"border-b bg-destructive/5",children:r.jsx("div",{className:"container mx-auto px-4 py-2",children:r.jsxs(at,{variant:"destructive",className:"mb-0",children:[r.jsx(nt,{className:"h-4 w-4"}),r.jsx(st,{children:s})]})})}),r.jsx(So,{children:r.jsx(gi,{children:r.jsx(fi,{children:r.jsx(Tc,{})})})}),r.jsx(ld,{}),r.jsx(id,{})]})}function Ja({initializationError:s}){return r.jsx(_c,{defaultTheme:"light",storageKey:"cardall-theme",children:r.jsx(ud,{initializationError:s})})}class md{async hasLegacyData(){const e=!!localStorage.getItem("cardall-cards"),t=!!localStorage.getItem("cardall-folders"),a=!!localStorage.getItem("cardall-tags");return e||t||a}async migrateFromLocalStorage(){const e={success:!1,migratedCards:0,migratedFolders:0,migratedTags:0,migratedImages:0,errors:[]};try{console.log("Starting migration from localStorage...");const t=await this.migrateFolders();e.migratedFolders=t.length;const a=await this.migrateTags();e.migratedTags=a.length;const{cards:n,images:o}=await this.migrateCards();e.migratedCards=n.length,e.migratedImages=o,e.success=!0,console.log("Migration completed successfully:",e),await this.backupLegacyData()}catch(t){console.error("Migration failed:",t),e.errors.push(t instanceof Error?t.message:"Unknown error")}return e}async migrateFolders(){const e=localStorage.getItem("cardall-folders");if(!e)return[];try{const a=JSON.parse(e).map(n=>({...n,syncVersion:1,pendingSync:!0}));return await _.folders.bulkAdd(a),console.log(`Migrated ${a.length} folders`),a}catch(t){throw console.error("Failed to migrate folders:",t),t}}async migrateTags(){const e=localStorage.getItem("cardall-tags");if(!e)return[];try{const a=JSON.parse(e).map(n=>({...n,syncVersion:1,pendingSync:!0}));return await _.tags.bulkAdd(a),console.log(`Migrated ${a.length} tags`),a}catch(t){throw console.error("Failed to migrate tags:",t),t}}async migrateCards(){const e=localStorage.getItem("cardall-cards");if(!e)return{cards:[],images:0};try{const t=JSON.parse(e),a=[];let n=0;for(const o of t){const i=await this.migrateCardImages(o.frontContent.images,o.id,o.folderId),l=await this.migrateCardImages(o.backContent.images,o.id,o.folderId);n+=i.length+l.length;const u={...o,frontContent:{...o.frontContent,images:i},backContent:{...o.backContent,images:l},syncVersion:1,pendingSync:!0};a.push(u)}return await _.cards.bulkAdd(a),console.log(`Migrated ${a.length} cards with ${n} images`),{cards:a,images:n}}catch(t){throw console.error("Failed to migrate cards:",t),t}}async migrateCardImages(e,t,a){const n=[];for(const o of e)try{if(o.url&&o.url.startsWith("data:")){const i=await this.base64ToBlob(o.url),l=new File([i],o.alt||"migrated-image.jpg",{type:i.type}),u=await He.saveImage(l,t,a);n.push({id:u.id,url:u.filePath,alt:o.alt,width:u.metadata.width,height:u.metadata.height,position:o.position,size:o.size,aspectRatio:u.metadata.width/u.metadata.height})}else n.push(o)}catch(i){console.error("Failed to migrate image:",i),n.push(o)}return n}async base64ToBlob(e){return(await fetch(e)).blob()}async backupLegacyData(){const e={cards:localStorage.getItem("cardall-cards"),folders:localStorage.getItem("cardall-folders"),tags:localStorage.getItem("cardall-tags"),hiddenTags:localStorage.getItem("cardall-hidden-tags"),timestamp:new Date().toISOString()};await _.settings.add({key:"legacy_backup",value:e,updatedAt:new Date}),console.log("Legacy data backed up successfully")}async cleanupLegacyData(){["cardall-cards","cardall-folders","cardall-tags","cardall-hidden-tags"].forEach(t=>localStorage.removeItem(t)),console.log("Legacy localStorage data cleaned up")}async restoreFromBackup(){try{const e=await _.settings.where("key").equals("legacy_backup").first();if(!e)return console.log("No backup data found"),!1;const t=e.value;return t.cards&&localStorage.setItem("cardall-cards",t.cards),t.folders&&localStorage.setItem("cardall-folders",t.folders),t.tags&&localStorage.setItem("cardall-tags",t.tags),t.hiddenTags&&localStorage.setItem("cardall-hidden-tags",t.hiddenTags),console.log("Backup data restored to localStorage"),!0}catch(e){return console.error("Failed to restore backup:",e),!1}}async getMigrationStatus(){const e=await this.hasLegacyData(),t=await _.getStats(),a=t.cards>0||t.folders>0||t.tags>0;return{hasLegacyData:e,hasMigratedData:a,migrationNeeded:e&&!a}}}const la=new md;class gd{listeners=[];onStatusChange(e){return this.listeners.push(e),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}updateStatus(e){this.listeners.forEach(t=>t(e))}async initialize(){console.log("开始应用初始化...");const e={success:!1,fileSystemAccess:!1};try{console.log("步骤1: 开始初始化数据库..."),this.updateStatus({step:"database",progress:10,message:"正在初始化数据库...",isComplete:!1,hasError:!1}),console.log("调用 initializeDatabase()...");try{await xn(),console.log("数据库初始化完成"),this.updateStatus({step:"database",progress:20,message:"数据库初始化完成",isComplete:!0,hasError:!1})}catch(t){throw console.error("数据库初始化失败:",t),new Error(`数据库初始化失败: ${t instanceof Error?t.message:"未知错误"}`)}this.updateStatus({step:"migration-check",progress:25,message:"检查数据迁移需求...",isComplete:!1,hasError:!1});try{if((await la.getMigrationStatus()).migrationNeeded&&(this.updateStatus({step:"migration",progress:40,message:"正在迁移现有数据...",isComplete:!1,hasError:!1}),e.migrationResult=await la.migrateFromLocalStorage(),!e.migrationResult.success))throw new Error(`数据迁移失败: ${e.migrationResult.errors.join(", ")}`)}catch(t){console.error("数据迁移检查失败:",t),this.updateStatus({step:"migration-check",progress:30,message:"数据迁移检查失败，跳过迁移",isComplete:!0,hasError:!1})}if(this.updateStatus({step:"filesystem",progress:60,message:"配置文件系统访问权限...",isComplete:!1,hasError:!1}),He.isFileSystemAccessSupported())try{await He.getStorageStrategy()==="filesystem"?(e.fileSystemAccess=await He.requestDirectoryAccess(),e.fileSystemAccess||console.warn("文件系统访问权限未获得，将使用IndexedDB存储")):(console.info("使用已配置的IndexedDB存储策略"),e.fileSystemAccess=!1)}catch(t){console.warn("文件系统访问请求失败，使用降级存储:",t),e.fileSystemAccess=!1}else console.info("浏览器不支持File System Access API，使用IndexedDB存储"),e.fileSystemAccess=!1;this.updateStatus({step:"sync",progress:85,message:"云端同步功能已删除，使用纯本地模式",isComplete:!0,hasError:!1}),console.log("云端同步功能已删除，使用纯本地存储模式"),this.updateStatus({step:"complete",progress:100,message:"应用初始化完成",isComplete:!0,hasError:!1}),e.success=!0,console.log("应用初始化成功:",e)}catch(t){console.error("应用初始化失败:",t),this.updateStatus({step:"error",progress:0,message:`初始化失败: ${t instanceof Error?t.message:"未知错误"}`,isComplete:!1,hasError:!0,error:t instanceof Error?t.message:"未知错误"}),e.success=!1,e.error=t instanceof Error?t.message:"未知错误"}return e}async reinitialize(){return console.log("重新初始化应用..."),this.initialize()}async checkInitializationStatus(){try{const e=await la.getMigrationStatus();return{databaseReady:!0,syncServiceReady:!1,fileSystemAccess:He.isFileSystemAccessSupported(),migrationNeeded:e.migrationNeeded}}catch(e){return console.error("检查初始化状态失败:",e),{databaseReady:!1,syncServiceReady:!1,fileSystemAccess:!1,migrationNeeded:!1}}}}const Xa=new gd;function fd({onInitialized:s,onError:e,onSkipInitialization:t}){const[a,n]=d.useState({step:"starting",progress:0,message:"准备初始化...",isComplete:!1,hasError:!1}),[o,i]=d.useState(!1),[l,u]=d.useState(null),m=async()=>{console.log("开始初始化流程..."),console.log("时间戳:",new Date().toISOString()),i(!0),u(null);try{console.log("调用appInitService.initialize()...");const y=await Xa.initialize();console.log("初始化结果:",y),console.log("结果详情:",JSON.stringify(y,null,2)),u(y),y.success?(console.log("初始化成功，准备进入应用..."),console.log("成功时间戳:",new Date().toISOString()),setTimeout(()=>{s(y)},1e3)):(console.log("初始化失败:",y.error),console.log("失败时间戳:",new Date().toISOString()))}catch(y){console.error("初始化过程出错:",y),console.error("错误时间戳:",new Date().toISOString()),e&&e(y instanceof Error?y.message:"初始化失败")}finally{i(!1)}};d.useEffect(()=>{console.log("设置状态监听器...");const y=Xa.onStatusChange(g=>{console.log("收到状态更新:",g),n(g)});return console.log("状态监听器设置完成"),y},[]),d.useEffect(()=>{m()},[]);const c=(y,g,S)=>g?r.jsx(ua,{className:"h-5 w-5 text-destructive"}):S?r.jsx(Ft,{className:"h-5 w-5 text-green-500"}):r.jsx(ma,{className:"h-5 w-5 animate-spin text-blue-500"}),w=y=>({database:"初始化本地数据库，设置数据存储结构","migration-check":"检查是否有需要从localStorage迁移的数据",migration:"将现有数据迁移到新的数据库结构",filesystem:"请求文件系统访问权限以支持本地文件存储",sync:ha.enableCloudSync?"初始化同步服务，准备离线和在线数据同步":"云端同步功能已禁用，使用本地存储模式",complete:"所有组件初始化完成，应用准备就绪"})[y]||"正在处理...";return r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:r.jsxs(ke,{className:"w-full max-w-md",children:[r.jsx(Kt,{className:"text-center",children:r.jsxs(Yt,{className:"flex items-center justify-center gap-2",children:[r.jsx(Lt,{className:"h-6 w-6 text-blue-600"}),"CardAll 初始化"]})}),r.jsxs(Ne,{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{children:"初始化进度"}),r.jsxs("span",{children:[a.progress,"%"]})]}),r.jsx(et,{value:a.progress,className:"h-2"})]}),r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg",children:[c(a.step,a.hasError,a.isComplete),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium",children:a.message}),r.jsx("div",{className:"text-sm text-muted-foreground",children:w(a.step)})]})]}),a.hasError&&a.error&&r.jsxs(at,{variant:"destructive",children:[r.jsx(ua,{className:"h-4 w-4"}),r.jsx(st,{children:a.error})]}),l?.migrationResult&&r.jsxs(at,{children:[r.jsx(Ft,{className:"h-4 w-4"}),r.jsxs(st,{children:["数据迁移完成: ",l.migrationResult.migratedCards," 张卡片, "," ",l.migrationResult.migratedFolders," 个文件夹, "," ",l.migrationResult.migratedTags," 个标签, "," ",l.migrationResult.migratedImages," 张图片"]})]}),!ha.enableCloudSync&&r.jsxs(at,{children:[r.jsx(Gn,{className:"h-4 w-4"}),r.jsx(st,{children:"云端同步功能已禁用，应用将在本地存储模式下运行"})]}),l&&r.jsxs(at,{variant:l.fileSystemAccess?"default":"destructive",children:[r.jsx(Lt,{className:"h-4 w-4"}),r.jsx(st,{children:l.fileSystemAccess?"文件系统访问权限已获得，支持本地文件存储":"未获得文件系统访问权限，将使用浏览器内置存储"})]}),r.jsxs("div",{className:"flex gap-2",children:[a.hasError&&r.jsxs(r.Fragment,{children:[r.jsx(G,{onClick:m,disabled:o,className:"flex-1",children:o?r.jsxs(r.Fragment,{children:[r.jsx(ma,{className:"h-4 w-4 mr-2 animate-spin"}),"重试中..."]}):"重试初始化"}),t&&r.jsx(G,{onClick:t,variant:"outline",className:"flex-1",children:"跳过初始化"})]}),l?.success&&r.jsxs(G,{onClick:()=>s(l),className:"flex-1",children:[r.jsx(Ft,{className:"h-4 w-4 mr-2"}),"进入应用"]})]}),r.jsxs("div",{className:"text-xs text-muted-foreground text-center space-y-1",children:[r.jsx("p",{children:"首次启动需要初始化数据库和同步服务"}),r.jsx("p",{children:"如果有现有数据，将自动迁移到新的存储结构"})]})]})]})})}function hd(){const[s,e]=d.useState({isInitialized:!1,hasError:!1,canSkip:!1}),t=o=>{console.log("应用初始化完成:",o),e({isInitialized:!0,hasError:!1,canSkip:!1})},a=o=>{console.error("应用初始化失败:",o),e(i=>({...i,hasError:!0,error:o,canSkip:!0}))},n=()=>{console.warn("用户选择跳过初始化，应用将以降级模式运行"),e({isInitialized:!0,hasError:!0,canSkip:!1,error:"应用以降级模式运行，某些功能可能不可用"})};return!s.isInitialized||s.hasError&&!s.canSkip?r.jsx(fd,{onInitialized:t,onError:a,onSkipInitialization:s.canSkip?n:void 0}):s.hasError?r.jsx(Ja,{initializationError:s.error}):r.jsx(Ja,{})}ga.createRoot(document.getElementById("root")).render(r.jsx(O.StrictMode,{children:r.jsx(hd,{})}));
