<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3 æœåŠ¡æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .loading {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Phase 3 æœåŠ¡æµ‹è¯•</h1>

        <div class="test-result info">
            <strong>è¯´æ˜ï¼š</strong>æ­¤æµ‹è¯•é¡µé¢ç”¨äºéªŒè¯Phase 3æœåŠ¡çš„åˆå§‹åŒ–å’ŒåŸºæœ¬åŠŸèƒ½ã€‚ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚
        </div>

        <button id="runTestsBtn" onclick="runTests()">è¿è¡Œæµ‹è¯•</button>
        <button id="clearResultsBtn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>

        <div id="testResults"></div>
    </div>

    <script type="module">
        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.runTests = async function() {
            const resultsDiv = document.getElementById('testResults');
            const runBtn = document.getElementById('runTestsBtn');

            runBtn.disabled = true;
            resultsDiv.innerHTML = '<div class="test-result loading">æ­£åœ¨è¿è¡Œæµ‹è¯•...</div>';

            try {
                // æµ‹è¯•1: æ£€æŸ¥æ¨¡å—å¯¼å…¥
                addTestResult('æµ‹è¯•1: æ£€æŸ¥æ¨¡å—å¯¼å…¥', 'loading', 'æ­£åœ¨æ£€æŸ¥æ¨¡å—å¯¼å…¥...');

                // åŠ¨æ€å¯¼å…¥æœåŠ¡æ¨¡å—
                const [
                    { Phase3Integration },
                    { PerformanceMonitor },
                    { DataEncryptionService },
                    { ConflictResolutionEngine },
                    { EnhancedOfflineManager },
                    { EnhancedCloudSync }
                ] = await Promise.all([
                    import('/src/integrations/phase3-integration.ts'),
                    import('/src/services/performance/performance-monitor.ts'),
                    import('/src/services/security/data-encryption-service.ts'),
                    import('/src/services/conflict/conflict-resolution-engine.ts'),
                    import('/src/services/offline/enhanced-offline-manager.ts'),
                    import('/src/services/sync/enhanced-cloud-sync.ts')
                ]);

                addTestResult('æµ‹è¯•1: æ£€æŸ¥æ¨¡å—å¯¼å…¥', 'success', 'æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸ âœ“');

                // æµ‹è¯•2: PerformanceMonitor åˆå§‹åŒ–
                addTestResult('æµ‹è¯•2: PerformanceMonitor åˆå§‹åŒ–', 'loading', 'æ­£åœ¨åˆå§‹åŒ– PerformanceMonitor...');

                const performanceMonitor = new PerformanceMonitor({
                    metricsInterval: 1000,
                    analysisInterval: 5000,
                    enableRealTimeAnalysis: true,
                    enableAutomaticAlerts: true,
                    alertThresholds: {
                        responseTime: { warning: 1000, critical: 2000 },
                        errorRate: { warning: 0.05, critical: 0.1 },
                        memoryUsage: { warning: 0.7, critical: 0.9 },
                        cpuUsage: { warning: 0.8, critical: 0.95 }
                    }
                });

                await performanceMonitor.initialize();
                addTestResult('æµ‹è¯•2: PerformanceMonitor åˆå§‹åŒ–', 'success',
                    `PerformanceMonitor åˆå§‹åŒ–æˆåŠŸ âœ“<br>çŠ¶æ€: ${performanceMonitor.isInitialized() ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`);

                // æµ‹è¯•3: DataEncryptionService åˆå§‹åŒ–
                addTestResult('æµ‹è¯•3: DataEncryptionService åˆå§‹åŒ–', 'loading', 'æ­£åœ¨åˆå§‹åŒ– DataEncryptionService...');

                const encryptionService = new DataEncryptionService({
                    algorithm: 'AES-256-GCM',
                    keyDerivation: 'PBKDF2',
                    keyRotationDays: 30,
                    enableAuditLogging: true,
                    enableCompliance: true
                });

                await encryptionService.initialize();
                const encryptionStatus = encryptionService.getStatus();
                addTestResult('æµ‹è¯•3: DataEncryptionService åˆå§‹åŒ–', 'success',
                    `DataEncryptionService åˆå§‹åŒ–æˆåŠŸ âœ“<br>çŠ¶æ€: ${encryptionStatus.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}<br>æ´»è·ƒå¯†é’¥ID: ${encryptionStatus.activeKeyId || 'æ— '}`);

                // æµ‹è¯•4: ConflictResolutionEngine åˆå§‹åŒ–
                addTestResult('æµ‹è¯•4: ConflictResolutionEngine åˆå§‹åŒ–', 'loading', 'æ­£åœ¨åˆå§‹åŒ– ConflictResolutionEngine...');

                const conflictEngine = new ConflictResolutionEngine({
                    enableAutoResolve: true,
                    enableSmartMerge: true,
                    maxRetryAttempts: 3,
                    conflictThreshold: 0.8
                });

                await conflictEngine.initialize();
                const engineStatus = conflictEngine.getStatus();
                addTestResult('æµ‹è¯•4: ConflictResolutionEngine åˆå§‹åŒ–', 'success',
                    `ConflictResolutionEngine åˆå§‹åŒ–æˆåŠŸ âœ“<br>çŠ¶æ€: ${engineStatus.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`);

                // æµ‹è¯•5: EnhancedOfflineManager åˆå§‹åŒ–
                addTestResult('æµ‹è¯•5: EnhancedOfflineManager åˆå§‹åŒ–', 'loading', 'æ­£åœ¨åˆå§‹åŒ– EnhancedOfflineManager...');

                const offlineManager = new EnhancedOfflineManager({
                    maxQueueSize: 1000,
                    compressionEnabled: true,
                    versionControlEnabled: true,
                    smartMergeEnabled: true,
                    networkAdaptiveSync: true
                });

                await offlineManager.initialize();
                const offlineStatus = offlineManager.getStatus();
                addTestResult('æµ‹è¯•5: EnhancedOfflineManager åˆå§‹åŒ–', 'success',
                    `EnhancedOfflineManager åˆå§‹åŒ–æˆåŠŸ âœ“<br>çŠ¶æ€: ${offlineStatus.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`);

                // æµ‹è¯•6: EnhancedCloudSync åˆå§‹åŒ–
                addTestResult('æµ‹è¯•6: EnhancedCloudSync åˆå§‹åŒ–', 'loading', 'æ­£åœ¨åˆå§‹åŒ– EnhancedCloudSync...');

                const cloudSync = new EnhancedCloudSync({
                    enableIncrementalSync: true,
                    enableConflictPrevention: true,
                    enableCompression: true,
                    enableNetworkAdaptation: true,
                    syncInterval: 30000,
                    batchSize: 50,
                    retryAttempts: 3
                });

                await cloudSync.initialize();
                const syncStatus = cloudSync.getStatus();
                addTestResult('æµ‹è¯•6: EnhancedCloudSync åˆå§‹åŒ–', 'success',
                    `EnhancedCloudSync åˆå§‹åŒ–æˆåŠŸ âœ“<br>çŠ¶æ€: ${syncStatus.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`);

                // æµ‹è¯•7: Phase3Integration åˆå§‹åŒ–
                addTestResult('æµ‹è¯•7: Phase3Integration åˆå§‹åŒ–', 'loading', 'æ­£åœ¨åˆå§‹åŒ– Phase3Integration...');

                const integration = await Phase3Integration.initialize({
                    enablePerformanceMonitor: true,
                    enableDataEncryption: true,
                    enableConflictResolution: true,
                    enableEnhancedOffline: true,
                    enableEnhancedCloudSync: true,
                    performanceMonitor: {
                        metricsInterval: 1000,
                        analysisInterval: 5000,
                        enableRealTimeAnalysis: true,
                        enableAutomaticAlerts: true
                    },
                    dataEncryption: {
                        algorithm: 'AES-256-GCM',
                        keyDerivation: 'PBKDF2',
                        keyRotationDays: 30,
                        enableAuditLogging: true,
                        enableCompliance: true
                    },
                    conflictResolution: {
                        enableAutoResolve: true,
                        enableSmartMerge: true,
                        maxRetryAttempts: 3,
                        conflictThreshold: 0.8
                    },
                    enhancedOffline: {
                        maxQueueSize: 1000,
                        compressionEnabled: true,
                        versionControlEnabled: true,
                        smartMergeEnabled: true,
                        networkAdaptiveSync: true
                    },
                    enhancedCloudSync: {
                        enableIncrementalSync: true,
                        enableConflictPrevention: true,
                        enableCompression: true,
                        enableNetworkAdaptation: true,
                        syncInterval: 30000,
                        batchSize: 50,
                        retryAttempts: 3
                    }
                });

                addTestResult('æµ‹è¯•7: Phase3Integration åˆå§‹åŒ–', 'success',
                    `Phase3Integration åˆå§‹åŒ–æˆåŠŸ âœ“<br>æ•´ä½“çŠ¶æ€: ${integration.isInitialized() ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`);

                // è·å–ç³»ç»ŸçŠ¶æ€
                const systemStatus = integration.getSystemStatus();
                const services = integration.getServices();

                addTestResult('æµ‹è¯•8: ç³»ç»ŸçŠ¶æ€æ£€æŸ¥', 'success',
                    `ç³»ç»ŸçŠ¶æ€æ£€æŸ¥æˆåŠŸ âœ“<br>` +
                    `æœåŠ¡çŠ¶æ€:<br>` +
                    `- PerformanceMonitor: ${services.performanceMonitor ? 'âœ“' : 'âœ—'}<br>` +
                    `- DataEncryptionService: ${services.dataEncryption ? 'âœ“' : 'âœ—'}<br>` +
                    `- ConflictResolutionEngine: ${services.conflictResolution ? 'âœ“' : 'âœ—'}<br>` +
                    `- EnhancedOfflineManager: ${services.enhancedOffline ? 'âœ“' : 'âœ—'}<br>` +
                    `- EnhancedCloudSync: ${services.enhancedCloudSync ? 'âœ“' : 'âœ—'}`);

                addTestResult('ğŸ‰ æµ‹è¯•å®Œæˆ', 'success', 'æ‰€æœ‰Phase 3æœåŠ¡æµ‹è¯•é€šè¿‡ï¼ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªã€‚');

                // æ¸…ç†èµ„æº
                await Promise.all([
                    performanceMonitor.cleanup(),
                    encryptionService.cleanup(),
                    conflictEngine.cleanup(),
                    offlineManager.cleanup(),
                    cloudSync.cleanup(),
                    integration.cleanup()
                ]);

            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                addTestResult('âŒ æµ‹è¯•å¤±è´¥', 'error',
                    `æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:<br>` +
                    `<strong>${error.message}</strong><br><br>` +
                    `<details><summary>æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</summary><pre>${error.stack}</pre></details>`);
            } finally {
                runBtn.disabled = false;
            }
        };

        window.clearResults = function() {
            document.getElementById('testResults').innerHTML = '';
        };

        function addTestResult(title, type, message) {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<strong>${title}</strong><br>${message}`;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ·»åŠ æç¤º
        window.addEventListener('load', function() {
            addTestResult('é¡µé¢åŠ è½½å®Œæˆ', 'info', 'ç‚¹å‡»"è¿è¡Œæµ‹è¯•"æŒ‰é’®å¼€å§‹æµ‹è¯•Phase 3æœåŠ¡ã€‚');
        });
    </script>
</body>
</html>