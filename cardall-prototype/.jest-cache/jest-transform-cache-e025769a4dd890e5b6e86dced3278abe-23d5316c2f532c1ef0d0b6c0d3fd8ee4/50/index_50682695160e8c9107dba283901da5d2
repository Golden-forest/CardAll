238f394dbcbd49a27a1fb5e671fc0340
'use strict';
Object.defineProperty(exports, '__esModule', {
    value: true
});
Object.defineProperty(exports, 'DIFF_DELETE', {
    enumerable: true,
    get: function () {
        return _cleanupSemantic.DIFF_DELETE;
    }
});
Object.defineProperty(exports, 'DIFF_EQUAL', {
    enumerable: true,
    get: function () {
        return _cleanupSemantic.DIFF_EQUAL;
    }
});
Object.defineProperty(exports, 'DIFF_INSERT', {
    enumerable: true,
    get: function () {
        return _cleanupSemantic.DIFF_INSERT;
    }
});
Object.defineProperty(exports, 'Diff', {
    enumerable: true,
    get: function () {
        return _cleanupSemantic.Diff;
    }
});
exports.diff = diff;
Object.defineProperty(exports, 'diffLinesRaw', {
    enumerable: true,
    get: function () {
        return _diffLines.diffLinesRaw;
    }
});
Object.defineProperty(exports, 'diffLinesUnified', {
    enumerable: true,
    get: function () {
        return _diffLines.diffLinesUnified;
    }
});
Object.defineProperty(exports, 'diffLinesUnified2', {
    enumerable: true,
    get: function () {
        return _diffLines.diffLinesUnified2;
    }
});
Object.defineProperty(exports, 'diffStringsRaw', {
    enumerable: true,
    get: function () {
        return _printDiffs.diffStringsRaw;
    }
});
Object.defineProperty(exports, 'diffStringsUnified', {
    enumerable: true,
    get: function () {
        return _printDiffs.diffStringsUnified;
    }
});
var _chalk = _interopRequireDefault(require('chalk'));
var _jestGetType = require('jest-get-type');
var _prettyFormat = require('pretty-format');
var _cleanupSemantic = require('./cleanupSemantic');
var _constants = require('./constants');
var _diffLines = require('./diffLines');
var _normalizeDiffOptions = require('./normalizeDiffOptions');
var _printDiffs = require('./printDiffs');
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}
var Symbol = globalThis['jest-symbol-do-not-touch'] || globalThis.Symbol;
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
const getCommonMessage = (message, options) => {
    const { commonColor } = (0, _normalizeDiffOptions.normalizeDiffOptions)(options);
    return commonColor(message);
};
const { AsymmetricMatcher, DOMCollection, DOMElement, Immutable, ReactElement, ReactTestComponent } = _prettyFormat.plugins;
const PLUGINS = [
    ReactTestComponent,
    ReactElement,
    DOMElement,
    DOMCollection,
    Immutable,
    AsymmetricMatcher
];
const FORMAT_OPTIONS = {
    plugins: PLUGINS
};
const FALLBACK_FORMAT_OPTIONS = {
    callToJSON: false,
    maxDepth: 10,
    plugins: PLUGINS
};
// Generate a string that will highlight the difference between two values
// with green and red. (similar to how github does code diffing)
// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function diff(a, b, options) {
    if (Object.is(a, b)) {
        return getCommonMessage(_constants.NO_DIFF_MESSAGE, options);
    }
    const aType = (0, _jestGetType.getType)(a);
    let expectedType = aType;
    let omitDifference = false;
    if (aType === 'object' && typeof a.asymmetricMatch === 'function') {
        if (a.$$typeof !== Symbol.for('jest.asymmetricMatcher')) {
            // Do not know expected type of user-defined asymmetric matcher.
            return null;
        }
        if (typeof a.getExpectedType !== 'function') {
            // For example, expect.anything() matches either null or undefined
            return null;
        }
        expectedType = a.getExpectedType();
        // Primitive types boolean and number omit difference below.
        // For example, omit difference for expect.stringMatching(regexp)
        omitDifference = expectedType === 'string';
    }
    if (expectedType !== (0, _jestGetType.getType)(b)) {
        return ('  Comparing two different types of values.' +
            ` Expected ${_chalk.default.green(expectedType)} but ` +
            `received ${_chalk.default.red((0, _jestGetType.getType)(b))}.`);
    }
    if (omitDifference) {
        return null;
    }
    switch (aType) {
        case 'string':
            return (0, _diffLines.diffLinesUnified)(a.split('\n'), b.split('\n'), options);
        case 'boolean':
        case 'number':
            return comparePrimitive(a, b, options);
        case 'map':
            return compareObjects(sortMap(a), sortMap(b), options);
        case 'set':
            return compareObjects(sortSet(a), sortSet(b), options);
        default:
            return compareObjects(a, b, options);
    }
}
function comparePrimitive(a, b, options) {
    const aFormat = (0, _prettyFormat.format)(a, FORMAT_OPTIONS);
    const bFormat = (0, _prettyFormat.format)(b, FORMAT_OPTIONS);
    return aFormat === bFormat
        ? getCommonMessage(_constants.NO_DIFF_MESSAGE, options)
        : (0, _diffLines.diffLinesUnified)(aFormat.split('\n'), bFormat.split('\n'), options);
}
function sortMap(map) {
    return new Map(Array.from(map.entries()).sort());
}
function sortSet(set) {
    return new Set(Array.from(set.values()).sort());
}
function compareObjects(a, b, options) {
    let difference;
    let hasThrown = false;
    try {
        const formatOptions = getFormatOptions(FORMAT_OPTIONS, options);
        difference = getObjectsDifference(a, b, formatOptions, options);
    }
    catch {
        hasThrown = true;
    }
    const noDiffMessage = getCommonMessage(_constants.NO_DIFF_MESSAGE, options);
    // If the comparison yields no results, compare again but this time
    // without calling `toJSON`. It's also possible that toJSON might throw.
    if (difference === undefined || difference === noDiffMessage) {
        const formatOptions = getFormatOptions(FALLBACK_FORMAT_OPTIONS, options);
        difference = getObjectsDifference(a, b, formatOptions, options);
        if (difference !== noDiffMessage && !hasThrown) {
            difference = `${getCommonMessage(_constants.SIMILAR_MESSAGE, options)}\n\n${difference}`;
        }
    }
    return difference;
}
function getFormatOptions(formatOptions, options) {
    const { compareKeys } = (0, _normalizeDiffOptions.normalizeDiffOptions)(options);
    return {
        ...formatOptions,
        compareKeys
    };
}
function getObjectsDifference(a, b, formatOptions, options) {
    const formatOptionsZeroIndent = {
        ...formatOptions,
        indent: 0
    };
    const aCompare = (0, _prettyFormat.format)(a, formatOptionsZeroIndent);
    const bCompare = (0, _prettyFormat.format)(b, formatOptionsZeroIndent);
    if (aCompare === bCompare) {
        return getCommonMessage(_constants.NO_DIFF_MESSAGE, options);
    }
    else {
        const aDisplay = (0, _prettyFormat.format)(a, formatOptions);
        const bDisplay = (0, _prettyFormat.format)(b, formatOptions);
        return (0, _diffLines.diffLinesUnified2)(aDisplay.split('\n'), bDisplay.split('\n'), aCompare.split('\n'), bCompare.split('\n'), options);
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXG5vZGVfbW9kdWxlc1xcamVzdC1heGVcXG5vZGVfbW9kdWxlc1xcamVzdC1kaWZmXFxidWlsZFxcaW5kZXguanMiLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0lBQzNDLEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsYUFBYSxFQUFFO0lBQzVDLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLEdBQUcsRUFBRTtRQUNILE9BQU8sZ0JBQWdCLENBQUMsV0FBVyxDQUFDO0lBQ3RDLENBQUM7Q0FDRixDQUFDLENBQUM7QUFDSCxNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUU7SUFDM0MsVUFBVSxFQUFFLElBQUk7SUFDaEIsR0FBRyxFQUFFO1FBQ0gsT0FBTyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7SUFDckMsQ0FBQztDQUNGLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLGFBQWEsRUFBRTtJQUM1QyxVQUFVLEVBQUUsSUFBSTtJQUNoQixHQUFHLEVBQUU7UUFDSCxPQUFPLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztJQUN0QyxDQUFDO0NBQ0YsQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFO0lBQ3JDLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLEdBQUcsRUFBRTtRQUNILE9BQU8sZ0JBQWdCLENBQUMsSUFBSSxDQUFDO0lBQy9CLENBQUM7Q0FDRixDQUFDLENBQUM7QUFDSCxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztBQUNwQixNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxjQUFjLEVBQUU7SUFDN0MsVUFBVSxFQUFFLElBQUk7SUFDaEIs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Q0FBQyxDQUFDO0lBQ3ZFLElBQUksUUFBUSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzFCLE9BQU8sZ0JBQWdCLENBQUMsVUFBVSxDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMvRCxDQUFDO1NBQU0sQ0FBQztRQUNOLE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDN0QsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUM3RCxPQUFPLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUN0QyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUNwQixRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUNwQixRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUNwQixRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUNwQixPQUFPLENBQ1IsQ0FBQztJQUNKLENBQUM7QUFDSCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcQ2FyZEV2ZXJ5dGhpbmdcXGNhcmRhbGwtcHJvdG90eXBlXFxub2RlX21vZHVsZXNcXGplc3QtYXhlXFxub2RlX21vZHVsZXNcXGplc3QtZGlmZlxcYnVpbGRcXGluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ0RJRkZfREVMRVRFJywge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURTtcbiAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ0RJRkZfRVFVQUwnLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGdldDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBfY2xlYW51cFNlbWFudGljLkRJRkZfRVFVQUw7XG4gIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdESUZGX0lOU0VSVCcsIHtcbiAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQ7XG4gIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdEaWZmJywge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gX2NsZWFudXBTZW1hbnRpYy5EaWZmO1xuICB9XG59KTtcbmV4cG9ydHMuZGlmZiA9IGRpZmY7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ2RpZmZMaW5lc1JhdycsIHtcbiAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIF9kaWZmTGluZXMuZGlmZkxpbmVzUmF3O1xuICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnZGlmZkxpbmVzVW5pZmllZCcsIHtcbiAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIF9kaWZmTGluZXMuZGlmZkxpbmVzVW5pZmllZDtcbiAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ2RpZmZMaW5lc1VuaWZpZWQyJywge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gX2RpZmZMaW5lcy5kaWZmTGluZXNVbmlmaWVkMjtcbiAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ2RpZmZTdHJpbmdzUmF3Jywge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gX3ByaW50RGlmZnMuZGlmZlN0cmluZ3NSYXc7XG4gIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdkaWZmU3RyaW5nc1VuaWZpZWQnLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGdldDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBfcHJpbnREaWZmcy5kaWZmU3RyaW5nc1VuaWZpZWQ7XG4gIH1cbn0pO1xudmFyIF9jaGFsayA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgnY2hhbGsnKSk7XG52YXIgX2plc3RHZXRUeXBlID0gcmVxdWlyZSgnamVzdC1nZXQtdHlwZScpO1xudmFyIF9wcmV0dHlGb3JtYXQgPSByZXF1aXJlKCdwcmV0dHktZm9ybWF0Jyk7XG52YXIgX2NsZWFudXBTZW1hbnRpYyA9IHJlcXVpcmUoJy4vY2xlYW51cFNlbWFudGljJyk7XG52YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoJy4vY29uc3RhbnRzJyk7XG52YXIgX2RpZmZMaW5lcyA9IHJlcXVpcmUoJy4vZGlmZkxpbmVzJyk7XG52YXIgX25vcm1hbGl6ZURpZmZPcHRpb25zID0gcmVxdWlyZSgnLi9ub3JtYWxpemVEaWZmT3B0aW9ucycpO1xudmFyIF9wcmludERpZmZzID0gcmVxdWlyZSgnLi9wcmludERpZmZzJyk7XG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge1xuICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDoge2RlZmF1bHQ6IG9ian07XG59XG52YXIgU3ltYm9sID0gZ2xvYmFsVGhpc1snamVzdC1zeW1ib2wtZG8tbm90LXRvdWNoJ10gfHwgZ2xvYmFsVGhpcy5TeW1ib2w7XG4vKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cbmNvbnN0IGdldENvbW1vbk1lc3NhZ2UgPSAobWVzc2FnZSwgb3B0aW9ucykgPT4ge1xuICBjb25zdCB7Y29tbW9uQ29sb3J9ID0gKDAsIF9ub3JtYWxpemVEaWZmT3B0aW9ucy5ub3JtYWxpemVEaWZmT3B0aW9ucykoXG4gICAgb3B0aW9uc1xuICApO1xuICByZXR1cm4gY29tbW9uQ29sb3IobWVzc2FnZSk7XG59O1xuY29uc3Qge1xuICBBc3ltbWV0cmljTWF0Y2hlcixcbiAgRE9NQ29sbGVjdGlvbixcbiAgRE9NRWxlbWVudCxcbiAgSW1tdXRhYmxlLFxuICBSZWFjdEVsZW1lbnQsXG4gIFJlYWN0VGVzdENvbXBvbmVudFxufSA9IF9wcmV0dHlGb3JtYXQucGx1Z2lucztcbmNvbnN0IFBMVUdJTlMgPSBbXG4gIFJlYWN0VGVzdENvbXBvbmVudCxcbiAgUmVhY3RFbGVtZW50LFxuICBET01FbGVtZW50LFxuICBET01Db2xsZWN0aW9uLFxuICBJbW11dGFibGUsXG4gIEFzeW1tZXRyaWNNYXRjaGVyXG5dO1xuY29uc3QgRk9STUFUX09QVElPTlMgPSB7XG4gIHBsdWdpbnM6IFBMVUdJTlNcbn07XG5jb25zdCBGQUxMQkFDS19GT1JNQVRfT1BUSU9OUyA9IHtcbiAgY2FsbFRvSlNPTjogZmFsc2UsXG4gIG1heERlcHRoOiAxMCxcbiAgcGx1Z2luczogUExVR0lOU1xufTtcblxuLy8gR2VuZXJhdGUgYSBzdHJpbmcgdGhhdCB3aWxsIGhpZ2hsaWdodCB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHR3byB2YWx1ZXNcbi8vIHdpdGggZ3JlZW4gYW5kIHJlZC4gKHNpbWlsYXIgdG8gaG93IGdpdGh1YiBkb2VzIGNvZGUgZGlmZmluZylcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvZXhwbGljaXQtbW9kdWxlLWJvdW5kYXJ5LXR5cGVzXG5mdW5jdGlvbiBkaWZmKGEsIGIsIG9wdGlvbnMpIHtcbiAgaWYgKE9iamVjdC5pcyhhLCBiKSkge1xuICAgIHJldHVybiBnZXRDb21tb25NZXNzYWdlKF9jb25zdGFudHMuTk9fRElGRl9NRVNTQUdFLCBvcHRpb25zKTtcbiAgfVxuICBjb25zdCBhVHlwZSA9ICgwLCBfamVzdEdldFR5cGUuZ2V0VHlwZSkoYSk7XG4gIGxldCBleHBlY3RlZFR5cGUgPSBhVHlwZTtcbiAgbGV0IG9taXREaWZmZXJlbmNlID0gZmFsc2U7XG4gIGlmIChhVHlwZSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGEuYXN5bW1ldHJpY01hdGNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgaWYgKGEuJCR0eXBlb2YgIT09IFN5bWJvbC5mb3IoJ2plc3QuYXN5bW1ldHJpY01hdGNoZXInKSkge1xuICAgICAgLy8gRG8gbm90IGtub3cgZXhwZWN0ZWQgdHlwZSBvZiB1c2VyLWRlZmluZWQgYXN5bW1ldHJpYyBtYXRjaGVyLlxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYS5nZXRFeHBlY3RlZFR5cGUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIC8vIEZvciBleGFtcGxlLCBleHBlY3QuYW55dGhpbmcoKSBtYXRjaGVzIGVpdGhlciBudWxsIG9yIHVuZGVmaW5lZFxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGV4cGVjdGVkVHlwZSA9IGEuZ2V0RXhwZWN0ZWRUeXBlKCk7XG4gICAgLy8gUHJpbWl0aXZlIHR5cGVzIGJvb2xlYW4gYW5kIG51bWJlciBvbWl0IGRpZmZlcmVuY2UgYmVsb3cuXG4gICAgLy8gRm9yIGV4YW1wbGUsIG9taXQgZGlmZmVyZW5jZSBmb3IgZXhwZWN0LnN0cmluZ01hdGNoaW5nKHJlZ2V4cClcbiAgICBvbWl0RGlmZmVyZW5jZSA9IGV4cGVjdGVkVHlwZSA9PT0gJ3N0cmluZyc7XG4gIH1cbiAgaWYgKGV4cGVjdGVkVHlwZSAhPT0gKDAsIF9qZXN0R2V0VHlwZS5nZXRUeXBlKShiKSkge1xuICAgIHJldHVybiAoXG4gICAgICAnICBDb21wYXJpbmcgdHdvIGRpZmZlcmVudCB0eXBlcyBvZiB2YWx1ZXMuJyArXG4gICAgICBgIEV4cGVjdGVkICR7X2NoYWxrLmRlZmF1bHQuZ3JlZW4oZXhwZWN0ZWRUeXBlKX0gYnV0IGAgK1xuICAgICAgYHJlY2VpdmVkICR7X2NoYWxrLmRlZmF1bHQucmVkKCgwLCBfamVzdEdldFR5cGUuZ2V0VHlwZSkoYikpfS5gXG4gICAgKTtcbiAgfVxuICBpZiAob21pdERpZmZlcmVuY2UpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBzd2l0Y2ggKGFUeXBlKSB7XG4gICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgIHJldHVybiAoMCwgX2RpZmZMaW5lcy5kaWZmTGluZXNVbmlmaWVkKShcbiAgICAgICAgYS5zcGxpdCgnXFxuJyksXG4gICAgICAgIGIuc3BsaXQoJ1xcbicpLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgIGNhc2UgJ251bWJlcic6XG4gICAgICByZXR1cm4gY29tcGFyZVByaW1pdGl2ZShhLCBiLCBvcHRpb25zKTtcbiAgICBjYXNlICdtYXAnOlxuICAgICAgcmV0dXJuIGNvbXBhcmVPYmplY3RzKHNvcnRNYXAoYSksIHNvcnRNYXAoYiksIG9wdGlvbnMpO1xuICAgIGNhc2UgJ3NldCc6XG4gICAgICByZXR1cm4gY29tcGFyZU9iamVjdHMoc29ydFNldChhKSwgc29ydFNldChiKSwgb3B0aW9ucyk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBjb21wYXJlT2JqZWN0cyhhLCBiLCBvcHRpb25zKTtcbiAgfVxufVxuZnVuY3Rpb24gY29tcGFyZVByaW1pdGl2ZShhLCBiLCBvcHRpb25zKSB7XG4gIGNvbnN0IGFGb3JtYXQgPSAoMCwgX3ByZXR0eUZvcm1hdC5mb3JtYXQpKGEsIEZPUk1BVF9PUFRJT05TKTtcbiAgY29uc3QgYkZvcm1hdCA9ICgwLCBfcHJldHR5Rm9ybWF0LmZvcm1hdCkoYiwgRk9STUFUX09QVElPTlMpO1xuICByZXR1cm4gYUZvcm1hdCA9PT0gYkZvcm1hdFxuICAgID8gZ2V0Q29tbW9uTWVzc2FnZShfY29uc3RhbnRzLk5PX0RJRkZfTUVTU0FHRSwgb3B0aW9ucylcbiAgICA6ICgwLCBfZGlmZkxpbmVzLmRpZmZMaW5lc1VuaWZpZWQpKFxuICAgICAgICBhRm9ybWF0LnNwbGl0KCdcXG4nKSxcbiAgICAgICAgYkZvcm1hdC5zcGxpdCgnXFxuJyksXG4gICAgICAgIG9wdGlvbnNcbiAgICAgICk7XG59XG5mdW5jdGlvbiBzb3J0TWFwKG1hcCkge1xuICByZXR1cm4gbmV3IE1hcChBcnJheS5mcm9tKG1hcC5lbnRyaWVzKCkpLnNvcnQoKSk7XG59XG5mdW5jdGlvbiBzb3J0U2V0KHNldCkge1xuICByZXR1cm4gbmV3IFNldChBcnJheS5mcm9tKHNldC52YWx1ZXMoKSkuc29ydCgpKTtcbn1cbmZ1bmN0aW9uIGNvbXBhcmVPYmplY3RzKGEsIGIsIG9wdGlvbnMpIHtcbiAgbGV0IGRpZmZlcmVuY2U7XG4gIGxldCBoYXNUaHJvd24gPSBmYWxzZTtcbiAgdHJ5IHtcbiAgICBjb25zdCBmb3JtYXRPcHRpb25zID0gZ2V0Rm9ybWF0T3B0aW9ucyhGT1JNQVRfT1BUSU9OUywgb3B0aW9ucyk7XG4gICAgZGlmZmVyZW5jZSA9IGdldE9iamVjdHNEaWZmZXJlbmNlKGEsIGIsIGZvcm1hdE9wdGlvbnMsIG9wdGlvbnMpO1xuICB9IGNhdGNoIHtcbiAgICBoYXNUaHJvd24gPSB0cnVlO1xuICB9XG4gIGNvbnN0IG5vRGlmZk1lc3NhZ2UgPSBnZXRDb21tb25NZXNzYWdlKF9jb25zdGFudHMuTk9fRElGRl9NRVNTQUdFLCBvcHRpb25zKTtcbiAgLy8gSWYgdGhlIGNvbXBhcmlzb24geWllbGRzIG5vIHJlc3VsdHMsIGNvbXBhcmUgYWdhaW4gYnV0IHRoaXMgdGltZVxuICAvLyB3aXRob3V0IGNhbGxpbmcgYHRvSlNPTmAuIEl0J3MgYWxzbyBwb3NzaWJsZSB0aGF0IHRvSlNPTiBtaWdodCB0aHJvdy5cbiAgaWYgKGRpZmZlcmVuY2UgPT09IHVuZGVmaW5lZCB8fCBkaWZmZXJlbmNlID09PSBub0RpZmZNZXNzYWdlKSB7XG4gICAgY29uc3QgZm9ybWF0T3B0aW9ucyA9IGdldEZvcm1hdE9wdGlvbnMoRkFMTEJBQ0tfRk9STUFUX09QVElPTlMsIG9wdGlvbnMpO1xuICAgIGRpZmZlcmVuY2UgPSBnZXRPYmplY3RzRGlmZmVyZW5jZShhLCBiLCBmb3JtYXRPcHRpb25zLCBvcHRpb25zKTtcbiAgICBpZiAoZGlmZmVyZW5jZSAhPT0gbm9EaWZmTWVzc2FnZSAmJiAhaGFzVGhyb3duKSB7XG4gICAgICBkaWZmZXJlbmNlID0gYCR7Z2V0Q29tbW9uTWVzc2FnZShcbiAgICAgICAgX2NvbnN0YW50cy5TSU1JTEFSX01FU1NBR0UsXG4gICAgICAgIG9wdGlvbnNcbiAgICAgICl9XFxuXFxuJHtkaWZmZXJlbmNlfWA7XG4gICAgfVxuICB9XG4gIHJldHVybiBkaWZmZXJlbmNlO1xufVxuZnVuY3Rpb24gZ2V0Rm9ybWF0T3B0aW9ucyhmb3JtYXRPcHRpb25zLCBvcHRpb25zKSB7XG4gIGNvbnN0IHtjb21wYXJlS2V5c30gPSAoMCwgX25vcm1hbGl6ZURpZmZPcHRpb25zLm5vcm1hbGl6ZURpZmZPcHRpb25zKShcbiAgICBvcHRpb25zXG4gICk7XG4gIHJldHVybiB7XG4gICAgLi4uZm9ybWF0T3B0aW9ucyxcbiAgICBjb21wYXJlS2V5c1xuICB9O1xufVxuZnVuY3Rpb24gZ2V0T2JqZWN0c0RpZmZlcmVuY2UoYSwgYiwgZm9ybWF0T3B0aW9ucywgb3B0aW9ucykge1xuICBjb25zdCBmb3JtYXRPcHRpb25zWmVyb0luZGVudCA9IHtcbiAgICAuLi5mb3JtYXRPcHRpb25zLFxuICAgIGluZGVudDogMFxuICB9O1xuICBjb25zdCBhQ29tcGFyZSA9ICgwLCBfcHJldHR5Rm9ybWF0LmZvcm1hdCkoYSwgZm9ybWF0T3B0aW9uc1plcm9JbmRlbnQpO1xuICBjb25zdCBiQ29tcGFyZSA9ICgwLCBfcHJldHR5Rm9ybWF0LmZvcm1hdCkoYiwgZm9ybWF0T3B0aW9uc1plcm9JbmRlbnQpO1xuICBpZiAoYUNvbXBhcmUgPT09IGJDb21wYXJlKSB7XG4gICAgcmV0dXJuIGdldENvbW1vbk1lc3NhZ2UoX2NvbnN0YW50cy5OT19ESUZGX01FU1NBR0UsIG9wdGlvbnMpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGFEaXNwbGF5ID0gKDAsIF9wcmV0dHlGb3JtYXQuZm9ybWF0KShhLCBmb3JtYXRPcHRpb25zKTtcbiAgICBjb25zdCBiRGlzcGxheSA9ICgwLCBfcHJldHR5Rm9ybWF0LmZvcm1hdCkoYiwgZm9ybWF0T3B0aW9ucyk7XG4gICAgcmV0dXJuICgwLCBfZGlmZkxpbmVzLmRpZmZMaW5lc1VuaWZpZWQyKShcbiAgICAgIGFEaXNwbGF5LnNwbGl0KCdcXG4nKSxcbiAgICAgIGJEaXNwbGF5LnNwbGl0KCdcXG4nKSxcbiAgICAgIGFDb21wYXJlLnNwbGl0KCdcXG4nKSxcbiAgICAgIGJDb21wYXJlLnNwbGl0KCdcXG4nKSxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=