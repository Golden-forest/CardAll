8869018fc01647186f06815d9a2e50c3
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cloudSyncService = void 0;
const supabase_1 = require("./supabase");
const database_1 = require("./database");
class CloudSyncService {
    constructor() {
        Object.defineProperty(this, "syncQueue", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "isOnline", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: navigator.onLine
        });
        Object.defineProperty(this, "syncInProgress", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "lastSyncTime", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        Object.defineProperty(this, "conflicts", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "listeners", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "authService", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        }); // 延迟初始化
        this.initialize();
    }
    // 初始化同步服务
    initialize() {
        // 监听网络状态
        window.addEventListener('online', () => {
            this.isOnline = true;
            this.notifyStatusChange();
            this.processSyncQueue();
        });
        window.addEventListener('offline', () => {
            this.isOnline = false;
            this.notifyStatusChange();
        });
        // 定期同步（每5分钟）
        setInterval(() => {
            if (this.isOnline && this.authService?.isAuthenticated()) {
                this.processSyncQueue();
            }
        }, 5 * 60 * 1000);
    }
    // 设置认证服务（解决循环依赖）
    setAuthService(authService) {
        this.authService = authService;
        // 监听认证状态变化
        authService.onAuthStateChange((authState) => {
            if (authState.user && this.isOnline) {
                this.performFullSync();
            }
        });
    }
    // 添加状态监听器
    onStatusChange(callback) {
        this.listeners.push(callback);
        callback(this.getCurrentStatus());
        return () => {
            const index = this.listeners.indexOf(callback);
            if (index > -1) {
                this.listeners.splice(index, 1);
            }
        };
    }
    // 通知状态变化
    notifyStatusChange() {
        const status = this.getCurrentStatus();
        this.listeners.forEach(listener => listener(status));
    }
    // 获取当前同步状态
    getCurrentStatus() {
        return {
            isOnline: this.isOnline,
            lastSyncTime: this.lastSyncTime,
            pendingOperations: this.syncQueue.length,
            syncInProgress: this.syncInProgress,
            hasConflicts: this.conflicts.length > 0
        };
    }
    // 添加同步操作到队列
    async queueOperation(operation) {
        const syncOp = {
            ...operation,
            id: crypto.randomUUID(),
            timestamp: new Date(),
            retryCount: 0
        };
        this.syncQueue.push(syncOp);
        // 保存到本地存储
        await this.persistSyncQueue();
        // 如果在线且已认证，立即尝试同步
        if (this.isOnline && this.authService?.isAuthenticated()) {
            this.processSyncQueue();
        }
        this.notifyStatusChange();
    }
    // 处理同步队列
    async processSyncQueue() {
        if (this.syncInProgress || !this.isOnline || !this.authService?.isAuthenticated()) {
            return;
        }
        this.syncInProgress = true;
        this.notifyStatusChange();
        try {
            const operations = [...this.syncQueue];
            for (const operation of operations) {
                try {
                    await this.executeOperation(operation);
                    // 成功后从队列中移除
                    const index = this.syncQueue.findIndex(op => op.id === operation.id);
                    if (index > -1) {
                        this.syncQueue.splice(index, 1);
                    }
                }
                catch (error) {
                    console.error('Sync operation failed:', error);
                    // 增加重试次数
                    operation.retryCount++;
                    // 如果重试次数过多，移除操作
                    if (operation.retryCount > 3) {
                        const index = this.syncQueue.findIndex(op => op.id === operation.id);
                        if (index > -1) {
                            this.syncQueue.splice(index, 1);
                        }
                    }
                }
            }
            await this.persistSyncQueue();
            this.lastSyncTime = new Date();
        }
        finally {
            this.syncInProgress = false;
            this.notifyStatusChange();
        }
    }
    // 执行单个同步操作
    async executeOperation(operation) {
        const user = this.authService?.getCurrentUser();
        if (!user)
            throw new Error('User not authenticated');
        switch (operation.table) {
            case 'cards':
                await this.syncCard(operation, user.id);
                break;
            case 'folders':
                await this.syncFolder(operation, user.id);
                break;
            case 'tags':
                await this.syncTag(operation, user.id);
                break;
            case 'images':
                await this.syncImage(operation, user.id);
                break;
        }
    }
    // 同步卡片
    async syncCard(operation, userId) {
        const { type, data, localId } = operation;
        switch (type) {
            case 'create':
            case 'update':
                const { error } = await supabase_1.supabase
                    .from('cards')
                    .upsert({
                    id: localId,
                    user_id: userId,
                    front_content: data.frontContent,
                    back_content: data.backContent,
                    style: data.style,
                    folder_id: data.folderId,
                    updated_at: new Date().toISOString(),
                    sync_version: data.syncVersion + 1
                });
                if (error)
                    throw error;
                break;
            case 'delete':
                const { error: deleteError } = await supabase_1.supabase
                    .from('cards')
                    .update({
                    is_deleted: true,
                    updated_at: new Date().toISOString()
                })
                    .eq('id', localId)
                    .eq('user_id', userId);
                if (deleteError)
                    throw deleteError;
                break;
        }
    }
    // 同步文件夹
    async syncFolder(operation, userId) {
        const { type, data, localId } = operation;
        switch (type) {
            case 'create':
            case 'update':
                const { error } = await supabase_1.supabase
                    .from('folders')
                    .upsert({
                    id: localId,
                    user_id: userId,
                    name: data.name,
                    parent_id: data.parentId,
                    updated_at: new Date().toISOString(),
                    sync_version: data.syncVersion + 1
                });
                if (error)
                    throw error;
                break;
            case 'delete':
                const { error: deleteError } = await supabase_1.supabase
                    .from('folders')
                    .update({
                    is_deleted: true,
                    updated_at: new Date().toISOString()
                })
                    .eq('id', localId)
                    .eq('user_id', userId);
                if (deleteError)
                    throw deleteError;
                break;
        }
    }
    // 同步标签
    async syncTag(operation, userId) {
        const { type, data, localId } = operation;
        switch (type) {
            case 'create':
            case 'update':
                const { error } = await supabase_1.supabase
                    .from('tags')
                    .upsert({
                    id: localId,
                    user_id: userId,
                    name: data.name,
                    color: data.color,
                    updated_at: new Date().toISOString(),
                    sync_version: data.syncVersion + 1
                });
                if (error)
                    throw error;
                break;
            case 'delete':
                const { error: deleteError } = await supabase_1.supabase
                    .from('tags')
                    .update({
                    is_deleted: true,
                    updated_at: new Date().toISOString()
                })
                    .eq('id', localId)
                    .eq('user_id', userId);
                if (deleteError)
                    throw deleteError;
                break;
        }
    }
    // 同步图片
    async syncImage(operation, userId) {
        const { type, data, localId } = operation;
        switch (type) {
            case 'create':
            case 'update':
                const { error } = await supabase_1.supabase
                    .from('images')
                    .upsert({
                    id: localId,
                    user_id: userId,
                    card_id: data.cardId,
                    file_name: data.fileName,
                    file_path: data.filePath,
                    cloud_url: data.cloudUrl,
                    metadata: data.metadata,
                    updated_at: new Date().toISOString(),
                    sync_version: data.syncVersion + 1
                });
                if (error)
                    throw error;
                break;
            case 'delete':
                const { error: deleteError } = await supabase_1.supabase
                    .from('images')
                    .update({
                    is_deleted: true,
                    updated_at: new Date().toISOString()
                })
                    .eq('id', localId)
                    .eq('user_id', userId);
                if (deleteError)
                    throw deleteError;
                break;
        }
    }
    // 执行完整同步
    async performFullSync() {
        if (!this.authService?.isAuthenticated() || !this.isOnline) {
            return;
        }
        try {
            this.syncInProgress = true;
            this.notifyStatusChange();
            const user = this.authService.getCurrentUser();
            // 下行同步：从云端获取数据
            await this.syncFromCloud(user.id);
            // 上行同步：处理本地队列
            await this.processSyncQueue();
            this.lastSyncTime = new Date();
            console.log('Full sync completed successfully');
        }
        catch (error) {
            console.error('Full sync failed:', error);
        }
        finally {
            this.syncInProgress = false;
            this.notifyStatusChange();
        }
    }
    // 从云端同步数据
    async syncFromCloud(userId) {
        // 获取本地最后同步时间
        const lastSync = this.lastSyncTime || new Date(0);
        // 同步卡片
        const { data: cards } = await supabase_1.supabase
            .from('cards')
            .select('*')
            .eq('user_id', userId)
            .gte('updated_at', lastSync.toISOString());
        if (cards) {
            for (const card of cards) {
                await this.mergeCloudCard(card);
            }
        }
        // 同步文件夹
        const { data: folders } = await supabase_1.supabase
            .from('folders')
            .select('*')
            .eq('user_id', userId)
            .gte('updated_at', lastSync.toISOString());
        if (folders) {
            for (const folder of folders) {
                await this.mergeCloudFolder(folder);
            }
        }
        // 同步标签
        const { data: tags } = await supabase_1.supabase
            .from('tags')
            .select('*')
            .eq('user_id', userId)
            .gte('updated_at', lastSync.toISOString());
        if (tags) {
            for (const tag of tags) {
                await this.mergeCloudTag(tag);
            }
        }
    }
    // 合并云端卡片数据 - 使用"最后写入获胜"策略
    async mergeCloudCard(cloudCard) {
        const localCard = await database_1.db.cards?.get(cloudCard.id);
        if (!localCard) {
            // 本地不存在，直接插入
            await database_1.db.cards?.add({
                id: cloudCard.id,
                frontContent: cloudCard.front_content,
                backContent: cloudCard.back_content,
                style: cloudCard.style,
                folderId: cloudCard.folder_id || undefined,
                isFlipped: false,
                createdAt: new Date(cloudCard.created_at),
                updatedAt: new Date(cloudCard.updated_at),
                syncVersion: cloudCard.sync_version,
                pendingSync: false
            });
        }
        else {
            // 比较更新时间，采用"最后写入获胜"策略
            const localUpdateTime = new Date(localCard.updatedAt).getTime();
            const cloudUpdateTime = new Date(cloudCard.updated_at).getTime();
            if (cloudUpdateTime > localUpdateTime) {
                // 云端数据更新，使用云端数据
                await database_1.db.cards?.update(cloudCard.id, {
                    frontContent: cloudCard.front_content,
                    backContent: cloudCard.back_content,
                    style: cloudCard.style,
                    folderId: cloudCard.folder_id || undefined,
                    updatedAt: new Date(cloudCard.updated_at),
                    syncVersion: cloudCard.sync_version,
                    pendingSync: false
                });
            }
            else if (localUpdateTime > cloudUpdateTime && localCard.pendingSync) {
                // 本地数据更新，上传到云端
                await this.queueOperation({
                    type: 'update',
                    table: 'cards',
                    data: localCard,
                    localId: localCard.id
                });
            }
            // 如果时间相同，认为是同步的，不做任何操作
        }
    }
    // 合并云端文件夹数据 - 使用"最后写入获胜"策略
    async mergeCloudFolder(cloudFolder) {
        const localFolder = await database_1.db.folders?.get(cloudFolder.id);
        if (!localFolder) {
            await database_1.db.folders?.add({
                id: cloudFolder.id,
                name: cloudFolder.name,
                color: '#3b82f6',
                icon: 'Folder',
                cardIds: [],
                parentId: cloudFolder.parent_id || undefined,
                isExpanded: true,
                createdAt: new Date(cloudFolder.created_at),
                updatedAt: new Date(cloudFolder.updated_at),
                syncVersion: cloudFolder.sync_version,
                pendingSync: false
            });
        }
        else {
            // 比较更新时间，采用"最后写入获胜"策略
            const localUpdateTime = new Date(localFolder.updatedAt).getTime();
            const cloudUpdateTime = new Date(cloudFolder.updated_at).getTime();
            if (cloudUpdateTime > localUpdateTime) {
                await database_1.db.folders?.update(cloudFolder.id, {
                    name: cloudFolder.name,
                    parentId: cloudFolder.parent_id || undefined,
                    updatedAt: new Date(cloudFolder.updated_at),
                    syncVersion: cloudFolder.sync_version,
                    pendingSync: false
                });
            }
            else if (localUpdateTime > cloudUpdateTime && localFolder.pendingSync) {
                // 本地数据更新，上传到云端
                await this.queueOperation({
                    type: 'update',
                    table: 'folders',
                    data: localFolder,
                    localId: localFolder.id
                });
            }
        }
    }
    // 合并云端标签数据 - 使用"最后写入获胜"策略
    async mergeCloudTag(cloudTag) {
        const localTag = await database_1.db.tags?.get(cloudTag.id);
        if (!localTag) {
            await database_1.db.tags?.add({
                id: cloudTag.id,
                name: cloudTag.name,
                color: cloudTag.color,
                count: 0, // 云端同步下来的标签初始计数为0，后续会通过syncTagsWithCards更新
                createdAt: new Date(cloudTag.created_at),
                updatedAt: new Date(cloudTag.updated_at),
                syncVersion: cloudTag.sync_version,
                pendingSync: false
            });
        }
        else {
            // 比较更新时间，采用"最后写入获胜"策略
            const localUpdateTime = new Date(localTag.updatedAt).getTime();
            const cloudUpdateTime = new Date(cloudTag.updatedAt).getTime();
            if (cloudUpdateTime > localUpdateTime) {
                await database_1.db.tags?.update(cloudTag.id, {
                    name: cloudTag.name,
                    color: cloudTag.color,
                    updatedAt: new Date(cloudTag.updated_at),
                    syncVersion: cloudTag.sync_version,
                    pendingSync: false
                });
            }
            else if (localUpdateTime > cloudUpdateTime && localTag.pendingSync) {
                // 本地数据更新，上传到云端
                await this.queueOperation({
                    type: 'update',
                    table: 'tags',
                    data: localTag,
                    localId: localTag.id
                });
            }
        }
    }
    // 持久化同步队列
    async persistSyncQueue() {
        try {
            localStorage.setItem('cardall_sync_queue', JSON.stringify(this.syncQueue));
        }
        catch (error) {
            console.error('Failed to persist sync queue:', error);
        }
    }
    // 恢复同步队列
    async restoreSyncQueue() {
        try {
            const stored = localStorage.getItem('cardall_sync_queue');
            if (stored) {
                this.syncQueue = JSON.parse(stored);
                this.notifyStatusChange();
            }
        }
        catch (error) {
            console.error('Failed to restore sync queue:', error);
        }
    }
    // 清除同步队列
    async clearSyncQueue() {
        this.syncQueue = [];
        await this.persistSyncQueue();
        this.notifyStatusChange();
    }
    // 获取冲突列表
    getConflicts() {
        return [...this.conflicts];
    }
    // 解决冲突
    async resolveConflict(conflictId, resolution) {
        const conflict = this.conflicts.find(c => c.id === conflictId);
        if (!conflict)
            return;
        // 根据解决方案处理冲突
        switch (resolution) {
            case 'local':
                // 使用本地数据，上传到云端
                await this.queueOperation({
                    type: 'update',
                    table: conflict.table,
                    data: conflict.localData,
                    localId: conflict.localData.id
                });
                break;
            case 'cloud':
                // 使用云端数据，更新本地
                // 这里需要根据具体表类型处理
                break;
            case 'merge':
                // 合并数据（需要具体实现）
                break;
        }
        // 移除已解决的冲突
        const index = this.conflicts.findIndex(c => c.id === conflictId);
        if (index > -1) {
            this.conflicts.splice(index, 1);
            this.notifyStatusChange();
        }
    }
}
// 导出单例实例
exports.cloudSyncService = new CloudSyncService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcc2VydmljZXNcXGNsb3VkLXN5bmMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEseUNBQXNEO0FBQ3RELHlDQUErQjtBQXNCL0IsTUFBTSxnQkFBZ0I7SUFTcEI7UUFSUTs7OzttQkFBNkIsRUFBRTtXQUFBO1FBQy9COzs7O21CQUFXLFNBQVMsQ0FBQyxNQUFNO1dBQUE7UUFDM0I7Ozs7bUJBQWlCLEtBQUs7V0FBQTtRQUN0Qjs7OzttQkFBNEIsSUFBSTtXQUFBO1FBQ2hDOzs7O21CQUFrQyxFQUFFO1dBQUE7UUFDcEM7Ozs7bUJBQThDLEVBQUU7V0FBQTtRQUNoRDs7OzttQkFBbUIsSUFBSTtXQUFBLENBQUMsUUFBUTtRQUd0QyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7SUFDbkIsQ0FBQztJQUVELFVBQVU7SUFDRixVQUFVO1FBQ2hCLFNBQVM7UUFDVCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtZQUNyQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQTtZQUNwQixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQTtZQUN6QixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtRQUN6QixDQUFDLENBQUMsQ0FBQTtRQUVGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1lBQ3RDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFBO1lBQ3JCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFBO1FBQzNCLENBQUMsQ0FBQyxDQUFBO1FBRUYsYUFBYTtRQUNiLFdBQVcsQ0FBQyxHQUFHLEVBQUU7WUFDZixJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFDO2dCQUN6RCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtZQUN6QixDQUFDO1FBQ0gsQ0FBQyxFQUFFLENB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XFxQcm9qZWN0c1xcQ2FyZEV2ZXJ5dGhpbmdcXGNhcmRhbGwtcHJvdG90eXBlXFxzcmNcXHNlcnZpY2VzXFxjbG91ZC1zeW5jLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN1cGFiYXNlLCB0eXBlIFN5bmNTdGF0dXMgfSBmcm9tICcuL3N1cGFiYXNlJ1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuL2RhdGFiYXNlJ1xuaW1wb3J0IHR5cGUgeyBEYkNhcmQsIERiRm9sZGVyLCBEYlRhZyB9IGZyb20gJy4vZGF0YWJhc2UnXG5cbmV4cG9ydCBpbnRlcmZhY2UgU3luY09wZXJhdGlvbiB7XG4gIGlkOiBzdHJpbmdcbiAgdHlwZTogJ2NyZWF0ZScgfCAndXBkYXRlJyB8ICdkZWxldGUnXG4gIHRhYmxlOiAnY2FyZHMnIHwgJ2ZvbGRlcnMnIHwgJ3RhZ3MnIHwgJ2ltYWdlcydcbiAgZGF0YTogYW55XG4gIGxvY2FsSWQ6IHN0cmluZ1xuICB0aW1lc3RhbXA6IERhdGVcbiAgcmV0cnlDb3VudDogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29uZmxpY3RSZXNvbHV0aW9uIHtcbiAgaWQ6IHN0cmluZ1xuICB0YWJsZTogc3RyaW5nXG4gIGxvY2FsRGF0YTogYW55XG4gIGNsb3VkRGF0YTogYW55XG4gIHJlc29sdXRpb246ICdsb2NhbCcgfCAnY2xvdWQnIHwgJ21lcmdlJyB8ICdtYW51YWwnXG4gIHRpbWVzdGFtcDogRGF0ZVxufVxuXG5jbGFzcyBDbG91ZFN5bmNTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzeW5jUXVldWU6IFN5bmNPcGVyYXRpb25bXSA9IFtdXG4gIHByaXZhdGUgaXNPbmxpbmUgPSBuYXZpZ2F0b3Iub25MaW5lXG4gIHByaXZhdGUgc3luY0luUHJvZ3Jlc3MgPSBmYWxzZVxuICBwcml2YXRlIGxhc3RTeW5jVGltZTogRGF0ZSB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgY29uZmxpY3RzOiBDb25mbGljdFJlc29sdXRpb25bXSA9IFtdXG4gIHByaXZhdGUgbGlzdGVuZXJzOiAoKHN0YXR1czogU3luY1N0YXR1cykgPT4gdm9pZClbXSA9IFtdXG4gIHByaXZhdGUgYXV0aFNlcnZpY2U6IGFueSA9IG51bGwgLy8g5bu26L+f5Yid5aeL5YyWXG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplKClcbiAgfVxuXG4gIC8vIOWIneWni+WMluWQjOatpeacjeWKoVxuICBwcml2YXRlIGluaXRpYWxpemUoKSB7XG4gICAgLy8g55uR5ZCs572R57uc54q25oCBXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsICgpID0+IHtcbiAgICAgIHRoaXMuaXNPbmxpbmUgPSB0cnVlXG4gICAgICB0aGlzLm5vdGlmeVN0YXR1c0NoYW5nZSgpXG4gICAgICB0aGlzLnByb2Nlc3NTeW5jUXVldWUoKVxuICAgIH0pXG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsICgpID0+IHtcbiAgICAgIHRoaXMuaXNPbmxpbmUgPSBmYWxzZVxuICAgICAgdGhpcy5ub3RpZnlTdGF0dXNDaGFuZ2UoKVxuICAgIH0pXG5cbiAgICAvLyDlrprmnJ/lkIzmraXvvIjmr4815YiG6ZKf77yJXG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuaXNPbmxpbmUgJiYgdGhpcy5hdXRoU2VydmljZT8uaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzU3luY1F1ZXVlKClcbiAgICAgIH1cbiAgICB9LCA1ICogNjAgKiAxMDAwKVxuICB9XG5cbiAgLy8g6K6+572u6K6k6K+B5pyN5Yqh77yI6Kej5Yaz5b6q546v5L6d6LWW77yJXG4gIHNldEF1dGhTZXJ2aWNlKGF1dGhTZXJ2aWNlOiBhbnkpIHtcbiAgICB0aGlzLmF1dGhTZXJ2aWNlID0gYXV0aFNlcnZpY2VcbiAgICBcbiAgICAvLyDnm5HlkKzorqTor4HnirbmgIHlj5jljJZcbiAgICBhdXRoU2VydmljZS5vbkF1dGhTdGF0ZUNoYW5nZSgoYXV0aFN0YXRlOiBhbnkpID0+IHtcbiAgICAgIGlmIChhdXRoU3RhdGUudXNlciAmJiB0aGlzLmlzT25saW5lKSB7XG4gICAgICAgIHRoaXMucGVyZm9ybUZ1bGxTeW5jKClcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgLy8g5re75Yqg54q25oCB55uR5ZCs5ZmoXG4gIG9uU3RhdHVzQ2hhbmdlKGNhbGxiYWNrOiAoc3RhdHVzOiBTeW5jU3RhdHVzKSA9PiB2b2lkKTogKCkgPT4gdm9pZCB7XG4gICAgdGhpcy5saXN0ZW5lcnMucHVzaChjYWxsYmFjaylcbiAgICBjYWxsYmFjayh0aGlzLmdldEN1cnJlbnRTdGF0dXMoKSlcbiAgICBcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmxpc3RlbmVycy5pbmRleE9mKGNhbGxiYWNrKVxuICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIOmAmuefpeeKtuaAgeWPmOWMllxuICBwcml2YXRlIG5vdGlmeVN0YXR1c0NoYW5nZSgpIHtcbiAgICBjb25zdCBzdGF0dXMgPSB0aGlzLmdldEN1cnJlbnRTdGF0dXMoKVxuICAgIHRoaXMubGlzdGVuZXJzLmZvckVhY2gobGlzdGVuZXIgPT4gbGlzdGVuZXIoc3RhdHVzKSlcbiAgfVxuXG4gIC8vIOiOt+WPluW9k+WJjeWQjOatpeeKtuaAgVxuICBnZXRDdXJyZW50U3RhdHVzKCk6IFN5bmNTdGF0dXMge1xuICAgIHJldHVybiB7XG4gICAgICBpc09ubGluZTogdGhpcy5pc09ubGluZSxcbiAgICAgIGxhc3RTeW5jVGltZTogdGhpcy5sYXN0U3luY1RpbWUsXG4gICAgICBwZW5kaW5nT3BlcmF0aW9uczogdGhpcy5zeW5jUXVldWUubGVuZ3RoLFxuICAgICAgc3luY0luUHJvZ3Jlc3M6IHRoaXMuc3luY0luUHJvZ3Jlc3MsXG4gICAgICBoYXNDb25mbGljdHM6IHRoaXMuY29uZmxpY3RzLmxlbmd0aCA+IDBcbiAgICB9XG4gIH1cblxuICAvLyDmt7vliqDlkIzmraXmk43kvZzliLDpmJ/liJdcbiAgYXN5bmMgcXVldWVPcGVyYXRpb24ob3BlcmF0aW9uOiBPbWl0PFN5bmNPcGVyYXRpb24sICdpZCcgfCAndGltZXN0YW1wJyB8ICdyZXRyeUNvdW50Jz4pIHtcbiAgICBjb25zdCBzeW5jT3A6IFN5bmNPcGVyYXRpb24gPSB7XG4gICAgICAuLi5vcGVyYXRpb24sXG4gICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHJldHJ5Q291bnQ6IDBcbiAgICB9XG5cbiAgICB0aGlzLnN5bmNRdWV1ZS5wdXNoKHN5bmNPcClcbiAgICBcbiAgICAvLyDkv53lrZjliLDmnKzlnLDlrZjlgqhcbiAgICBhd2FpdCB0aGlzLnBlcnNpc3RTeW5jUXVldWUoKVxuICAgIFxuICAgIC8vIOWmguaenOWcqOe6v+S4lOW3suiupOivge+8jOeri+WNs+WwneivleWQjOatpVxuICAgIGlmICh0aGlzLmlzT25saW5lICYmIHRoaXMuYXV0aFNlcnZpY2U/LmlzQXV0aGVudGljYXRlZCgpKSB7XG4gICAgICB0aGlzLnByb2Nlc3NTeW5jUXVldWUoKVxuICAgIH1cblxuICAgIHRoaXMubm90aWZ5U3RhdHVzQ2hhbmdlKClcbiAgfVxuXG4gIC8vIOWkhOeQhuWQjOatpemYn+WIl1xuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NTeW5jUXVldWUoKSB7XG4gICAgaWYgKHRoaXMuc3luY0luUHJvZ3Jlc3MgfHwgIXRoaXMuaXNPbmxpbmUgfHwgIXRoaXMuYXV0aFNlcnZpY2U/LmlzQXV0aGVudGljYXRlZCgpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0aGlzLnN5bmNJblByb2dyZXNzID0gdHJ1ZVxuICAgIHRoaXMubm90aWZ5U3RhdHVzQ2hhbmdlKClcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBvcGVyYXRpb25zID0gWy4uLnRoaXMuc3luY1F1ZXVlXVxuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiBvcGVyYXRpb25zKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlT3BlcmF0aW9uKG9wZXJhdGlvbilcbiAgICAgICAgICBcbiAgICAgICAgICAvLyDmiJDlip/lkI7ku47pmJ/liJfkuK3np7vpmaRcbiAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuc3luY1F1ZXVlLmZpbmRJbmRleChvcCA9PiBvcC5pZCA9PT0gb3BlcmF0aW9uLmlkKVxuICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgICB0aGlzLnN5bmNRdWV1ZS5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N5bmMgb3BlcmF0aW9uIGZhaWxlZDonLCBlcnJvcilcbiAgICAgICAgICBcbiAgICAgICAgICAvLyDlop7liqDph43or5XmrKHmlbBcbiAgICAgICAgICBvcGVyYXRpb24ucmV0cnlDb3VudCsrXG4gICAgICAgICAgXG4gICAgICAgICAgLy8g5aaC5p6c6YeN6K+V5qyh5pWw6L+H5aSa77yM56e76Zmk5pON5L2cXG4gICAgICAgICAgaWYgKG9wZXJhdGlvbi5yZXRyeUNvdW50ID4gMykge1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnN5bmNRdWV1ZS5maW5kSW5kZXgob3AgPT4gb3AuaWQgPT09IG9wZXJhdGlvbi5pZClcbiAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3luY1F1ZXVlLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0U3luY1F1ZXVlKClcbiAgICAgIHRoaXMubGFzdFN5bmNUaW1lID0gbmV3IERhdGUoKVxuICAgICAgXG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuc3luY0luUHJvZ3Jlc3MgPSBmYWxzZVxuICAgICAgdGhpcy5ub3RpZnlTdGF0dXNDaGFuZ2UoKVxuICAgIH1cbiAgfVxuXG4gIC8vIOaJp+ihjOWNleS4quWQjOatpeaTjeS9nFxuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVPcGVyYXRpb24ob3BlcmF0aW9uOiBTeW5jT3BlcmF0aW9uKSB7XG4gICAgY29uc3QgdXNlciA9IHRoaXMuYXV0aFNlcnZpY2U/LmdldEN1cnJlbnRVc2VyKClcbiAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgYXV0aGVudGljYXRlZCcpXG5cbiAgICBzd2l0Y2ggKG9wZXJhdGlvbi50YWJsZSkge1xuICAgICAgY2FzZSAnY2FyZHMnOlxuICAgICAgICBhd2FpdCB0aGlzLnN5bmNDYXJkKG9wZXJhdGlvbiwgdXNlci5pZClcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2ZvbGRlcnMnOlxuICAgICAgICBhd2FpdCB0aGlzLnN5bmNGb2xkZXIob3BlcmF0aW9uLCB1c2VyLmlkKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAndGFncyc6XG4gICAgICAgIGF3YWl0IHRoaXMuc3luY1RhZyhvcGVyYXRpb24sIHVzZXIuaWQpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdpbWFnZXMnOlxuICAgICAgICBhd2FpdCB0aGlzLnN5bmNJbWFnZShvcGVyYXRpb24sIHVzZXIuaWQpXG4gICAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgLy8g5ZCM5q2l5Y2h54mHXG4gIHByaXZhdGUgYXN5bmMgc3luY0NhcmQob3BlcmF0aW9uOiBTeW5jT3BlcmF0aW9uLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHsgdHlwZSwgZGF0YSwgbG9jYWxJZCB9ID0gb3BlcmF0aW9uXG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgJ2NyZWF0ZSc6XG4gICAgICBjYXNlICd1cGRhdGUnOlxuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCdjYXJkcycpXG4gICAgICAgICAgLnVwc2VydCh7XG4gICAgICAgICAgICBpZDogbG9jYWxJZCxcbiAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIGZyb250X2NvbnRlbnQ6IGRhdGEuZnJvbnRDb250ZW50LFxuICAgICAgICAgICAgYmFja19jb250ZW50OiBkYXRhLmJhY2tDb250ZW50LFxuICAgICAgICAgICAgc3R5bGU6IGRhdGEuc3R5bGUsXG4gICAgICAgICAgICBmb2xkZXJfaWQ6IGRhdGEuZm9sZGVySWQsXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBzeW5jX3ZlcnNpb246IGRhdGEuc3luY1ZlcnNpb24gKyAxXG4gICAgICAgICAgfSlcbiAgICAgICAgXG4gICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3JcbiAgICAgICAgYnJlYWtcblxuICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgLmZyb20oJ2NhcmRzJylcbiAgICAgICAgICAudXBkYXRlKHsgXG4gICAgICAgICAgICBpc19kZWxldGVkOiB0cnVlLFxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZXEoJ2lkJywgbG9jYWxJZClcbiAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIFxuICAgICAgICBpZiAoZGVsZXRlRXJyb3IpIHRocm93IGRlbGV0ZUVycm9yXG4gICAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgLy8g5ZCM5q2l5paH5Lu25aS5XG4gIHByaXZhdGUgYXN5bmMgc3luY0ZvbGRlcihvcGVyYXRpb246IFN5bmNPcGVyYXRpb24sIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgeyB0eXBlLCBkYXRhLCBsb2NhbElkIH0gPSBvcGVyYXRpb25cblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnY3JlYXRlJzpcbiAgICAgIGNhc2UgJ3VwZGF0ZSc6XG4gICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgLmZyb20oJ2ZvbGRlcnMnKVxuICAgICAgICAgIC51cHNlcnQoe1xuICAgICAgICAgICAgaWQ6IGxvY2FsSWQsXG4gICAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXG4gICAgICAgICAgICBwYXJlbnRfaWQ6IGRhdGEucGFyZW50SWQsXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBzeW5jX3ZlcnNpb246IGRhdGEuc3luY1ZlcnNpb24gKyAxXG4gICAgICAgICAgfSlcbiAgICAgICAgXG4gICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3JcbiAgICAgICAgYnJlYWtcblxuICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgY29uc3QgeyBlcnJvcjogZGVsZXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgLmZyb20oJ2ZvbGRlcnMnKVxuICAgICAgICAgIC51cGRhdGUoeyBcbiAgICAgICAgICAgIGlzX2RlbGV0ZWQ6IHRydWUsXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5lcSgnaWQnLCBsb2NhbElkKVxuICAgICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgXG4gICAgICAgIGlmIChkZWxldGVFcnJvcikgdGhyb3cgZGVsZXRlRXJyb3JcbiAgICAgICAgYnJlYWtcbiAgICB9XG4gIH1cblxuICAvLyDlkIzmraXmoIfnrb5cbiAgcHJpdmF0ZSBhc3luYyBzeW5jVGFnKG9wZXJhdGlvbjogU3luY09wZXJhdGlvbiwgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCB7IHR5cGUsIGRhdGEsIGxvY2FsSWQgfSA9IG9wZXJhdGlvblxuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdjcmVhdGUnOlxuICAgICAgY2FzZSAndXBkYXRlJzpcbiAgICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgndGFncycpXG4gICAgICAgICAgLnVwc2VydCh7XG4gICAgICAgICAgICBpZDogbG9jYWxJZCxcbiAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgICAgICAgIGNvbG9yOiBkYXRhLmNvbG9yLFxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgc3luY192ZXJzaW9uOiBkYXRhLnN5bmNWZXJzaW9uICsgMVxuICAgICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yXG4gICAgICAgIGJyZWFrXG5cbiAgICAgIGNhc2UgJ2RlbGV0ZSc6XG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCd0YWdzJylcbiAgICAgICAgICAudXBkYXRlKHsgXG4gICAgICAgICAgICBpc19kZWxldGVkOiB0cnVlLFxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZXEoJ2lkJywgbG9jYWxJZClcbiAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIFxuICAgICAgICBpZiAoZGVsZXRlRXJyb3IpIHRocm93IGRlbGV0ZUVycm9yXG4gICAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgLy8g5ZCM5q2l5Zu+54mHXG4gIHByaXZhdGUgYXN5bmMgc3luY0ltYWdlKG9wZXJhdGlvbjogU3luY09wZXJhdGlvbiwgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCB7IHR5cGUsIGRhdGEsIGxvY2FsSWQgfSA9IG9wZXJhdGlvblxuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdjcmVhdGUnOlxuICAgICAgY2FzZSAndXBkYXRlJzpcbiAgICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgnaW1hZ2VzJylcbiAgICAgICAgICAudXBzZXJ0KHtcbiAgICAgICAgICAgIGlkOiBsb2NhbElkLFxuICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICAgICAgY2FyZF9pZDogZGF0YS5jYXJkSWQsXG4gICAgICAgICAgICBmaWxlX25hbWU6IGRhdGEuZmlsZU5hbWUsXG4gICAgICAgICAgICBmaWxlX3BhdGg6IGRhdGEuZmlsZVBhdGgsXG4gICAgICAgICAgICBjbG91ZF91cmw6IGRhdGEuY2xvdWRVcmwsXG4gICAgICAgICAgICBtZXRhZGF0YTogZGF0YS5tZXRhZGF0YSxcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHN5bmNfdmVyc2lvbjogZGF0YS5zeW5jVmVyc2lvbiArIDFcbiAgICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvclxuICAgICAgICBicmVha1xuXG4gICAgICBjYXNlICdkZWxldGUnOlxuICAgICAgICBjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgnaW1hZ2VzJylcbiAgICAgICAgICAudXBkYXRlKHsgXG4gICAgICAgICAgICBpc19kZWxldGVkOiB0cnVlLFxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZXEoJ2lkJywgbG9jYWxJZClcbiAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAgIFxuICAgICAgICBpZiAoZGVsZXRlRXJyb3IpIHRocm93IGRlbGV0ZUVycm9yXG4gICAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgLy8g5omn6KGM5a6M5pW05ZCM5q2lXG4gIGFzeW5jIHBlcmZvcm1GdWxsU3luYygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuYXV0aFNlcnZpY2U/LmlzQXV0aGVudGljYXRlZCgpIHx8ICF0aGlzLmlzT25saW5lKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgdGhpcy5zeW5jSW5Qcm9ncmVzcyA9IHRydWVcbiAgICAgIHRoaXMubm90aWZ5U3RhdHVzQ2hhbmdlKClcblxuICAgICAgY29uc3QgdXNlciA9IHRoaXMuYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoKSFcbiAgICAgIFxuICAgICAgLy8g5LiL6KGM5ZCM5q2l77ya5LuO5LqR56uv6I635Y+W5pWw5o2uXG4gICAgICBhd2FpdCB0aGlzLnN5bmNGcm9tQ2xvdWQodXNlci5pZClcbiAgICAgIFxuICAgICAgLy8g5LiK6KGM5ZCM5q2l77ya5aSE55CG5pys5Zyw6Zif5YiXXG4gICAgICBhd2FpdCB0aGlzLnByb2Nlc3NTeW5jUXVldWUoKVxuICAgICAgXG4gICAgICB0aGlzLmxhc3RTeW5jVGltZSA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnNvbGUubG9nKCdGdWxsIHN5bmMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpXG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRnVsbCBzeW5jIGZhaWxlZDonLCBlcnJvcilcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5zeW5jSW5Qcm9ncmVzcyA9IGZhbHNlXG4gICAgICB0aGlzLm5vdGlmeVN0YXR1c0NoYW5nZSgpXG4gICAgfVxuICB9XG5cbiAgLy8g5LuO5LqR56uv5ZCM5q2l5pWw5o2uXG4gIHByaXZhdGUgYXN5bmMgc3luY0Zyb21DbG91ZCh1c2VySWQ6IHN0cmluZykge1xuICAgIC8vIOiOt+WPluacrOWcsOacgOWQjuWQjOatpeaXtumXtFxuICAgIGNvbnN0IGxhc3RTeW5jID0gdGhpcy5sYXN0U3luY1RpbWUgfHwgbmV3IERhdGUoMClcbiAgICBcbiAgICAvLyDlkIzmraXljaHniYdcbiAgICBjb25zdCB7IGRhdGE6IGNhcmRzIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2NhcmRzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmd0ZSgndXBkYXRlZF9hdCcsIGxhc3RTeW5jLnRvSVNPU3RyaW5nKCkpXG4gICAgXG4gICAgaWYgKGNhcmRzKSB7XG4gICAgICBmb3IgKGNvbnN0IGNhcmQgb2YgY2FyZHMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5tZXJnZUNsb3VkQ2FyZChjYXJkKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOWQjOatpeaWh+S7tuWkuVxuICAgIGNvbnN0IHsgZGF0YTogZm9sZGVycyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdmb2xkZXJzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmd0ZSgndXBkYXRlZF9hdCcsIGxhc3RTeW5jLnRvSVNPU3RyaW5nKCkpXG4gICAgXG4gICAgaWYgKGZvbGRlcnMpIHtcbiAgICAgIGZvciAoY29uc3QgZm9sZGVyIG9mIGZvbGRlcnMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5tZXJnZUNsb3VkRm9sZGVyKGZvbGRlcilcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDlkIzmraXmoIfnrb5cbiAgICBjb25zdCB7IGRhdGE6IHRhZ3MgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndGFncycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgIC5ndGUoJ3VwZGF0ZWRfYXQnLCBsYXN0U3luYy50b0lTT1N0cmluZygpKVxuICAgIFxuICAgIGlmICh0YWdzKSB7XG4gICAgICBmb3IgKGNvbnN0IHRhZyBvZiB0YWdzKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubWVyZ2VDbG91ZFRhZyh0YWcpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8g5ZCI5bm25LqR56uv5Y2h54mH5pWw5o2uIC0g5L2/55SoXCLmnIDlkI7lhpnlhaXojrfog5xcIuetlueVpVxuICBwcml2YXRlIGFzeW5jIG1lcmdlQ2xvdWRDYXJkKGNsb3VkQ2FyZDogYW55KSB7XG4gICAgY29uc3QgbG9jYWxDYXJkID0gYXdhaXQgZGIuY2FyZHM/LmdldChjbG91ZENhcmQuaWQpXG4gICAgXG4gICAgaWYgKCFsb2NhbENhcmQpIHtcbiAgICAgIC8vIOacrOWcsOS4jeWtmOWcqO+8jOebtOaOpeaPkuWFpVxuICAgICAgYXdhaXQgZGIuY2FyZHM/LmFkZCh7XG4gICAgICAgIGlkOiBjbG91ZENhcmQuaWQsXG4gICAgICAgIGZyb250Q29udGVudDogY2xvdWRDYXJkLmZyb250X2NvbnRlbnQsXG4gICAgICAgIGJhY2tDb250ZW50OiBjbG91ZENhcmQuYmFja19jb250ZW50LFxuICAgICAgICBzdHlsZTogY2xvdWRDYXJkLnN0eWxlLFxuICAgICAgICBmb2xkZXJJZDogY2xvdWRDYXJkLmZvbGRlcl9pZCB8fCB1bmRlZmluZWQsXG4gICAgICAgIGlzRmxpcHBlZDogZmFsc2UsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoY2xvdWRDYXJkLmNyZWF0ZWRfYXQpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKGNsb3VkQ2FyZC51cGRhdGVkX2F0KSxcbiAgICAgICAgc3luY1ZlcnNpb246IGNsb3VkQ2FyZC5zeW5jX3ZlcnNpb24sXG4gICAgICAgIHBlbmRpbmdTeW5jOiBmYWxzZVxuICAgICAgfSBhcyBEYkNhcmQpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOavlOi+g+abtOaWsOaXtumXtO+8jOmHh+eUqFwi5pyA5ZCO5YaZ5YWl6I636IOcXCLnrZbnlaVcbiAgICAgIGNvbnN0IGxvY2FsVXBkYXRlVGltZSA9IG5ldyBEYXRlKGxvY2FsQ2FyZC51cGRhdGVkQXQpLmdldFRpbWUoKVxuICAgICAgY29uc3QgY2xvdWRVcGRhdGVUaW1lID0gbmV3IERhdGUoY2xvdWRDYXJkLnVwZGF0ZWRfYXQpLmdldFRpbWUoKVxuICAgICAgXG4gICAgICBpZiAoY2xvdWRVcGRhdGVUaW1lID4gbG9jYWxVcGRhdGVUaW1lKSB7XG4gICAgICAgIC8vIOS6keerr+aVsOaNruabtOaWsO+8jOS9v+eUqOS6keerr+aVsOaNrlxuICAgICAgICBhd2FpdCBkYi5jYXJkcz8udXBkYXRlKGNsb3VkQ2FyZC5pZCwge1xuICAgICAgICAgIGZyb250Q29udGVudDogY2xvdWRDYXJkLmZyb250X2NvbnRlbnQsXG4gICAgICAgICAgYmFja0NvbnRlbnQ6IGNsb3VkQ2FyZC5iYWNrX2NvbnRlbnQsXG4gICAgICAgICAgc3R5bGU6IGNsb3VkQ2FyZC5zdHlsZSxcbiAgICAgICAgICBmb2xkZXJJZDogY2xvdWRDYXJkLmZvbGRlcl9pZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShjbG91ZENhcmQudXBkYXRlZF9hdCksXG4gICAgICAgICAgc3luY1ZlcnNpb246IGNsb3VkQ2FyZC5zeW5jX3ZlcnNpb24sXG4gICAgICAgICAgcGVuZGluZ1N5bmM6IGZhbHNlXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2UgaWYgKGxvY2FsVXBkYXRlVGltZSA+IGNsb3VkVXBkYXRlVGltZSAmJiBsb2NhbENhcmQucGVuZGluZ1N5bmMpIHtcbiAgICAgICAgLy8g5pys5Zyw5pWw5o2u5pu05paw77yM5LiK5Lyg5Yiw5LqR56uvXG4gICAgICAgIGF3YWl0IHRoaXMucXVldWVPcGVyYXRpb24oe1xuICAgICAgICAgIHR5cGU6ICd1cGRhdGUnLFxuICAgICAgICAgIHRhYmxlOiAnY2FyZHMnLFxuICAgICAgICAgIGRhdGE6IGxvY2FsQ2FyZCxcbiAgICAgICAgICBsb2NhbElkOiBsb2NhbENhcmQuaWRcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIC8vIOWmguaenOaXtumXtOebuOWQjO+8jOiupOS4uuaYr+WQjOatpeeahO+8jOS4jeWBmuS7u+S9leaTjeS9nFxuICAgIH1cbiAgfVxuXG4gIC8vIOWQiOW5tuS6keerr+aWh+S7tuWkueaVsOaNriAtIOS9v+eUqFwi5pyA5ZCO5YaZ5YWl6I636IOcXCLnrZbnlaVcbiAgcHJpdmF0ZSBhc3luYyBtZXJnZUNsb3VkRm9sZGVyKGNsb3VkRm9sZGVyOiBhbnkpIHtcbiAgICBjb25zdCBsb2NhbEZvbGRlciA9IGF3YWl0IGRiLmZvbGRlcnM/LmdldChjbG91ZEZvbGRlci5pZClcbiAgICBcbiAgICBpZiAoIWxvY2FsRm9sZGVyKSB7XG4gICAgICBhd2FpdCBkYi5mb2xkZXJzPy5hZGQoe1xuICAgICAgICBpZDogY2xvdWRGb2xkZXIuaWQsXG4gICAgICAgIG5hbWU6IGNsb3VkRm9sZGVyLm5hbWUsXG4gICAgICAgIGNvbG9yOiAnIzNiODJmNicsXG4gICAgICAgIGljb246ICdGb2xkZXInLFxuICAgICAgICBjYXJkSWRzOiBbXSxcbiAgICAgICAgcGFyZW50SWQ6IGNsb3VkRm9sZGVyLnBhcmVudF9pZCB8fCB1bmRlZmluZWQsXG4gICAgICAgIGlzRXhwYW5kZWQ6IHRydWUsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoY2xvdWRGb2xkZXIuY3JlYXRlZF9hdCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoY2xvdWRGb2xkZXIudXBkYXRlZF9hdCksXG4gICAgICAgIHN5bmNWZXJzaW9uOiBjbG91ZEZvbGRlci5zeW5jX3ZlcnNpb24sXG4gICAgICAgIHBlbmRpbmdTeW5jOiBmYWxzZVxuICAgICAgfSBhcyBEYkZvbGRlcilcbiAgICB9IGVsc2Uge1xuICAgICAgLy8g5q+U6L6D5pu05paw5pe26Ze077yM6YeH55SoXCLmnIDlkI7lhpnlhaXojrfog5xcIuetlueVpVxuICAgICAgY29uc3QgbG9jYWxVcGRhdGVUaW1lID0gbmV3IERhdGUobG9jYWxGb2xkZXIudXBkYXRlZEF0KS5nZXRUaW1lKClcbiAgICAgIGNvbnN0IGNsb3VkVXBkYXRlVGltZSA9IG5ldyBEYXRlKGNsb3VkRm9sZGVyLnVwZGF0ZWRfYXQpLmdldFRpbWUoKVxuICAgICAgXG4gICAgICBpZiAoY2xvdWRVcGRhdGVUaW1lID4gbG9jYWxVcGRhdGVUaW1lKSB7XG4gICAgICAgIGF3YWl0IGRiLmZvbGRlcnM/LnVwZGF0ZShjbG91ZEZvbGRlci5pZCwge1xuICAgICAgICAgIG5hbWU6IGNsb3VkRm9sZGVyLm5hbWUsXG4gICAgICAgICAgcGFyZW50SWQ6IGNsb3VkRm9sZGVyLnBhcmVudF9pZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShjbG91ZEZvbGRlci51cGRhdGVkX2F0KSxcbiAgICAgICAgICBzeW5jVmVyc2lvbjogY2xvdWRGb2xkZXIuc3luY192ZXJzaW9uLFxuICAgICAgICAgIHBlbmRpbmdTeW5jOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIGlmIChsb2NhbFVwZGF0ZVRpbWUgPiBjbG91ZFVwZGF0ZVRpbWUgJiYgbG9jYWxGb2xkZXIucGVuZGluZ1N5bmMpIHtcbiAgICAgICAgLy8g5pys5Zyw5pWw5o2u5pu05paw77yM5LiK5Lyg5Yiw5LqR56uvXG4gICAgICAgIGF3YWl0IHRoaXMucXVldWVPcGVyYXRpb24oe1xuICAgICAgICAgIHR5cGU6ICd1cGRhdGUnLFxuICAgICAgICAgIHRhYmxlOiAnZm9sZGVycycsXG4gICAgICAgICAgZGF0YTogbG9jYWxGb2xkZXIsXG4gICAgICAgICAgbG9jYWxJZDogbG9jYWxGb2xkZXIuaWRcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyDlkIjlubbkupHnq6/moIfnrb7mlbDmja4gLSDkvb/nlKhcIuacgOWQjuWGmeWFpeiOt+iDnFwi562W55WlXG4gIHByaXZhdGUgYXN5bmMgbWVyZ2VDbG91ZFRhZyhjbG91ZFRhZzogYW55KSB7XG4gICAgY29uc3QgbG9jYWxUYWcgPSBhd2FpdCBkYi50YWdzPy5nZXQoY2xvdWRUYWcuaWQpXG4gICAgXG4gICAgaWYgKCFsb2NhbFRhZykge1xuICAgICAgYXdhaXQgZGIudGFncz8uYWRkKHtcbiAgICAgICAgaWQ6IGNsb3VkVGFnLmlkLFxuICAgICAgICBuYW1lOiBjbG91ZFRhZy5uYW1lLFxuICAgICAgICBjb2xvcjogY2xvdWRUYWcuY29sb3IsXG4gICAgICAgIGNvdW50OiAwLCAvLyDkupHnq6/lkIzmraXkuIvmnaXnmoTmoIfnrb7liJ3lp4vorqHmlbDkuLow77yM5ZCO57ut5Lya6YCa6L+Hc3luY1RhZ3NXaXRoQ2FyZHPmm7TmlrBcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShjbG91ZFRhZy5jcmVhdGVkX2F0KSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZShjbG91ZFRhZy51cGRhdGVkX2F0KSxcbiAgICAgICAgc3luY1ZlcnNpb246IGNsb3VkVGFnLnN5bmNfdmVyc2lvbixcbiAgICAgICAgcGVuZGluZ1N5bmM6IGZhbHNlXG4gICAgICB9IGFzIERiVGFnKVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyDmr5TovoPmm7TmlrDml7bpl7TvvIzph4fnlKhcIuacgOWQjuWGmeWFpeiOt+iDnFwi562W55WlXG4gICAgICBjb25zdCBsb2NhbFVwZGF0ZVRpbWUgPSBuZXcgRGF0ZShsb2NhbFRhZy51cGRhdGVkQXQpLmdldFRpbWUoKVxuICAgICAgY29uc3QgY2xvdWRVcGRhdGVUaW1lID0gbmV3IERhdGUoY2xvdWRUYWcudXBkYXRlZEF0KS5nZXRUaW1lKClcbiAgICAgIFxuICAgICAgaWYgKGNsb3VkVXBkYXRlVGltZSA+IGxvY2FsVXBkYXRlVGltZSkge1xuICAgICAgICBhd2FpdCBkYi50YWdzPy51cGRhdGUoY2xvdWRUYWcuaWQsIHtcbiAgICAgICAgICBuYW1lOiBjbG91ZFRhZy5uYW1lLFxuICAgICAgICAgIGNvbG9yOiBjbG91ZFRhZy5jb2xvcixcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKGNsb3VkVGFnLnVwZGF0ZWRfYXQpLFxuICAgICAgICAgIHN5bmNWZXJzaW9uOiBjbG91ZFRhZy5zeW5jX3ZlcnNpb24sXG4gICAgICAgICAgcGVuZGluZ1N5bmM6IGZhbHNlXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2UgaWYgKGxvY2FsVXBkYXRlVGltZSA+IGNsb3VkVXBkYXRlVGltZSAmJiBsb2NhbFRhZy5wZW5kaW5nU3luYykge1xuICAgICAgICAvLyDmnKzlnLDmlbDmja7mm7TmlrDvvIzkuIrkvKDliLDkupHnq69cbiAgICAgICAgYXdhaXQgdGhpcy5xdWV1ZU9wZXJhdGlvbih7XG4gICAgICAgICAgdHlwZTogJ3VwZGF0ZScsXG4gICAgICAgICAgdGFibGU6ICd0YWdzJyxcbiAgICAgICAgICBkYXRhOiBsb2NhbFRhZyxcbiAgICAgICAgICBsb2NhbElkOiBsb2NhbFRhZy5pZFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIOaMgeS5heWMluWQjOatpemYn+WIl1xuICBwcml2YXRlIGFzeW5jIHBlcnNpc3RTeW5jUXVldWUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjYXJkYWxsX3N5bmNfcXVldWUnLCBKU09OLnN0cmluZ2lmeSh0aGlzLnN5bmNRdWV1ZSkpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwZXJzaXN0IHN5bmMgcXVldWU6JywgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLy8g5oGi5aSN5ZCM5q2l6Zif5YiXXG4gIGFzeW5jIHJlc3RvcmVTeW5jUXVldWUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0b3JlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYXJkYWxsX3N5bmNfcXVldWUnKVxuICAgICAgaWYgKHN0b3JlZCkge1xuICAgICAgICB0aGlzLnN5bmNRdWV1ZSA9IEpTT04ucGFyc2Uoc3RvcmVkKVxuICAgICAgICB0aGlzLm5vdGlmeVN0YXR1c0NoYW5nZSgpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byByZXN0b3JlIHN5bmMgcXVldWU6JywgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLy8g5riF6Zmk5ZCM5q2l6Zif5YiXXG4gIGFzeW5jIGNsZWFyU3luY1F1ZXVlKCkge1xuICAgIHRoaXMuc3luY1F1ZXVlID0gW11cbiAgICBhd2FpdCB0aGlzLnBlcnNpc3RTeW5jUXVldWUoKVxuICAgIHRoaXMubm90aWZ5U3RhdHVzQ2hhbmdlKClcbiAgfVxuXG4gIC8vIOiOt+WPluWGsueqgeWIl+ihqFxuICBnZXRDb25mbGljdHMoKTogQ29uZmxpY3RSZXNvbHV0aW9uW10ge1xuICAgIHJldHVybiBbLi4udGhpcy5jb25mbGljdHNdXG4gIH1cblxuICAvLyDop6PlhrPlhrLnqoFcbiAgYXN5bmMgcmVzb2x2ZUNvbmZsaWN0KGNvbmZsaWN0SWQ6IHN0cmluZywgcmVzb2x1dGlvbjogJ2xvY2FsJyB8ICdjbG91ZCcgfCAnbWVyZ2UnKSB7XG4gICAgY29uc3QgY29uZmxpY3QgPSB0aGlzLmNvbmZsaWN0cy5maW5kKGMgPT4gYy5pZCA9PT0gY29uZmxpY3RJZClcbiAgICBpZiAoIWNvbmZsaWN0KSByZXR1cm5cblxuICAgIC8vIOagueaNruino+WGs+aWueahiOWkhOeQhuWGsueqgVxuICAgIHN3aXRjaCAocmVzb2x1dGlvbikge1xuICAgICAgY2FzZSAnbG9jYWwnOlxuICAgICAgICAvLyDkvb/nlKjmnKzlnLDmlbDmja7vvIzkuIrkvKDliLDkupHnq69cbiAgICAgICAgYXdhaXQgdGhpcy5xdWV1ZU9wZXJhdGlvbih7XG4gICAgICAgICAgdHlwZTogJ3VwZGF0ZScsXG4gICAgICAgICAgdGFibGU6IGNvbmZsaWN0LnRhYmxlIGFzIGFueSxcbiAgICAgICAgICBkYXRhOiBjb25mbGljdC5sb2NhbERhdGEsXG4gICAgICAgICAgbG9jYWxJZDogY29uZmxpY3QubG9jYWxEYXRhLmlkXG4gICAgICAgIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICBcbiAgICAgIGNhc2UgJ2Nsb3VkJzpcbiAgICAgICAgLy8g5L2/55So5LqR56uv5pWw5o2u77yM5pu05paw5pys5ZywXG4gICAgICAgIC8vIOi/memHjOmcgOimgeagueaNruWFt+S9k+ihqOexu+Wei+WkhOeQhlxuICAgICAgICBicmVha1xuICAgICAgXG4gICAgICBjYXNlICdtZXJnZSc6XG4gICAgICAgIC8vIOWQiOW5tuaVsOaNru+8iOmcgOimgeWFt+S9k+WunueOsO+8iVxuICAgICAgICBicmVha1xuICAgIH1cblxuICAgIC8vIOenu+mZpOW3suino+WGs+eahOWGsueqgVxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jb25mbGljdHMuZmluZEluZGV4KGMgPT4gYy5pZCA9PT0gY29uZmxpY3RJZClcbiAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5jb25mbGljdHMuc3BsaWNlKGluZGV4LCAxKVxuICAgICAgdGhpcy5ub3RpZnlTdGF0dXNDaGFuZ2UoKVxuICAgIH1cbiAgfVxufVxuXG4vLyDlr7zlh7rljZXkvovlrp7kvotcbmV4cG9ydCBjb25zdCBjbG91ZFN5bmNTZXJ2aWNlID0gbmV3IENsb3VkU3luY1NlcnZpY2UoKSJdLCJ2ZXJzaW9uIjozfQ==