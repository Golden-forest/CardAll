e9ac11787a6387cb81a4a10612ae3929
'use strict';
Object.defineProperty(exports, '__esModule', {
    value: true
});
exports.default = deepCyclicCopyReplaceable;
var _prettyFormat = require('pretty-format');
/**
 * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
const builtInObject = [
    Array,
    Date,
    Float32Array,
    Float64Array,
    Int16Array,
    Int32Array,
    Int8Array,
    Map,
    Set,
    RegExp,
    Uint16Array,
    Uint32Array,
    Uint8Array,
    Uint8ClampedArray
];
if (typeof Buffer !== 'undefined') {
    builtInObject.push(Buffer);
}
const isBuiltInObject = object => builtInObject.includes(object.constructor);
const isMap = value => value.constructor === Map;
function deepCyclicCopyReplaceable(value, cycles = new WeakMap()) {
    if (typeof value !== 'object' || value === null) {
        return value;
    }
    else if (cycles.has(value)) {
        return cycles.get(value);
    }
    else if (Array.isArray(value)) {
        return deepCyclicCopyArray(value, cycles);
    }
    else if (isMap(value)) {
        return deepCyclicCopyMap(value, cycles);
    }
    else if (isBuiltInObject(value)) {
        return value;
    }
    else if (_prettyFormat.plugins.DOMElement.test(value)) {
        return value.cloneNode(true);
    }
    else {
        return deepCyclicCopyObject(value, cycles);
    }
}
function deepCyclicCopyObject(object, cycles) {
    const newObject = Object.create(Object.getPrototypeOf(object));
    const descriptors = Object.getOwnPropertyDescriptors(object);
    cycles.set(object, newObject);
    const newDescriptors = [
        ...Object.keys(descriptors),
        ...Object.getOwnPropertySymbols(descriptors)
    ].reduce(
    //@ts-expect-error because typescript do not support symbol key in object
    //https://github.com/microsoft/TypeScript/issues/1863
    (newDescriptors, key) => {
        const enumerable = descriptors[key].enumerable;
        newDescriptors[key] = {
            configurable: true,
            enumerable,
            value: deepCyclicCopyReplaceable(
            // this accesses the value or getter, depending. We just care about the value anyways, and this allows us to not mess with accessors
            // it has the side effect of invoking the getter here though, rather than copying it over
            object[key], cycles),
            writable: true
        };
        return newDescriptors;
    }, {});
    //@ts-expect-error because typescript do not support symbol key in object
    //https://github.com/microsoft/TypeScript/issues/1863
    return Object.defineProperties(newObject, newDescriptors);
}
function deepCyclicCopyArray(array, cycles) {
    const newArray = new (Object.getPrototypeOf(array).constructor)(array.length);
    const length = array.length;
    cycles.set(array, newArray);
    for (let i = 0; i < length; i++) {
        newArray[i] = deepCyclicCopyReplaceable(array[i], cycles);
    }
    return newArray;
}
function deepCyclicCopyMap(map, cycles) {
    const newMap = new Map();
    cycles.set(map, newMap);
    map.forEach((value, key) => {
        newMap.set(key, deepCyclicCopyReplaceable(value, cycles));
    });
    return newMap;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXG5vZGVfbW9kdWxlc1xcamVzdC1heGVcXG5vZGVfbW9kdWxlc1xcamVzdC1tYXRjaGVyLXV0aWxzXFxidWlsZFxcZGVlcEN5Y2xpY0NvcHlSZXBsYWNlYWJsZS5qcyIsIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUFFYixNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUU7SUFDM0MsS0FBSyxFQUFFLElBQUk7Q0FDWixDQUFDLENBQUM7QUFDSCxPQUFPLENBQUMsT0FBTyxHQUFHLHlCQUF5QixDQUFDO0FBQzVDLElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUM3Qzs7Ozs7R0FLRztBQUVILE1BQU0sYUFBYSxHQUFHO0lBQ3BCLEtBQUs7SUFDTCxJQUFJO0lBQ0osWUFBWTtJQUNaLFlBQVk7SUFDWixVQUFVO0lBQ1YsVUFBVTtJQUNWLFNBQVM7SUFDVCxHQUFHO0lBQ0gsR0FBRztJQUNILE1BQU07SUFDTixXQUFXO0lBQ1gsV0FBVztJQUNYLFVBQVU7SUFDVixpQkFBaUI7Q0FDbEIsQ0FBQztBQUNGLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFLENBQUM7SUFDbEMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixDQUFDO0FBQ0QsTUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUM3RSxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLEtBQUssR0FBRyxDQUFDO0FBQ2pELFNBQVMseUJBQXlCLENBQUMsS0FBSyxFQUFFLE1BQU0sR0FBRyxJQUFJLE9BQU8sRUFBRTtJQUM5RCxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDaEQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO1NBQU0sSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDN0IsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzNCLENBQUM7U0FBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNoQyxPQUFPLG1CQUFtQixDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM1QyxDQUFDO1NBQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUN4QixPQUFPLGlCQUFpQixDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUMxQyxDQUFDO1NBQU0sSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNsQyxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7U0FBTSxJQUFJLGFBQWEsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3hELE9BQU8sS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQixDQUFDO1NBQU0sQ0FBQztRQUNOLE9BQU8sb0JBQW9CLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdDLENBQUM7QUFDSCxDQUFDO0FBQ0QsU0FBUyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsTUFBTTtJQUMxQyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUMvRCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMseUJBQXlCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDN0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDOUIsTUFBTSxjQUFjLEdBQUc7UUFDckIsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUMzQixHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLENBQUM7S0FDN0MsQ0FBQyxNQUFNO0lBQ04seUVBQXlFO0lBQ3pFLHFEQUFxRDtJQUNyRCxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUN0QixNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxDQUFDO1FBQy9DLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRztZQUNwQixZQUFZLEVBQUUsSUFBSTtZQUNsQixVQUFVO1lBQ1YsS0FBSyxFQUFFLHlCQUF5QjtZQUM5QixvSUFBb0k7WUFDcEkseUZBQXlGO1lBQ3pGLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFDWCxNQUFNLENBQ1A7WUFDRCxRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUM7UUFDRixPQUFPLGNBQWMsQ0FBQztJQUN4QixDQUFDLEVBQ0QsRUFBRSxDQUNILENBQUM7SUFDRix5RUFBeUU7SUFDekUscURBQXFEO0lBQ3JELE9BQU8sTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsQ0FBQztBQUM1RCxDQUFDO0FBQ0QsU0FBUyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsTUFBTTtJQUN4QyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDOUUsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUM1QixNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztJQUM1QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDaEMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLHlCQUF5QixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBQ0QsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQztBQUNELFNBQVMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLE1BQU07SUFDcEMsTUFBTSxNQUFNLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN6QixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN4QixHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ3pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzVELENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXENhcmRFdmVyeXRoaW5nXFxjYXJkYWxsLXByb3RvdHlwZVxcbm9kZV9tb2R1bGVzXFxqZXN0LWF4ZVxcbm9kZV9tb2R1bGVzXFxqZXN0LW1hdGNoZXItdXRpbHNcXGJ1aWxkXFxkZWVwQ3ljbGljQ29weVJlcGxhY2VhYmxlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmRlZmF1bHQgPSBkZWVwQ3ljbGljQ29weVJlcGxhY2VhYmxlO1xudmFyIF9wcmV0dHlGb3JtYXQgPSByZXF1aXJlKCdwcmV0dHktZm9ybWF0Jyk7XG4vKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbmNvbnN0IGJ1aWx0SW5PYmplY3QgPSBbXG4gIEFycmF5LFxuICBEYXRlLFxuICBGbG9hdDMyQXJyYXksXG4gIEZsb2F0NjRBcnJheSxcbiAgSW50MTZBcnJheSxcbiAgSW50MzJBcnJheSxcbiAgSW50OEFycmF5LFxuICBNYXAsXG4gIFNldCxcbiAgUmVnRXhwLFxuICBVaW50MTZBcnJheSxcbiAgVWludDMyQXJyYXksXG4gIFVpbnQ4QXJyYXksXG4gIFVpbnQ4Q2xhbXBlZEFycmF5XG5dO1xuaWYgKHR5cGVvZiBCdWZmZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gIGJ1aWx0SW5PYmplY3QucHVzaChCdWZmZXIpO1xufVxuY29uc3QgaXNCdWlsdEluT2JqZWN0ID0gb2JqZWN0ID0+IGJ1aWx0SW5PYmplY3QuaW5jbHVkZXMob2JqZWN0LmNvbnN0cnVjdG9yKTtcbmNvbnN0IGlzTWFwID0gdmFsdWUgPT4gdmFsdWUuY29uc3RydWN0b3IgPT09IE1hcDtcbmZ1bmN0aW9uIGRlZXBDeWNsaWNDb3B5UmVwbGFjZWFibGUodmFsdWUsIGN5Y2xlcyA9IG5ldyBXZWFrTWFwKCkpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH0gZWxzZSBpZiAoY3ljbGVzLmhhcyh2YWx1ZSkpIHtcbiAgICByZXR1cm4gY3ljbGVzLmdldCh2YWx1ZSk7XG4gIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gZGVlcEN5Y2xpY0NvcHlBcnJheSh2YWx1ZSwgY3ljbGVzKTtcbiAgfSBlbHNlIGlmIChpc01hcCh2YWx1ZSkpIHtcbiAgICByZXR1cm4gZGVlcEN5Y2xpY0NvcHlNYXAodmFsdWUsIGN5Y2xlcyk7XG4gIH0gZWxzZSBpZiAoaXNCdWlsdEluT2JqZWN0KHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfSBlbHNlIGlmIChfcHJldHR5Rm9ybWF0LnBsdWdpbnMuRE9NRWxlbWVudC50ZXN0KHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGRlZXBDeWNsaWNDb3B5T2JqZWN0KHZhbHVlLCBjeWNsZXMpO1xuICB9XG59XG5mdW5jdGlvbiBkZWVwQ3ljbGljQ29weU9iamVjdChvYmplY3QsIGN5Y2xlcykge1xuICBjb25zdCBuZXdPYmplY3QgPSBPYmplY3QuY3JlYXRlKE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpKTtcbiAgY29uc3QgZGVzY3JpcHRvcnMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhvYmplY3QpO1xuICBjeWNsZXMuc2V0KG9iamVjdCwgbmV3T2JqZWN0KTtcbiAgY29uc3QgbmV3RGVzY3JpcHRvcnMgPSBbXG4gICAgLi4uT2JqZWN0LmtleXMoZGVzY3JpcHRvcnMpLFxuICAgIC4uLk9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZGVzY3JpcHRvcnMpXG4gIF0ucmVkdWNlKFxuICAgIC8vQHRzLWV4cGVjdC1lcnJvciBiZWNhdXNlIHR5cGVzY3JpcHQgZG8gbm90IHN1cHBvcnQgc3ltYm9sIGtleSBpbiBvYmplY3RcbiAgICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTg2M1xuICAgIChuZXdEZXNjcmlwdG9ycywga2V5KSA9PiB7XG4gICAgICBjb25zdCBlbnVtZXJhYmxlID0gZGVzY3JpcHRvcnNba2V5XS5lbnVtZXJhYmxlO1xuICAgICAgbmV3RGVzY3JpcHRvcnNba2V5XSA9IHtcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICBlbnVtZXJhYmxlLFxuICAgICAgICB2YWx1ZTogZGVlcEN5Y2xpY0NvcHlSZXBsYWNlYWJsZShcbiAgICAgICAgICAvLyB0aGlzIGFjY2Vzc2VzIHRoZSB2YWx1ZSBvciBnZXR0ZXIsIGRlcGVuZGluZy4gV2UganVzdCBjYXJlIGFib3V0IHRoZSB2YWx1ZSBhbnl3YXlzLCBhbmQgdGhpcyBhbGxvd3MgdXMgdG8gbm90IG1lc3Mgd2l0aCBhY2Nlc3NvcnNcbiAgICAgICAgICAvLyBpdCBoYXMgdGhlIHNpZGUgZWZmZWN0IG9mIGludm9raW5nIHRoZSBnZXR0ZXIgaGVyZSB0aG91Z2gsIHJhdGhlciB0aGFuIGNvcHlpbmcgaXQgb3ZlclxuICAgICAgICAgIG9iamVjdFtrZXldLFxuICAgICAgICAgIGN5Y2xlc1xuICAgICAgICApLFxuICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgfTtcbiAgICAgIHJldHVybiBuZXdEZXNjcmlwdG9ycztcbiAgICB9LFxuICAgIHt9XG4gICk7XG4gIC8vQHRzLWV4cGVjdC1lcnJvciBiZWNhdXNlIHR5cGVzY3JpcHQgZG8gbm90IHN1cHBvcnQgc3ltYm9sIGtleSBpbiBvYmplY3RcbiAgLy9odHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzE4NjNcbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG5ld09iamVjdCwgbmV3RGVzY3JpcHRvcnMpO1xufVxuZnVuY3Rpb24gZGVlcEN5Y2xpY0NvcHlBcnJheShhcnJheSwgY3ljbGVzKSB7XG4gIGNvbnN0IG5ld0FycmF5ID0gbmV3IChPYmplY3QuZ2V0UHJvdG90eXBlT2YoYXJyYXkpLmNvbnN0cnVjdG9yKShhcnJheS5sZW5ndGgpO1xuICBjb25zdCBsZW5ndGggPSBhcnJheS5sZW5ndGg7XG4gIGN5Y2xlcy5zZXQoYXJyYXksIG5ld0FycmF5KTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgIG5ld0FycmF5W2ldID0gZGVlcEN5Y2xpY0NvcHlSZXBsYWNlYWJsZShhcnJheVtpXSwgY3ljbGVzKTtcbiAgfVxuICByZXR1cm4gbmV3QXJyYXk7XG59XG5mdW5jdGlvbiBkZWVwQ3ljbGljQ29weU1hcChtYXAsIGN5Y2xlcykge1xuICBjb25zdCBuZXdNYXAgPSBuZXcgTWFwKCk7XG4gIGN5Y2xlcy5zZXQobWFwLCBuZXdNYXApO1xuICBtYXAuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgIG5ld01hcC5zZXQoa2V5LCBkZWVwQ3ljbGljQ29weVJlcGxhY2VhYmxlKHZhbHVlLCBjeWNsZXMpKTtcbiAgfSk7XG4gIHJldHVybiBuZXdNYXA7XG59XG4iXSwidmVyc2lvbiI6M30=