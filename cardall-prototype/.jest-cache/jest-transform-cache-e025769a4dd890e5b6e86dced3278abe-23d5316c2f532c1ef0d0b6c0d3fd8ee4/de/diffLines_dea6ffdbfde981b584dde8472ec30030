e7e226eb6f5060b5cf6ea3a5be0d08d1
'use strict';
Object.defineProperty(exports, '__esModule', {
    value: true
});
exports.printDiffLines =
    exports.diffLinesUnified2 =
        exports.diffLinesUnified =
            exports.diffLinesRaw =
                void 0;
var _diffSequences = _interopRequireDefault(require('diff-sequences'));
var _cleanupSemantic = require('./cleanupSemantic');
var _joinAlignedDiffs = require('./joinAlignedDiffs');
var _normalizeDiffOptions = require('./normalizeDiffOptions');
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
const isEmptyString = lines => lines.length === 1 && lines[0].length === 0;
const countChanges = diffs => {
    let a = 0;
    let b = 0;
    diffs.forEach(diff => {
        switch (diff[0]) {
            case _cleanupSemantic.DIFF_DELETE:
                a += 1;
                break;
            case _cleanupSemantic.DIFF_INSERT:
                b += 1;
                break;
        }
    });
    return {
        a,
        b
    };
};
const printAnnotation = ({ aAnnotation, aColor, aIndicator, bAnnotation, bColor, bIndicator, includeChangeCounts, omitAnnotationLines }, changeCounts) => {
    if (omitAnnotationLines) {
        return '';
    }
    let aRest = '';
    let bRest = '';
    if (includeChangeCounts) {
        const aCount = String(changeCounts.a);
        const bCount = String(changeCounts.b);
        // Padding right aligns the ends of the annotations.
        const baAnnotationLengthDiff = bAnnotation.length - aAnnotation.length;
        const aAnnotationPadding = ' '.repeat(Math.max(0, baAnnotationLengthDiff));
        const bAnnotationPadding = ' '.repeat(Math.max(0, -baAnnotationLengthDiff));
        // Padding left aligns the ends of the counts.
        const baCountLengthDiff = bCount.length - aCount.length;
        const aCountPadding = ' '.repeat(Math.max(0, baCountLengthDiff));
        const bCountPadding = ' '.repeat(Math.max(0, -baCountLengthDiff));
        aRest = `${aAnnotationPadding}  ${aIndicator} ${aCountPadding}${aCount}`;
        bRest = `${bAnnotationPadding}  ${bIndicator} ${bCountPadding}${bCount}`;
    }
    const a = `${aIndicator} ${aAnnotation}${aRest}`;
    const b = `${bIndicator} ${bAnnotation}${bRest}`;
    return `${aColor(a)}\n${bColor(b)}\n\n`;
};
const printDiffLines = (diffs, options) => printAnnotation(options, countChanges(diffs)) +
    (options.expand
        ? (0, _joinAlignedDiffs.joinAlignedDiffsExpand)(diffs, options)
        : (0, _joinAlignedDiffs.joinAlignedDiffsNoExpand)(diffs, options));
// Compare two arrays of strings line-by-line. Format as comparison lines.
exports.printDiffLines = printDiffLines;
const diffLinesUnified = (aLines, bLines, options) => printDiffLines(diffLinesRaw(isEmptyString(aLines) ? [] : aLines, isEmptyString(bLines) ? [] : bLines), (0, _normalizeDiffOptions.normalizeDiffOptions)(options));
// Given two pairs of arrays of strings:
// Compare the pair of comparison arrays line-by-line.
// Format the corresponding lines in the pair of displayable arrays.
exports.diffLinesUnified = diffLinesUnified;
const diffLinesUnified2 = (aLinesDisplay, bLinesDisplay, aLinesCompare, bLinesCompare, options) => {
    if (isEmptyString(aLinesDisplay) && isEmptyString(aLinesCompare)) {
        aLinesDisplay = [];
        aLinesCompare = [];
    }
    if (isEmptyString(bLinesDisplay) && isEmptyString(bLinesCompare)) {
        bLinesDisplay = [];
        bLinesCompare = [];
    }
    if (aLinesDisplay.length !== aLinesCompare.length ||
        bLinesDisplay.length !== bLinesCompare.length) {
        // Fall back to diff of display lines.
        return diffLinesUnified(aLinesDisplay, bLinesDisplay, options);
    }
    const diffs = diffLinesRaw(aLinesCompare, bLinesCompare);
    // Replace comparison lines with displayable lines.
    let aIndex = 0;
    let bIndex = 0;
    diffs.forEach(diff => {
        switch (diff[0]) {
            case _cleanupSemantic.DIFF_DELETE:
                diff[1] = aLinesDisplay[aIndex];
                aIndex += 1;
                break;
            case _cleanupSemantic.DIFF_INSERT:
                diff[1] = bLinesDisplay[bIndex];
                bIndex += 1;
                break;
            default:
                diff[1] = bLinesDisplay[bIndex];
                aIndex += 1;
                bIndex += 1;
        }
    });
    return printDiffLines(diffs, (0, _normalizeDiffOptions.normalizeDiffOptions)(options));
};
// Compare two arrays of strings line-by-line.
exports.diffLinesUnified2 = diffLinesUnified2;
const diffLinesRaw = (aLines, bLines) => {
    const aLength = aLines.length;
    const bLength = bLines.length;
    const isCommon = (aIndex, bIndex) => aLines[aIndex] === bLines[bIndex];
    const diffs = [];
    let aIndex = 0;
    let bIndex = 0;
    const foundSubsequence = (nCommon, aCommon, bCommon) => {
        for (; aIndex !== aCommon; aIndex += 1) {
            diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_DELETE, aLines[aIndex]));
        }
        for (; bIndex !== bCommon; bIndex += 1) {
            diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_INSERT, bLines[bIndex]));
        }
        for (; nCommon !== 0; nCommon -= 1, aIndex += 1, bIndex += 1) {
            diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_EQUAL, bLines[bIndex]));
        }
    };
    (0, _diffSequences.default)(aLength, bLength, isCommon, foundSubsequence);
    // After the last common subsequence, push remaining change items.
    for (; aIndex !== aLength; aIndex += 1) {
        diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_DELETE, aLines[aIndex]));
    }
    for (; bIndex !== bLength; bIndex += 1) {
        diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_INSERT, bLines[bIndex]));
    }
    return diffs;
};
exports.diffLinesRaw = diffLinesRaw;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXG5vZGVfbW9kdWxlc1xcamVzdC1heGVcXG5vZGVfbW9kdWxlc1xcamVzdC1kaWZmXFxidWlsZFxcZGlmZkxpbmVzLmpzIiwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUViLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRTtJQUMzQyxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUMsQ0FBQztBQUNILE9BQU8sQ0FBQyxjQUFjO0lBQ3BCLE9BQU8sQ0FBQyxpQkFBaUI7UUFDekIsT0FBTyxDQUFDLGdCQUFnQjtZQUN4QixPQUFPLENBQUMsWUFBWTtnQkFDbEIsS0FBSyxDQUFDLENBQUM7QUFDWCxJQUFJLGNBQWMsR0FBRyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0FBQ3ZFLElBQUksZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDcEQsSUFBSSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUN0RCxJQUFJLHFCQUFxQixHQUFHLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0FBQzlELFNBQVMsc0JBQXNCLENBQUMsR0FBRztJQUNqQyxPQUFPLEdBQUcsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsT0FBTyxFQUFFLEdBQUcsRUFBQyxDQUFDO0FBQ3RELENBQUM7QUFDRDs7Ozs7R0FLRztBQUVILE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7QUFDM0UsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLEVBQUU7SUFDM0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1Ys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QUFnQixDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FDdkUsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDLENBQUM7SUFDRixDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUUxRSxrRUFBa0U7SUFDbEUsT0FBTyxNQUFNLEtBQUssT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUN2QyxLQUFLLENBQUMsSUFBSSxDQUNSLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FDeEUsQ0FBQztJQUNKLENBQUM7SUFDRCxPQUFPLE1BQU0sS0FBSyxPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3ZDLEtBQUssQ0FBQyxJQUFJLENBQ1IsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUN4RSxDQUFDO0lBQ0osQ0FBQztJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyxDQUFDO0FBQ0YsT0FBTyxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXG5vZGVfbW9kdWxlc1xcamVzdC1heGVcXG5vZGVfbW9kdWxlc1xcamVzdC1kaWZmXFxidWlsZFxcZGlmZkxpbmVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLnByaW50RGlmZkxpbmVzID1cbiAgZXhwb3J0cy5kaWZmTGluZXNVbmlmaWVkMiA9XG4gIGV4cG9ydHMuZGlmZkxpbmVzVW5pZmllZCA9XG4gIGV4cG9ydHMuZGlmZkxpbmVzUmF3ID1cbiAgICB2b2lkIDA7XG52YXIgX2RpZmZTZXF1ZW5jZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoJ2RpZmYtc2VxdWVuY2VzJykpO1xudmFyIF9jbGVhbnVwU2VtYW50aWMgPSByZXF1aXJlKCcuL2NsZWFudXBTZW1hbnRpYycpO1xudmFyIF9qb2luQWxpZ25lZERpZmZzID0gcmVxdWlyZSgnLi9qb2luQWxpZ25lZERpZmZzJyk7XG52YXIgX25vcm1hbGl6ZURpZmZPcHRpb25zID0gcmVxdWlyZSgnLi9ub3JtYWxpemVEaWZmT3B0aW9ucycpO1xuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtcbiAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHtkZWZhdWx0OiBvYmp9O1xufVxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE1ldGEgUGxhdGZvcm1zLCBJbmMuIGFuZCBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbmNvbnN0IGlzRW1wdHlTdHJpbmcgPSBsaW5lcyA9PiBsaW5lcy5sZW5ndGggPT09IDEgJiYgbGluZXNbMF0ubGVuZ3RoID09PSAwO1xuY29uc3QgY291bnRDaGFuZ2VzID0gZGlmZnMgPT4ge1xuICBsZXQgYSA9IDA7XG4gIGxldCBiID0gMDtcbiAgZGlmZnMuZm9yRWFjaChkaWZmID0+IHtcbiAgICBzd2l0Y2ggKGRpZmZbMF0pIHtcbiAgICAgIGNhc2UgX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURTpcbiAgICAgICAgYSArPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgX2NsZWFudXBTZW1hbnRpYy5ESUZGX0lOU0VSVDpcbiAgICAgICAgYiArPSAxO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIGEsXG4gICAgYlxuICB9O1xufTtcbmNvbnN0IHByaW50QW5ub3RhdGlvbiA9IChcbiAge1xuICAgIGFBbm5vdGF0aW9uLFxuICAgIGFDb2xvcixcbiAgICBhSW5kaWNhdG9yLFxuICAgIGJBbm5vdGF0aW9uLFxuICAgIGJDb2xvcixcbiAgICBiSW5kaWNhdG9yLFxuICAgIGluY2x1ZGVDaGFuZ2VDb3VudHMsXG4gICAgb21pdEFubm90YXRpb25MaW5lc1xuICB9LFxuICBjaGFuZ2VDb3VudHNcbikgPT4ge1xuICBpZiAob21pdEFubm90YXRpb25MaW5lcykge1xuICAgIHJldHVybiAnJztcbiAgfVxuICBsZXQgYVJlc3QgPSAnJztcbiAgbGV0IGJSZXN0ID0gJyc7XG4gIGlmIChpbmNsdWRlQ2hhbmdlQ291bnRzKSB7XG4gICAgY29uc3QgYUNvdW50ID0gU3RyaW5nKGNoYW5nZUNvdW50cy5hKTtcbiAgICBjb25zdCBiQ291bnQgPSBTdHJpbmcoY2hhbmdlQ291bnRzLmIpO1xuXG4gICAgLy8gUGFkZGluZyByaWdodCBhbGlnbnMgdGhlIGVuZHMgb2YgdGhlIGFubm90YXRpb25zLlxuICAgIGNvbnN0IGJhQW5ub3RhdGlvbkxlbmd0aERpZmYgPSBiQW5ub3RhdGlvbi5sZW5ndGggLSBhQW5ub3RhdGlvbi5sZW5ndGg7XG4gICAgY29uc3QgYUFubm90YXRpb25QYWRkaW5nID0gJyAnLnJlcGVhdChNYXRoLm1heCgwLCBiYUFubm90YXRpb25MZW5ndGhEaWZmKSk7XG4gICAgY29uc3QgYkFubm90YXRpb25QYWRkaW5nID0gJyAnLnJlcGVhdChNYXRoLm1heCgwLCAtYmFBbm5vdGF0aW9uTGVuZ3RoRGlmZikpO1xuXG4gICAgLy8gUGFkZGluZyBsZWZ0IGFsaWducyB0aGUgZW5kcyBvZiB0aGUgY291bnRzLlxuICAgIGNvbnN0IGJhQ291bnRMZW5ndGhEaWZmID0gYkNvdW50Lmxlbmd0aCAtIGFDb3VudC5sZW5ndGg7XG4gICAgY29uc3QgYUNvdW50UGFkZGluZyA9ICcgJy5yZXBlYXQoTWF0aC5tYXgoMCwgYmFDb3VudExlbmd0aERpZmYpKTtcbiAgICBjb25zdCBiQ291bnRQYWRkaW5nID0gJyAnLnJlcGVhdChNYXRoLm1heCgwLCAtYmFDb3VudExlbmd0aERpZmYpKTtcbiAgICBhUmVzdCA9IGAke2FBbm5vdGF0aW9uUGFkZGluZ30gICR7YUluZGljYXRvcn0gJHthQ291bnRQYWRkaW5nfSR7YUNvdW50fWA7XG4gICAgYlJlc3QgPSBgJHtiQW5ub3RhdGlvblBhZGRpbmd9ICAke2JJbmRpY2F0b3J9ICR7YkNvdW50UGFkZGluZ30ke2JDb3VudH1gO1xuICB9XG4gIGNvbnN0IGEgPSBgJHthSW5kaWNhdG9yfSAke2FBbm5vdGF0aW9ufSR7YVJlc3R9YDtcbiAgY29uc3QgYiA9IGAke2JJbmRpY2F0b3J9ICR7YkFubm90YXRpb259JHtiUmVzdH1gO1xuICByZXR1cm4gYCR7YUNvbG9yKGEpfVxcbiR7YkNvbG9yKGIpfVxcblxcbmA7XG59O1xuY29uc3QgcHJpbnREaWZmTGluZXMgPSAoZGlmZnMsIG9wdGlvbnMpID0+XG4gIHByaW50QW5ub3RhdGlvbihvcHRpb25zLCBjb3VudENoYW5nZXMoZGlmZnMpKSArXG4gIChvcHRpb25zLmV4cGFuZFxuICAgID8gKDAsIF9qb2luQWxpZ25lZERpZmZzLmpvaW5BbGlnbmVkRGlmZnNFeHBhbmQpKGRpZmZzLCBvcHRpb25zKVxuICAgIDogKDAsIF9qb2luQWxpZ25lZERpZmZzLmpvaW5BbGlnbmVkRGlmZnNOb0V4cGFuZCkoZGlmZnMsIG9wdGlvbnMpKTtcblxuLy8gQ29tcGFyZSB0d28gYXJyYXlzIG9mIHN0cmluZ3MgbGluZS1ieS1saW5lLiBGb3JtYXQgYXMgY29tcGFyaXNvbiBsaW5lcy5cbmV4cG9ydHMucHJpbnREaWZmTGluZXMgPSBwcmludERpZmZMaW5lcztcbmNvbnN0IGRpZmZMaW5lc1VuaWZpZWQgPSAoYUxpbmVzLCBiTGluZXMsIG9wdGlvbnMpID0+XG4gIHByaW50RGlmZkxpbmVzKFxuICAgIGRpZmZMaW5lc1JhdyhcbiAgICAgIGlzRW1wdHlTdHJpbmcoYUxpbmVzKSA/IFtdIDogYUxpbmVzLFxuICAgICAgaXNFbXB0eVN0cmluZyhiTGluZXMpID8gW10gOiBiTGluZXNcbiAgICApLFxuICAgICgwLCBfbm9ybWFsaXplRGlmZk9wdGlvbnMubm9ybWFsaXplRGlmZk9wdGlvbnMpKG9wdGlvbnMpXG4gICk7XG5cbi8vIEdpdmVuIHR3byBwYWlycyBvZiBhcnJheXMgb2Ygc3RyaW5nczpcbi8vIENvbXBhcmUgdGhlIHBhaXIgb2YgY29tcGFyaXNvbiBhcnJheXMgbGluZS1ieS1saW5lLlxuLy8gRm9ybWF0IHRoZSBjb3JyZXNwb25kaW5nIGxpbmVzIGluIHRoZSBwYWlyIG9mIGRpc3BsYXlhYmxlIGFycmF5cy5cbmV4cG9ydHMuZGlmZkxpbmVzVW5pZmllZCA9IGRpZmZMaW5lc1VuaWZpZWQ7XG5jb25zdCBkaWZmTGluZXNVbmlmaWVkMiA9IChcbiAgYUxpbmVzRGlzcGxheSxcbiAgYkxpbmVzRGlzcGxheSxcbiAgYUxpbmVzQ29tcGFyZSxcbiAgYkxpbmVzQ29tcGFyZSxcbiAgb3B0aW9uc1xuKSA9PiB7XG4gIGlmIChpc0VtcHR5U3RyaW5nKGFMaW5lc0Rpc3BsYXkpICYmIGlzRW1wdHlTdHJpbmcoYUxpbmVzQ29tcGFyZSkpIHtcbiAgICBhTGluZXNEaXNwbGF5ID0gW107XG4gICAgYUxpbmVzQ29tcGFyZSA9IFtdO1xuICB9XG4gIGlmIChpc0VtcHR5U3RyaW5nKGJMaW5lc0Rpc3BsYXkpICYmIGlzRW1wdHlTdHJpbmcoYkxpbmVzQ29tcGFyZSkpIHtcbiAgICBiTGluZXNEaXNwbGF5ID0gW107XG4gICAgYkxpbmVzQ29tcGFyZSA9IFtdO1xuICB9XG4gIGlmIChcbiAgICBhTGluZXNEaXNwbGF5Lmxlbmd0aCAhPT0gYUxpbmVzQ29tcGFyZS5sZW5ndGggfHxcbiAgICBiTGluZXNEaXNwbGF5Lmxlbmd0aCAhPT0gYkxpbmVzQ29tcGFyZS5sZW5ndGhcbiAgKSB7XG4gICAgLy8gRmFsbCBiYWNrIHRvIGRpZmYgb2YgZGlzcGxheSBsaW5lcy5cbiAgICByZXR1cm4gZGlmZkxpbmVzVW5pZmllZChhTGluZXNEaXNwbGF5LCBiTGluZXNEaXNwbGF5LCBvcHRpb25zKTtcbiAgfVxuICBjb25zdCBkaWZmcyA9IGRpZmZMaW5lc1JhdyhhTGluZXNDb21wYXJlLCBiTGluZXNDb21wYXJlKTtcblxuICAvLyBSZXBsYWNlIGNvbXBhcmlzb24gbGluZXMgd2l0aCBkaXNwbGF5YWJsZSBsaW5lcy5cbiAgbGV0IGFJbmRleCA9IDA7XG4gIGxldCBiSW5kZXggPSAwO1xuICBkaWZmcy5mb3JFYWNoKGRpZmYgPT4ge1xuICAgIHN3aXRjaCAoZGlmZlswXSkge1xuICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFOlxuICAgICAgICBkaWZmWzFdID0gYUxpbmVzRGlzcGxheVthSW5kZXhdO1xuICAgICAgICBhSW5kZXggKz0gMTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQ6XG4gICAgICAgIGRpZmZbMV0gPSBiTGluZXNEaXNwbGF5W2JJbmRleF07XG4gICAgICAgIGJJbmRleCArPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGRpZmZbMV0gPSBiTGluZXNEaXNwbGF5W2JJbmRleF07XG4gICAgICAgIGFJbmRleCArPSAxO1xuICAgICAgICBiSW5kZXggKz0gMTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcHJpbnREaWZmTGluZXMoXG4gICAgZGlmZnMsXG4gICAgKDAsIF9ub3JtYWxpemVEaWZmT3B0aW9ucy5ub3JtYWxpemVEaWZmT3B0aW9ucykob3B0aW9ucylcbiAgKTtcbn07XG5cbi8vIENvbXBhcmUgdHdvIGFycmF5cyBvZiBzdHJpbmdzIGxpbmUtYnktbGluZS5cbmV4cG9ydHMuZGlmZkxpbmVzVW5pZmllZDIgPSBkaWZmTGluZXNVbmlmaWVkMjtcbmNvbnN0IGRpZmZMaW5lc1JhdyA9IChhTGluZXMsIGJMaW5lcykgPT4ge1xuICBjb25zdCBhTGVuZ3RoID0gYUxpbmVzLmxlbmd0aDtcbiAgY29uc3QgYkxlbmd0aCA9IGJMaW5lcy5sZW5ndGg7XG4gIGNvbnN0IGlzQ29tbW9uID0gKGFJbmRleCwgYkluZGV4KSA9PiBhTGluZXNbYUluZGV4XSA9PT0gYkxpbmVzW2JJbmRleF07XG4gIGNvbnN0IGRpZmZzID0gW107XG4gIGxldCBhSW5kZXggPSAwO1xuICBsZXQgYkluZGV4ID0gMDtcbiAgY29uc3QgZm91bmRTdWJzZXF1ZW5jZSA9IChuQ29tbW9uLCBhQ29tbW9uLCBiQ29tbW9uKSA9PiB7XG4gICAgZm9yICg7IGFJbmRleCAhPT0gYUNvbW1vbjsgYUluZGV4ICs9IDEpIHtcbiAgICAgIGRpZmZzLnB1c2goXG4gICAgICAgIG5ldyBfY2xlYW51cFNlbWFudGljLkRpZmYoX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURSwgYUxpbmVzW2FJbmRleF0pXG4gICAgICApO1xuICAgIH1cbiAgICBmb3IgKDsgYkluZGV4ICE9PSBiQ29tbW9uOyBiSW5kZXggKz0gMSkge1xuICAgICAgZGlmZnMucHVzaChcbiAgICAgICAgbmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZihfY2xlYW51cFNlbWFudGljLkRJRkZfSU5TRVJULCBiTGluZXNbYkluZGV4XSlcbiAgICAgICk7XG4gICAgfVxuICAgIGZvciAoOyBuQ29tbW9uICE9PSAwOyBuQ29tbW9uIC09IDEsIGFJbmRleCArPSAxLCBiSW5kZXggKz0gMSkge1xuICAgICAgZGlmZnMucHVzaChcbiAgICAgICAgbmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZihfY2xlYW51cFNlbWFudGljLkRJRkZfRVFVQUwsIGJMaW5lc1tiSW5kZXhdKVxuICAgICAgKTtcbiAgICB9XG4gIH07XG4gICgwLCBfZGlmZlNlcXVlbmNlcy5kZWZhdWx0KShhTGVuZ3RoLCBiTGVuZ3RoLCBpc0NvbW1vbiwgZm91bmRTdWJzZXF1ZW5jZSk7XG5cbiAgLy8gQWZ0ZXIgdGhlIGxhc3QgY29tbW9uIHN1YnNlcXVlbmNlLCBwdXNoIHJlbWFpbmluZyBjaGFuZ2UgaXRlbXMuXG4gIGZvciAoOyBhSW5kZXggIT09IGFMZW5ndGg7IGFJbmRleCArPSAxKSB7XG4gICAgZGlmZnMucHVzaChcbiAgICAgIG5ldyBfY2xlYW51cFNlbWFudGljLkRpZmYoX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURSwgYUxpbmVzW2FJbmRleF0pXG4gICAgKTtcbiAgfVxuICBmb3IgKDsgYkluZGV4ICE9PSBiTGVuZ3RoOyBiSW5kZXggKz0gMSkge1xuICAgIGRpZmZzLnB1c2goXG4gICAgICBuZXcgX2NsZWFudXBTZW1hbnRpYy5EaWZmKF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQsIGJMaW5lc1tiSW5kZXhdKVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGRpZmZzO1xufTtcbmV4cG9ydHMuZGlmZkxpbmVzUmF3ID0gZGlmZkxpbmVzUmF3O1xuIl0sInZlcnNpb24iOjN9