e69f072b24d4836e296bdf9809a88c9a
'use strict';
Object.defineProperty(exports, '__esModule', {
    value: true
});
exports.joinAlignedDiffsNoExpand = exports.joinAlignedDiffsExpand = void 0;
var _cleanupSemantic = require('./cleanupSemantic');
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
const formatTrailingSpaces = (line, trailingSpaceFormatter) => line.replace(/\s+$/, match => trailingSpaceFormatter(match));
const printDiffLine = (line, isFirstOrLast, color, indicator, trailingSpaceFormatter, emptyFirstOrLastLinePlaceholder) => line.length !== 0
    ? color(`${indicator} ${formatTrailingSpaces(line, trailingSpaceFormatter)}`)
    : indicator !== ' '
        ? color(indicator)
        : isFirstOrLast && emptyFirstOrLastLinePlaceholder.length !== 0
            ? color(`${indicator} ${emptyFirstOrLastLinePlaceholder}`)
            : '';
const printDeleteLine = (line, isFirstOrLast, { aColor, aIndicator, changeLineTrailingSpaceColor, emptyFirstOrLastLinePlaceholder }) => printDiffLine(line, isFirstOrLast, aColor, aIndicator, changeLineTrailingSpaceColor, emptyFirstOrLastLinePlaceholder);
const printInsertLine = (line, isFirstOrLast, { bColor, bIndicator, changeLineTrailingSpaceColor, emptyFirstOrLastLinePlaceholder }) => printDiffLine(line, isFirstOrLast, bColor, bIndicator, changeLineTrailingSpaceColor, emptyFirstOrLastLinePlaceholder);
const printCommonLine = (line, isFirstOrLast, { commonColor, commonIndicator, commonLineTrailingSpaceColor, emptyFirstOrLastLinePlaceholder }) => printDiffLine(line, isFirstOrLast, commonColor, commonIndicator, commonLineTrailingSpaceColor, emptyFirstOrLastLinePlaceholder);
// In GNU diff format, indexes are one-based instead of zero-based.
const createPatchMark = (aStart, aEnd, bStart, bEnd, { patchColor }) => patchColor(`@@ -${aStart + 1},${aEnd - aStart} +${bStart + 1},${bEnd - bStart} @@`);
// jest --no-expand
//
// Given array of aligned strings with inverse highlight formatting,
// return joined lines with diff formatting (and patch marks, if needed).
const joinAlignedDiffsNoExpand = (diffs, options) => {
    const iLength = diffs.length;
    const nContextLines = options.contextLines;
    const nContextLines2 = nContextLines + nContextLines;
    // First pass: count output lines and see if it has patches.
    let jLength = iLength;
    let hasExcessAtStartOrEnd = false;
    let nExcessesBetweenChanges = 0;
    let i = 0;
    while (i !== iLength) {
        const iStart = i;
        while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_EQUAL) {
            i += 1;
        }
        if (iStart !== i) {
            if (iStart === 0) {
                // at start
                if (i > nContextLines) {
                    jLength -= i - nContextLines; // subtract excess common lines
                    hasExcessAtStartOrEnd = true;
                }
            }
            else if (i === iLength) {
                // at end
                const n = i - iStart;
                if (n > nContextLines) {
                    jLength -= n - nContextLines; // subtract excess common lines
                    hasExcessAtStartOrEnd = true;
                }
            }
            else {
                // between changes
                const n = i - iStart;
                if (n > nContextLines2) {
                    jLength -= n - nContextLines2; // subtract excess common lines
                    nExcessesBetweenChanges += 1;
                }
            }
        }
        while (i !== iLength && diffs[i][0] !== _cleanupSemantic.DIFF_EQUAL) {
            i += 1;
        }
    }
    const hasPatch = nExcessesBetweenChanges !== 0 || hasExcessAtStartOrEnd;
    if (nExcessesBetweenChanges !== 0) {
        jLength += nExcessesBetweenChanges + 1; // add patch lines
    }
    else if (hasExcessAtStartOrEnd) {
        jLength += 1; // add patch line
    }
    const jLast = jLength - 1;
    const lines = [];
    let jPatchMark = 0; // index of placeholder line for current patch mark
    if (hasPatch) {
        lines.push(''); // placeholder line for first patch mark
    }
    // Indexes of expected or received lines in current patch:
    let aStart = 0;
    let bStart = 0;
    let aEnd = 0;
    let bEnd = 0;
    const pushCommonLine = line => {
        const j = lines.length;
        lines.push(printCommonLine(line, j === 0 || j === jLast, options));
        aEnd += 1;
        bEnd += 1;
    };
    const pushDeleteLine = line => {
        const j = lines.length;
        lines.push(printDeleteLine(line, j === 0 || j === jLast, options));
        aEnd += 1;
    };
    const pushInsertLine = line => {
        const j = lines.length;
        lines.push(printInsertLine(line, j === 0 || j === jLast, options));
        bEnd += 1;
    };
    // Second pass: push lines with diff formatting (and patch marks, if needed).
    i = 0;
    while (i !== iLength) {
        let iStart = i;
        while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_EQUAL) {
            i += 1;
        }
        if (iStart !== i) {
            if (iStart === 0) {
                // at beginning
                if (i > nContextLines) {
                    iStart = i - nContextLines;
                    aStart = iStart;
                    bStart = iStart;
                    aEnd = aStart;
                    bEnd = bStart;
                }
                for (let iCommon = iStart; iCommon !== i; iCommon += 1) {
                    pushCommonLine(diffs[iCommon][1]);
                }
            }
            else if (i === iLength) {
                // at end
                const iEnd = i - iStart > nContextLines ? iStart + nContextLines : i;
                for (let iCommon = iStart; iCommon !== iEnd; iCommon += 1) {
                    pushCommonLine(diffs[iCommon][1]);
                }
            }
            else {
                // between changes
                const nCommon = i - iStart;
                if (nCommon > nContextLines2) {
                    const iEnd = iStart + nContextLines;
                    for (let iCommon = iStart; iCommon !== iEnd; iCommon += 1) {
                        pushCommonLine(diffs[iCommon][1]);
                    }
                    lines[jPatchMark] = createPatchMark(aStart, aEnd, bStart, bEnd, options);
                    jPatchMark = lines.length;
                    lines.push(''); // placeholder line for next patch mark
                    const nOmit = nCommon - nContextLines2;
                    aStart = aEnd + nOmit;
                    bStart = bEnd + nOmit;
                    aEnd = aStart;
                    bEnd = bStart;
                    for (let iCommon = i - nContextLines; iCommon !== i; iCommon += 1) {
                        pushCommonLine(diffs[iCommon][1]);
                    }
                }
                else {
                    for (let iCommon = iStart; iCommon !== i; iCommon += 1) {
                        pushCommonLine(diffs[iCommon][1]);
                    }
                }
            }
        }
        while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_DELETE) {
            pushDeleteLine(diffs[i][1]);
            i += 1;
        }
        while (i !== iLength && diffs[i][0] === _cleanupSemantic.DIFF_INSERT) {
            pushInsertLine(diffs[i][1]);
            i += 1;
        }
    }
    if (hasPatch) {
        lines[jPatchMark] = createPatchMark(aStart, aEnd, bStart, bEnd, options);
    }
    return lines.join('\n');
};
// jest --expand
//
// Given array of aligned strings with inverse highlight formatting,
// return joined lines with diff formatting.
exports.joinAlignedDiffsNoExpand = joinAlignedDiffsNoExpand;
const joinAlignedDiffsExpand = (diffs, options) => diffs
    .map((diff, i, diffs) => {
    const line = diff[1];
    const isFirstOrLast = i === 0 || i === diffs.length - 1;
    switch (diff[0]) {
        case _cleanupSemantic.DIFF_DELETE:
            return printDeleteLine(line, isFirstOrLast, options);
        case _cleanupSemantic.DIFF_INSERT:
            return printInsertLine(line, isFirstOrLast, options);
        default:
            return printCommonLine(line, isFirstOrLast, options);
    }
})
    .join('\n');
exports.joinAlignedDiffsExpand = joinAlignedDiffsExpand;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXG5vZGVfbW9kdWxlc1xcamVzdC1heGVcXG5vZGVfbW9kdWxlc1xcamVzdC1kaWZmXFxidWlsZFxcam9pbkFsaWduZWREaWZmcy5qcyIsIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUFFYixNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUU7SUFDM0MsS0FBSyxFQUFFLElBQUk7Q0FDWixDQUFDLENBQUM7QUFDSCxPQUFPLENBQUMsd0JBQXdCLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixHQUFHLEtBQUssQ0FBQyxDQUFDO0FBQzNFLElBQUksZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDcEQ7Ozs7O0dBS0c7QUFFSCxNQUFNLG9CQUFvQixHQUFHLENBQUMsSUFBSSxFQUFFLHNCQUFzQixFQUFFLEVBQUUsQ0FDNUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQy9ELE1BQU0sYUFBYSxHQUFHLENBQ3BCLElBQUksRUFDSixhQUFhLEVBQ2IsS0FBSyxFQUNMLFNBQVMsRUFDVCxzQkFBc0IsRUFDdEIsK0JBQStCLEVBQy9CLEVBQUUsQ0FDRixJQUFJLENBQUMsTUFBTSxLQUFLLENBQUM7SUFDZixDQUFDLENBQUMsS0FBSyxDQUNILEdBQUcsU0FBUyxJQUFJLG9CQUFvQixDQUFDLElBQUksRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLENBQ3JFO0lBQ0gsQ0FBQyxDQUFDLFNBQVMsS0FBSyxHQUFHO1FBQ25CLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxhQUFhLElBQUksK0JBQStCLENBQUMsTUFBTSxLQUFLLENBQUM7WUFDL0QsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLFNBQVMsSUFBSSwrQkFBK0IsRUFBRSxD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QUFDLENBQUMsQ0FBQztJQUNyQixNQUFNLGFBQWEsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUN4RCxRQUFRLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hCLEtBQUssZ0JBQWdCLENBQUMsV0FBVztZQUMvQixPQUFPLGVBQWUsQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZELEtBQUssZ0JBQWdCLENBQUMsV0FBVztZQUMvQixPQUFPLGVBQWUsQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZEO1lBQ0UsT0FBTyxlQUFlLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN6RCxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0tBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2hCLE9BQU8sQ0FBQyxzQkFBc0IsR0FBRyxzQkFBc0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXENhcmRFdmVyeXRoaW5nXFxjYXJkYWxsLXByb3RvdHlwZVxcbm9kZV9tb2R1bGVzXFxqZXN0LWF4ZVxcbm9kZV9tb2R1bGVzXFxqZXN0LWRpZmZcXGJ1aWxkXFxqb2luQWxpZ25lZERpZmZzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmpvaW5BbGlnbmVkRGlmZnNOb0V4cGFuZCA9IGV4cG9ydHMuam9pbkFsaWduZWREaWZmc0V4cGFuZCA9IHZvaWQgMDtcbnZhciBfY2xlYW51cFNlbWFudGljID0gcmVxdWlyZSgnLi9jbGVhbnVwU2VtYW50aWMnKTtcbi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG5jb25zdCBmb3JtYXRUcmFpbGluZ1NwYWNlcyA9IChsaW5lLCB0cmFpbGluZ1NwYWNlRm9ybWF0dGVyKSA9PlxuICBsaW5lLnJlcGxhY2UoL1xccyskLywgbWF0Y2ggPT4gdHJhaWxpbmdTcGFjZUZvcm1hdHRlcihtYXRjaCkpO1xuY29uc3QgcHJpbnREaWZmTGluZSA9IChcbiAgbGluZSxcbiAgaXNGaXJzdE9yTGFzdCxcbiAgY29sb3IsXG4gIGluZGljYXRvcixcbiAgdHJhaWxpbmdTcGFjZUZvcm1hdHRlcixcbiAgZW1wdHlGaXJzdE9yTGFzdExpbmVQbGFjZWhvbGRlclxuKSA9PlxuICBsaW5lLmxlbmd0aCAhPT0gMFxuICAgID8gY29sb3IoXG4gICAgICAgIGAke2luZGljYXRvcn0gJHtmb3JtYXRUcmFpbGluZ1NwYWNlcyhsaW5lLCB0cmFpbGluZ1NwYWNlRm9ybWF0dGVyKX1gXG4gICAgICApXG4gICAgOiBpbmRpY2F0b3IgIT09ICcgJ1xuICAgID8gY29sb3IoaW5kaWNhdG9yKVxuICAgIDogaXNGaXJzdE9yTGFzdCAmJiBlbXB0eUZpcnN0T3JMYXN0TGluZVBsYWNlaG9sZGVyLmxlbmd0aCAhPT0gMFxuICAgID8gY29sb3IoYCR7aW5kaWNhdG9yfSAke2VtcHR5Rmlyc3RPckxhc3RMaW5lUGxhY2Vob2xkZXJ9YClcbiAgICA6ICcnO1xuY29uc3QgcHJpbnREZWxldGVMaW5lID0gKFxuICBsaW5lLFxuICBpc0ZpcnN0T3JMYXN0LFxuICB7XG4gICAgYUNvbG9yLFxuICAgIGFJbmRpY2F0b3IsXG4gICAgY2hhbmdlTGluZVRyYWlsaW5nU3BhY2VDb2xvcixcbiAgICBlbXB0eUZpcnN0T3JMYXN0TGluZVBsYWNlaG9sZGVyXG4gIH1cbikgPT5cbiAgcHJpbnREaWZmTGluZShcbiAgICBsaW5lLFxuICAgIGlzRmlyc3RPckxhc3QsXG4gICAgYUNvbG9yLFxuICAgIGFJbmRpY2F0b3IsXG4gICAgY2hhbmdlTGluZVRyYWlsaW5nU3BhY2VDb2xvcixcbiAgICBlbXB0eUZpcnN0T3JMYXN0TGluZVBsYWNlaG9sZGVyXG4gICk7XG5jb25zdCBwcmludEluc2VydExpbmUgPSAoXG4gIGxpbmUsXG4gIGlzRmlyc3RPckxhc3QsXG4gIHtcbiAgICBiQ29sb3IsXG4gICAgYkluZGljYXRvcixcbiAgICBjaGFuZ2VMaW5lVHJhaWxpbmdTcGFjZUNvbG9yLFxuICAgIGVtcHR5Rmlyc3RPckxhc3RMaW5lUGxhY2Vob2xkZXJcbiAgfVxuKSA9PlxuICBwcmludERpZmZMaW5lKFxuICAgIGxpbmUsXG4gICAgaXNGaXJzdE9yTGFzdCxcbiAgICBiQ29sb3IsXG4gICAgYkluZGljYXRvcixcbiAgICBjaGFuZ2VMaW5lVHJhaWxpbmdTcGFjZUNvbG9yLFxuICAgIGVtcHR5Rmlyc3RPckxhc3RMaW5lUGxhY2Vob2xkZXJcbiAgKTtcbmNvbnN0IHByaW50Q29tbW9uTGluZSA9IChcbiAgbGluZSxcbiAgaXNGaXJzdE9yTGFzdCxcbiAge1xuICAgIGNvbW1vbkNvbG9yLFxuICAgIGNvbW1vbkluZGljYXRvcixcbiAgICBjb21tb25MaW5lVHJhaWxpbmdTcGFjZUNvbG9yLFxuICAgIGVtcHR5Rmlyc3RPckxhc3RMaW5lUGxhY2Vob2xkZXJcbiAgfVxuKSA9PlxuICBwcmludERpZmZMaW5lKFxuICAgIGxpbmUsXG4gICAgaXNGaXJzdE9yTGFzdCxcbiAgICBjb21tb25Db2xvcixcbiAgICBjb21tb25JbmRpY2F0b3IsXG4gICAgY29tbW9uTGluZVRyYWlsaW5nU3BhY2VDb2xvcixcbiAgICBlbXB0eUZpcnN0T3JMYXN0TGluZVBsYWNlaG9sZGVyXG4gICk7XG5cbi8vIEluIEdOVSBkaWZmIGZvcm1hdCwgaW5kZXhlcyBhcmUgb25lLWJhc2VkIGluc3RlYWQgb2YgemVyby1iYXNlZC5cbmNvbnN0IGNyZWF0ZVBhdGNoTWFyayA9IChhU3RhcnQsIGFFbmQsIGJTdGFydCwgYkVuZCwge3BhdGNoQ29sb3J9KSA9PlxuICBwYXRjaENvbG9yKFxuICAgIGBAQCAtJHthU3RhcnQgKyAxfSwke2FFbmQgLSBhU3RhcnR9ICske2JTdGFydCArIDF9LCR7YkVuZCAtIGJTdGFydH0gQEBgXG4gICk7XG5cbi8vIGplc3QgLS1uby1leHBhbmRcbi8vXG4vLyBHaXZlbiBhcnJheSBvZiBhbGlnbmVkIHN0cmluZ3Mgd2l0aCBpbnZlcnNlIGhpZ2hsaWdodCBmb3JtYXR0aW5nLFxuLy8gcmV0dXJuIGpvaW5lZCBsaW5lcyB3aXRoIGRpZmYgZm9ybWF0dGluZyAoYW5kIHBhdGNoIG1hcmtzLCBpZiBuZWVkZWQpLlxuY29uc3Qgam9pbkFsaWduZWREaWZmc05vRXhwYW5kID0gKGRpZmZzLCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IGlMZW5ndGggPSBkaWZmcy5sZW5ndGg7XG4gIGNvbnN0IG5Db250ZXh0TGluZXMgPSBvcHRpb25zLmNvbnRleHRMaW5lcztcbiAgY29uc3QgbkNvbnRleHRMaW5lczIgPSBuQ29udGV4dExpbmVzICsgbkNvbnRleHRMaW5lcztcblxuICAvLyBGaXJzdCBwYXNzOiBjb3VudCBvdXRwdXQgbGluZXMgYW5kIHNlZSBpZiBpdCBoYXMgcGF0Y2hlcy5cbiAgbGV0IGpMZW5ndGggPSBpTGVuZ3RoO1xuICBsZXQgaGFzRXhjZXNzQXRTdGFydE9yRW5kID0gZmFsc2U7XG4gIGxldCBuRXhjZXNzZXNCZXR3ZWVuQ2hhbmdlcyA9IDA7XG4gIGxldCBpID0gMDtcbiAgd2hpbGUgKGkgIT09IGlMZW5ndGgpIHtcbiAgICBjb25zdCBpU3RhcnQgPSBpO1xuICAgIHdoaWxlIChpICE9PSBpTGVuZ3RoICYmIGRpZmZzW2ldWzBdID09PSBfY2xlYW51cFNlbWFudGljLkRJRkZfRVFVQUwpIHtcbiAgICAgIGkgKz0gMTtcbiAgICB9XG4gICAgaWYgKGlTdGFydCAhPT0gaSkge1xuICAgICAgaWYgKGlTdGFydCA9PT0gMCkge1xuICAgICAgICAvLyBhdCBzdGFydFxuICAgICAgICBpZiAoaSA+IG5Db250ZXh0TGluZXMpIHtcbiAgICAgICAgICBqTGVuZ3RoIC09IGkgLSBuQ29udGV4dExpbmVzOyAvLyBzdWJ0cmFjdCBleGNlc3MgY29tbW9uIGxpbmVzXG4gICAgICAgICAgaGFzRXhjZXNzQXRTdGFydE9yRW5kID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChpID09PSBpTGVuZ3RoKSB7XG4gICAgICAgIC8vIGF0IGVuZFxuICAgICAgICBjb25zdCBuID0gaSAtIGlTdGFydDtcbiAgICAgICAgaWYgKG4gPiBuQ29udGV4dExpbmVzKSB7XG4gICAgICAgICAgakxlbmd0aCAtPSBuIC0gbkNvbnRleHRMaW5lczsgLy8gc3VidHJhY3QgZXhjZXNzIGNvbW1vbiBsaW5lc1xuICAgICAgICAgIGhhc0V4Y2Vzc0F0U3RhcnRPckVuZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGJldHdlZW4gY2hhbmdlc1xuICAgICAgICBjb25zdCBuID0gaSAtIGlTdGFydDtcbiAgICAgICAgaWYgKG4gPiBuQ29udGV4dExpbmVzMikge1xuICAgICAgICAgIGpMZW5ndGggLT0gbiAtIG5Db250ZXh0TGluZXMyOyAvLyBzdWJ0cmFjdCBleGNlc3MgY29tbW9uIGxpbmVzXG4gICAgICAgICAgbkV4Y2Vzc2VzQmV0d2VlbkNoYW5nZXMgKz0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB3aGlsZSAoaSAhPT0gaUxlbmd0aCAmJiBkaWZmc1tpXVswXSAhPT0gX2NsZWFudXBTZW1hbnRpYy5ESUZGX0VRVUFMKSB7XG4gICAgICBpICs9IDE7XG4gICAgfVxuICB9XG4gIGNvbnN0IGhhc1BhdGNoID0gbkV4Y2Vzc2VzQmV0d2VlbkNoYW5nZXMgIT09IDAgfHwgaGFzRXhjZXNzQXRTdGFydE9yRW5kO1xuICBpZiAobkV4Y2Vzc2VzQmV0d2VlbkNoYW5nZXMgIT09IDApIHtcbiAgICBqTGVuZ3RoICs9IG5FeGNlc3Nlc0JldHdlZW5DaGFuZ2VzICsgMTsgLy8gYWRkIHBhdGNoIGxpbmVzXG4gIH0gZWxzZSBpZiAoaGFzRXhjZXNzQXRTdGFydE9yRW5kKSB7XG4gICAgakxlbmd0aCArPSAxOyAvLyBhZGQgcGF0Y2ggbGluZVxuICB9XG5cbiAgY29uc3Qgakxhc3QgPSBqTGVuZ3RoIC0gMTtcbiAgY29uc3QgbGluZXMgPSBbXTtcbiAgbGV0IGpQYXRjaE1hcmsgPSAwOyAvLyBpbmRleCBvZiBwbGFjZWhvbGRlciBsaW5lIGZvciBjdXJyZW50IHBhdGNoIG1hcmtcbiAgaWYgKGhhc1BhdGNoKSB7XG4gICAgbGluZXMucHVzaCgnJyk7IC8vIHBsYWNlaG9sZGVyIGxpbmUgZm9yIGZpcnN0IHBhdGNoIG1hcmtcbiAgfVxuXG4gIC8vIEluZGV4ZXMgb2YgZXhwZWN0ZWQgb3IgcmVjZWl2ZWQgbGluZXMgaW4gY3VycmVudCBwYXRjaDpcbiAgbGV0IGFTdGFydCA9IDA7XG4gIGxldCBiU3RhcnQgPSAwO1xuICBsZXQgYUVuZCA9IDA7XG4gIGxldCBiRW5kID0gMDtcbiAgY29uc3QgcHVzaENvbW1vbkxpbmUgPSBsaW5lID0+IHtcbiAgICBjb25zdCBqID0gbGluZXMubGVuZ3RoO1xuICAgIGxpbmVzLnB1c2gocHJpbnRDb21tb25MaW5lKGxpbmUsIGogPT09IDAgfHwgaiA9PT0gakxhc3QsIG9wdGlvbnMpKTtcbiAgICBhRW5kICs9IDE7XG4gICAgYkVuZCArPSAxO1xuICB9O1xuICBjb25zdCBwdXNoRGVsZXRlTGluZSA9IGxpbmUgPT4ge1xuICAgIGNvbnN0IGogPSBsaW5lcy5sZW5ndGg7XG4gICAgbGluZXMucHVzaChwcmludERlbGV0ZUxpbmUobGluZSwgaiA9PT0gMCB8fCBqID09PSBqTGFzdCwgb3B0aW9ucykpO1xuICAgIGFFbmQgKz0gMTtcbiAgfTtcbiAgY29uc3QgcHVzaEluc2VydExpbmUgPSBsaW5lID0+IHtcbiAgICBjb25zdCBqID0gbGluZXMubGVuZ3RoO1xuICAgIGxpbmVzLnB1c2gocHJpbnRJbnNlcnRMaW5lKGxpbmUsIGogPT09IDAgfHwgaiA9PT0gakxhc3QsIG9wdGlvbnMpKTtcbiAgICBiRW5kICs9IDE7XG4gIH07XG5cbiAgLy8gU2Vjb25kIHBhc3M6IHB1c2ggbGluZXMgd2l0aCBkaWZmIGZvcm1hdHRpbmcgKGFuZCBwYXRjaCBtYXJrcywgaWYgbmVlZGVkKS5cbiAgaSA9IDA7XG4gIHdoaWxlIChpICE9PSBpTGVuZ3RoKSB7XG4gICAgbGV0IGlTdGFydCA9IGk7XG4gICAgd2hpbGUgKGkgIT09IGlMZW5ndGggJiYgZGlmZnNbaV1bMF0gPT09IF9jbGVhbnVwU2VtYW50aWMuRElGRl9FUVVBTCkge1xuICAgICAgaSArPSAxO1xuICAgIH1cbiAgICBpZiAoaVN0YXJ0ICE9PSBpKSB7XG4gICAgICBpZiAoaVN0YXJ0ID09PSAwKSB7XG4gICAgICAgIC8vIGF0IGJlZ2lubmluZ1xuICAgICAgICBpZiAoaSA+IG5Db250ZXh0TGluZXMpIHtcbiAgICAgICAgICBpU3RhcnQgPSBpIC0gbkNvbnRleHRMaW5lcztcbiAgICAgICAgICBhU3RhcnQgPSBpU3RhcnQ7XG4gICAgICAgICAgYlN0YXJ0ID0gaVN0YXJ0O1xuICAgICAgICAgIGFFbmQgPSBhU3RhcnQ7XG4gICAgICAgICAgYkVuZCA9IGJTdGFydDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpQ29tbW9uID0gaVN0YXJ0OyBpQ29tbW9uICE9PSBpOyBpQ29tbW9uICs9IDEpIHtcbiAgICAgICAgICBwdXNoQ29tbW9uTGluZShkaWZmc1tpQ29tbW9uXVsxXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoaSA9PT0gaUxlbmd0aCkge1xuICAgICAgICAvLyBhdCBlbmRcbiAgICAgICAgY29uc3QgaUVuZCA9IGkgLSBpU3RhcnQgPiBuQ29udGV4dExpbmVzID8gaVN0YXJ0ICsgbkNvbnRleHRMaW5lcyA6IGk7XG4gICAgICAgIGZvciAobGV0IGlDb21tb24gPSBpU3RhcnQ7IGlDb21tb24gIT09IGlFbmQ7IGlDb21tb24gKz0gMSkge1xuICAgICAgICAgIHB1c2hDb21tb25MaW5lKGRpZmZzW2lDb21tb25dWzFdKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gYmV0d2VlbiBjaGFuZ2VzXG4gICAgICAgIGNvbnN0IG5Db21tb24gPSBpIC0gaVN0YXJ0O1xuICAgICAgICBpZiAobkNvbW1vbiA+IG5Db250ZXh0TGluZXMyKSB7XG4gICAgICAgICAgY29uc3QgaUVuZCA9IGlTdGFydCArIG5Db250ZXh0TGluZXM7XG4gICAgICAgICAgZm9yIChsZXQgaUNvbW1vbiA9IGlTdGFydDsgaUNvbW1vbiAhPT0gaUVuZDsgaUNvbW1vbiArPSAxKSB7XG4gICAgICAgICAgICBwdXNoQ29tbW9uTGluZShkaWZmc1tpQ29tbW9uXVsxXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxpbmVzW2pQYXRjaE1hcmtdID0gY3JlYXRlUGF0Y2hNYXJrKFxuICAgICAgICAgICAgYVN0YXJ0LFxuICAgICAgICAgICAgYUVuZCxcbiAgICAgICAgICAgIGJTdGFydCxcbiAgICAgICAgICAgIGJFbmQsXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgKTtcbiAgICAgICAgICBqUGF0Y2hNYXJrID0gbGluZXMubGVuZ3RoO1xuICAgICAgICAgIGxpbmVzLnB1c2goJycpOyAvLyBwbGFjZWhvbGRlciBsaW5lIGZvciBuZXh0IHBhdGNoIG1hcmtcblxuICAgICAgICAgIGNvbnN0IG5PbWl0ID0gbkNvbW1vbiAtIG5Db250ZXh0TGluZXMyO1xuICAgICAgICAgIGFTdGFydCA9IGFFbmQgKyBuT21pdDtcbiAgICAgICAgICBiU3RhcnQgPSBiRW5kICsgbk9taXQ7XG4gICAgICAgICAgYUVuZCA9IGFTdGFydDtcbiAgICAgICAgICBiRW5kID0gYlN0YXJ0O1xuICAgICAgICAgIGZvciAobGV0IGlDb21tb24gPSBpIC0gbkNvbnRleHRMaW5lczsgaUNvbW1vbiAhPT0gaTsgaUNvbW1vbiArPSAxKSB7XG4gICAgICAgICAgICBwdXNoQ29tbW9uTGluZShkaWZmc1tpQ29tbW9uXVsxXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAobGV0IGlDb21tb24gPSBpU3RhcnQ7IGlDb21tb24gIT09IGk7IGlDb21tb24gKz0gMSkge1xuICAgICAgICAgICAgcHVzaENvbW1vbkxpbmUoZGlmZnNbaUNvbW1vbl1bMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB3aGlsZSAoaSAhPT0gaUxlbmd0aCAmJiBkaWZmc1tpXVswXSA9PT0gX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURSkge1xuICAgICAgcHVzaERlbGV0ZUxpbmUoZGlmZnNbaV1bMV0pO1xuICAgICAgaSArPSAxO1xuICAgIH1cbiAgICB3aGlsZSAoaSAhPT0gaUxlbmd0aCAmJiBkaWZmc1tpXVswXSA9PT0gX2NsZWFudXBTZW1hbnRpYy5ESUZGX0lOU0VSVCkge1xuICAgICAgcHVzaEluc2VydExpbmUoZGlmZnNbaV1bMV0pO1xuICAgICAgaSArPSAxO1xuICAgIH1cbiAgfVxuICBpZiAoaGFzUGF0Y2gpIHtcbiAgICBsaW5lc1tqUGF0Y2hNYXJrXSA9IGNyZWF0ZVBhdGNoTWFyayhhU3RhcnQsIGFFbmQsIGJTdGFydCwgYkVuZCwgb3B0aW9ucyk7XG4gIH1cbiAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xufTtcblxuLy8gamVzdCAtLWV4cGFuZFxuLy9cbi8vIEdpdmVuIGFycmF5IG9mIGFsaWduZWQgc3RyaW5ncyB3aXRoIGludmVyc2UgaGlnaGxpZ2h0IGZvcm1hdHRpbmcsXG4vLyByZXR1cm4gam9pbmVkIGxpbmVzIHdpdGggZGlmZiBmb3JtYXR0aW5nLlxuZXhwb3J0cy5qb2luQWxpZ25lZERpZmZzTm9FeHBhbmQgPSBqb2luQWxpZ25lZERpZmZzTm9FeHBhbmQ7XG5jb25zdCBqb2luQWxpZ25lZERpZmZzRXhwYW5kID0gKGRpZmZzLCBvcHRpb25zKSA9PlxuICBkaWZmc1xuICAgIC5tYXAoKGRpZmYsIGksIGRpZmZzKSA9PiB7XG4gICAgICBjb25zdCBsaW5lID0gZGlmZlsxXTtcbiAgICAgIGNvbnN0IGlzRmlyc3RPckxhc3QgPSBpID09PSAwIHx8IGkgPT09IGRpZmZzLmxlbmd0aCAtIDE7XG4gICAgICBzd2l0Y2ggKGRpZmZbMF0pIHtcbiAgICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFOlxuICAgICAgICAgIHJldHVybiBwcmludERlbGV0ZUxpbmUobGluZSwgaXNGaXJzdE9yTGFzdCwgb3B0aW9ucyk7XG4gICAgICAgIGNhc2UgX2NsZWFudXBTZW1hbnRpYy5ESUZGX0lOU0VSVDpcbiAgICAgICAgICByZXR1cm4gcHJpbnRJbnNlcnRMaW5lKGxpbmUsIGlzRmlyc3RPckxhc3QsIG9wdGlvbnMpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBwcmludENvbW1vbkxpbmUobGluZSwgaXNGaXJzdE9yTGFzdCwgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgfSlcbiAgICAuam9pbignXFxuJyk7XG5leHBvcnRzLmpvaW5BbGlnbmVkRGlmZnNFeHBhbmQgPSBqb2luQWxpZ25lZERpZmZzRXhwYW5kO1xuIl0sInZlcnNpb24iOjN9