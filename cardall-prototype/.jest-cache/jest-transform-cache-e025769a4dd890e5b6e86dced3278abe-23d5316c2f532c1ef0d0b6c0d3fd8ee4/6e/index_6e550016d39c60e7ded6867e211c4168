22c5200fb6b883a518e12547c8b5c203
'use strict';
Object.defineProperty(exports, '__esModule', { value: true });
var picocolors = require('picocolors');
var jsTokens = require('js-tokens');
var helperValidatorIdentifier = require('@babel/helper-validator-identifier');
function isColorSupported() {
    return (typeof process === "object" && (process.env.FORCE_COLOR === "0" || process.env.FORCE_COLOR === "false") ? false : picocolors.isColorSupported);
}
const compose = (f, g) => v => f(g(v));
function buildDefs(colors) {
    return {
        keyword: colors.cyan,
        capitalized: colors.yellow,
        jsxIdentifier: colors.yellow,
        punctuator: colors.yellow,
        number: colors.magenta,
        string: colors.green,
        regex: colors.magenta,
        comment: colors.gray,
        invalid: compose(compose(colors.white, colors.bgRed), colors.bold),
        gutter: colors.gray,
        marker: compose(colors.red, colors.bold),
        message: compose(colors.red, colors.bold),
        reset: colors.reset
    };
}
const defsOn = buildDefs(picocolors.createColors(true));
const defsOff = buildDefs(picocolors.createColors(false));
function getDefs(enabled) {
    return enabled ? defsOn : defsOff;
}
const sometimesKeywords = new Set(["as", "async", "from", "get", "of", "set"]);
const NEWLINE$1 = /\r\n|[\n\r\u2028\u2029]/;
const BRACKET = /^[()[\]{}]$/;
let tokenize;
{
    const JSX_TAG = /^[a-z][\w-]*$/i;
    const getTokenType = function (token, offset, text) {
        if (token.type === "name") {
            if (helperValidatorIdentifier.isKeyword(token.value) || helperValidatorIdentifier.isStrictReservedWord(token.value, true) || sometimesKeywords.has(token.value)) {
                return "keyword";
            }
            if (JSX_TAG.test(token.value) && (text[offset - 1] === "<" || text.slice(offset - 2, offset) === "</")) {
                return "jsxIdentifier";
            }
            if (token.value[0] !== token.value[0].toLowerCase()) {
                return "capitalized";
            }
        }
        if (token.type === "punctuator" && BRACKET.test(token.value)) {
            return "bracket";
        }
        if (token.type === "invalid" && (token.value === "@" || token.value === "#")) {
            return "punctuator";
        }
        return token.type;
    };
    tokenize = function* (text) {
        let match;
        while (match = jsTokens.default.exec(text)) {
            const token = jsTokens.matchToToken(match);
            yield {
                type: getTokenType(token, match.index, text),
                value: token.value
            };
        }
    };
}
function highlight(text) {
    if (text === "")
        return "";
    const defs = getDefs(true);
    let highlighted = "";
    for (const { type, value } of tokenize(text)) {
        if (type in defs) {
            highlighted += value.split(NEWLINE$1).map(str => defs[type](str)).join("\n");
        }
        else {
            highlighted += value;
        }
    }
    return highlighted;
}
let deprecationWarningShown = false;
const NEWLINE = /\r\n|[\n\r\u2028\u2029]/;
function getMarkerLines(loc, source, opts) {
    const startLoc = Object.assign({
        column: 0,
        line: -1
    }, loc.start);
    const endLoc = Object.assign({}, startLoc, loc.end);
    const { linesAbove = 2, linesBelow = 3 } = opts || {};
    const startLine = startLoc.line;
    const startColumn = startLoc.column;
    const endLine = endLoc.line;
    const endColumn = endLoc.column;
    let start = Math.max(startLine - (linesAbove + 1), 0);
    let end = Math.min(source.length, endLine + linesBelow);
    if (startLine === -1) {
        start = 0;
    }
    if (endLine === -1) {
        end = source.length;
    }
    const lineDiff = endLine - startLine;
    const markerLines = {};
    if (lineDiff) {
        for (let i = 0; i <= lineDiff; i++) {
            const lineNumber = i + startLine;
            if (!startColumn) {
                markerLines[lineNumber] = true;
            }
            else if (i === 0) {
                const sourceLength = source[lineNumber - 1].length;
                markerLines[lineNumber] = [startColumn, sourceLength - startColumn + 1];
            }
            else if (i === lineDiff) {
                markerLines[lineNumber] = [0, endColumn];
            }
            else {
                const sourceLength = source[lineNumber - i].length;
                markerLines[lineNumber] = [0, sourceLength];
            }
        }
    }
    else {
        if (startColumn === endColumn) {
            if (startColumn) {
                markerLines[startLine] = [startColumn, 0];
            }
            else {
                markerLines[startLine] = true;
            }
        }
        else {
            markerLines[startLine] = [startColumn, endColumn - startColumn];
        }
    }
    return {
        start,
        end,
        markerLines
    };
}
function codeFrameColumns(rawLines, loc, opts = {}) {
    const shouldHighlight = opts.forceColor || isColorSupported() && opts.highlightCode;
    const defs = getDefs(shouldHighlight);
    const lines = rawLines.split(NEWLINE);
    const { start, end, markerLines } = getMarkerLines(loc, lines, opts);
    const hasColumns = loc.start && typeof loc.start.column === "number";
    const numberMaxWidth = String(end).length;
    const highlightedLines = shouldHighlight ? highlight(rawLines) : rawLines;
    let frame = highlightedLines.split(NEWLINE, end).slice(start, end).map((line, index) => {
        const number = start + 1 + index;
        const paddedNumber = ` ${number}`.slice(-numberMaxWidth);
        const gutter = ` ${paddedNumber} |`;
        const hasMarker = markerLines[number];
        const lastMarkerLine = !markerLines[number + 1];
        if (hasMarker) {
            let markerLine = "";
            if (Array.isArray(hasMarker)) {
                const markerSpacing = line.slice(0, Math.max(hasMarker[0] - 1, 0)).replace(/[^\t]/g, " ");
                const numberOfMarkers = hasMarker[1] || 1;
                markerLine = ["\n ", defs.gutter(gutter.replace(/\d/g, " ")), " ", markerSpacing, defs.marker("^").repeat(numberOfMarkers)].join("");
                if (lastMarkerLine && opts.message) {
                    markerLine += " " + defs.message(opts.message);
                }
            }
            return [defs.marker(">"), defs.gutter(gutter), line.length > 0 ? ` ${line}` : "", markerLine].join("");
        }
        else {
            return ` ${defs.gutter(gutter)}${line.length > 0 ? ` ${line}` : ""}`;
        }
    }).join("\n");
    if (opts.message && !hasColumns) {
        frame = `${" ".repeat(numberMaxWidth + 1)}${opts.message}\n${frame}`;
    }
    if (shouldHighlight) {
        return defs.reset(frame);
    }
    else {
        return frame;
    }
}
function index(rawLines, lineNumber, colNumber, opts = {}) {
    if (!deprecationWarningShown) {
        deprecationWarningShown = true;
        const message = "Passing lineNumber and colNumber is deprecated to @babel/code-frame. Please use `codeFrameColumns`.";
        if (process.emitWarning) {
            process.emitWarning(message, "DeprecationWarning");
        }
        else {
            const deprecationError = new Error(message);
            deprecationError.name = "DeprecationWarning";
            console.warn(new Error(message));
        }
    }
    colNumber = Math.max(colNumber, 0);
    const location = {
        start: {
            column: colNumber,
            line: lineNumber
        }
    };
    return codeFrameColumns(rawLines, location, opts);
}
exports.codeFrameColumns = codeFrameColumns;
exports.default = index;
exports.highlight = highlight;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxjb2RlLWZyYW1lXFxsaWJcXGluZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUViLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBRTlELElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN2QyxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDcEMsSUFBSSx5QkFBeUIsR0FBRyxPQUFPLENBQUMsb0NBQW9DLENBQUMsQ0FBQztBQUU5RSxTQUFTLGdCQUFnQjtJQUN2QixPQUFPLENBQUMsT0FBTyxPQUFPLEtBQUssUUFBUSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEtBQUssR0FBRyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FDcEosQ0FBQztBQUNKLENBQUM7QUFDRCxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3ZDLFNBQVMsU0FBUyxDQUFDLE1BQU07SUFDdkIsT0FBTztRQUNMLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSTtRQUNwQixXQUFXLEVBQUUsTUFBTSxDQUFDLE1BQU07UUFDMUIsYUFBYSxFQUFFLE1BQU0sQ0FBQyxNQUFNO1FBQzVCLFVBQVUsRUFBRSxNQUFNLENBQUMsTUFBTTtRQUN6QixNQUFNLEVBQUUsTUFBTSxDQUFDLE9BQU87UUFDdEIsTUFBTSxFQUFFLE1BQU0s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QUFDO1FBQzdCLHVCQUF1QixHQUFHLElBQUksQ0FBQztRQUMvQixNQUFNLE9BQU8sR0FBRyxxR0FBcUcsQ0FBQztRQUN0SCxJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN4QixPQUFPLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1FBQ3JELENBQUM7YUFBTSxDQUFDO1lBQ04sTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM1QyxnQkFBZ0IsQ0FBQyxJQUFJLEdBQUcsb0JBQW9CLENBQUM7WUFDN0MsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ25DLENBQUM7SUFDSCxDQUFDO0lBQ0QsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ25DLE1BQU0sUUFBUSxHQUFHO1FBQ2YsS0FBSyxFQUFFO1lBQ0wsTUFBTSxFQUFFLFNBQVM7WUFDakIsSUFBSSxFQUFFLFVBQVU7U0FDakI7S0FDRixDQUFDO0lBQ0YsT0FBTyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3BELENBQUM7QUFFRCxPQUFPLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7QUFDeEIsT0FBTyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxjb2RlLWZyYW1lXFxsaWJcXGluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcblxudmFyIHBpY29jb2xvcnMgPSByZXF1aXJlKCdwaWNvY29sb3JzJyk7XG52YXIganNUb2tlbnMgPSByZXF1aXJlKCdqcy10b2tlbnMnKTtcbnZhciBoZWxwZXJWYWxpZGF0b3JJZGVudGlmaWVyID0gcmVxdWlyZSgnQGJhYmVsL2hlbHBlci12YWxpZGF0b3ItaWRlbnRpZmllcicpO1xuXG5mdW5jdGlvbiBpc0NvbG9yU3VwcG9ydGVkKCkge1xuICByZXR1cm4gKHR5cGVvZiBwcm9jZXNzID09PSBcIm9iamVjdFwiICYmIChwcm9jZXNzLmVudi5GT1JDRV9DT0xPUiA9PT0gXCIwXCIgfHwgcHJvY2Vzcy5lbnYuRk9SQ0VfQ09MT1IgPT09IFwiZmFsc2VcIikgPyBmYWxzZSA6IHBpY29jb2xvcnMuaXNDb2xvclN1cHBvcnRlZFxuICApO1xufVxuY29uc3QgY29tcG9zZSA9IChmLCBnKSA9PiB2ID0+IGYoZyh2KSk7XG5mdW5jdGlvbiBidWlsZERlZnMoY29sb3JzKSB7XG4gIHJldHVybiB7XG4gICAga2V5d29yZDogY29sb3JzLmN5YW4sXG4gICAgY2FwaXRhbGl6ZWQ6IGNvbG9ycy55ZWxsb3csXG4gICAganN4SWRlbnRpZmllcjogY29sb3JzLnllbGxvdyxcbiAgICBwdW5jdHVhdG9yOiBjb2xvcnMueWVsbG93LFxuICAgIG51bWJlcjogY29sb3JzLm1hZ2VudGEsXG4gICAgc3RyaW5nOiBjb2xvcnMuZ3JlZW4sXG4gICAgcmVnZXg6IGNvbG9ycy5tYWdlbnRhLFxuICAgIGNvbW1lbnQ6IGNvbG9ycy5ncmF5LFxuICAgIGludmFsaWQ6IGNvbXBvc2UoY29tcG9zZShjb2xvcnMud2hpdGUsIGNvbG9ycy5iZ1JlZCksIGNvbG9ycy5ib2xkKSxcbiAgICBndXR0ZXI6IGNvbG9ycy5ncmF5LFxuICAgIG1hcmtlcjogY29tcG9zZShjb2xvcnMucmVkLCBjb2xvcnMuYm9sZCksXG4gICAgbWVzc2FnZTogY29tcG9zZShjb2xvcnMucmVkLCBjb2xvcnMuYm9sZCksXG4gICAgcmVzZXQ6IGNvbG9ycy5yZXNldFxuICB9O1xufVxuY29uc3QgZGVmc09uID0gYnVpbGREZWZzKHBpY29jb2xvcnMuY3JlYXRlQ29sb3JzKHRydWUpKTtcbmNvbnN0IGRlZnNPZmYgPSBidWlsZERlZnMocGljb2NvbG9ycy5jcmVhdGVDb2xvcnMoZmFsc2UpKTtcbmZ1bmN0aW9uIGdldERlZnMoZW5hYmxlZCkge1xuICByZXR1cm4gZW5hYmxlZCA/IGRlZnNPbiA6IGRlZnNPZmY7XG59XG5cbmNvbnN0IHNvbWV0aW1lc0tleXdvcmRzID0gbmV3IFNldChbXCJhc1wiLCBcImFzeW5jXCIsIFwiZnJvbVwiLCBcImdldFwiLCBcIm9mXCIsIFwic2V0XCJdKTtcbmNvbnN0IE5FV0xJTkUkMSA9IC9cXHJcXG58W1xcblxcclxcdTIwMjhcXHUyMDI5XS87XG5jb25zdCBCUkFDS0VUID0gL15bKClbXFxde31dJC87XG5sZXQgdG9rZW5pemU7XG57XG4gIGNvbnN0IEpTWF9UQUcgPSAvXlthLXpdW1xcdy1dKiQvaTtcbiAgY29uc3QgZ2V0VG9rZW5UeXBlID0gZnVuY3Rpb24gKHRva2VuLCBvZmZzZXQsIHRleHQpIHtcbiAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJuYW1lXCIpIHtcbiAgICAgIGlmIChoZWxwZXJWYWxpZGF0b3JJZGVudGlmaWVyLmlzS2V5d29yZCh0b2tlbi52YWx1ZSkgfHwgaGVscGVyVmFsaWRhdG9ySWRlbnRpZmllci5pc1N0cmljdFJlc2VydmVkV29yZCh0b2tlbi52YWx1ZSwgdHJ1ZSkgfHwgc29tZXRpbWVzS2V5d29yZHMuaGFzKHRva2VuLnZhbHVlKSkge1xuICAgICAgICByZXR1cm4gXCJrZXl3b3JkXCI7XG4gICAgICB9XG4gICAgICBpZiAoSlNYX1RBRy50ZXN0KHRva2VuLnZhbHVlKSAmJiAodGV4dFtvZmZzZXQgLSAxXSA9PT0gXCI8XCIgfHwgdGV4dC5zbGljZShvZmZzZXQgLSAyLCBvZmZzZXQpID09PSBcIjwvXCIpKSB7XG4gICAgICAgIHJldHVybiBcImpzeElkZW50aWZpZXJcIjtcbiAgICAgIH1cbiAgICAgIGlmICh0b2tlbi52YWx1ZVswXSAhPT0gdG9rZW4udmFsdWVbMF0udG9Mb3dlckNhc2UoKSkge1xuICAgICAgICByZXR1cm4gXCJjYXBpdGFsaXplZFwiO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJwdW5jdHVhdG9yXCIgJiYgQlJBQ0tFVC50ZXN0KHRva2VuLnZhbHVlKSkge1xuICAgICAgcmV0dXJuIFwiYnJhY2tldFwiO1xuICAgIH1cbiAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJpbnZhbGlkXCIgJiYgKHRva2VuLnZhbHVlID09PSBcIkBcIiB8fCB0b2tlbi52YWx1ZSA9PT0gXCIjXCIpKSB7XG4gICAgICByZXR1cm4gXCJwdW5jdHVhdG9yXCI7XG4gICAgfVxuICAgIHJldHVybiB0b2tlbi50eXBlO1xuICB9O1xuICB0b2tlbml6ZSA9IGZ1bmN0aW9uKiAodGV4dCkge1xuICAgIGxldCBtYXRjaDtcbiAgICB3aGlsZSAobWF0Y2ggPSBqc1Rva2Vucy5kZWZhdWx0LmV4ZWModGV4dCkpIHtcbiAgICAgIGNvbnN0IHRva2VuID0ganNUb2tlbnMubWF0Y2hUb1Rva2VuKG1hdGNoKTtcbiAgICAgIHlpZWxkIHtcbiAgICAgICAgdHlwZTogZ2V0VG9rZW5UeXBlKHRva2VuLCBtYXRjaC5pbmRleCwgdGV4dCksXG4gICAgICAgIHZhbHVlOiB0b2tlbi52YWx1ZVxuICAgICAgfTtcbiAgICB9XG4gIH07XG59XG5mdW5jdGlvbiBoaWdobGlnaHQodGV4dCkge1xuICBpZiAodGV4dCA9PT0gXCJcIikgcmV0dXJuIFwiXCI7XG4gIGNvbnN0IGRlZnMgPSBnZXREZWZzKHRydWUpO1xuICBsZXQgaGlnaGxpZ2h0ZWQgPSBcIlwiO1xuICBmb3IgKGNvbnN0IHtcbiAgICB0eXBlLFxuICAgIHZhbHVlXG4gIH0gb2YgdG9rZW5pemUodGV4dCkpIHtcbiAgICBpZiAodHlwZSBpbiBkZWZzKSB7XG4gICAgICBoaWdobGlnaHRlZCArPSB2YWx1ZS5zcGxpdChORVdMSU5FJDEpLm1hcChzdHIgPT4gZGVmc1t0eXBlXShzdHIpKS5qb2luKFwiXFxuXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBoaWdobGlnaHRlZCArPSB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGhpZ2hsaWdodGVkO1xufVxuXG5sZXQgZGVwcmVjYXRpb25XYXJuaW5nU2hvd24gPSBmYWxzZTtcbmNvbnN0IE5FV0xJTkUgPSAvXFxyXFxufFtcXG5cXHJcXHUyMDI4XFx1MjAyOV0vO1xuZnVuY3Rpb24gZ2V0TWFya2VyTGluZXMobG9jLCBzb3VyY2UsIG9wdHMpIHtcbiAgY29uc3Qgc3RhcnRMb2MgPSBPYmplY3QuYXNzaWduKHtcbiAgICBjb2x1bW46IDAsXG4gICAgbGluZTogLTFcbiAgfSwgbG9jLnN0YXJ0KTtcbiAgY29uc3QgZW5kTG9jID0gT2JqZWN0LmFzc2lnbih7fSwgc3RhcnRMb2MsIGxvYy5lbmQpO1xuICBjb25zdCB7XG4gICAgbGluZXNBYm92ZSA9IDIsXG4gICAgbGluZXNCZWxvdyA9IDNcbiAgfSA9IG9wdHMgfHwge307XG4gIGNvbnN0IHN0YXJ0TGluZSA9IHN0YXJ0TG9jLmxpbmU7XG4gIGNvbnN0IHN0YXJ0Q29sdW1uID0gc3RhcnRMb2MuY29sdW1uO1xuICBjb25zdCBlbmRMaW5lID0gZW5kTG9jLmxpbmU7XG4gIGNvbnN0IGVuZENvbHVtbiA9IGVuZExvYy5jb2x1bW47XG4gIGxldCBzdGFydCA9IE1hdGgubWF4KHN0YXJ0TGluZSAtIChsaW5lc0Fib3ZlICsgMSksIDApO1xuICBsZXQgZW5kID0gTWF0aC5taW4oc291cmNlLmxlbmd0aCwgZW5kTGluZSArIGxpbmVzQmVsb3cpO1xuICBpZiAoc3RhcnRMaW5lID09PSAtMSkge1xuICAgIHN0YXJ0ID0gMDtcbiAgfVxuICBpZiAoZW5kTGluZSA9PT0gLTEpIHtcbiAgICBlbmQgPSBzb3VyY2UubGVuZ3RoO1xuICB9XG4gIGNvbnN0IGxpbmVEaWZmID0gZW5kTGluZSAtIHN0YXJ0TGluZTtcbiAgY29uc3QgbWFya2VyTGluZXMgPSB7fTtcbiAgaWYgKGxpbmVEaWZmKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbGluZURpZmY7IGkrKykge1xuICAgICAgY29uc3QgbGluZU51bWJlciA9IGkgKyBzdGFydExpbmU7XG4gICAgICBpZiAoIXN0YXJ0Q29sdW1uKSB7XG4gICAgICAgIG1hcmtlckxpbmVzW2xpbmVOdW1iZXJdID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoaSA9PT0gMCkge1xuICAgICAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBzb3VyY2VbbGluZU51bWJlciAtIDFdLmxlbmd0aDtcbiAgICAgICAgbWFya2VyTGluZXNbbGluZU51bWJlcl0gPSBbc3RhcnRDb2x1bW4sIHNvdXJjZUxlbmd0aCAtIHN0YXJ0Q29sdW1uICsgMV07XG4gICAgICB9IGVsc2UgaWYgKGkgPT09IGxpbmVEaWZmKSB7XG4gICAgICAgIG1hcmtlckxpbmVzW2xpbmVOdW1iZXJdID0gWzAsIGVuZENvbHVtbl07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBzb3VyY2VbbGluZU51bWJlciAtIGldLmxlbmd0aDtcbiAgICAgICAgbWFya2VyTGluZXNbbGluZU51bWJlcl0gPSBbMCwgc291cmNlTGVuZ3RoXTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKHN0YXJ0Q29sdW1uID09PSBlbmRDb2x1bW4pIHtcbiAgICAgIGlmIChzdGFydENvbHVtbikge1xuICAgICAgICBtYXJrZXJMaW5lc1tzdGFydExpbmVdID0gW3N0YXJ0Q29sdW1uLCAwXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hcmtlckxpbmVzW3N0YXJ0TGluZV0gPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBtYXJrZXJMaW5lc1tzdGFydExpbmVdID0gW3N0YXJ0Q29sdW1uLCBlbmRDb2x1bW4gLSBzdGFydENvbHVtbl07XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgc3RhcnQsXG4gICAgZW5kLFxuICAgIG1hcmtlckxpbmVzXG4gIH07XG59XG5mdW5jdGlvbiBjb2RlRnJhbWVDb2x1bW5zKHJhd0xpbmVzLCBsb2MsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzaG91bGRIaWdobGlnaHQgPSBvcHRzLmZvcmNlQ29sb3IgfHwgaXNDb2xvclN1cHBvcnRlZCgpICYmIG9wdHMuaGlnaGxpZ2h0Q29kZTtcbiAgY29uc3QgZGVmcyA9IGdldERlZnMoc2hvdWxkSGlnaGxpZ2h0KTtcbiAgY29uc3QgbGluZXMgPSByYXdMaW5lcy5zcGxpdChORVdMSU5FKTtcbiAgY29uc3Qge1xuICAgIHN0YXJ0LFxuICAgIGVuZCxcbiAgICBtYXJrZXJMaW5lc1xuICB9ID0gZ2V0TWFya2VyTGluZXMobG9jLCBsaW5lcywgb3B0cyk7XG4gIGNvbnN0IGhhc0NvbHVtbnMgPSBsb2Muc3RhcnQgJiYgdHlwZW9mIGxvYy5zdGFydC5jb2x1bW4gPT09IFwibnVtYmVyXCI7XG4gIGNvbnN0IG51bWJlck1heFdpZHRoID0gU3RyaW5nKGVuZCkubGVuZ3RoO1xuICBjb25zdCBoaWdobGlnaHRlZExpbmVzID0gc2hvdWxkSGlnaGxpZ2h0ID8gaGlnaGxpZ2h0KHJhd0xpbmVzKSA6IHJhd0xpbmVzO1xuICBsZXQgZnJhbWUgPSBoaWdobGlnaHRlZExpbmVzLnNwbGl0KE5FV0xJTkUsIGVuZCkuc2xpY2Uoc3RhcnQsIGVuZCkubWFwKChsaW5lLCBpbmRleCkgPT4ge1xuICAgIGNvbnN0IG51bWJlciA9IHN0YXJ0ICsgMSArIGluZGV4O1xuICAgIGNvbnN0IHBhZGRlZE51bWJlciA9IGAgJHtudW1iZXJ9YC5zbGljZSgtbnVtYmVyTWF4V2lkdGgpO1xuICAgIGNvbnN0IGd1dHRlciA9IGAgJHtwYWRkZWROdW1iZXJ9IHxgO1xuICAgIGNvbnN0IGhhc01hcmtlciA9IG1hcmtlckxpbmVzW251bWJlcl07XG4gICAgY29uc3QgbGFzdE1hcmtlckxpbmUgPSAhbWFya2VyTGluZXNbbnVtYmVyICsgMV07XG4gICAgaWYgKGhhc01hcmtlcikge1xuICAgICAgbGV0IG1hcmtlckxpbmUgPSBcIlwiO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaGFzTWFya2VyKSkge1xuICAgICAgICBjb25zdCBtYXJrZXJTcGFjaW5nID0gbGluZS5zbGljZSgwLCBNYXRoLm1heChoYXNNYXJrZXJbMF0gLSAxLCAwKSkucmVwbGFjZSgvW15cXHRdL2csIFwiIFwiKTtcbiAgICAgICAgY29uc3QgbnVtYmVyT2ZNYXJrZXJzID0gaGFzTWFya2VyWzFdIHx8IDE7XG4gICAgICAgIG1hcmtlckxpbmUgPSBbXCJcXG4gXCIsIGRlZnMuZ3V0dGVyKGd1dHRlci5yZXBsYWNlKC9cXGQvZywgXCIgXCIpKSwgXCIgXCIsIG1hcmtlclNwYWNpbmcsIGRlZnMubWFya2VyKFwiXlwiKS5yZXBlYXQobnVtYmVyT2ZNYXJrZXJzKV0uam9pbihcIlwiKTtcbiAgICAgICAgaWYgKGxhc3RNYXJrZXJMaW5lICYmIG9wdHMubWVzc2FnZSkge1xuICAgICAgICAgIG1hcmtlckxpbmUgKz0gXCIgXCIgKyBkZWZzLm1lc3NhZ2Uob3B0cy5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIFtkZWZzLm1hcmtlcihcIj5cIiksIGRlZnMuZ3V0dGVyKGd1dHRlciksIGxpbmUubGVuZ3RoID4gMCA/IGAgJHtsaW5lfWAgOiBcIlwiLCBtYXJrZXJMaW5lXS5qb2luKFwiXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCAke2RlZnMuZ3V0dGVyKGd1dHRlcil9JHtsaW5lLmxlbmd0aCA+IDAgPyBgICR7bGluZX1gIDogXCJcIn1gO1xuICAgIH1cbiAgfSkuam9pbihcIlxcblwiKTtcbiAgaWYgKG9wdHMubWVzc2FnZSAmJiAhaGFzQ29sdW1ucykge1xuICAgIGZyYW1lID0gYCR7XCIgXCIucmVwZWF0KG51bWJlck1heFdpZHRoICsgMSl9JHtvcHRzLm1lc3NhZ2V9XFxuJHtmcmFtZX1gO1xuICB9XG4gIGlmIChzaG91bGRIaWdobGlnaHQpIHtcbiAgICByZXR1cm4gZGVmcy5yZXNldChmcmFtZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZyYW1lO1xuICB9XG59XG5mdW5jdGlvbiBpbmRleCAocmF3TGluZXMsIGxpbmVOdW1iZXIsIGNvbE51bWJlciwgb3B0cyA9IHt9KSB7XG4gIGlmICghZGVwcmVjYXRpb25XYXJuaW5nU2hvd24pIHtcbiAgICBkZXByZWNhdGlvbldhcm5pbmdTaG93biA9IHRydWU7XG4gICAgY29uc3QgbWVzc2FnZSA9IFwiUGFzc2luZyBsaW5lTnVtYmVyIGFuZCBjb2xOdW1iZXIgaXMgZGVwcmVjYXRlZCB0byBAYmFiZWwvY29kZS1mcmFtZS4gUGxlYXNlIHVzZSBgY29kZUZyYW1lQ29sdW1uc2AuXCI7XG4gICAgaWYgKHByb2Nlc3MuZW1pdFdhcm5pbmcpIHtcbiAgICAgIHByb2Nlc3MuZW1pdFdhcm5pbmcobWVzc2FnZSwgXCJEZXByZWNhdGlvbldhcm5pbmdcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGRlcHJlY2F0aW9uRXJyb3IgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICBkZXByZWNhdGlvbkVycm9yLm5hbWUgPSBcIkRlcHJlY2F0aW9uV2FybmluZ1wiO1xuICAgICAgY29uc29sZS53YXJuKG5ldyBFcnJvcihtZXNzYWdlKSk7XG4gICAgfVxuICB9XG4gIGNvbE51bWJlciA9IE1hdGgubWF4KGNvbE51bWJlciwgMCk7XG4gIGNvbnN0IGxvY2F0aW9uID0ge1xuICAgIHN0YXJ0OiB7XG4gICAgICBjb2x1bW46IGNvbE51bWJlcixcbiAgICAgIGxpbmU6IGxpbmVOdW1iZXJcbiAgICB9XG4gIH07XG4gIHJldHVybiBjb2RlRnJhbWVDb2x1bW5zKHJhd0xpbmVzLCBsb2NhdGlvbiwgb3B0cyk7XG59XG5cbmV4cG9ydHMuY29kZUZyYW1lQ29sdW1ucyA9IGNvZGVGcmFtZUNvbHVtbnM7XG5leHBvcnRzLmRlZmF1bHQgPSBpbmRleDtcbmV4cG9ydHMuaGlnaGxpZ2h0ID0gaGlnaGxpZ2h0O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwidmVyc2lvbiI6M30=