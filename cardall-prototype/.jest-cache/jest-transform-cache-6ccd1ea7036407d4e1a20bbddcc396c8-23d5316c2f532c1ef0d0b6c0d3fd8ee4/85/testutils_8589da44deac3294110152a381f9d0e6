e84f093ce2ef982c3812647d349dfebe
"use strict";
/**
 * 数据迁移测试工具函数
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MigrationTestHelpers = exports.MockDatabase = exports.TestDataFactory = void 0;
// 测试数据工厂
class TestDataFactory {
    /**
     * 创建测试卡片
     */
    static createTestCard(overrides = {}) {
        return {
            id: `card-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
            frontContent: {
                title: '测试卡片正面',
                text: '这是卡片的正面内容',
                tags: ['测试', '示例'],
                images: []
            },
            backContent: {
                title: '测试卡片背面',
                text: '这是卡片的背面内容',
                tags: ['测试', '示例'],
                images: []
            },
            folderId: 'test-folder',
            createdAt: new Date('2024-01-01'),
            updatedAt: new Date('2024-01-01'),
            ...overrides
        };
    }
    /**
     * 创建测试文件夹
     */
    static createTestFolder(overrides = {}) {
        return {
            id: `folder-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
            name: '测试文件夹',
            parentId: null,
            color: '#4f46e5',
            icon: 'folder',
            createdAt: new Date('2024-01-01'),
            updatedAt: new Date('2024-01-01'),
            ...overrides
        };
    }
    /**
     * 创建测试标签
     */
    static createTestTag(overrides = {}) {
        return {
            id: `tag-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
            name: '测试标签',
            color: '#ef4444',
            count: 0,
            createdAt: new Date('2024-01-01'),
            ...overrides
        };
    }
    /**
     * 创建包含图片的卡片
     */
    static createCardWithImage(overrides = {}) {
        const base64Image = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=';
        return {
            ...this.createTestCard(overrides),
            frontContent: {
                ...this.createTestCard(overrides).frontContent,
                images: [{
                        id: 'test-image',
                        url: base64Image,
                        alt: '测试图片',
                        width: 100,
                        height: 100
                    }]
            }
        };
    }
    /**
     * 创建大量测试数据
     */
    static createBulkTestData(cardCount = 100, folderCount = 10, tagCount = 20) {
        const folders = [];
        const tags = [];
        const cards = [];
        // 创建文件夹
        for (let i = 0; i < folderCount; i++) {
            folders.push(this.createTestFolder({
                id: `folder-${i}`,
                name: `测试文件夹 ${i + 1}`,
                parentId: i > 0 ? `folder-${Math.floor((i - 1) / 5)}` : null
            }));
        }
        // 创建标签
        for (let i = 0; i < tagCount; i++) {
            tags.push(this.createTestTag({
                id: `tag-${i}`,
                name: `测试标签 ${i + 1}`,
                color: `#${Math.floor(Math.random() * 16777215).toString(16)}`
            }));
        }
        // 创建卡片
        for (let i = 0; i < cardCount; i++) {
            const cardTags = tags
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.floor(Math.random() * 3) + 1)
                .map(tag => tag.name);
            cards.push(this.createTestCard({
                id: `card-${i}`,
                folderId: folders[Math.floor(Math.random() * folders.length)].id,
                frontContent: {
                    title: `测试卡片 ${i + 1}`,
                    text: `这是第 ${i + 1} 个测试卡片`,
                    tags: cardTags,
                    images: i % 10 === 0 ? [{
                            id: `image-${i}`,
                            url: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=',
                            alt: `图片 ${i + 1}`,
                            width: 100,
                            height: 100
                        }] : []
                }
            }));
        }
        return { folders, tags, cards };
    }
    /**
     * 创建损坏的测试数据
     */
    static createCorruptedTestData() {
        return {
            invalidCard: {
                id: 'invalid-card',
                frontContent: null, // 缺少必需字段
                backContent: { title: '', text: '' },
                createdAt: 'invalid-date',
                updatedAt: new Date()
            },
            invalidFolder: {
                id: 'invalid-folder',
                name: '', // 空名称
                parentId: 'non-existent',
                color: 'invalid-color',
                icon: 'folder',
                createdAt: new Date(),
                updatedAt: new Date()
            },
            invalidTag: {
                id: 'invalid-tag',
                name: '', // 空名称
                color: '#invalid',
                count: -1, // 负数
                createdAt: new Date()
            }
        };
    }
}
exports.TestDataFactory = TestDataFactory;
// Mock 工具
class MockDatabase {
    constructor() {
        Object.defineProperty(this, "data", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: {
                cards: [],
                folders: [],
                tags: [],
                images: [],
                settings: [],
                syncQueue: []
            }
        });
    }
    async clear() {
        Object.keys(this.data).forEach(key => {
            this.data[key] = [];
        });
    }
    // 卡片操作
    async addCard(card) {
        this.data.cards.push({ ...card, id: card.id || `card-${Date.now()}` });
        return this.data.cards[this.data.cards.length - 1];
    }
    async getCards() {
        return this.data.cards;
    }
    // 文件夹操作
    async addFolder(folder) {
        this.data.folders.push({ ...folder, id: folder.id || `folder-${Date.now()}` });
        return this.data.folders[this.data.folders.length - 1];
    }
    async getFolders() {
        return this.data.folders;
    }
    // 标签操作
    async addTag(tag) {
        this.data.tags.push({ ...tag, id: tag.id || `tag-${Date.now()}` });
        return this.data.tags[this.data.tags.length - 1];
    }
    async getTags() {
        return this.data.tags;
    }
    // 设置操作
    async addSetting(key, value) {
        const setting = {
            key,
            value,
            updatedAt: new Date(),
            scope: 'global'
        };
        this.data.settings.push(setting);
        return setting;
    }
    async getSetting(key) {
        return this.data.settings.find(s => s.key === key)?.value;
    }
    // 统计信息
    async getStats() {
        return {
            cards: this.data.cards.length,
            folders: this.data.folders.length,
            tags: this.data.tags.length,
            images: this.data.images.length,
            pendingSync: this.data.syncQueue.length,
            totalSize: JSON.stringify(this.data).length,
            version: '4.0.0'
        };
    }
    // 模拟数据库健康检查
    async healthCheck() {
        return {
            isHealthy: true,
            issues: []
        };
    }
    // 清空所有数据
    async clearAll() {
        await this.clear();
    }
}
exports.MockDatabase = MockDatabase;
// 测试辅助函数
class MigrationTestHelpers {
    /**
     * 设置localStorage测试数据
     */
    static setupLocalStorageData(data) {
        if (data.cards) {
            localStorage.setItem('cardall-cards', JSON.stringify(data.cards));
        }
        if (data.folders) {
            localStorage.setItem('cardall-folders', JSON.stringify(data.folders));
        }
        if (data.tags) {
            localStorage.setItem('cardall-tags', JSON.stringify(data.tags));
        }
        if (data.cards?.some(card => card.frontContent?.images?.length > 0)) {
            localStorage.setItem('cardall-hidden-tags', JSON.stringify(['image-test']));
        }
    }
    /**
     * 清理localStorage
     */
    static cleanupLocalStorage() {
        localStorage.removeItem('cardall-cards');
        localStorage.removeItem('cardall-folders');
        localStorage.removeItem('cardall-tags');
        localStorage.removeItem('cardall-hidden-tags');
    }
    /**
     * 模拟IndexedDB数据库
     */
    static mockIndexedDB(data = {}) {
        const mockDb = {
            open: jest.fn().mockResolvedValue({}),
            close: jest.fn(),
            delete: jest.fn().mockResolvedValue({}),
            cards: {
                count: jest.fn().mockResolvedValue(data.cards?.length || 0),
                toArray: jest.fn().mockResolvedValue(data.cards || []),
                bulkAdd: jest.fn().mockResolvedValue(undefined)
            },
            folders: {
                count: jest.fn().mockResolvedValue(data.folders?.length || 0),
                toArray: jest.fn().mockResolvedValue(data.folders || []),
                bulkAdd: jest.fn().mockResolvedValue(undefined)
            },
            tags: {
                count: jest.fn().mockResolvedValue(data.tags?.length || 0),
                toArray: jest.fn().mockResolvedValue(data.tags || []),
                bulkAdd: jest.fn().mockResolvedValue(undefined)
            },
            images: {
                count: jest.fn().mockResolvedValue(data.images?.length || 0),
                toArray: jest.fn().mockResolvedValue(data.images || []),
                bulkAdd: jest.fn().mockResolvedValue(undefined)
            },
            syncQueue: {
                count: jest.fn().mockResolvedValue(data.syncQueue?.length || 0),
                toArray: jest.fn().mockResolvedValue(data.syncQueue || []),
                bulkAdd: jest.fn().mockResolvedValue(undefined)
            }
        };
        // 模拟Dexie构造函数
        const OriginalDexie = global.Dexie;
        global.Dexie = jest.fn().mockImplementation(() => mockDb);
        return mockDb;
    }
    /**
     * 恢复原始Dexie
     */
    static restoreIndexedDB() {
        const OriginalDexie = global.OriginalDexie;
        if (OriginalDexie) {
            ;
            global.Dexie = OriginalDexie;
        }
    }
    /**
     * 创建迁移进度监听器
     */
    static createProgressListener() {
        const progressEvents = [];
        const callback = jest.fn((progress) => {
            progressEvents.push(progress);
        });
        return {
            callback,
            getEvents: () => progressEvents,
            clearEvents: () => {
                progressEvents.length = 0;
            },
            getLastEvent: () => progressEvents[progressEvents.length - 1]
        };
    }
    /**
     * 验证迁移结果
     */
    static validateMigrationResult(result, expectations) {
        if (expectations.success !== undefined) {
            expect(result.success).toBe(expectations.success);
        }
        if (expectations.migratedCards !== undefined) {
            expect(result.migratedCards).toBe(expectations.migratedCards);
        }
        if (expectations.migratedFolders !== undefined) {
            expect(result.migratedFolders).toBe(expectations.migratedFolders);
        }
        if (expectations.migratedTags !== undefined) {
            expect(result.migratedTags).toBe(expectations.migratedTags);
        }
        if (expectations.migratedImages !== undefined) {
            expect(result.migratedImages).toBe(expectations.migratedImages);
        }
        if (expectations.hasErrors !== undefined) {
            expect(result.errors.length > 0).toBe(expectations.hasErrors);
        }
        if (expectations.hasWarnings !== undefined) {
            expect(result.warnings.length > 0).toBe(expectations.hasWarnings);
        }
        // 基本验证
        expect(result.planId).toBeDefined();
        expect(result.executedAt).toBeInstanceOf(Date);
        expect(result.duration).toBeGreaterThan(0);
        expect(result.stepsCompleted).toBeGreaterThanOrEqual(0);
        expect(result.totalSteps).toBeGreaterThan(0);
    }
    /**
     * 验证迁移计划
     */
    static validateMigrationPlan(plan, expectations) {
        if (expectations.sourceType !== undefined) {
            expect(plan.source.type).toBe(expectations.sourceType);
        }
        if (expectations.backupRequired !== undefined) {
            expect(plan.backupRequired).toBe(expectations.backupRequired);
        }
        if (expectations.rollbackEnabled !== undefined) {
            expect(plan.rollbackEnabled).toBe(expectations.rollbackEnabled);
        }
        if (expectations.minSteps !== undefined) {
            expect(plan.steps.length).toBeGreaterThanOrEqual(expectations.minSteps);
        }
        if (expectations.validationLevel !== undefined) {
            expect(plan.validationLevel).toBe(expectations.validationLevel);
        }
        // 基本验证
        expect(plan.id).toBeDefined();
        expect(plan.target.version).toBe('4.0.0');
        expect(plan.target.database).toBe('CardAllUnifiedDatabase');
        expect(plan.estimatedTime).toBeGreaterThan(0);
        expect(plan.steps.length).toBeGreaterThan(0);
    }
    /**
     * 等待异步操作完成
     */
    static async waitFor(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    /**
     * 重试函数直到成功
     */
    static async retry(fn, maxAttempts = 3, delay = 100) {
        let lastError;
        for (let i = 0; i < maxAttempts; i++) {
            try {
                return await fn();
            }
            catch (error) {
                lastError = error;
                if (i < maxAttempts - 1) {
                    await this.waitFor(delay);
                }
            }
        }
        throw lastError;
    }
}
exports.MigrationTestHelpers = MigrationTestHelpers;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcX190ZXN0c19fXFxzZXJ2aWNlc1xcZGF0YS1taWdyYXRpb25cXHRlc3QtdXRpbHMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7QUFLSCxTQUFTO0FBQ1QsTUFBYSxlQUFlO0lBQzFCOztPQUVHO0lBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxZQUEyQixFQUFFO1FBQ2pELE9BQU87WUFDTCxFQUFFLEVBQUUsUUFBUSxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO1lBQ25FLFlBQVksRUFBRTtnQkFDWixLQUFLLEVBQUUsUUFBUTtnQkFDZixJQUFJLEVBQUUsV0FBVztnQkFDakIsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztnQkFDbEIsTUFBTSxFQUFFLEVBQUU7YUFDWDtZQUNELFdBQVcsRUFBRTtnQkFDWCxLQUFLLEVBQUUsUUFBUTtnQkFDZixJQUFJLEVBQUUsV0FBVztnQkFDakIsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztnQkFDbEIsTUFBTSxFQUFFLEVBQUU7YUFDWDtZQUNELFFBQVEsRUFBRSxhQUFhO1lBQ3ZCLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUM7WUFDakMsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztZQUNqQyxHQUFHLFNBQVM7U0FDYixDQUFBO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFlBQTZCLEVBQUU7UUFDckQsT0FBTztZQUNMLEVBQUUsRUFBRSxVQUFVLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFD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QUN4RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FDaEIsRUFBb0IsRUFDcEIsY0FBc0IsQ0FBQyxFQUN2QixRQUFnQixHQUFHO1FBRW5CLElBQUksU0FBZ0IsQ0FBQTtRQUVwQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDckMsSUFBSSxDQUFDO2dCQUNILE9BQU8sTUFBTSxFQUFFLEVBQUUsQ0FBQTtZQUNuQixDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixTQUFTLEdBQUcsS0FBYyxDQUFBO2dCQUMxQixJQUFJLENBQUMsR0FBRyxXQUFXLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ3hCLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDM0IsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO1FBRUQsTUFBTSxTQUFVLENBQUE7SUFDbEIsQ0FBQztDQUNGO0FBOU5ELG9EQThOQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXENhcmRFdmVyeXRoaW5nXFxjYXJkYWxsLXByb3RvdHlwZVxcc3JjXFxfX3Rlc3RzX19cXHNlcnZpY2VzXFxkYXRhLW1pZ3JhdGlvblxcdGVzdC11dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOaVsOaNrui/geenu+a1i+ivleW3peWFt+WHveaVsFxuICovXG5cbmltcG9ydCB7IERhdGFNaWdyYXRpb25Ub29sLCBNaWdyYXRpb25Tb3VyY2UsIE1pZ3JhdGlvblBsYW4sIE1pZ3JhdGlvblJlc3VsdCB9IGZyb20gJ0Avc2VydmljZXMvZGF0YS1taWdyYXRpb24tdG9vbCdcbmltcG9ydCB7IENhcmQsIEZvbGRlciwgVGFnIH0gZnJvbSAnQC90eXBlcy9jYXJkJ1xuXG4vLyDmtYvor5XmlbDmja7lt6XljoJcbmV4cG9ydCBjbGFzcyBUZXN0RGF0YUZhY3Rvcnkge1xuICAvKipcbiAgICog5Yib5bu65rWL6K+V5Y2h54mHXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlVGVzdENhcmQob3ZlcnJpZGVzOiBQYXJ0aWFsPENhcmQ+ID0ge30pOiBDYXJkIHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGBjYXJkLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgIGZyb250Q29udGVudDoge1xuICAgICAgICB0aXRsZTogJ+a1i+ivleWNoeeJh+ato+mdoicsXG4gICAgICAgIHRleHQ6ICfov5nmmK/ljaHniYfnmoTmraPpnaLlhoXlrrknLFxuICAgICAgICB0YWdzOiBbJ+a1i+ivlScsICfnpLrkvosnXSxcbiAgICAgICAgaW1hZ2VzOiBbXVxuICAgICAgfSxcbiAgICAgIGJhY2tDb250ZW50OiB7XG4gICAgICAgIHRpdGxlOiAn5rWL6K+V5Y2h54mH6IOM6Z2iJyxcbiAgICAgICAgdGV4dDogJ+i/meaYr+WNoeeJh+eahOiDjOmdouWGheWuuScsXG4gICAgICAgIHRhZ3M6IFsn5rWL6K+VJywgJ+ekuuS+iyddLFxuICAgICAgICBpbWFnZXM6IFtdXG4gICAgICB9LFxuICAgICAgZm9sZGVySWQ6ICd0ZXN0LWZvbGRlcicsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gICAgICAuLi5vdmVycmlkZXNcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65rWL6K+V5paH5Lu25aS5XG4gICAqL1xuICBzdGF0aWMgY3JlYXRlVGVzdEZvbGRlcihvdmVycmlkZXM6IFBhcnRpYWw8Rm9sZGVyPiA9IHt9KTogRm9sZGVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGBmb2xkZXItJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgbmFtZTogJ+a1i+ivleaWh+S7tuWkuScsXG4gICAgICBwYXJlbnRJZDogbnVsbCxcbiAgICAgIGNvbG9yOiAnIzRmNDZlNScsXG4gICAgICBpY29uOiAnZm9sZGVyJyxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgIC4uLm92ZXJyaWRlc1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmtYvor5XmoIfnrb5cbiAgICovXG4gIHN0YXRpYyBjcmVhdGVUZXN0VGFnKG92ZXJyaWRlczogUGFydGlhbDxUYWc+ID0ge30pOiBUYWcge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogYHRhZy0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICBuYW1lOiAn5rWL6K+V5qCH562+JyxcbiAgICAgIGNvbG9yOiAnI2VmNDQ0NCcsXG4gICAgICBjb3VudDogMCxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgIC4uLm92ZXJyaWRlc1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rljIXlkKvlm77niYfnmoTljaHniYdcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVDYXJkV2l0aEltYWdlKG92ZXJyaWRlczogUGFydGlhbDxDYXJkPiA9IHt9KTogQ2FyZCB7XG4gICAgY29uc3QgYmFzZTY0SW1hZ2UgPSAnZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwvOWovNEFBUVNrWkpSZ0FCQVFFQVlBQmdBQUQvMndCREFBWUVCUVlGQkFZR0JRWUhCd1lJQ2hBS0Nna0pDaFFPRHd3UUZ4UVlHQmNVRmhZYUhTVWZHaHNqSEJZV0lDd2dJeVluS1NvcEdSOHRNQzBvTUNVb0tTai8yd0JEQVFjSEJ3b0lDaE1LQ2hNb0doWWFLQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0NqL3dBQVJDQUFCQUFFREFTSUFBaEVCQXhFQi84UUFGUUFCQVFBQUFBQUFBQUFBQUFBQUFBQUFBQXYveEFBVUVBRUFBQUFBQUFBQUFBQUFBQUFBQUFBQS84UUFGUUVCQVFBQUFBQUFBQUFBQUFBQUFBQUFBQVgveEFBVUVRRUFBQUFBQUFBQUFBQUFBQUFBQUFBQS85b0FEQU1CQUFJUkF4RUFQd0NkQUJtWC85az0nXG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4udGhpcy5jcmVhdGVUZXN0Q2FyZChvdmVycmlkZXMpLFxuICAgICAgZnJvbnRDb250ZW50OiB7XG4gICAgICAgIC4uLnRoaXMuY3JlYXRlVGVzdENhcmQob3ZlcnJpZGVzKS5mcm9udENvbnRlbnQsXG4gICAgICAgIGltYWdlczogW3tcbiAgICAgICAgICBpZDogJ3Rlc3QtaW1hZ2UnLFxuICAgICAgICAgIHVybDogYmFzZTY0SW1hZ2UsXG4gICAgICAgICAgYWx0OiAn5rWL6K+V5Zu+54mHJyxcbiAgICAgICAgICB3aWR0aDogMTAwLFxuICAgICAgICAgIGhlaWdodDogMTAwXG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuWkp+mHj+a1i+ivleaVsOaNrlxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZUJ1bGtUZXN0RGF0YShcbiAgICBjYXJkQ291bnQ6IG51bWJlciA9IDEwMCxcbiAgICBmb2xkZXJDb3VudDogbnVtYmVyID0gMTAsXG4gICAgdGFnQ291bnQ6IG51bWJlciA9IDIwXG4gICkge1xuICAgIGNvbnN0IGZvbGRlcnM6IEZvbGRlcltdID0gW11cbiAgICBjb25zdCB0YWdzOiBUYWdbXSA9IFtdXG4gICAgY29uc3QgY2FyZHM6IENhcmRbXSA9IFtdXG5cbiAgICAvLyDliJvlu7rmlofku7blpLlcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvbGRlckNvdW50OyBpKyspIHtcbiAgICAgIGZvbGRlcnMucHVzaCh0aGlzLmNyZWF0ZVRlc3RGb2xkZXIoe1xuICAgICAgICBpZDogYGZvbGRlci0ke2l9YCxcbiAgICAgICAgbmFtZTogYOa1i+ivleaWh+S7tuWkuSAke2kgKyAxfWAsXG4gICAgICAgIHBhcmVudElkOiBpID4gMCA/IGBmb2xkZXItJHtNYXRoLmZsb29yKChpIC0gMSkgLyA1KX1gIDogbnVsbFxuICAgICAgfSkpXG4gICAgfVxuXG4gICAgLy8g5Yib5bu65qCH562+XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWdDb3VudDsgaSsrKSB7XG4gICAgICB0YWdzLnB1c2godGhpcy5jcmVhdGVUZXN0VGFnKHtcbiAgICAgICAgaWQ6IGB0YWctJHtpfWAsXG4gICAgICAgIG5hbWU6IGDmtYvor5XmoIfnrb4gJHtpICsgMX1gLFxuICAgICAgICBjb2xvcjogYCMke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxNjc3NzIxNSkudG9TdHJpbmcoMTYpfWBcbiAgICAgIH0pKVxuICAgIH1cblxuICAgIC8vIOWIm+W7uuWNoeeJh1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FyZENvdW50OyBpKyspIHtcbiAgICAgIGNvbnN0IGNhcmRUYWdzID0gdGFnc1xuICAgICAgICAuc29ydCgoKSA9PiBNYXRoLnJhbmRvbSgpIC0gMC41KVxuICAgICAgICAuc2xpY2UoMCwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMykgKyAxKVxuICAgICAgICAubWFwKHRhZyA9PiB0YWcubmFtZSlcblxuICAgICAgY2FyZHMucHVzaCh0aGlzLmNyZWF0ZVRlc3RDYXJkKHtcbiAgICAgICAgaWQ6IGBjYXJkLSR7aX1gLFxuICAgICAgICBmb2xkZXJJZDogZm9sZGVyc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBmb2xkZXJzLmxlbmd0aCldLmlkLFxuICAgICAgICBmcm9udENvbnRlbnQ6IHtcbiAgICAgICAgICB0aXRsZTogYOa1i+ivleWNoeeJhyAke2kgKyAxfWAsXG4gICAgICAgICAgdGV4dDogYOi/meaYr+esrCAke2kgKyAxfSDkuKrmtYvor5XljaHniYdgLFxuICAgICAgICAgIHRhZ3M6IGNhcmRUYWdzLFxuICAgICAgICAgIGltYWdlczogaSAlIDEwID09PSAwID8gW3tcbiAgICAgICAgICAgIGlkOiBgaW1hZ2UtJHtpfWAsXG4gICAgICAgICAgICB1cmw6ICdkYXRhOmltYWdlL2pwZWc7YmFzZTY0LC85ai80QUFRU2taSlJnQUJBUUVBWUFCZ0FBRC8yd0JEQUFZRUJRWUZCQVlHQlFZSEJ3WUlDaEFLQ2drSkNoUU9Ed3dRRnhRWUdCY1VGaFlhSFNVZkdoc2pIQllXSUN3Z0l5WW5LU29wR1I4dE1DMG9NQ1VvS1NqLzJ3QkRBUWNIQndvSUNoTUtDaE1vR2hZYUtDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2dvS0Nnb0tDZ29LQ2ovd0FBUkNBQUJBQUVEQVNJQUFoRUJBeEVCLzhRQUZRQUJBUUFBQUFBQUFBQUFBQUFBQUFBQUFBdi94QUFVRUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBLzhRQUZRRUJBUUFBQUFBQUFBQUFBQUFBQUFBQUFBWC94QUFVRVFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBLzlvQURBTUJBQUlSQXhFQVB3Q2RBQm1YLzlrPScsXG4gICAgICAgICAgICBhbHQ6IGDlm77niYcgJHtpICsgMX1gLFxuICAgICAgICAgICAgd2lkdGg6IDEwMCxcbiAgICAgICAgICAgIGhlaWdodDogMTAwXG4gICAgICAgICAgfV0gOiBbXVxuICAgICAgICB9XG4gICAgICB9KSlcbiAgICB9XG5cbiAgICByZXR1cm4geyBmb2xkZXJzLCB0YWdzLCBjYXJkcyB9XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65o2f5Z2P55qE5rWL6K+V5pWw5o2uXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlQ29ycnVwdGVkVGVzdERhdGEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGludmFsaWRDYXJkOiB7XG4gICAgICAgIGlkOiAnaW52YWxpZC1jYXJkJyxcbiAgICAgICAgZnJvbnRDb250ZW50OiBudWxsIGFzIGFueSwgLy8g57y65bCR5b+F6ZyA5a2X5q61XG4gICAgICAgIGJhY2tDb250ZW50OiB7IHRpdGxlOiAnJywgdGV4dDogJycgfSxcbiAgICAgICAgY3JlYXRlZEF0OiAnaW52YWxpZC1kYXRlJyBhcyBhbnksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgICAgfSxcbiAgICAgIGludmFsaWRGb2xkZXI6IHtcbiAgICAgICAgaWQ6ICdpbnZhbGlkLWZvbGRlcicsXG4gICAgICAgIG5hbWU6ICcnLCAvLyDnqbrlkI3np7BcbiAgICAgICAgcGFyZW50SWQ6ICdub24tZXhpc3RlbnQnLFxuICAgICAgICBjb2xvcjogJ2ludmFsaWQtY29sb3InLFxuICAgICAgICBpY29uOiAnZm9sZGVyJyxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgIH0sXG4gICAgICBpbnZhbGlkVGFnOiB7XG4gICAgICAgIGlkOiAnaW52YWxpZC10YWcnLFxuICAgICAgICBuYW1lOiAnJywgLy8g56m65ZCN56ewXG4gICAgICAgIGNvbG9yOiAnI2ludmFsaWQnLFxuICAgICAgICBjb3VudDogLTEsIC8vIOi0n+aVsFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLy8gTW9jayDlt6XlhbdcbmV4cG9ydCBjbGFzcyBNb2NrRGF0YWJhc2Uge1xuICBwcml2YXRlIGRhdGE6IHtcbiAgICBjYXJkczogYW55W11cbiAgICBmb2xkZXJzOiBhbnlbXVxuICAgIHRhZ3M6IGFueVtdXG4gICAgaW1hZ2VzOiBhbnlbXVxuICAgIHNldHRpbmdzOiBhbnlbXVxuICAgIHN5bmNRdWV1ZTogYW55W11cbiAgfSA9IHtcbiAgICBjYXJkczogW10sXG4gICAgZm9sZGVyczogW10sXG4gICAgdGFnczogW10sXG4gICAgaW1hZ2VzOiBbXSxcbiAgICBzZXR0aW5nczogW10sXG4gICAgc3luY1F1ZXVlOiBbXVxuICB9XG5cbiAgYXN5bmMgY2xlYXIoKSB7XG4gICAgT2JqZWN0LmtleXModGhpcy5kYXRhKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICB0aGlzLmRhdGFba2V5IGFzIGtleW9mIHR5cGVvZiB0aGlzLmRhdGFdID0gW11cbiAgICB9KVxuICB9XG5cbiAgLy8g5Y2h54mH5pON5L2cXG4gIGFzeW5jIGFkZENhcmQoY2FyZDogYW55KSB7XG4gICAgdGhpcy5kYXRhLmNhcmRzLnB1c2goeyAuLi5jYXJkLCBpZDogY2FyZC5pZCB8fCBgY2FyZC0ke0RhdGUubm93KCl9YCB9KVxuICAgIHJldHVybiB0aGlzLmRhdGEuY2FyZHNbdGhpcy5kYXRhLmNhcmRzLmxlbmd0aCAtIDFdXG4gIH1cblxuICBhc3luYyBnZXRDYXJkcygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmNhcmRzXG4gIH1cblxuICAvLyDmlofku7blpLnmk43kvZxcbiAgYXN5bmMgYWRkRm9sZGVyKGZvbGRlcjogYW55KSB7XG4gICAgdGhpcy5kYXRhLmZvbGRlcnMucHVzaCh7IC4uLmZvbGRlciwgaWQ6IGZvbGRlci5pZCB8fCBgZm9sZGVyLSR7RGF0ZS5ub3coKX1gIH0pXG4gICAgcmV0dXJuIHRoaXMuZGF0YS5mb2xkZXJzW3RoaXMuZGF0YS5mb2xkZXJzLmxlbmd0aCAtIDFdXG4gIH1cblxuICBhc3luYyBnZXRGb2xkZXJzKCkge1xuICAgIHJldHVybiB0aGlzLmRhdGEuZm9sZGVyc1xuICB9XG5cbiAgLy8g5qCH562+5pON5L2cXG4gIGFzeW5jIGFkZFRhZyh0YWc6IGFueSkge1xuICAgIHRoaXMuZGF0YS50YWdzLnB1c2goeyAuLi50YWcsIGlkOiB0YWcuaWQgfHwgYHRhZy0ke0RhdGUubm93KCl9YCB9KVxuICAgIHJldHVybiB0aGlzLmRhdGEudGFnc1t0aGlzLmRhdGEudGFncy5sZW5ndGggLSAxXVxuICB9XG5cbiAgYXN5bmMgZ2V0VGFncygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLnRhZ3NcbiAgfVxuXG4gIC8vIOiuvue9ruaTjeS9nFxuICBhc3luYyBhZGRTZXR0aW5nKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgY29uc3Qgc2V0dGluZyA9IHtcbiAgICAgIGtleSxcbiAgICAgIHZhbHVlLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgc2NvcGU6ICdnbG9iYWwnXG4gICAgfVxuICAgIHRoaXMuZGF0YS5zZXR0aW5ncy5wdXNoKHNldHRpbmcpXG4gICAgcmV0dXJuIHNldHRpbmdcbiAgfVxuXG4gIGFzeW5jIGdldFNldHRpbmcoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLnNldHRpbmdzLmZpbmQocyA9PiBzLmtleSA9PT0ga2V5KT8udmFsdWVcbiAgfVxuXG4gIC8vIOe7n+iuoeS/oeaBr1xuICBhc3luYyBnZXRTdGF0cygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY2FyZHM6IHRoaXMuZGF0YS5jYXJkcy5sZW5ndGgsXG4gICAgICBmb2xkZXJzOiB0aGlzLmRhdGEuZm9sZGVycy5sZW5ndGgsXG4gICAgICB0YWdzOiB0aGlzLmRhdGEudGFncy5sZW5ndGgsXG4gICAgICBpbWFnZXM6IHRoaXMuZGF0YS5pbWFnZXMubGVuZ3RoLFxuICAgICAgcGVuZGluZ1N5bmM6IHRoaXMuZGF0YS5zeW5jUXVldWUubGVuZ3RoLFxuICAgICAgdG90YWxTaXplOiBKU09OLnN0cmluZ2lmeSh0aGlzLmRhdGEpLmxlbmd0aCxcbiAgICAgIHZlcnNpb246ICc0LjAuMCdcbiAgICB9XG4gIH1cblxuICAvLyDmqKHmi5/mlbDmja7lupPlgaXlurfmo4Dmn6VcbiAgYXN5bmMgaGVhbHRoQ2hlY2soKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzSGVhbHRoeTogdHJ1ZSxcbiAgICAgIGlzc3VlczogW11cbiAgICB9XG4gIH1cblxuICAvLyDmuIXnqbrmiYDmnInmlbDmja5cbiAgYXN5bmMgY2xlYXJBbGwoKSB7XG4gICAgYXdhaXQgdGhpcy5jbGVhcigpXG4gIH1cbn1cblxuLy8g5rWL6K+V6L6F5Yqp5Ye95pWwXG5leHBvcnQgY2xhc3MgTWlncmF0aW9uVGVzdEhlbHBlcnMge1xuICAvKipcbiAgICog6K6+572ubG9jYWxTdG9yYWdl5rWL6K+V5pWw5o2uXG4gICAqL1xuICBzdGF0aWMgc2V0dXBMb2NhbFN0b3JhZ2VEYXRhKGRhdGE6IHsgY2FyZHM/OiBDYXJkW107IGZvbGRlcnM/OiBGb2xkZXJbXTsgdGFncz86IFRhZ1tdIH0pIHtcbiAgICBpZiAoZGF0YS5jYXJkcykge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NhcmRhbGwtY2FyZHMnLCBKU09OLnN0cmluZ2lmeShkYXRhLmNhcmRzKSlcbiAgICB9XG4gICAgaWYgKGRhdGEuZm9sZGVycykge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NhcmRhbGwtZm9sZGVycycsIEpTT04uc3RyaW5naWZ5KGRhdGEuZm9sZGVycykpXG4gICAgfVxuICAgIGlmIChkYXRhLnRhZ3MpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjYXJkYWxsLXRhZ3MnLCBKU09OLnN0cmluZ2lmeShkYXRhLnRhZ3MpKVxuICAgIH1cbiAgICBpZiAoZGF0YS5jYXJkcz8uc29tZShjYXJkID0+IGNhcmQuZnJvbnRDb250ZW50Py5pbWFnZXM/Lmxlbmd0aCA+IDApKSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FyZGFsbC1oaWRkZW4tdGFncycsIEpTT04uc3RyaW5naWZ5KFsnaW1hZ2UtdGVzdCddKSlcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5riF55CGbG9jYWxTdG9yYWdlXG4gICAqL1xuICBzdGF0aWMgY2xlYW51cExvY2FsU3RvcmFnZSgpIHtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY2FyZGFsbC1jYXJkcycpXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2NhcmRhbGwtZm9sZGVycycpXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2NhcmRhbGwtdGFncycpXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2NhcmRhbGwtaGlkZGVuLXRhZ3MnKVxuICB9XG5cbiAgLyoqXG4gICAqIOaooeaLn0luZGV4ZWREQuaVsOaNruW6k1xuICAgKi9cbiAgc3RhdGljIG1vY2tJbmRleGVkREIoZGF0YTogYW55ID0ge30pIHtcbiAgICBjb25zdCBtb2NrRGIgPSB7XG4gICAgICBvcGVuOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxuICAgICAgY2xvc2U6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KSxcbiAgICAgIGNhcmRzOiB7XG4gICAgICAgIGNvdW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZGF0YS5jYXJkcz8ubGVuZ3RoIHx8IDApLFxuICAgICAgICB0b0FycmF5OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZGF0YS5jYXJkcyB8fCBbXSksXG4gICAgICAgIGJ1bGtBZGQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpXG4gICAgICB9LFxuICAgICAgZm9sZGVyczoge1xuICAgICAgICBjb3VudDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGRhdGEuZm9sZGVycz8ubGVuZ3RoIHx8IDApLFxuICAgICAgICB0b0FycmF5OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZGF0YS5mb2xkZXJzIHx8IFtdKSxcbiAgICAgICAgYnVsa0FkZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZClcbiAgICAgIH0sXG4gICAgICB0YWdzOiB7XG4gICAgICAgIGNvdW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZGF0YS50YWdzPy5sZW5ndGggfHwgMCksXG4gICAgICAgIHRvQXJyYXk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShkYXRhLnRhZ3MgfHwgW10pLFxuICAgICAgICBidWxrQWRkOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKVxuICAgICAgfSxcbiAgICAgIGltYWdlczoge1xuICAgICAgICBjb3VudDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGRhdGEuaW1hZ2VzPy5sZW5ndGggfHwgMCksXG4gICAgICAgIHRvQXJyYXk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShkYXRhLmltYWdlcyB8fCBbXSksXG4gICAgICAgIGJ1bGtBZGQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpXG4gICAgICB9LFxuICAgICAgc3luY1F1ZXVlOiB7XG4gICAgICAgIGNvdW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZGF0YS5zeW5jUXVldWU/Lmxlbmd0aCB8fCAwKSxcbiAgICAgICAgdG9BcnJheTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGRhdGEuc3luY1F1ZXVlIHx8IFtdKSxcbiAgICAgICAgYnVsa0FkZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmqKHmi59EZXhpZeaehOmAoOWHveaVsFxuICAgIGNvbnN0IE9yaWdpbmFsRGV4aWUgPSAoZ2xvYmFsIGFzIGFueSkuRGV4aWVcbiAgICA7KGdsb2JhbCBhcyBhbnkpLkRleGllID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrRGIpXG5cbiAgICByZXR1cm4gbW9ja0RiXG4gIH1cblxuICAvKipcbiAgICog5oGi5aSN5Y6f5aeLRGV4aWVcbiAgICovXG4gIHN0YXRpYyByZXN0b3JlSW5kZXhlZERCKCkge1xuICAgIGNvbnN0IE9yaWdpbmFsRGV4aWUgPSAoZ2xvYmFsIGFzIGFueSkuT3JpZ2luYWxEZXhpZVxuICAgIGlmIChPcmlnaW5hbERleGllKSB7XG4gICAgICA7KGdsb2JhbCBhcyBhbnkpLkRleGllID0gT3JpZ2luYWxEZXhpZVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rov4Hnp7vov5vluqbnm5HlkKzlmahcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVQcm9ncmVzc0xpc3RlbmVyKCkge1xuICAgIGNvbnN0IHByb2dyZXNzRXZlbnRzOiBhbnlbXSA9IFtdXG4gICAgY29uc3QgY2FsbGJhY2sgPSBqZXN0LmZuKChwcm9ncmVzcykgPT4ge1xuICAgICAgcHJvZ3Jlc3NFdmVudHMucHVzaChwcm9ncmVzcylcbiAgICB9KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNhbGxiYWNrLFxuICAgICAgZ2V0RXZlbnRzOiAoKSA9PiBwcm9ncmVzc0V2ZW50cyxcbiAgICAgIGNsZWFyRXZlbnRzOiAoKSA9PiB7XG4gICAgICAgIHByb2dyZXNzRXZlbnRzLmxlbmd0aCA9IDBcbiAgICAgIH0sXG4gICAgICBnZXRMYXN0RXZlbnQ6ICgpID0+IHByb2dyZXNzRXZlbnRzW3Byb2dyZXNzRXZlbnRzLmxlbmd0aCAtIDFdXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOmqjOivgei/geenu+e7k+aenFxuICAgKi9cbiAgc3RhdGljIHZhbGlkYXRlTWlncmF0aW9uUmVzdWx0KFxuICAgIHJlc3VsdDogTWlncmF0aW9uUmVzdWx0LFxuICAgIGV4cGVjdGF0aW9uczoge1xuICAgICAgc3VjY2Vzcz86IGJvb2xlYW5cbiAgICAgIG1pZ3JhdGVkQ2FyZHM/OiBudW1iZXJcbiAgICAgIG1pZ3JhdGVkRm9sZGVycz86IG51bWJlclxuICAgICAgbWlncmF0ZWRUYWdzPzogbnVtYmVyXG4gICAgICBtaWdyYXRlZEltYWdlcz86IG51bWJlclxuICAgICAgaGFzRXJyb3JzPzogYm9vbGVhblxuICAgICAgaGFzV2FybmluZ3M/OiBib29sZWFuXG4gICAgfVxuICApIHtcbiAgICBpZiAoZXhwZWN0YXRpb25zLnN1Y2Nlc3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGV4cGVjdGF0aW9ucy5zdWNjZXNzKVxuICAgIH1cblxuICAgIGlmIChleHBlY3RhdGlvbnMubWlncmF0ZWRDYXJkcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBleHBlY3QocmVzdWx0Lm1pZ3JhdGVkQ2FyZHMpLnRvQmUoZXhwZWN0YXRpb25zLm1pZ3JhdGVkQ2FyZHMpXG4gICAgfVxuXG4gICAgaWYgKGV4cGVjdGF0aW9ucy5taWdyYXRlZEZvbGRlcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHJlc3VsdC5taWdyYXRlZEZvbGRlcnMpLnRvQmUoZXhwZWN0YXRpb25zLm1pZ3JhdGVkRm9sZGVycylcbiAgICB9XG5cbiAgICBpZiAoZXhwZWN0YXRpb25zLm1pZ3JhdGVkVGFncyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBleHBlY3QocmVzdWx0Lm1pZ3JhdGVkVGFncykudG9CZShleHBlY3RhdGlvbnMubWlncmF0ZWRUYWdzKVxuICAgIH1cblxuICAgIGlmIChleHBlY3RhdGlvbnMubWlncmF0ZWRJbWFnZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHJlc3VsdC5taWdyYXRlZEltYWdlcykudG9CZShleHBlY3RhdGlvbnMubWlncmF0ZWRJbWFnZXMpXG4gICAgfVxuXG4gICAgaWYgKGV4cGVjdGF0aW9ucy5oYXNFcnJvcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMubGVuZ3RoID4gMCkudG9CZShleHBlY3RhdGlvbnMuaGFzRXJyb3JzKVxuICAgIH1cblxuICAgIGlmIChleHBlY3RhdGlvbnMuaGFzV2FybmluZ3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKS50b0JlKGV4cGVjdGF0aW9ucy5oYXNXYXJuaW5ncylcbiAgICB9XG5cbiAgICAvLyDln7rmnKzpqozor4FcbiAgICBleHBlY3QocmVzdWx0LnBsYW5JZCkudG9CZURlZmluZWQoKVxuICAgIGV4cGVjdChyZXN1bHQuZXhlY3V0ZWRBdCkudG9CZUluc3RhbmNlT2YoRGF0ZSlcbiAgICBleHBlY3QocmVzdWx0LmR1cmF0aW9uKS50b0JlR3JlYXRlclRoYW4oMClcbiAgICBleHBlY3QocmVzdWx0LnN0ZXBzQ29tcGxldGVkKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApXG4gICAgZXhwZWN0KHJlc3VsdC50b3RhbFN0ZXBzKS50b0JlR3JlYXRlclRoYW4oMClcbiAgfVxuXG4gIC8qKlxuICAgKiDpqozor4Hov4Hnp7vorqHliJJcbiAgICovXG4gIHN0YXRpYyB2YWxpZGF0ZU1pZ3JhdGlvblBsYW4oXG4gICAgcGxhbjogTWlncmF0aW9uUGxhbixcbiAgICBleHBlY3RhdGlvbnM6IHtcbiAgICAgIHNvdXJjZVR5cGU/OiBzdHJpbmdcbiAgICAgIGJhY2t1cFJlcXVpcmVkPzogYm9vbGVhblxuICAgICAgcm9sbGJhY2tFbmFibGVkPzogYm9vbGVhblxuICAgICAgbWluU3RlcHM/OiBudW1iZXJcbiAgICAgIHZhbGlkYXRpb25MZXZlbD86IHN0cmluZ1xuICAgIH1cbiAgKSB7XG4gICAgaWYgKGV4cGVjdGF0aW9ucy5zb3VyY2VUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGV4cGVjdChwbGFuLnNvdXJjZS50eXBlKS50b0JlKGV4cGVjdGF0aW9ucy5zb3VyY2VUeXBlKVxuICAgIH1cblxuICAgIGlmIChleHBlY3RhdGlvbnMuYmFja3VwUmVxdWlyZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHBsYW4uYmFja3VwUmVxdWlyZWQpLnRvQmUoZXhwZWN0YXRpb25zLmJhY2t1cFJlcXVpcmVkKVxuICAgIH1cblxuICAgIGlmIChleHBlY3RhdGlvbnMucm9sbGJhY2tFbmFibGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGV4cGVjdChwbGFuLnJvbGxiYWNrRW5hYmxlZCkudG9CZShleHBlY3RhdGlvbnMucm9sbGJhY2tFbmFibGVkKVxuICAgIH1cblxuICAgIGlmIChleHBlY3RhdGlvbnMubWluU3RlcHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHBsYW4uc3RlcHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKGV4cGVjdGF0aW9ucy5taW5TdGVwcylcbiAgICB9XG5cbiAgICBpZiAoZXhwZWN0YXRpb25zLnZhbGlkYXRpb25MZXZlbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBleHBlY3QocGxhbi52YWxpZGF0aW9uTGV2ZWwpLnRvQmUoZXhwZWN0YXRpb25zLnZhbGlkYXRpb25MZXZlbClcbiAgICB9XG5cbiAgICAvLyDln7rmnKzpqozor4FcbiAgICBleHBlY3QocGxhbi5pZCkudG9CZURlZmluZWQoKVxuICAgIGV4cGVjdChwbGFuLnRhcmdldC52ZXJzaW9uKS50b0JlKCc0LjAuMCcpXG4gICAgZXhwZWN0KHBsYW4udGFyZ2V0LmRhdGFiYXNlKS50b0JlKCdDYXJkQWxsVW5pZmllZERhdGFiYXNlJylcbiAgICBleHBlY3QocGxhbi5lc3RpbWF0ZWRUaW1lKS50b0JlR3JlYXRlclRoYW4oMClcbiAgICBleHBlY3QocGxhbi5zdGVwcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKVxuICB9XG5cbiAgLyoqXG4gICAqIOetieW+heW8guatpeaTjeS9nOWujOaIkFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHdhaXRGb3IobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKVxuICB9XG5cbiAgLyoqXG4gICAqIOmHjeivleWHveaVsOebtOWIsOaIkOWKn1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIHJldHJ5PFQ+KFxuICAgIGZuOiAoKSA9PiBQcm9taXNlPFQ+LFxuICAgIG1heEF0dGVtcHRzOiBudW1iZXIgPSAzLFxuICAgIGRlbGF5OiBudW1iZXIgPSAxMDBcbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgbGV0IGxhc3RFcnJvcjogRXJyb3JcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4QXR0ZW1wdHM7IGkrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGZuKClcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxhc3RFcnJvciA9IGVycm9yIGFzIEVycm9yXG4gICAgICAgIGlmIChpIDwgbWF4QXR0ZW1wdHMgLSAxKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yKGRlbGF5KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhyb3cgbGFzdEVycm9yIVxuICB9XG59XG5cbmV4cG9ydCB7XG4gIFRlc3REYXRhRmFjdG9yeSxcbiAgTW9ja0RhdGFiYXNlLFxuICBNaWdyYXRpb25UZXN0SGVscGVyc1xufSJdLCJ2ZXJzaW9uIjozfQ==