2f4a412fd35d56daa2d6cc93abd6bab5
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.RichTextEditor = RichTextEditor;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importStar(require("react"));
const react_2 = require("@tiptap/react");
const starter_kit_1 = __importDefault(require("@tiptap/starter-kit"));
const extension_image_1 = __importDefault(require("@tiptap/extension-image"));
const extension_placeholder_1 = __importDefault(require("@tiptap/extension-placeholder"));
const extension_task_list_1 = __importDefault(require("@tiptap/extension-task-list"));
const extension_task_item_1 = __importDefault(require("@tiptap/extension-task-item"));
const extension_link_1 = __importDefault(require("@tiptap/extension-link"));
const extension_blockquote_1 = __importDefault(require("@tiptap/extension-blockquote"));
const extension_code_1 = __importDefault(require("@tiptap/extension-code"));
const extension_code_block_1 = __importDefault(require("@tiptap/extension-code-block"));
const extension_strike_1 = __importDefault(require("@tiptap/extension-strike"));
const tiptap_markdown_3_1 = require("tiptap-markdown-3");
const button_1 = require("@/components/ui/button");
const lucide_react_1 = require("lucide-react");
const utils_1 = require("@/lib/utils");
const emoji_picker_1 = require("./emoji-picker");
require("./editor-styles.css");
function RichTextEditor({ content, placeholder = "Start typing...", onUpdate, onSave, onCancel, className, autoFocus = false }) {
    const [showEmojiPicker, setShowEmojiPicker] = (0, react_1.useState)(false);
    const [emojiQuery, setEmojiQuery] = (0, react_1.useState)('');
    const [emojiPosition, setEmojiPosition] = (0, react_1.useState)(null);
    const editorRef = (0, react_1.useRef)(null);
    const editor = (0, react_2.useEditor)({
        extensions: [
            starter_kit_1.default.configure({
                // 禁用默认的一些扩展，因为我们要单独配置
                strike: false,
                code: false,
                blockquote: false,
            }),
            // Markdown 支持
            tiptap_markdown_3_1.Markdown.configure({
                html: true, // 允许HTML输出
                transformPastedText: true, // 自动转换粘贴的Markdown
                transformCopiedText: false, // 复制时保持HTML格式
            }),
            // 任务列表支持 (复选框)
            extension_task_list_1.default,
            extension_task_item_1.default.configure({
                nested: true,
            }),
            // 链接支持
            extension_link_1.default.configure({
                openOnClick: false, // 在编辑模式下禁用自动打开，由我们手动处理
                HTMLAttributes: {
                    class: 'text-blue-600 underline hover:text-blue-800 cursor-pointer',
                    target: '_blank', // 新窗口打开
                    rel: 'noopener noreferrer', // 安全性
                },
                protocols: ['http', 'https', 'ftp', 'mailto'], // 支持的协议
                validate: href => /^https?:\/\//.test(href), // 验证链接格式
            }),
            // 引用块
            extension_blockquote_1.default.configure({
                HTMLAttributes: {
                    class: 'border-l-4 border-gray-300 pl-4 italic',
                },
            }),
            // 行内代码
            extension_code_1.default.configure({
                HTMLAttributes: {
                    class: 'inline-code',
                },
            }),
            // 代码块
            extension_code_block_1.default.configure({
                HTMLAttributes: {
                    class: 'code-block',
                },
            }),
            // 删除线
            extension_strike_1.default.configure({
                HTMLAttributes: {
                    class: 'line-through',
                },
            }),
            // 图片
            extension_image_1.default.configure({
                inline: true,
                allowBase64: true,
                HTMLAttributes: {
                    class: 'rounded-md max-w-full h-auto',
                },
            }),
            // 占位符
            extension_placeholder_1.default.configure({
                placeholder,
            }),
        ],
        content,
        onUpdate: ({ editor }) => {
            onUpdate(editor.getHTML());
        },
        editorProps: {
            attributes: {
                class: 'tiptap-editor text-sm leading-relaxed focus:outline-none min-h-[100px] w-full',
            },
            handleKeyDown: (view, event) => {
                // 只有在行首或空白处按 "/" 才触发 emoji 选择器
                if (event.key === '/' && !showEmojiPicker) {
                    const { selection } = view.state;
                    const { from } = selection;
                    const $pos = view.state.doc.resolve(from);
                    // 检查光标前的文本，如果前面有非空白字符，则不触发emoji选择器
                    const textBefore = $pos.parent.textBetween(0, $pos.parentOffset);
                    const isAtStartOrAfterSpace = !textBefore.trim() || textBefore.endsWith(' ');
                    if (isAtStartOrAfterSpace) {
                        const coords = view.coordsAtPos(from);
                        setEmojiPosition({
                            x: coords.left,
                            y: coords.bottom + 5
                        });
                        setShowEmojiPicker(true);
                        setEmojiQuery('');
                        // 阻止默认的 "/" 输入
                        event.preventDefault();
                        return true;
                    }
                }
                // 如果emoji选择器打开，处理查询输入
                if (showEmojiPicker) {
                    if (event.key === 'Escape') {
                        setShowEmojiPicker(false);
                        setEmojiQuery('');
                        return true;
                    }
                    if (event.key === 'Backspace') {
                        if (emojiQuery.length > 0) {
                            setEmojiQuery(prev => prev.slice(0, -1));
                        }
                        else {
                            setShowEmojiPicker(false);
                        }
                        return true;
                    }
                    // 添加字符到查询
                    if (event.key.length === 1 && !event.ctrlKey && !event.metaKey && event.key !== ' ') {
                        setEmojiQuery(prev => prev + event.key);
                        return true;
                    }
                    // 空格键选择第一个emoji或关闭选择器
                    if (event.key === ' ') {
                        setShowEmojiPicker(false);
                        setEmojiQuery('');
                        return true;
                    }
                }
                return false;
            },
        },
    });
    // Handle image upload
    const handleImageUpload = (0, react_1.useCallback)(() => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = (e) => {
            const file = e.target.files?.[0];
            if (file && editor) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target?.result;
                    editor.chain().focus().setImage({ src: base64 }).run();
                };
                reader.readAsDataURL(file);
            }
        };
        input.click();
    }, [editor]);
    // Handle paste images
    (0, react_1.useEffect)(() => {
        if (!editor)
            return;
        const handlePaste = (event) => {
            const items = event.clipboardData?.items;
            if (!items)
                return;
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                if (item.type.indexOf('image') !== -1) {
                    event.preventDefault();
                    const file = item.getAsFile();
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const base64 = e.target?.result;
                            editor.chain().focus().setImage({ src: base64 }).run();
                        };
                        reader.readAsDataURL(file);
                    }
                }
            }
        };
        const editorElement = editor.view.dom;
        editorElement.addEventListener('paste', handlePaste);
        return () => {
            editorElement.removeEventListener('paste', handlePaste);
        };
    }, [editor]);
    // Handle emoji selection
    const handleEmojiSelect = (0, react_1.useCallback)((emoji) => {
        if (editor) {
            editor.chain().focus().insertContent(emoji).run();
        }
        setShowEmojiPicker(false);
        setEmojiQuery('');
    }, [editor]);
    // Handle emoji picker close
    const handleEmojiPickerClose = (0, react_1.useCallback)(() => {
        setShowEmojiPicker(false);
        setEmojiQuery('');
    }, []);
    // Handle keyboard shortcuts
    (0, react_1.useEffect)(() => {
        if (!editor)
            return;
        const handleKeyDown = (event) => {
            if (event.key === 'Escape') {
                if (showEmojiPicker) {
                    setShowEmojiPicker(false);
                    setEmojiQuery('');
                }
                else {
                    onCancel();
                }
            }
            else if (event.key === 'Enter' && (event.ctrlKey || event.metaKey)) {
                onSave();
            }
        };
        const editorElement = editor.view.dom;
        editorElement.addEventListener('keydown', handleKeyDown);
        return () => {
            editorElement.removeEventListener('keydown', handleKeyDown);
        };
    }, [editor, onSave, onCancel, showEmojiPicker]);
    // Auto focus
    (0, react_1.useEffect)(() => {
        if (editor && autoFocus) {
            editor.commands.focus();
        }
    }, [editor, autoFocus]);
    if (!editor) {
        return null;
    }
    return ((0, jsx_runtime_1.jsxs)("div", { className: (0, utils_1.cn)("relative z-20", className), ref: editorRef, children: [(0, jsx_runtime_1.jsxs)("div", { className: "relative p-2 -m-2", children: [(0, jsx_runtime_1.jsx)(react_2.EditorContent, { editor: editor, className: "min-h-[100px]" }), (0, jsx_runtime_1.jsxs)("div", { className: "absolute top-0 right-0 flex gap-1 opacity-60 hover:opacity-100 transition-opacity", children: [(0, jsx_runtime_1.jsx)(button_1.Button, { size: "sm", variant: "ghost", className: "h-6 w-6 p-0 bg-white/90 hover:bg-white shadow-sm rounded", onClick: () => setShowEmojiPicker(!showEmojiPicker), title: "Insert Emoji (Press / to open)", children: (0, jsx_runtime_1.jsx)(lucide_react_1.Smile, { className: "h-3 w-3" }) }), (0, jsx_runtime_1.jsx)(button_1.Button, { size: "sm", variant: "ghost", className: "h-6 w-6 p-0 bg-white/90 hover:bg-white shadow-sm rounded", onClick: handleImageUpload, title: "Insert Image", children: (0, jsx_runtime_1.jsx)(lucide_react_1.ImageIcon, { className: "h-3 w-3" }) })] })] }), showEmojiPicker && ((0, jsx_runtime_1.jsx)(emoji_picker_1.EmojiPicker, { onEmojiSelect: handleEmojiSelect, onClose: handleEmojiPickerClose, query: emojiQuery, position: emojiPosition || undefined })), (0, jsx_runtime_1.jsxs)("div", { className: "flex justify-end gap-2 mt-2 pt-2 border-t border-border/30", children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { size: "sm", variant: "ghost", onClick: onCancel, className: "h-7 px-3 text-xs", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.X, { className: "h-3 w-3 mr-1" }), "Cancel"] }), (0, jsx_runtime_1.jsxs)(button_1.Button, { size: "sm", onClick: onSave, className: "h-7 px-3 text-xs", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Check, { className: "h-3 w-3 mr-1" }), "Accept"] })] }), editor && ((0, jsx_runtime_1.jsxs)("div", { className: "absolute top-0 right-0 text-xs text-muted-foreground bg-white/90 px-2 py-1 rounded shadow-sm opacity-0 hover:opacity-100 transition-opacity pointer-events-none z-10 max-w-xs", children: ["**bold** *italic* # heading - list ", '>', " quote `code` ~~strike~~ [link](url) [] task / emoji"] }))] }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcY29tcG9uZW50c1xcY2FyZFxccmljaC10ZXh0LWVkaXRvci50c3giLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkEsd0NBc1VDOztBQW5XRCwrQ0FBdUU7QUFDdkUseUNBQXdEO0FBQ3hELHNFQUE0QztBQUM1Qyw4RUFBMkM7QUFDM0MsMEZBQXVEO0FBQ3ZELHNGQUFrRDtBQUNsRCxzRkFBa0Q7QUFDbEQsNEVBQXlDO0FBQ3pDLHdGQUFxRDtBQUNyRCw0RUFBeUM7QUFDekMsd0ZBQW9EO0FBQ3BELGdGQUE2QztBQUM3Qyx5REFBNEM7QUFDNUMsbURBQStDO0FBQy9DLCtDQUF5RDtBQUN6RCx1Q0FBZ0M7QUFDaEMsaURBQTRDO0FBQzVDLCtCQUE0QjtBQVk1QixTQUFnQixjQUFjLENBQUMsRUFDN0IsT0FBTyxFQUNQLFdBQVcsR0FBRyxpQkFBaUIsRUFDL0IsUUFBUSxFQUNSLE1BQU0sRUFDTixRQUFRLEVBQ1IsU0FBUyxFQUNULFNBQVMsR0FBRyxLQUFLLEVBQ0c7SUFDcEIsTUFBTSxDQUFDLGVBQWUsRUFBRSxrQkFBa0IsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQTtJQUM3RCxNQUFNLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQTtJQUNoRCxNQUFNLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFrQyxJQUFJLENBQUMsQ0FBQTtJQUN6RixNQUFNLFNBQVMsR0FBRyxJQUFBLGNBQU0sRUFBaUIsSUFBSSxDQUFDLENBQUE7SUFFOUMsTUFBTSxNQUFNLEdBQUcsSUFBQSxpQkFBUyxFQUFDO1FBQ3ZCLFVBQVUsRUFBRTtZQUNWLHFCQUFVLENBQUMsU0FBUyxDQUFDO2dCQUNuQixzQkFBc0I7Z0JBQ3RCLE1BQU0s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SUFBSSxFQUNULE9BQU8sRUFBQyxPQUFPLEVBQ2YsT0FBTyxFQUFFLFFBQVEsRUFDakIsU0FBUyxFQUFDLGtCQUFrQixhQUU1Qix1QkFBQyxnQkFBQyxJQUFDLFNBQVMsRUFBQyxjQUFjLEdBQUcsY0FFdkIsRUFDVCx3QkFBQyxlQUFNLElBQ0wsSUFBSSxFQUFDLElBQUksRUFDVCxPQUFPLEVBQUUsTUFBTSxFQUNmLFNBQVMsRUFBQyxrQkFBa0IsYUFFNUIsdUJBQUMsb0JBQUssSUFBQyxTQUFTLEVBQUMsY0FBYyxHQUFHLGNBRTNCLElBQ0wsRUFHTCxNQUFNLElBQUksQ0FDVCxpQ0FBSyxTQUFTLEVBQUMsK0tBQStLLG9EQUN4SixHQUFHLDREQUNuQyxDQUNQLElBQ0csQ0FDUCxDQUFBO0FBQ0gsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXENhcmRFdmVyeXRoaW5nXFxjYXJkYWxsLXByb3RvdHlwZVxcc3JjXFxjb21wb25lbnRzXFxjYXJkXFxyaWNoLXRleHQtZWRpdG9yLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlU3RhdGUsIHVzZVJlZiB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgdXNlRWRpdG9yLCBFZGl0b3JDb250ZW50IH0gZnJvbSAnQHRpcHRhcC9yZWFjdCdcbmltcG9ydCBTdGFydGVyS2l0IGZyb20gJ0B0aXB0YXAvc3RhcnRlci1raXQnXG5pbXBvcnQgSW1hZ2UgZnJvbSAnQHRpcHRhcC9leHRlbnNpb24taW1hZ2UnXG5pbXBvcnQgUGxhY2Vob2xkZXIgZnJvbSAnQHRpcHRhcC9leHRlbnNpb24tcGxhY2Vob2xkZXInXG5pbXBvcnQgVGFza0xpc3QgZnJvbSAnQHRpcHRhcC9leHRlbnNpb24tdGFzay1saXN0J1xuaW1wb3J0IFRhc2tJdGVtIGZyb20gJ0B0aXB0YXAvZXh0ZW5zaW9uLXRhc2staXRlbSdcbmltcG9ydCBMaW5rIGZyb20gJ0B0aXB0YXAvZXh0ZW5zaW9uLWxpbmsnXG5pbXBvcnQgQmxvY2txdW90ZSBmcm9tICdAdGlwdGFwL2V4dGVuc2lvbi1ibG9ja3F1b3RlJ1xuaW1wb3J0IENvZGUgZnJvbSAnQHRpcHRhcC9leHRlbnNpb24tY29kZSdcbmltcG9ydCBDb2RlQmxvY2sgZnJvbSAnQHRpcHRhcC9leHRlbnNpb24tY29kZS1ibG9jaydcbmltcG9ydCBTdHJpa2UgZnJvbSAnQHRpcHRhcC9leHRlbnNpb24tc3RyaWtlJ1xuaW1wb3J0IHsgTWFya2Rvd24gfSBmcm9tICd0aXB0YXAtbWFya2Rvd24tMydcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9idXR0b24nXG5pbXBvcnQgeyBJbWFnZUljb24sIENoZWNrLCBYLCBTbWlsZSB9IGZyb20gJ2x1Y2lkZS1yZWFjdCdcbmltcG9ydCB7IGNuIH0gZnJvbSAnQC9saWIvdXRpbHMnXG5pbXBvcnQgeyBFbW9qaVBpY2tlciB9IGZyb20gJy4vZW1vamktcGlja2VyJ1xuaW1wb3J0ICcuL2VkaXRvci1zdHlsZXMuY3NzJ1xuXG5pbnRlcmZhY2UgUmljaFRleHRFZGl0b3JQcm9wcyB7XG4gIGNvbnRlbnQ6IHN0cmluZ1xuICBwbGFjZWhvbGRlcj86IHN0cmluZ1xuICBvblVwZGF0ZTogKGNvbnRlbnQ6IHN0cmluZykgPT4gdm9pZFxuICBvblNhdmU6ICgpID0+IHZvaWRcbiAgb25DYW5jZWw6ICgpID0+IHZvaWRcbiAgY2xhc3NOYW1lPzogc3RyaW5nXG4gIGF1dG9Gb2N1cz86IGJvb2xlYW5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFJpY2hUZXh0RWRpdG9yKHtcbiAgY29udGVudCxcbiAgcGxhY2Vob2xkZXIgPSBcIlN0YXJ0IHR5cGluZy4uLlwiLFxuICBvblVwZGF0ZSxcbiAgb25TYXZlLFxuICBvbkNhbmNlbCxcbiAgY2xhc3NOYW1lLFxuICBhdXRvRm9jdXMgPSBmYWxzZVxufTogUmljaFRleHRFZGl0b3JQcm9wcykge1xuICBjb25zdCBbc2hvd0Vtb2ppUGlja2VyLCBzZXRTaG93RW1vamlQaWNrZXJdID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IFtlbW9qaVF1ZXJ5LCBzZXRFbW9qaVF1ZXJ5XSA9IHVzZVN0YXRlKCcnKVxuICBjb25zdCBbZW1vamlQb3NpdGlvbiwgc2V0RW1vamlQb3NpdGlvbl0gPSB1c2VTdGF0ZTx7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0gfCBudWxsPihudWxsKVxuICBjb25zdCBlZGl0b3JSZWYgPSB1c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpXG5cbiAgY29uc3QgZWRpdG9yID0gdXNlRWRpdG9yKHtcbiAgICBleHRlbnNpb25zOiBbXG4gICAgICBTdGFydGVyS2l0LmNvbmZpZ3VyZSh7XG4gICAgICAgIC8vIOemgeeUqOm7mOiupOeahOS4gOS6m+aJqeWxle+8jOWboOS4uuaIkeS7rOimgeWNleeLrOmFjee9rlxuICAgICAgICBzdHJpa2U6IGZhbHNlLFxuICAgICAgICBjb2RlOiBmYWxzZSxcbiAgICAgICAgYmxvY2txdW90ZTogZmFsc2UsXG4gICAgICB9KSxcbiAgICAgIC8vIE1hcmtkb3duIOaUr+aMgVxuICAgICAgTWFya2Rvd24uY29uZmlndXJlKHtcbiAgICAgICAgaHRtbDogdHJ1ZSwgLy8g5YWB6K64SFRNTOi+k+WHulxuICAgICAgICB0cmFuc2Zvcm1QYXN0ZWRUZXh0OiB0cnVlLCAvLyDoh6rliqjovazmjaLnspjotLTnmoRNYXJrZG93blxuICAgICAgICB0cmFuc2Zvcm1Db3BpZWRUZXh0OiBmYWxzZSwgLy8g5aSN5Yi25pe25L+d5oyBSFRNTOagvOW8j1xuICAgICAgfSksXG4gICAgICAvLyDku7vliqHliJfooajmlK/mjIEgKOWkjemAieahhilcbiAgICAgIFRhc2tMaXN0LFxuICAgICAgVGFza0l0ZW0uY29uZmlndXJlKHtcbiAgICAgICAgbmVzdGVkOiB0cnVlLFxuICAgICAgfSksXG4gICAgICAvLyDpk77mjqXmlK/mjIFcbiAgICAgIExpbmsuY29uZmlndXJlKHtcbiAgICAgICAgb3Blbk9uQ2xpY2s6IGZhbHNlLCAvLyDlnKjnvJbovpHmqKHlvI/kuIvnpoHnlKjoh6rliqjmiZPlvIDvvIznlLHmiJHku6zmiYvliqjlpITnkIZcbiAgICAgICAgSFRNTEF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICBjbGFzczogJ3RleHQtYmx1ZS02MDAgdW5kZXJsaW5lIGhvdmVyOnRleHQtYmx1ZS04MDAgY3Vyc29yLXBvaW50ZXInLFxuICAgICAgICAgIHRhcmdldDogJ19ibGFuaycsIC8vIOaWsOeql+WPo+aJk+W8gFxuICAgICAgICAgIHJlbDogJ25vb3BlbmVyIG5vcmVmZXJyZXInLCAvLyDlronlhajmgKdcbiAgICAgICAgfSxcbiAgICAgICAgcHJvdG9jb2xzOiBbJ2h0dHAnLCAnaHR0cHMnLCAnZnRwJywgJ21haWx0byddLCAvLyDmlK/mjIHnmoTljY/orq5cbiAgICAgICAgdmFsaWRhdGU6IGhyZWYgPT4gL15odHRwcz86XFwvXFwvLy50ZXN0KGhyZWYpLCAvLyDpqozor4Hpk77mjqXmoLzlvI9cbiAgICAgIH0pLFxuICAgICAgLy8g5byV55So5Z2XXG4gICAgICBCbG9ja3F1b3RlLmNvbmZpZ3VyZSh7XG4gICAgICAgIEhUTUxBdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgY2xhc3M6ICdib3JkZXItbC00IGJvcmRlci1ncmF5LTMwMCBwbC00IGl0YWxpYycsXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICAgIC8vIOihjOWGheS7o+eggVxuICAgICAgQ29kZS5jb25maWd1cmUoe1xuICAgICAgICBIVE1MQXR0cmlidXRlczoge1xuICAgICAgICAgIGNsYXNzOiAnaW5saW5lLWNvZGUnLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgICAvLyDku6PnoIHlnZdcbiAgICAgIENvZGVCbG9jay5jb25maWd1cmUoe1xuICAgICAgICBIVE1MQXR0cmlidXRlczoge1xuICAgICAgICAgIGNsYXNzOiAnY29kZS1ibG9jaycsXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICAgIC8vIOWIoOmZpOe6v1xuICAgICAgU3RyaWtlLmNvbmZpZ3VyZSh7XG4gICAgICAgIEhUTUxBdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgY2xhc3M6ICdsaW5lLXRocm91Z2gnLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgICAvLyDlm77niYdcbiAgICAgIEltYWdlLmNvbmZpZ3VyZSh7XG4gICAgICAgIGlubGluZTogdHJ1ZSxcbiAgICAgICAgYWxsb3dCYXNlNjQ6IHRydWUsXG4gICAgICAgIEhUTUxBdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgY2xhc3M6ICdyb3VuZGVkLW1kIG1heC13LWZ1bGwgaC1hdXRvJyxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgLy8g5Y2g5L2N56ymXG4gICAgICBQbGFjZWhvbGRlci5jb25maWd1cmUoe1xuICAgICAgICBwbGFjZWhvbGRlcixcbiAgICAgIH0pLFxuICAgIF0sXG4gICAgY29udGVudCxcbiAgICBvblVwZGF0ZTogKHsgZWRpdG9yIH0pID0+IHtcbiAgICAgIG9uVXBkYXRlKGVkaXRvci5nZXRIVE1MKCkpXG4gICAgfSxcbiAgICBlZGl0b3JQcm9wczoge1xuICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICBjbGFzczogJ3RpcHRhcC1lZGl0b3IgdGV4dC1zbSBsZWFkaW5nLXJlbGF4ZWQgZm9jdXM6b3V0bGluZS1ub25lIG1pbi1oLVsxMDBweF0gdy1mdWxsJyxcbiAgICAgIH0sXG4gICAgICBoYW5kbGVLZXlEb3duOiAodmlldywgZXZlbnQpID0+IHtcbiAgICAgICAgLy8g5Y+q5pyJ5Zyo6KGM6aaW5oiW56m655m95aSE5oyJIFwiL1wiIOaJjeinpuWPkSBlbW9qaSDpgInmi6nlmahcbiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJy8nICYmICFzaG93RW1vamlQaWNrZXIpIHtcbiAgICAgICAgICBjb25zdCB7IHNlbGVjdGlvbiB9ID0gdmlldy5zdGF0ZVxuICAgICAgICAgIGNvbnN0IHsgZnJvbSB9ID0gc2VsZWN0aW9uXG4gICAgICAgICAgY29uc3QgJHBvcyA9IHZpZXcuc3RhdGUuZG9jLnJlc29sdmUoZnJvbSlcbiAgICAgICAgICBcbiAgICAgICAgICAvLyDmo4Dmn6XlhYnmoIfliY3nmoTmlofmnKzvvIzlpoLmnpzliY3pnaLmnInpnZ7nqbrnmb3lrZfnrKbvvIzliJnkuI3op6blj5FlbW9qaemAieaLqeWZqFxuICAgICAgICAgIGNvbnN0IHRleHRCZWZvcmUgPSAkcG9zLnBhcmVudC50ZXh0QmV0d2VlbigwLCAkcG9zLnBhcmVudE9mZnNldClcbiAgICAgICAgICBjb25zdCBpc0F0U3RhcnRPckFmdGVyU3BhY2UgPSAhdGV4dEJlZm9yZS50cmltKCkgfHwgdGV4dEJlZm9yZS5lbmRzV2l0aCgnICcpXG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGlzQXRTdGFydE9yQWZ0ZXJTcGFjZSkge1xuICAgICAgICAgICAgY29uc3QgY29vcmRzID0gdmlldy5jb29yZHNBdFBvcyhmcm9tKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBzZXRFbW9qaVBvc2l0aW9uKHtcbiAgICAgICAgICAgICAgeDogY29vcmRzLmxlZnQsXG4gICAgICAgICAgICAgIHk6IGNvb3Jkcy5ib3R0b20gKyA1XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgc2V0U2hvd0Vtb2ppUGlja2VyKHRydWUpXG4gICAgICAgICAgICBzZXRFbW9qaVF1ZXJ5KCcnKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyDpmLvmraLpu5jorqTnmoQgXCIvXCIg6L6T5YWlXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8g5aaC5p6cZW1vamnpgInmi6nlmajmiZPlvIDvvIzlpITnkIbmn6Xor6LovpPlhaVcbiAgICAgICAgaWYgKHNob3dFbW9qaVBpY2tlcikge1xuICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgICAgICBzZXRTaG93RW1vamlQaWNrZXIoZmFsc2UpXG4gICAgICAgICAgICBzZXRFbW9qaVF1ZXJ5KCcnKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0JhY2tzcGFjZScpIHtcbiAgICAgICAgICAgIGlmIChlbW9qaVF1ZXJ5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgc2V0RW1vamlRdWVyeShwcmV2ID0+IHByZXYuc2xpY2UoMCwgLTEpKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0U2hvd0Vtb2ppUGlja2VyKGZhbHNlKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8g5re75Yqg5a2X56ym5Yiw5p+l6K+iXG4gICAgICAgICAgaWYgKGV2ZW50LmtleS5sZW5ndGggPT09IDEgJiYgIWV2ZW50LmN0cmxLZXkgJiYgIWV2ZW50Lm1ldGFLZXkgJiYgZXZlbnQua2V5ICE9PSAnICcpIHtcbiAgICAgICAgICAgIHNldEVtb2ppUXVlcnkocHJldiA9PiBwcmV2ICsgZXZlbnQua2V5KVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8g56m65qC86ZSu6YCJ5oup56ys5LiA5LiqZW1vamnmiJblhbPpl63pgInmi6nlmahcbiAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnICcpIHtcbiAgICAgICAgICAgIHNldFNob3dFbW9qaVBpY2tlcihmYWxzZSlcbiAgICAgICAgICAgIHNldEVtb2ppUXVlcnkoJycpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG5cbiAgLy8gSGFuZGxlIGltYWdlIHVwbG9hZFxuICBjb25zdCBoYW5kbGVJbWFnZVVwbG9hZCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JylcbiAgICBpbnB1dC50eXBlID0gJ2ZpbGUnXG4gICAgaW5wdXQuYWNjZXB0ID0gJ2ltYWdlLyonXG4gICAgaW5wdXQub25jaGFuZ2UgPSAoZSkgPT4ge1xuICAgICAgY29uc3QgZmlsZSA9IChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS5maWxlcz8uWzBdXG4gICAgICBpZiAoZmlsZSAmJiBlZGl0b3IpIHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHtcbiAgICAgICAgICBjb25zdCBiYXNlNjQgPSBlLnRhcmdldD8ucmVzdWx0IGFzIHN0cmluZ1xuICAgICAgICAgIGVkaXRvci5jaGFpbigpLmZvY3VzKCkuc2V0SW1hZ2UoeyBzcmM6IGJhc2U2NCB9KS5ydW4oKVxuICAgICAgICB9XG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpXG4gICAgICB9XG4gICAgfVxuICAgIGlucHV0LmNsaWNrKClcbiAgfSwgW2VkaXRvcl0pXG5cbiAgLy8gSGFuZGxlIHBhc3RlIGltYWdlc1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICghZWRpdG9yKSByZXR1cm5cblxuICAgIGNvbnN0IGhhbmRsZVBhc3RlID0gKGV2ZW50OiBDbGlwYm9hcmRFdmVudCkgPT4ge1xuICAgICAgY29uc3QgaXRlbXMgPSBldmVudC5jbGlwYm9hcmREYXRhPy5pdGVtc1xuICAgICAgaWYgKCFpdGVtcykgcmV0dXJuXG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IGl0ZW1zW2ldXG4gICAgICAgIGlmIChpdGVtLnR5cGUuaW5kZXhPZignaW1hZ2UnKSAhPT0gLTEpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgY29uc3QgZmlsZSA9IGl0ZW0uZ2V0QXNGaWxlKClcbiAgICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGUudGFyZ2V0Py5yZXN1bHQgYXMgc3RyaW5nXG4gICAgICAgICAgICAgIGVkaXRvci5jaGFpbigpLmZvY3VzKCkuc2V0SW1hZ2UoeyBzcmM6IGJhc2U2NCB9KS5ydW4oKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBlZGl0b3JFbGVtZW50ID0gZWRpdG9yLnZpZXcuZG9tXG4gICAgZWRpdG9yRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdwYXN0ZScsIGhhbmRsZVBhc3RlKVxuICAgIFxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBlZGl0b3JFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgaGFuZGxlUGFzdGUpXG4gICAgfVxuICB9LCBbZWRpdG9yXSlcblxuICAvLyBIYW5kbGUgZW1vamkgc2VsZWN0aW9uXG4gIGNvbnN0IGhhbmRsZUVtb2ppU2VsZWN0ID0gdXNlQ2FsbGJhY2soKGVtb2ppOiBzdHJpbmcpID0+IHtcbiAgICBpZiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3IuY2hhaW4oKS5mb2N1cygpLmluc2VydENvbnRlbnQoZW1vamkpLnJ1bigpXG4gICAgfVxuICAgIHNldFNob3dFbW9qaVBpY2tlcihmYWxzZSlcbiAgICBzZXRFbW9qaVF1ZXJ5KCcnKVxuICB9LCBbZWRpdG9yXSlcblxuICAvLyBIYW5kbGUgZW1vamkgcGlja2VyIGNsb3NlXG4gIGNvbnN0IGhhbmRsZUVtb2ppUGlja2VyQ2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0U2hvd0Vtb2ppUGlja2VyKGZhbHNlKVxuICAgIHNldEVtb2ppUXVlcnkoJycpXG4gIH0sIFtdKVxuXG4gIC8vIEhhbmRsZSBrZXlib2FyZCBzaG9ydGN1dHNcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoIWVkaXRvcikgcmV0dXJuXG5cbiAgICBjb25zdCBoYW5kbGVLZXlEb3duID0gKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICBpZiAoc2hvd0Vtb2ppUGlja2VyKSB7XG4gICAgICAgICAgc2V0U2hvd0Vtb2ppUGlja2VyKGZhbHNlKVxuICAgICAgICAgIHNldEVtb2ppUXVlcnkoJycpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb25DYW5jZWwoKVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJyAmJiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSkge1xuICAgICAgICBvblNhdmUoKVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGVkaXRvckVsZW1lbnQgPSBlZGl0b3Iudmlldy5kb21cbiAgICBlZGl0b3JFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duKVxuICAgIFxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBlZGl0b3JFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duKVxuICAgIH1cbiAgfSwgW2VkaXRvciwgb25TYXZlLCBvbkNhbmNlbCwgc2hvd0Vtb2ppUGlja2VyXSlcblxuICAvLyBBdXRvIGZvY3VzXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGVkaXRvciAmJiBhdXRvRm9jdXMpIHtcbiAgICAgIGVkaXRvci5jb21tYW5kcy5mb2N1cygpXG4gICAgfVxuICB9LCBbZWRpdG9yLCBhdXRvRm9jdXNdKVxuXG4gIGlmICghZWRpdG9yKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9e2NuKFwicmVsYXRpdmUgei0yMFwiLCBjbGFzc05hbWUpfSByZWY9e2VkaXRvclJlZn0+XG4gICAgICB7LyogRWRpdG9yIENvbnRlbnQgKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInJlbGF0aXZlIHAtMiAtbS0yXCI+XG4gICAgICAgIDxFZGl0b3JDb250ZW50IFxuICAgICAgICAgIGVkaXRvcj17ZWRpdG9yfSBcbiAgICAgICAgICBjbGFzc05hbWU9XCJtaW4taC1bMTAwcHhdXCJcbiAgICAgICAgLz5cbiAgICAgICAgXG4gICAgICAgIHsvKiBGbG9hdGluZyBUb29sYmFyICovfVxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImFic29sdXRlIHRvcC0wIHJpZ2h0LTAgZmxleCBnYXAtMSBvcGFjaXR5LTYwIGhvdmVyOm9wYWNpdHktMTAwIHRyYW5zaXRpb24tb3BhY2l0eVwiPlxuICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgIHNpemU9XCJzbVwiXG4gICAgICAgICAgICB2YXJpYW50PVwiZ2hvc3RcIlxuICAgICAgICAgICAgY2xhc3NOYW1lPVwiaC02IHctNiBwLTAgYmctd2hpdGUvOTAgaG92ZXI6Ymctd2hpdGUgc2hhZG93LXNtIHJvdW5kZWRcIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0U2hvd0Vtb2ppUGlja2VyKCFzaG93RW1vamlQaWNrZXIpfVxuICAgICAgICAgICAgdGl0bGU9XCJJbnNlcnQgRW1vamkgKFByZXNzIC8gdG8gb3BlbilcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxTbWlsZSBjbGFzc05hbWU9XCJoLTMgdy0zXCIgLz5cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICBzaXplPVwic21cIlxuICAgICAgICAgICAgdmFyaWFudD1cImdob3N0XCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImgtNiB3LTYgcC0wIGJnLXdoaXRlLzkwIGhvdmVyOmJnLXdoaXRlIHNoYWRvdy1zbSByb3VuZGVkXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUltYWdlVXBsb2FkfVxuICAgICAgICAgICAgdGl0bGU9XCJJbnNlcnQgSW1hZ2VcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxJbWFnZUljb24gY2xhc3NOYW1lPVwiaC0zIHctM1wiIC8+XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIHsvKiBFbW9qaSBQaWNrZXIgKi99XG4gICAgICB7c2hvd0Vtb2ppUGlja2VyICYmIChcbiAgICAgICAgPEVtb2ppUGlja2VyXG4gICAgICAgICAgb25FbW9qaVNlbGVjdD17aGFuZGxlRW1vamlTZWxlY3R9XG4gICAgICAgICAgb25DbG9zZT17aGFuZGxlRW1vamlQaWNrZXJDbG9zZX1cbiAgICAgICAgICBxdWVyeT17ZW1vamlRdWVyeX1cbiAgICAgICAgICBwb3NpdGlvbj17ZW1vamlQb3NpdGlvbiB8fCB1bmRlZmluZWR9XG4gICAgICAgIC8+XG4gICAgICApfVxuXG4gICAgICB7LyogQWN0aW9uIEJ1dHRvbnMgKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXgganVzdGlmeS1lbmQgZ2FwLTIgbXQtMiBwdC0yIGJvcmRlci10IGJvcmRlci1ib3JkZXIvMzBcIj5cbiAgICAgICAgPEJ1dHRvblxuICAgICAgICAgIHNpemU9XCJzbVwiXG4gICAgICAgICAgdmFyaWFudD1cImdob3N0XCJcbiAgICAgICAgICBvbkNsaWNrPXtvbkNhbmNlbH1cbiAgICAgICAgICBjbGFzc05hbWU9XCJoLTcgcHgtMyB0ZXh0LXhzXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxYIGNsYXNzTmFtZT1cImgtMyB3LTMgbXItMVwiIC8+XG4gICAgICAgICAgQ2FuY2VsXG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgc2l6ZT1cInNtXCJcbiAgICAgICAgICBvbkNsaWNrPXtvblNhdmV9XG4gICAgICAgICAgY2xhc3NOYW1lPVwiaC03IHB4LTMgdGV4dC14c1wiXG4gICAgICAgID5cbiAgICAgICAgICA8Q2hlY2sgY2xhc3NOYW1lPVwiaC0zIHctMyBtci0xXCIgLz5cbiAgICAgICAgICBBY2NlcHRcbiAgICAgICAgPC9CdXR0b24+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIE1hcmtkb3duIEhlbHAgVG9vbHRpcCAtIOenu+WIsOWPs+S4iuinku+8jOmBv+WFjemBruaMoeaMiemSriAqL31cbiAgICAgIHtlZGl0b3IgJiYgKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImFic29sdXRlIHRvcC0wIHJpZ2h0LTAgdGV4dC14cyB0ZXh0LW11dGVkLWZvcmVncm91bmQgYmctd2hpdGUvOTAgcHgtMiBweS0xIHJvdW5kZWQgc2hhZG93LXNtIG9wYWNpdHktMCBob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkgcG9pbnRlci1ldmVudHMtbm9uZSB6LTEwIG1heC13LXhzXCI+XG4gICAgICAgICAgKipib2xkKiogKml0YWxpYyogIyBoZWFkaW5nIC0gbGlzdCB7Jz4nfSBxdW90ZSBgY29kZWAgfn5zdHJpa2V+fiBbbGlua10odXJsKSBbXSB0YXNrIC8gZW1vamlcbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuICAgIDwvZGl2PlxuICApXG59Il0sInZlcnNpb24iOjN9