7c7a50b7e971ed68d476e4f27a98bba4
"use strict";
/**
 * 高性能查询优化器
 * 实现智能查询优化和索引管理
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.queryOptimizer = exports.QueryOptimizer = void 0;
const database_unified_1 = require("../services/database-unified");
// ============================================================================
// 智能查询优化器
// ============================================================================
class QueryOptimizer {
    constructor() {
        Object.defineProperty(this, "indexStats", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Map()
        });
        Object.defineProperty(this, "queryMetrics", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Map()
        });
        Object.defineProperty(this, "ANALYSIS_THRESHOLD", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 100
        }); // 分析阈值
    }
    /**
     * 优化卡片查询
     */
    async optimizeCardsQuery(query) {
        const startTime = performance.now();
        // 1. 分析查询模式
        const analysis = this.analyzeQueryPattern(query);
        // 2. 生成查询计划
        const plan = this.generateQueryPlan(analysis);
        // 3. 构建优化查询
        const optimizedQuery = this.buildOptimizedQuery(plan, query);
        // 4. 估算结果数量
        const estimatedRows = await this.estimateResultCount(plan, query);
        // 5. 记录分析数据
        this.recordQueryAnalysis(analysis, plan, performance.now() - startTime);
        return {
            query: optimizedQuery,
            plan,
            estimatedRows
        };
    }
    /**
     * 分析查询模式
     */
    analyzeQueryPattern(query) {
        const analysis = {
            hasUserId: !!query.userId,
            hasFolderId: !!query.folderId,
            hasSearch: !!query.search,
            hasTags: !!query.tags?.length,
            hasSort: !!query.sortBy,
            hasPagination: !!(query.limit || query.offset),
            selectivity: this.calculateSelectivity(query),
            complexity: this.calculateComplexity(query)
        };
        return analysis;
    }
    /**
     * 计算查询选择性
     */
    calculateSelectivity(query) {
        let selectivity = 1.0;
        // 用户ID过滤 - 高选择性
        if (query.userId)
            selectivity *= 0.1;
        // 文件夹ID过滤 - 中等选择性
        if (query.folderId)
            selectivity *= 0.3;
        // 搜索过滤 - 低选择性
        if (query.search)
            selectivity *= 0.7;
        // 标签过滤 - 中等选择性
        if (query.tags?.length)
            selectivity *= 0.5;
        return Math.max(selectivity, 0.01); // 最小选择性
    }
    /**
     * 计算查询复杂度
     */
    calculateComplexity(query) {
        let complexity = 0;
        if (query.userId)
            complexity += 1;
        if (query.folderId)
            complexity += 1;
        if (query.search)
            complexity += 3; // 搜索较复杂
        if (query.tags?.length)
            complexity += query.tags.length * 0.5;
        if (query.sortBy)
            complexity += 1;
        if (query.limit || query.offset)
            complexity += 0.5;
        return complexity;
    }
    /**
     * 生成查询计划
     */
    generateQueryPlan(analysis) {
        const plan = {
            estimatedCost: 0,
            indexes: [],
            filterOrder: [],
            limitStrategy: 'offset',
            cacheKey: '',
            cacheTTL: 30000
        };
        // 选择最佳索引
        plan.indexes = this.selectBestIndexes(analysis);
        // 确定过滤顺序
        plan.filterOrder = this.determineFilterOrder(analysis);
        // 选择分页策略
        plan.limitStrategy = this.selectPaginationStrategy(analysis);
        // 计算预估成本
        plan.estimatedCost = this.calculateEstimatedCost(plan, analysis);
        // 生成缓存键
        plan.cacheKey = this.generateCacheKey(analysis);
        // 动态调整TTL
        plan.cacheTTL = this.calculateCacheTTL(analysis);
        return plan;
    }
    /**
     * 选择最佳索引
     */
    selectBestIndexes(analysis) {
        const indexes = [];
        // 基于查询模式选择索引
        if (analysis.hasUserId && analysis.hasFolderId) {
            indexes.push('[userId+folderId+updatedAt]');
        }
        else if (analysis.hasUserId) {
            indexes.push('[userId+createdAt]');
        }
        // 搜索使用专用索引
        if (analysis.hasSearch) {
            indexes.push('[searchVector+userId]');
        }
        // 标签查询
        if (analysis.hasTags) {
            indexes.push('userId'); // 标签查询需要用户ID过滤
        }
        // 排序索引
        if (analysis.hasSort) {
            indexes.push('updatedAt');
        }
        return indexes;
    }
    /**
     * 确定过滤顺序
     */
    determineFilterOrder(analysis) {
        const order = [];
        // 按选择性排序
        if (analysis.hasUserId)
            order.push('userId');
        if (analysis.hasFolderId)
            order.push('folderId');
        if (analysis.hasTags)
            order.push('tags');
        if (analysis.hasSearch)
            order.push('search');
        return order;
    }
    /**
     * 选择分页策略
     */
    selectPaginationStrategy(analysis) {
        // 大数据量使用游标分页
        if (analysis.selectivity < 0.1) {
            return 'cursor';
        }
        return 'offset';
    }
    /**
     * 计算预估成本
     */
    calculateEstimatedCost(plan, analysis) {
        let cost = 0;
        // 基础成本
        cost += analysis.complexity * 10;
        // 索引使用成本
        plan.indexes.forEach(index => {
            const stats = this.indexStats.get(index);
            if (stats) {
                cost += (1 - stats.avgSelectivity) * 50;
            }
            else {
                cost += 25; // 新索引的估算成本
            }
        });
        // 搜索成本
        if (analysis.hasSearch) {
            cost += 100;
        }
        return cost;
    }
    /**
     * 生成缓存键
     */
    generateCacheKey(analysis) {
        const keyParts = [
            analysis.hasUserId ? 'user' : 'no-user',
            analysis.hasFolderId ? 'folder' : 'no-folder',
            analysis.hasSearch ? 'search' : 'no-search',
            analysis.hasTags ? 'tags' : 'no-tags',
            analysis.hasSort ? 'sort' : 'no-sort'
        ];
        return keyParts.join('-');
    }
    /**
     * 计算缓存TTL
     */
    calculateCacheTTL(analysis) {
        let ttl = 30000; // 默认30秒
        // 高选择性查询缓存更久
        if (analysis.selectivity < 0.1) {
            ttl *= 2;
        }
        // 简单查询缓存更久
        if (analysis.complexity < 3) {
            ttl *= 1.5;
        }
        // 搜索查询缓存较短
        if (analysis.hasSearch) {
            ttl *= 0.5;
        }
        return Math.min(ttl, 300000); // 最大5分钟
    }
    /**
     * 构建优化查询
     */
    buildOptimizedQuery(plan, originalQuery) {
        let query = database_unified_1.db.cards;
        // 应用过滤条件（按优化顺序）
        if (originalQuery.userId) {
            query = query.where('userId').equals(originalQuery.userId);
        }
        if (originalQuery.folderId) {
            query = query.and(card => card.folderId === originalQuery.folderId);
        }
        // 应用搜索过滤
        if (originalQuery.search) {
            query = query.filter(card => {
                const searchTerm = originalQuery.search.toLowerCase();
                return card.searchVector?.includes(searchTerm) || false;
            });
        }
        // 应用标签过滤
        if (originalQuery.tags?.length) {
            query = query.filter(card => {
                const cardTags = [...card.frontContent.tags, ...card.backContent.tags];
                return originalQuery.tags.some((tag) => cardTags.includes(tag));
            });
        }
        // 应用排序
        if (originalQuery.sortBy) {
            const sortField = this.getSortField(originalQuery.sortBy);
            if (sortField) {
                query = query.sortBy(sortField);
                if (originalQuery.sortOrder === 'desc') {
                    query = query.reverse();
                }
            }
        }
        else {
            // 默认按更新时间排序
            query = query.orderBy('updatedAt').reverse();
        }
        // 应用分页
        if (originalQuery.limit) {
            query = query.limit(originalQuery.limit);
        }
        if (originalQuery.offset) {
            query = query.offset(originalQuery.offset);
        }
        return query;
    }
    /**
     * 获取排序字段
     */
    getSortField(sortBy) {
        const fieldMap = {
            'title': 'frontContent.title',
            'created': 'createdAt',
            'updated': 'updatedAt',
            'sync': 'syncVersion'
        };
        return fieldMap[sortBy] || null;
    }
    /**
     * 估算结果数量
     */
    async estimateResultCount(plan, query) {
        try {
            // 使用索引统计估算
            let estimatedCount = await database_unified_1.db.cards.count();
            // 应用选择性估算
            estimatedCount *= this.calculateSelectivity(query);
            return Math.round(estimatedCount);
        }
        catch (error) {
            // 保守估算
            return query.limit || 50;
        }
    }
    /**
     * 记录查询分析
     */
    recordQueryAnalysis(analysis, plan, optimizationTime) {
        // 记录索引使用统计
        plan.indexes.forEach(index => {
            let stats = this.indexStats.get(index);
            if (!stats) {
                stats = {
                    name: index,
                    hits: 0,
                    misses: 0,
                    avgSelectivity: 0.5,
                    lastOptimized: new Date()
                };
                this.indexStats.set(index, stats);
            }
            stats.hits++;
        });
        // 记录查询模式用于学习
        const patternKey = this.generateCacheKey(analysis);
        let metrics = this.queryMetrics.get(patternKey) || [];
        metrics.push({
            executionTime: optimizationTime,
            rowsReturned: 0,
            indexesUsed: plan.indexes,
            cacheHit: false
        });
        // 保持最近100次查询
        if (metrics.length > 100) {
            metrics = metrics.slice(-100);
        }
        this.queryMetrics.set(patternKey, metrics);
    }
    /**
     * 获取索引统计信息
     */
    getIndexStats() {
        return Array.from(this.indexStats.values());
    }
    /**
     * 获取查询性能报告
     */
    getPerformanceReport() {
        const totalQueries = Array.from(this.queryMetrics.values())
            .reduce((sum, metrics) => sum + metrics.length, 0);
        const avgOptimizationTime = Array.from(this.queryMetrics.values())
            .flat()
            .reduce((sum, metric) => sum + metric.executionTime, 0) / totalQueries;
        const indexUsage = Array.from(this.indexStats.entries())
            .sort((a, b) => b[1].hits - a[1].hits);
        const mostUsedIndexes = indexUsage.slice(0, 5).map(([name]) => name);
        const recommendations = this.generateRecommendations();
        return {
            totalQueries,
            avgOptimizationTime,
            mostUsedIndexes,
            recommendations
        };
    }
    /**
     * 生成优化建议
     */
    generateRecommendations() {
        const recommendations = [];
        // 分析索引使用情况
        const underusedIndexes = Array.from(this.indexStats.entries())
            .filter(([_, stats]) => stats.hits < 10)
            .map(([name]) => name);
        if (underusedIndexes.length > 0) {
            recommendations.push(`考虑删除低使用率索引: ${underusedIndexes.join(', ')}`);
        }
        // 分析查询模式
        const slowQueries = Array.from(this.queryMetrics.entries())
            .filter(([_, metrics]) => {
            const avgTime = metrics.reduce((sum, m) => sum + m.executionTime, 0) / metrics.length;
            return avgTime > 50;
        });
        if (slowQueries.length > 0) {
            recommendations.push(`发现 ${slowQueries.length} 个慢查询模式，建议优化`);
        }
        return recommendations;
    }
    /**
     * 清理统计数据
     */
    cleanup() {
        // 清理旧的统计数据
        const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
        for (const [key, metrics] of this.queryMetrics.entries()) {
            const recentMetrics = metrics.filter(m => m.executionTime > oneWeekAgo.getTime());
            if (recentMetrics.length === 0) {
                this.queryMetrics.delete(key);
            }
            else {
                this.queryMetrics.set(key, recentMetrics);
            }
        }
    }
}
exports.QueryOptimizer = QueryOptimizer;
// ============================================================================
// 导出单例实例
// ============================================================================
exports.queryOptimizer = new QueryOptimizer();
// ============================================================================
// 定期清理统计
// ============================================================================
setInterval(() => {
    exports.queryOptimizer.cleanup();
}, 24 * 60 * 60 * 1000); // 每天清理一次
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcdXRpbHNcXHF1ZXJ5LW9wdGltaXplci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFFSCxtRUFBeUY7QUErQnpGLCtFQUErRTtBQUMvRSxVQUFVO0FBQ1YsK0VBQStFO0FBRS9FLE1BQWEsY0FBYztJQUEzQjtRQUNVOzs7O21CQUFhLElBQUksR0FBRyxFQUFzQjtXQUFBO1FBQzFDOzs7O21CQUFlLElBQUksR0FBRyxFQUEwQjtXQUFBO1FBQ3ZDOzs7O21CQUFxQixHQUFHO1dBQUEsQ0FBQyxPQUFPO0lBb2RuRCxDQUFDO0lBbGRDOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGtCQUFrQixDQUFDLEtBU3hCO1FBS0MsTUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBRW5DLFlBQVk7UUFDWixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFaEQsWUFBWTtRQUNaLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUU3QyxZQUFZO1FBQ1osTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUU1RCxZQUFZO1FBQ1osTUFBTSxhQUFhLEdBQUcsTUFBTSxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBRWpFLFlBQVk7UUFDWixJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUE7UUFFdkUsT0FBTztZQUNMLEtBQUssRUFBRSxjQUFjO1lBQ3JCLElBQUk7WUFDSixhQUFhO1NBQ2QsQ0FBQTtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLG1CQUFtQixDQUFDLEtBQVU7UUFD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QkFDL0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDL0IsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUMsQ0FBQTtZQUMzQyxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7Q0FDRjtBQXZkRCx3Q0F1ZEM7QUFFRCwrRUFBK0U7QUFDL0UsU0FBUztBQUNULCtFQUErRTtBQUVsRSxRQUFBLGNBQWMsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFBO0FBRWxELCtFQUErRTtBQUMvRSxTQUFTO0FBQ1QsK0VBQStFO0FBRS9FLFdBQVcsQ0FBQyxHQUFHLEVBQUU7SUFDZixzQkFBYyxDQUFDLE9BQU8sRUFBRSxDQUFBO0FBQzFCLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQSxDQUFDLFNBQVMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcdXRpbHNcXHF1ZXJ5LW9wdGltaXplci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog6auY5oCn6IO95p+l6K+i5LyY5YyW5ZmoXHJcbiAqIOWunueOsOaZuuiDveafpeivouS8mOWMluWSjOe0ouW8leeuoeeQhlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGRiLCB0eXBlIERiQ2FyZCwgdHlwZSBEYkZvbGRlciwgdHlwZSBEYlRhZyB9IGZyb20gJy4uL3NlcnZpY2VzL2RhdGFiYXNlLXVuaWZpZWQnXHJcbmltcG9ydCBEZXhpZSwgeyBUYWJsZSB9IGZyb20gJ2RleGllJ1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDnsbvlnovlrprkuYlcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuaW50ZXJmYWNlIFF1ZXJ5UGxhbiB7XHJcbiAgZXN0aW1hdGVkQ29zdDogbnVtYmVyXHJcbiAgaW5kZXhlczogc3RyaW5nW11cclxuICBmaWx0ZXJPcmRlcjogc3RyaW5nW11cclxuICBsaW1pdFN0cmF0ZWd5OiAnb2Zmc2V0JyB8ICdjdXJzb3InXHJcbiAgY2FjaGVLZXk6IHN0cmluZ1xyXG4gIGNhY2hlVFRMOiBudW1iZXJcclxufVxyXG5cclxuaW50ZXJmYWNlIFF1ZXJ5TWV0cmljcyB7XHJcbiAgZXhlY3V0aW9uVGltZTogbnVtYmVyXHJcbiAgcm93c1JldHVybmVkOiBudW1iZXJcclxuICBpbmRleGVzVXNlZDogc3RyaW5nW11cclxuICBjYWNoZUhpdDogYm9vbGVhblxyXG59XHJcblxyXG5pbnRlcmZhY2UgSW5kZXhTdGF0cyB7XHJcbiAgbmFtZTogc3RyaW5nXHJcbiAgaGl0czogbnVtYmVyXHJcbiAgbWlzc2VzOiBudW1iZXJcclxuICBhdmdTZWxlY3Rpdml0eTogbnVtYmVyXHJcbiAgbGFzdE9wdGltaXplZDogRGF0ZVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIOaZuuiDveafpeivouS8mOWMluWZqFxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgY2xhc3MgUXVlcnlPcHRpbWl6ZXIge1xyXG4gIHByaXZhdGUgaW5kZXhTdGF0cyA9IG5ldyBNYXA8c3RyaW5nLCBJbmRleFN0YXRzPigpXHJcbiAgcHJpdmF0ZSBxdWVyeU1ldHJpY3MgPSBuZXcgTWFwPHN0cmluZywgUXVlcnlNZXRyaWNzW10+KClcclxuICBwcml2YXRlIHJlYWRvbmx5IEFOQUxZU0lTX1RIUkVTSE9MRCA9IDEwMCAvLyDliIbmnpDpmIjlgLxcclxuXHJcbiAgLyoqXHJcbiAgICog5LyY5YyW5Y2h54mH5p+l6K+iXHJcbiAgICovXHJcbiAgYXN5bmMgb3B0aW1pemVDYXJkc1F1ZXJ5KHF1ZXJ5OiB7XHJcbiAgICB1c2VySWQ/OiBzdHJpbmdcclxuICAgIGZvbGRlcklkPzogc3RyaW5nXHJcbiAgICBsaW1pdD86IG51bWJlclxyXG4gICAgb2Zmc2V0PzogbnVtYmVyXHJcbiAgICBzb3J0Qnk/OiBzdHJpbmdcclxuICAgIHNvcnRPcmRlcj86ICdhc2MnIHwgJ2Rlc2MnXHJcbiAgICBzZWFyY2g/OiBzdHJpbmdcclxuICAgIHRhZ3M/OiBzdHJpbmdbXVxyXG4gIH0pOiBQcm9taXNlPHtcclxuICAgIHF1ZXJ5OiBEZXhpZS5RdWVyeTxEYkNhcmQsIGFueT5cclxuICAgIHBsYW46IFF1ZXJ5UGxhblxyXG4gICAgZXN0aW1hdGVkUm93czogbnVtYmVyXHJcbiAgfT4ge1xyXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KClcclxuICAgIFxyXG4gICAgLy8gMS4g5YiG5p6Q5p+l6K+i5qih5byPXHJcbiAgICBjb25zdCBhbmFseXNpcyA9IHRoaXMuYW5hbHl6ZVF1ZXJ5UGF0dGVybihxdWVyeSlcclxuICAgIFxyXG4gICAgLy8gMi4g55Sf5oiQ5p+l6K+i6K6h5YiSXHJcbiAgICBjb25zdCBwbGFuID0gdGhpcy5nZW5lcmF0ZVF1ZXJ5UGxhbihhbmFseXNpcylcclxuICAgIFxyXG4gICAgLy8gMy4g5p6E5bu65LyY5YyW5p+l6K+iXHJcbiAgICBjb25zdCBvcHRpbWl6ZWRRdWVyeSA9IHRoaXMuYnVpbGRPcHRpbWl6ZWRRdWVyeShwbGFuLCBxdWVyeSlcclxuICAgIFxyXG4gICAgLy8gNC4g5Lyw566X57uT5p6c5pWw6YePXHJcbiAgICBjb25zdCBlc3RpbWF0ZWRSb3dzID0gYXdhaXQgdGhpcy5lc3RpbWF0ZVJlc3VsdENvdW50KHBsYW4sIHF1ZXJ5KVxyXG4gICAgXHJcbiAgICAvLyA1LiDorrDlvZXliIbmnpDmlbDmja5cclxuICAgIHRoaXMucmVjb3JkUXVlcnlBbmFseXNpcyhhbmFseXNpcywgcGxhbiwgcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUpXHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHF1ZXJ5OiBvcHRpbWl6ZWRRdWVyeSxcclxuICAgICAgcGxhbixcclxuICAgICAgZXN0aW1hdGVkUm93c1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YiG5p6Q5p+l6K+i5qih5byPXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhbmFseXplUXVlcnlQYXR0ZXJuKHF1ZXJ5OiBhbnkpOiBhbnkge1xyXG4gICAgY29uc3QgYW5hbHlzaXMgPSB7XHJcbiAgICAgIGhhc1VzZXJJZDogISFxdWVyeS51c2VySWQsXHJcbiAgICAgIGhhc0ZvbGRlcklkOiAhIXF1ZXJ5LmZvbGRlcklkLFxyXG4gICAgICBoYXNTZWFyY2g6ICEhcXVlcnkuc2VhcmNoLFxyXG4gICAgICBoYXNUYWdzOiAhIXF1ZXJ5LnRhZ3M/Lmxlbmd0aCxcclxuICAgICAgaGFzU29ydDogISFxdWVyeS5zb3J0QnksXHJcbiAgICAgIGhhc1BhZ2luYXRpb246ICEhKHF1ZXJ5LmxpbWl0IHx8IHF1ZXJ5Lm9mZnNldCksXHJcbiAgICAgIHNlbGVjdGl2aXR5OiB0aGlzLmNhbGN1bGF0ZVNlbGVjdGl2aXR5KHF1ZXJ5KSxcclxuICAgICAgY29tcGxleGl0eTogdGhpcy5jYWxjdWxhdGVDb21wbGV4aXR5KHF1ZXJ5KVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gYW5hbHlzaXNcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuoeeul+afpeivoumAieaLqeaAp1xyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlU2VsZWN0aXZpdHkocXVlcnk6IGFueSk6IG51bWJlciB7XHJcbiAgICBsZXQgc2VsZWN0aXZpdHkgPSAxLjBcclxuICAgIFxyXG4gICAgLy8g55So5oi3SUTov4fmu6QgLSDpq5jpgInmi6nmgKdcclxuICAgIGlmIChxdWVyeS51c2VySWQpIHNlbGVjdGl2aXR5ICo9IDAuMVxyXG4gICAgXHJcbiAgICAvLyDmlofku7blpLlJROi/h+a7pCAtIOS4reetiemAieaLqeaAp1xyXG4gICAgaWYgKHF1ZXJ5LmZvbGRlcklkKSBzZWxlY3Rpdml0eSAqPSAwLjNcclxuICAgIFxyXG4gICAgLy8g5pCc57Si6L+H5rukIC0g5L2O6YCJ5oup5oCnXHJcbiAgICBpZiAocXVlcnkuc2VhcmNoKSBzZWxlY3Rpdml0eSAqPSAwLjdcclxuICAgIFxyXG4gICAgLy8g5qCH562+6L+H5rukIC0g5Lit562J6YCJ5oup5oCnXHJcbiAgICBpZiAocXVlcnkudGFncz8ubGVuZ3RoKSBzZWxlY3Rpdml0eSAqPSAwLjVcclxuICAgIFxyXG4gICAgcmV0dXJuIE1hdGgubWF4KHNlbGVjdGl2aXR5LCAwLjAxKSAvLyDmnIDlsI/pgInmi6nmgKdcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuoeeul+afpeivouWkjeadguW6plxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29tcGxleGl0eShxdWVyeTogYW55KTogbnVtYmVyIHtcclxuICAgIGxldCBjb21wbGV4aXR5ID0gMFxyXG4gICAgXHJcbiAgICBpZiAocXVlcnkudXNlcklkKSBjb21wbGV4aXR5ICs9IDFcclxuICAgIGlmIChxdWVyeS5mb2xkZXJJZCkgY29tcGxleGl0eSArPSAxXHJcbiAgICBpZiAocXVlcnkuc2VhcmNoKSBjb21wbGV4aXR5ICs9IDMgLy8g5pCc57Si6L6D5aSN5p2CXHJcbiAgICBpZiAocXVlcnkudGFncz8ubGVuZ3RoKSBjb21wbGV4aXR5ICs9IHF1ZXJ5LnRhZ3MubGVuZ3RoICogMC41XHJcbiAgICBpZiAocXVlcnkuc29ydEJ5KSBjb21wbGV4aXR5ICs9IDFcclxuICAgIGlmIChxdWVyeS5saW1pdCB8fCBxdWVyeS5vZmZzZXQpIGNvbXBsZXhpdHkgKz0gMC41XHJcbiAgICBcclxuICAgIHJldHVybiBjb21wbGV4aXR5XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnlJ/miJDmn6Xor6LorqHliJJcclxuICAgKi9cclxuICBwcml2YXRlIGdlbmVyYXRlUXVlcnlQbGFuKGFuYWx5c2lzOiBhbnkpOiBRdWVyeVBsYW4ge1xyXG4gICAgY29uc3QgcGxhbjogUXVlcnlQbGFuID0ge1xyXG4gICAgICBlc3RpbWF0ZWRDb3N0OiAwLFxyXG4gICAgICBpbmRleGVzOiBbXSxcclxuICAgICAgZmlsdGVyT3JkZXI6IFtdLFxyXG4gICAgICBsaW1pdFN0cmF0ZWd5OiAnb2Zmc2V0JyxcclxuICAgICAgY2FjaGVLZXk6ICcnLFxyXG4gICAgICBjYWNoZVRUTDogMzAwMDBcclxuICAgIH1cclxuXHJcbiAgICAvLyDpgInmi6nmnIDkvbPntKLlvJVcclxuICAgIHBsYW4uaW5kZXhlcyA9IHRoaXMuc2VsZWN0QmVzdEluZGV4ZXMoYW5hbHlzaXMpXHJcbiAgICBcclxuICAgIC8vIOehruWumui/h+a7pOmhuuW6j1xyXG4gICAgcGxhbi5maWx0ZXJPcmRlciA9IHRoaXMuZGV0ZXJtaW5lRmlsdGVyT3JkZXIoYW5hbHlzaXMpXHJcbiAgICBcclxuICAgIC8vIOmAieaLqeWIhumhteetlueVpVxyXG4gICAgcGxhbi5saW1pdFN0cmF0ZWd5ID0gdGhpcy5zZWxlY3RQYWdpbmF0aW9uU3RyYXRlZ3koYW5hbHlzaXMpXHJcbiAgICBcclxuICAgIC8vIOiuoeeul+mihOS8sOaIkOacrFxyXG4gICAgcGxhbi5lc3RpbWF0ZWRDb3N0ID0gdGhpcy5jYWxjdWxhdGVFc3RpbWF0ZWRDb3N0KHBsYW4sIGFuYWx5c2lzKVxyXG4gICAgXHJcbiAgICAvLyDnlJ/miJDnvJPlrZjplK5cclxuICAgIHBsYW4uY2FjaGVLZXkgPSB0aGlzLmdlbmVyYXRlQ2FjaGVLZXkoYW5hbHlzaXMpXHJcbiAgICBcclxuICAgIC8vIOWKqOaAgeiwg+aVtFRUTFxyXG4gICAgcGxhbi5jYWNoZVRUTCA9IHRoaXMuY2FsY3VsYXRlQ2FjaGVUVEwoYW5hbHlzaXMpXHJcbiAgICBcclxuICAgIHJldHVybiBwbGFuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpgInmi6nmnIDkvbPntKLlvJVcclxuICAgKi9cclxuICBwcml2YXRlIHNlbGVjdEJlc3RJbmRleGVzKGFuYWx5c2lzOiBhbnkpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBpbmRleGVzOiBzdHJpbmdbXSA9IFtdXHJcbiAgICBcclxuICAgIC8vIOWfuuS6juafpeivouaooeW8j+mAieaLqee0ouW8lVxyXG4gICAgaWYgKGFuYWx5c2lzLmhhc1VzZXJJZCAmJiBhbmFseXNpcy5oYXNGb2xkZXJJZCkge1xyXG4gICAgICBpbmRleGVzLnB1c2goJ1t1c2VySWQrZm9sZGVySWQrdXBkYXRlZEF0XScpXHJcbiAgICB9IGVsc2UgaWYgKGFuYWx5c2lzLmhhc1VzZXJJZCkge1xyXG4gICAgICBpbmRleGVzLnB1c2goJ1t1c2VySWQrY3JlYXRlZEF0XScpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOaQnOe0ouS9v+eUqOS4k+eUqOe0ouW8lVxyXG4gICAgaWYgKGFuYWx5c2lzLmhhc1NlYXJjaCkge1xyXG4gICAgICBpbmRleGVzLnB1c2goJ1tzZWFyY2hWZWN0b3IrdXNlcklkXScpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOagh+etvuafpeivolxyXG4gICAgaWYgKGFuYWx5c2lzLmhhc1RhZ3MpIHtcclxuICAgICAgaW5kZXhlcy5wdXNoKCd1c2VySWQnKSAvLyDmoIfnrb7mn6Xor6LpnIDopoHnlKjmiLdJROi/h+a7pFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDmjpLluo/ntKLlvJVcclxuICAgIGlmIChhbmFseXNpcy5oYXNTb3J0KSB7XHJcbiAgICAgIGluZGV4ZXMucHVzaCgndXBkYXRlZEF0JylcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGluZGV4ZXNcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOehruWumui/h+a7pOmhuuW6j1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGV0ZXJtaW5lRmlsdGVyT3JkZXIoYW5hbHlzaXM6IGFueSk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IG9yZGVyOiBzdHJpbmdbXSA9IFtdXHJcbiAgICBcclxuICAgIC8vIOaMiemAieaLqeaAp+aOkuW6j1xyXG4gICAgaWYgKGFuYWx5c2lzLmhhc1VzZXJJZCkgb3JkZXIucHVzaCgndXNlcklkJylcclxuICAgIGlmIChhbmFseXNpcy5oYXNGb2xkZXJJZCkgb3JkZXIucHVzaCgnZm9sZGVySWQnKVxyXG4gICAgaWYgKGFuYWx5c2lzLmhhc1RhZ3MpIG9yZGVyLnB1c2goJ3RhZ3MnKVxyXG4gICAgaWYgKGFuYWx5c2lzLmhhc1NlYXJjaCkgb3JkZXIucHVzaCgnc2VhcmNoJylcclxuICAgIFxyXG4gICAgcmV0dXJuIG9yZGVyXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpgInmi6nliIbpobXnrZbnlaVcclxuICAgKi9cclxuICBwcml2YXRlIHNlbGVjdFBhZ2luYXRpb25TdHJhdGVneShhbmFseXNpczogYW55KTogJ29mZnNldCcgfCAnY3Vyc29yJyB7XHJcbiAgICAvLyDlpKfmlbDmja7ph4/kvb/nlKjmuLjmoIfliIbpobVcclxuICAgIGlmIChhbmFseXNpcy5zZWxlY3Rpdml0eSA8IDAuMSkge1xyXG4gICAgICByZXR1cm4gJ2N1cnNvcidcclxuICAgIH1cclxuICAgIHJldHVybiAnb2Zmc2V0J1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6h566X6aKE5Lyw5oiQ5pysXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVFc3RpbWF0ZWRDb3N0KHBsYW46IFF1ZXJ5UGxhbiwgYW5hbHlzaXM6IGFueSk6IG51bWJlciB7XHJcbiAgICBsZXQgY29zdCA9IDBcclxuICAgIFxyXG4gICAgLy8g5Z+656GA5oiQ5pysXHJcbiAgICBjb3N0ICs9IGFuYWx5c2lzLmNvbXBsZXhpdHkgKiAxMFxyXG4gICAgXHJcbiAgICAvLyDntKLlvJXkvb/nlKjmiJDmnKxcclxuICAgIHBsYW4uaW5kZXhlcy5mb3JFYWNoKGluZGV4ID0+IHtcclxuICAgICAgY29uc3Qgc3RhdHMgPSB0aGlzLmluZGV4U3RhdHMuZ2V0KGluZGV4KVxyXG4gICAgICBpZiAoc3RhdHMpIHtcclxuICAgICAgICBjb3N0ICs9ICgxIC0gc3RhdHMuYXZnU2VsZWN0aXZpdHkpICogNTBcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb3N0ICs9IDI1IC8vIOaWsOe0ouW8leeahOS8sOeul+aIkOacrFxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgXHJcbiAgICAvLyDmkJzntKLmiJDmnKxcclxuICAgIGlmIChhbmFseXNpcy5oYXNTZWFyY2gpIHtcclxuICAgICAgY29zdCArPSAxMDBcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGNvc3RcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+aIkOe8k+WtmOmUrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2VuZXJhdGVDYWNoZUtleShhbmFseXNpczogYW55KTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGtleVBhcnRzID0gW1xyXG4gICAgICBhbmFseXNpcy5oYXNVc2VySWQgPyAndXNlcicgOiAnbm8tdXNlcicsXHJcbiAgICAgIGFuYWx5c2lzLmhhc0ZvbGRlcklkID8gJ2ZvbGRlcicgOiAnbm8tZm9sZGVyJyxcclxuICAgICAgYW5hbHlzaXMuaGFzU2VhcmNoID8gJ3NlYXJjaCcgOiAnbm8tc2VhcmNoJyxcclxuICAgICAgYW5hbHlzaXMuaGFzVGFncyA/ICd0YWdzJyA6ICduby10YWdzJyxcclxuICAgICAgYW5hbHlzaXMuaGFzU29ydCA/ICdzb3J0JyA6ICduby1zb3J0J1xyXG4gICAgXVxyXG4gICAgXHJcbiAgICByZXR1cm4ga2V5UGFydHMuam9pbignLScpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorqHnrpfnvJPlrZhUVExcclxuICAgKi9cclxuICBwcml2YXRlIGNhbGN1bGF0ZUNhY2hlVFRMKGFuYWx5c2lzOiBhbnkpOiBudW1iZXIge1xyXG4gICAgbGV0IHR0bCA9IDMwMDAwIC8vIOm7mOiupDMw56eSXHJcbiAgICBcclxuICAgIC8vIOmrmOmAieaLqeaAp+afpeivoue8k+WtmOabtOS5hVxyXG4gICAgaWYgKGFuYWx5c2lzLnNlbGVjdGl2aXR5IDwgMC4xKSB7XHJcbiAgICAgIHR0bCAqPSAyXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOeugOWNleafpeivoue8k+WtmOabtOS5hVxyXG4gICAgaWYgKGFuYWx5c2lzLmNvbXBsZXhpdHkgPCAzKSB7XHJcbiAgICAgIHR0bCAqPSAxLjVcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5pCc57Si5p+l6K+i57yT5a2Y6L6D55+tXHJcbiAgICBpZiAoYW5hbHlzaXMuaGFzU2VhcmNoKSB7XHJcbiAgICAgIHR0bCAqPSAwLjVcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIE1hdGgubWluKHR0bCwgMzAwMDAwKSAvLyDmnIDlpKc15YiG6ZKfXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnoTlu7rkvJjljJbmn6Xor6JcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkT3B0aW1pemVkUXVlcnkocGxhbjogUXVlcnlQbGFuLCBvcmlnaW5hbFF1ZXJ5OiBhbnkpOiBEZXhpZS5RdWVyeTxEYkNhcmQsIGFueT4ge1xyXG4gICAgbGV0IHF1ZXJ5ID0gZGIuY2FyZHMgYXMgRGV4aWUuUXVlcnk8RGJDYXJkLCBhbnk+XHJcbiAgICBcclxuICAgIC8vIOW6lOeUqOi/h+a7pOadoeS7tu+8iOaMieS8mOWMlumhuuW6j++8iVxyXG4gICAgaWYgKG9yaWdpbmFsUXVlcnkudXNlcklkKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoJ3VzZXJJZCcpLmVxdWFscyhvcmlnaW5hbFF1ZXJ5LnVzZXJJZClcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKG9yaWdpbmFsUXVlcnkuZm9sZGVySWQpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5hbmQoY2FyZCA9PiBjYXJkLmZvbGRlcklkID09PSBvcmlnaW5hbFF1ZXJ5LmZvbGRlcklkKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDlupTnlKjmkJzntKLov4fmu6RcclxuICAgIGlmIChvcmlnaW5hbFF1ZXJ5LnNlYXJjaCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmZpbHRlcihjYXJkID0+IHtcclxuICAgICAgICBjb25zdCBzZWFyY2hUZXJtID0gb3JpZ2luYWxRdWVyeS5zZWFyY2gudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgIHJldHVybiBjYXJkLnNlYXJjaFZlY3Rvcj8uaW5jbHVkZXMoc2VhcmNoVGVybSkgfHwgZmFsc2VcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5bqU55So5qCH562+6L+H5rukXHJcbiAgICBpZiAob3JpZ2luYWxRdWVyeS50YWdzPy5sZW5ndGgpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5maWx0ZXIoY2FyZCA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZFRhZ3MgPSBbLi4uY2FyZC5mcm9udENvbnRlbnQudGFncywgLi4uY2FyZC5iYWNrQ29udGVudC50YWdzXVxyXG4gICAgICAgIHJldHVybiBvcmlnaW5hbFF1ZXJ5LnRhZ3Muc29tZSgodGFnOiBzdHJpbmcpID0+IGNhcmRUYWdzLmluY2x1ZGVzKHRhZykpXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOW6lOeUqOaOkuW6j1xyXG4gICAgaWYgKG9yaWdpbmFsUXVlcnkuc29ydEJ5KSB7XHJcbiAgICAgIGNvbnN0IHNvcnRGaWVsZCA9IHRoaXMuZ2V0U29ydEZpZWxkKG9yaWdpbmFsUXVlcnkuc29ydEJ5KVxyXG4gICAgICBpZiAoc29ydEZpZWxkKSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5zb3J0Qnkoc29ydEZpZWxkKVxyXG4gICAgICAgIGlmIChvcmlnaW5hbFF1ZXJ5LnNvcnRPcmRlciA9PT0gJ2Rlc2MnKSB7XHJcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LnJldmVyc2UoKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g6buY6K6k5oyJ5pu05paw5pe26Ze05o6S5bqPXHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3JkZXJCeSgndXBkYXRlZEF0JykucmV2ZXJzZSgpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOW6lOeUqOWIhumhtVxyXG4gICAgaWYgKG9yaWdpbmFsUXVlcnkubGltaXQpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5saW1pdChvcmlnaW5hbFF1ZXJ5LmxpbWl0KVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAob3JpZ2luYWxRdWVyeS5vZmZzZXQpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5vZmZzZXQob3JpZ2luYWxRdWVyeS5vZmZzZXQpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBxdWVyeVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5o6S5bqP5a2X5q61XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRTb3J0RmllbGQoc29ydEJ5OiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcclxuICAgIGNvbnN0IGZpZWxkTWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xyXG4gICAgICAndGl0bGUnOiAnZnJvbnRDb250ZW50LnRpdGxlJyxcclxuICAgICAgJ2NyZWF0ZWQnOiAnY3JlYXRlZEF0JyxcclxuICAgICAgJ3VwZGF0ZWQnOiAndXBkYXRlZEF0JyxcclxuICAgICAgJ3N5bmMnOiAnc3luY1ZlcnNpb24nXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBmaWVsZE1hcFtzb3J0QnldIHx8IG51bGxcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS8sOeul+e7k+aenOaVsOmHj1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgZXN0aW1hdGVSZXN1bHRDb3VudChwbGFuOiBRdWVyeVBsYW4sIHF1ZXJ5OiBhbnkpOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g5L2/55So57Si5byV57uf6K6h5Lyw566XXHJcbiAgICAgIGxldCBlc3RpbWF0ZWRDb3VudCA9IGF3YWl0IGRiLmNhcmRzLmNvdW50KClcclxuICAgICAgXHJcbiAgICAgIC8vIOW6lOeUqOmAieaLqeaAp+S8sOeul1xyXG4gICAgICBlc3RpbWF0ZWRDb3VudCAqPSB0aGlzLmNhbGN1bGF0ZVNlbGVjdGl2aXR5KHF1ZXJ5KVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE1hdGgucm91bmQoZXN0aW1hdGVkQ291bnQpXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyDkv53lrojkvLDnrpdcclxuICAgICAgcmV0dXJuIHF1ZXJ5LmxpbWl0IHx8IDUwXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorrDlvZXmn6Xor6LliIbmnpBcclxuICAgKi9cclxuICBwcml2YXRlIHJlY29yZFF1ZXJ5QW5hbHlzaXMoYW5hbHlzaXM6IGFueSwgcGxhbjogUXVlcnlQbGFuLCBvcHRpbWl6YXRpb25UaW1lOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIC8vIOiusOW9lee0ouW8leS9v+eUqOe7n+iuoVxyXG4gICAgcGxhbi5pbmRleGVzLmZvckVhY2goaW5kZXggPT4ge1xyXG4gICAgICBsZXQgc3RhdHMgPSB0aGlzLmluZGV4U3RhdHMuZ2V0KGluZGV4KVxyXG4gICAgICBpZiAoIXN0YXRzKSB7XHJcbiAgICAgICAgc3RhdHMgPSB7XHJcbiAgICAgICAgICBuYW1lOiBpbmRleCxcclxuICAgICAgICAgIGhpdHM6IDAsXHJcbiAgICAgICAgICBtaXNzZXM6IDAsXHJcbiAgICAgICAgICBhdmdTZWxlY3Rpdml0eTogMC41LFxyXG4gICAgICAgICAgbGFzdE9wdGltaXplZDogbmV3IERhdGUoKVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmluZGV4U3RhdHMuc2V0KGluZGV4LCBzdGF0cylcclxuICAgICAgfVxyXG4gICAgICBzdGF0cy5oaXRzKytcclxuICAgIH0pXHJcbiAgICBcclxuICAgIC8vIOiusOW9leafpeivouaooeW8j+eUqOS6juWtpuS5oFxyXG4gICAgY29uc3QgcGF0dGVybktleSA9IHRoaXMuZ2VuZXJhdGVDYWNoZUtleShhbmFseXNpcylcclxuICAgIGxldCBtZXRyaWNzID0gdGhpcy5xdWVyeU1ldHJpY3MuZ2V0KHBhdHRlcm5LZXkpIHx8IFtdXHJcbiAgICBtZXRyaWNzLnB1c2goe1xyXG4gICAgICBleGVjdXRpb25UaW1lOiBvcHRpbWl6YXRpb25UaW1lLFxyXG4gICAgICByb3dzUmV0dXJuZWQ6IDAsXHJcbiAgICAgIGluZGV4ZXNVc2VkOiBwbGFuLmluZGV4ZXMsXHJcbiAgICAgIGNhY2hlSGl0OiBmYWxzZVxyXG4gICAgfSlcclxuICAgIFxyXG4gICAgLy8g5L+d5oyB5pyA6L+RMTAw5qyh5p+l6K+iXHJcbiAgICBpZiAobWV0cmljcy5sZW5ndGggPiAxMDApIHtcclxuICAgICAgbWV0cmljcyA9IG1ldHJpY3Muc2xpY2UoLTEwMClcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhpcy5xdWVyeU1ldHJpY3Muc2V0KHBhdHRlcm5LZXksIG1ldHJpY3MpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bntKLlvJXnu5/orqHkv6Hmga9cclxuICAgKi9cclxuICBnZXRJbmRleFN0YXRzKCk6IEluZGV4U3RhdHNbXSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmluZGV4U3RhdHMudmFsdWVzKCkpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmn6Xor6LmgKfog73miqXlkYpcclxuICAgKi9cclxuICBnZXRQZXJmb3JtYW5jZVJlcG9ydCgpOiB7XHJcbiAgICB0b3RhbFF1ZXJpZXM6IG51bWJlclxyXG4gICAgYXZnT3B0aW1pemF0aW9uVGltZTogbnVtYmVyXHJcbiAgICBtb3N0VXNlZEluZGV4ZXM6IHN0cmluZ1tdXHJcbiAgICByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdXHJcbiAgfSB7XHJcbiAgICBjb25zdCB0b3RhbFF1ZXJpZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlNZXRyaWNzLnZhbHVlcygpKVxyXG4gICAgICAucmVkdWNlKChzdW0sIG1ldHJpY3MpID0+IHN1bSArIG1ldHJpY3MubGVuZ3RoLCAwKVxyXG4gICAgXHJcbiAgICBjb25zdCBhdmdPcHRpbWl6YXRpb25UaW1lID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5TWV0cmljcy52YWx1ZXMoKSlcclxuICAgICAgLmZsYXQoKVxyXG4gICAgICAucmVkdWNlKChzdW0sIG1ldHJpYykgPT4gc3VtICsgbWV0cmljLmV4ZWN1dGlvblRpbWUsIDApIC8gdG90YWxRdWVyaWVzXHJcbiAgICBcclxuICAgIGNvbnN0IGluZGV4VXNhZ2UgPSBBcnJheS5mcm9tKHRoaXMuaW5kZXhTdGF0cy5lbnRyaWVzKCkpXHJcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiWzFdLmhpdHMgLSBhWzFdLmhpdHMpXHJcbiAgICBcclxuICAgIGNvbnN0IG1vc3RVc2VkSW5kZXhlcyA9IGluZGV4VXNhZ2Uuc2xpY2UoMCwgNSkubWFwKChbbmFtZV0pID0+IG5hbWUpXHJcbiAgICBcclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoKVxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RhbFF1ZXJpZXMsXHJcbiAgICAgIGF2Z09wdGltaXphdGlvblRpbWUsXHJcbiAgICAgIG1vc3RVc2VkSW5kZXhlcyxcclxuICAgICAgcmVjb21tZW5kYXRpb25zXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnlJ/miJDkvJjljJblu7rorq5cclxuICAgKi9cclxuICBwcml2YXRlIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKCk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXVxyXG4gICAgXHJcbiAgICAvLyDliIbmnpDntKLlvJXkvb/nlKjmg4XlhrVcclxuICAgIGNvbnN0IHVuZGVydXNlZEluZGV4ZXMgPSBBcnJheS5mcm9tKHRoaXMuaW5kZXhTdGF0cy5lbnRyaWVzKCkpXHJcbiAgICAgIC5maWx0ZXIoKFtfLCBzdGF0c10pID0+IHN0YXRzLmhpdHMgPCAxMClcclxuICAgICAgLm1hcCgoW25hbWVdKSA9PiBuYW1lKVxyXG4gICAgXHJcbiAgICBpZiAodW5kZXJ1c2VkSW5kZXhlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGDogIPomZHliKDpmaTkvY7kvb/nlKjnjofntKLlvJU6ICR7dW5kZXJ1c2VkSW5kZXhlcy5qb2luKCcsICcpfWApXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOWIhuaekOafpeivouaooeW8j1xyXG4gICAgY29uc3Qgc2xvd1F1ZXJpZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlNZXRyaWNzLmVudHJpZXMoKSlcclxuICAgICAgLmZpbHRlcigoW18sIG1ldHJpY3NdKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXZnVGltZSA9IG1ldHJpY3MucmVkdWNlKChzdW0sIG0pID0+IHN1bSArIG0uZXhlY3V0aW9uVGltZSwgMCkgLyBtZXRyaWNzLmxlbmd0aFxyXG4gICAgICAgIHJldHVybiBhdmdUaW1lID4gNTBcclxuICAgICAgfSlcclxuICAgIFxyXG4gICAgaWYgKHNsb3dRdWVyaWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goYOWPkeeOsCAke3Nsb3dRdWVyaWVzLmxlbmd0aH0g5Liq5oWi5p+l6K+i5qih5byP77yM5bu66K6u5LyY5YyWYClcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9uc1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5riF55CG57uf6K6h5pWw5o2uXHJcbiAgICovXHJcbiAgY2xlYW51cCgpOiB2b2lkIHtcclxuICAgIC8vIOa4heeQhuaXp+eahOe7n+iuoeaVsOaNrlxyXG4gICAgY29uc3Qgb25lV2Vla0FnbyA9IG5ldyBEYXRlKERhdGUubm93KCkgLSA3ICogMjQgKiA2MCAqIDYwICogMTAwMClcclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBba2V5LCBtZXRyaWNzXSBvZiB0aGlzLnF1ZXJ5TWV0cmljcy5lbnRyaWVzKCkpIHtcclxuICAgICAgY29uc3QgcmVjZW50TWV0cmljcyA9IG1ldHJpY3MuZmlsdGVyKG0gPT4gXHJcbiAgICAgICAgbS5leGVjdXRpb25UaW1lID4gb25lV2Vla0Fnby5nZXRUaW1lKClcclxuICAgICAgKVxyXG4gICAgICBcclxuICAgICAgaWYgKHJlY2VudE1ldHJpY3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgdGhpcy5xdWVyeU1ldHJpY3MuZGVsZXRlKGtleSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnF1ZXJ5TWV0cmljcy5zZXQoa2V5LCByZWNlbnRNZXRyaWNzKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIOWvvOWHuuWNleS+i+WunuS+i1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgY29uc3QgcXVlcnlPcHRpbWl6ZXIgPSBuZXcgUXVlcnlPcHRpbWl6ZXIoKVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDlrprmnJ/muIXnkIbnu5/orqFcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gIHF1ZXJ5T3B0aW1pemVyLmNsZWFudXAoKVxyXG59LCAyNCAqIDYwICogNjAgKiAxMDAwKSAvLyDmr4/lpKnmuIXnkIbkuIDmrKEiXSwidmVyc2lvbiI6M30=