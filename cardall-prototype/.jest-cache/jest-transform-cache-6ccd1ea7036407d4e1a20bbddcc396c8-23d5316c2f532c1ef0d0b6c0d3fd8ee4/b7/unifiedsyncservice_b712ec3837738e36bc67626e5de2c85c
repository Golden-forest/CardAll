9d63fd93fbdaa52d3ae8cb26945bf394
"use strict";
/**
 * 统一同步服务整合层
 * 合并cloud-sync.ts和optimized-cloud-sync.ts的功能，消除冗余
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getSyncHistory = exports.getSyncConflicts = exports.getSyncMetrics = exports.performIncrementalSync = exports.performFullSync = exports.addSyncOperation = exports.unifiedSyncService = exports.UnifiedSyncService = void 0;
const supabase_1 = require("./supabase");
const database_1 = require("./database");
const sync_queue_1 = require("./sync-queue");
const network_state_detector_1 = require("./network-state-detector");
const data_converter_1 = require("./data-converter");
const local_operation_1 = require("./local-operation");
const offline_manager_1 = require("./offline-manager");
// ============================================================================
// 统一同步服务类
// ============================================================================
class UnifiedSyncService {
    constructor() {
        Object.defineProperty(this, "isInitialized", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "authService", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        Object.defineProperty(this, "isOnline", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "syncInProgress", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "conflicts", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "metrics", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: this.getDefaultMetrics()
        });
        Object.defineProperty(this, "listeners", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Set()
        });
        Object.defineProperty(this, "operationHistory", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "syncCache", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Map()
        });
        Object.defineProperty(this, "lastFullSync", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        this.initialize();
        this.setupOfflineIntegration();
    }
    getDefaultMetrics() {
        return {
            totalOperations: 0,
            successfulOperations: 0,
            failedOperations: 0,
            averageSyncTime: 0,
            lastSyncTime: null,
            conflictsCount: 0,
            networkQuality: 'good',
            cacheHitRate: 0
        };
    }
    // ============================================================================
    // 初始化和配置
    // ============================================================================
    initialize() {
        if (this.isInitialized)
            return;
        // 集成网络状态检测
        this.initializeNetworkIntegration();
        // 集成同步队列管理
        this.initializeQueueIntegration();
        // 启动后台同步
        this.startBackgroundSync();
        this.isInitialized = true;
        console.log('Unified sync service initialized');
    }
    initializeNetworkIntegration() {
        network_state_detector_1.networkStateDetector.addListener({
            onNetworkStateChanged: this.handleNetworkStateChange.bind(this),
            onNetworkError: this.handleNetworkError.bind(this),
            onSyncCompleted: this.handleSyncCompleted.bind(this),
            onSyncStrategyChanged: this.handleSyncStrategyChanged.bind(this)
        });
    }
    initializeQueueIntegration() {
        // 设置队列事件监听器
        sync_queue_1.syncQueueManager.setEventListeners({
            onOperationComplete: this.handleOperationComplete.bind(this),
            onBatchComplete: this.handleBatchComplete.bind(this),
            onQueueError: this.handleQueueError.bind(this),
            onStatusChange: this.handleQueueStatusChange.bind(this)
        });
    }
    startBackgroundSync() {
        // 基于网络质量的智能同步间隔
        setInterval(() => {
            if (this.shouldPerformBackgroundSync()) {
                this.performIncrementalSync();
            }
        }, this.getAdaptiveSyncInterval());
        // 定期处理本地同步队列（更频繁的本地操作处理）
        setInterval(() => {
            if (this.isOnline && !this.syncInProgress) {
                this.processLocalSyncQueue().catch(console.error);
            }
        }, 30000); // 每30秒处理一次本地同步队列
    }
    // ============================================================================
    // 离线管理集成
    // ============================================================================
    setupOfflineIntegration() {
        // 设置离线管理器事件监听器
        offline_manager_1.offlineManager.setEventListeners({
            onNetworkChange: (info) => this.handleOfflineNetworkChange(info),
            onOfflineOperation: (operation) => this.handleOfflineOperation(operation),
            onSyncProgress: (progress) => this.handleOfflineSyncProgress(progress),
            onConflict: (conflict) => this.handleOfflineConflict(conflict),
            onSyncComplete: (stats) => this.handleOfflineSyncComplete(stats),
            onError: (error) => this.handleOfflineError(error)
        });
    }
    handleOfflineNetworkChange(info) {
        this.isOnline = info.status === 'online';
        this.notifyStatusChange();
        if (this.isOnline) {
            // 网络恢复，触发同步
            this.performIncrementalSync().catch(console.error);
        }
    }
    handleOfflineOperation(operation) {
        // 将离线操作转换为统一同步操作
        const unifiedOperation = {
            id: operation.id,
            type: operation.type,
            entity: operation.entity,
            entityId: operation.entityId || '',
            data: operation.data,
            priority: this.mapOfflinePriorityToSyncPriority(operation.priority),
            timestamp: operation.timestamp,
            userId: operation.userId,
            metadata: {
                source: 'user',
                conflictResolution: operation.metadata?.conflictResolution,
                retryStrategy: 'delayed'
            }
        };
        // 添加到操作历史
        this.operationHistory.push(unifiedOperation);
    }
    handleOfflineSyncProgress(progress) {
        // 更新同步状态
        this.notifyListeners({
            status: 'syncing',
            progress: (progress.completed / progress.total) * 100,
            message: `离线同步进度: ${progress.completed}/${progress.total}`
        });
    }
    handleOfflineConflict(conflict) {
        // 将离线冲突转换为统一冲突格式
        const unifiedConflict = {
            id: conflict.id,
            entity: conflict.entityType,
            entityId: conflict.entityId,
            localData: conflict.localData,
            cloudData: conflict.remoteData,
            conflictType: this.mapOfflineConflictType(conflict.conflictType),
            resolution: conflict.resolution,
            timestamp: conflict.timestamp
        };
        this.conflicts.push(unifiedConflict);
        this.notifyStatusChange();
    }
    handleOfflineSyncComplete(stats) {
        // 更新同步指标
        this.metrics.totalOperations += stats.completedOfflineOperations;
        this.metrics.successfulOperations += stats.completedOfflineOperations;
        this.metrics.failedOperations += stats.failedOperations;
        this.metrics.lastSyncTime = stats.lastSyncTime;
        // 通知同步完成
        this.notifyListeners({
            status: 'completed',
            progress: 100,
            message: '离线同步完成'
        });
    }
    handleOfflineError(error) {
        console.error('离线管理器错误:', error);
        this.notifyListeners({
            status: 'error',
            progress: 0,
            message: `离线操作错误: ${error.message}`
        });
    }
    mapOfflinePriorityToSyncPriority(priority) {
        switch (priority) {
            case 'critical':
            case 'high':
                return 'high';
            case 'normal':
                return 'normal';
            case 'low':
                return 'low';
            default:
                return 'normal';
        }
    }
    mapOfflineConflictType(conflictType) {
        switch (conflictType) {
            case 'simultaneous_edit':
                return 'content';
            case 'delete_conflict':
                return 'version';
            case 'structure_conflict':
                return 'structure';
            default:
                return 'content';
        }
    }
    // ============================================================================
    // 核心同步功能
    // ============================================================================
    /**
     * 添加同步操作
     */
    async addOperation(operation) {
        const unifiedOp = {
            ...operation,
            id: crypto.randomUUID(),
            timestamp: new Date()
        };
        try {
            // 转换为队列操作格式
            const queueOp = {
                type: operation.type,
                entity: operation.entity,
                entityId: operation.entityId,
                userId: operation.userId,
                data: operation.data,
                priority: operation.priority,
                retryCount: 0,
                maxRetries: this.getMaxRetries(operation.priority),
                dependencies: this.getOperationDependencies(operation)
            };
            // 添加到队列
            const operationId = await sync_queue_1.syncQueueManager.enqueueOperation(queueOp);
            // 记录操作历史
            this.operationHistory.push(unifiedOp);
            // 更新指标
            this.updateMetrics({ totalOperations: this.metrics.totalOperations + 1 });
            // 如果条件允许，立即处理
            if (this.shouldProcessImmediately()) {
                this.processNextOperations();
            }
            return operationId;
        }
        catch (error) {
            console.error('Failed to add sync operation:', error);
            throw error;
        }
    }
    /**
     * 执行完整同步
     */
    async performFullSync() {
        if (this.syncInProgress || !this.canSync()) {
            return;
        }
        this.syncInProgress = true;
        this.notifyStatusChange();
        try {
            const startTime = performance.now();
            // 处理本地同步队列（优先处理用户本地操作）
            await this.processLocalSyncQueue();
            // 下行同步：从云端获取最新数据
            await this.syncFromCloud();
            // 上行同步：处理本地队列
            await this.processSyncQueue();
            // 冲突检测和解决
            await this.detectAndResolveConflicts();
            // 数据一致性检查
            await this.verifyDataConsistency();
            const syncTime = performance.now() - startTime;
            this.lastFullSync = new Date();
            // 更新指标
            this.updateMetrics({
                lastSyncTime: this.lastFullSync,
                averageSyncTime: (this.metrics.averageSyncTime + syncTime) / 2
            });
            console.log(`Full sync completed in ${syncTime}ms`);
        }
        catch (error) {
            console.error('Full sync failed:', error);
            throw error;
        }
        finally {
            this.syncInProgress = false;
            this.notifyStatusChange();
        }
    }
    /**
     * 执行增量同步
     */
    async performIncrementalSync() {
        if (this.syncInProgress || !this.canSync()) {
            return;
        }
        try {
            // 处理本地同步队列（优先级最高）
            await this.processLocalSyncQueue();
            // 只处理高优先级操作
            await this.processHighPriorityOperations();
            // 检查云端更新
            await this.checkCloudUpdates();
            // 清理缓存
            this.cleanupCache();
        }
        catch (error) {
            console.error('Incremental sync failed:', error);
        }
    }
    // ============================================================================
    // 本地操作服务集成
    // ========================================================================
    /**
     * 处理本地操作队列中的同步操作
     */
    async processLocalSyncQueue() {
        if (!this.isOnline)
            return;
        try {
            // 从本地操作服务获取待处理的操作
            const pendingOperations = await local_operation_1.localOperationService.getPendingSyncOperations();
            if (pendingOperations.length === 0) {
                return;
            }
            console.log(`Processing ${pendingOperations.length} local sync operations`);
            // 批量处理本地操作
            const results = await this.processBatchLocalOperations(pendingOperations);
            // 更新本地操作状态
            await local_operation_1.localOperationService.updateOperationStatuses(results);
            // 更新同步统计
            this.metrics.totalOperations += results.length;
            this.metrics.successfulOperations += results.filter(r => r.success).length;
            this.metrics.failedOperations += results.filter(r => !r.success).length;
        }
        catch (error) {
            console.error('Failed to process local sync queue:', error);
        }
    }
    /**
     * 批量处理本地同步操作
     */
    async processBatchLocalOperations(operations) {
        const results = [];
        // 按操作类型分组
        const operationGroups = this.groupLocalOperationsByType(operations);
        // 处理每个操作组
        for (const [operationType, typeOperations] of Object.entries(operationGroups)) {
            const groupResults = await this.processLocalOperationGroup(operationType, typeOperations);
            results.push(...groupResults);
        }
        return results;
    }
    /**
     * 按类型分组本地操作
     */
    groupLocalOperationsByType(operations) {
        const groups = {};
        for (const operation of operations) {
            const key = `${operation.entityType}_${operation.operationType}`;
            if (!groups[key]) {
                groups[key] = [];
            }
            groups[key].push(operation);
        }
        return groups;
    }
    /**
     * 处理本地操作组
     */
    async processLocalOperationGroup(operationType, operations) {
        const results = [];
        try {
            switch (operationType) {
                case 'card_create':
                case 'card_update':
                case 'card_delete':
                    await this.processCardOperations(operations, results);
                    break;
                case 'folder_create':
                case 'folder_update':
                case 'folder_delete':
                    await this.processFolderOperations(operations, results);
                    break;
                case 'tag_create':
                case 'tag_update':
                case 'tag_delete':
                    await this.processTagOperations(operations, results);
                    break;
                default:
                    console.warn(`Unknown operation type: ${operationType}`);
                    for (const op of operations) {
                        results.push({
                            operationId: op.id,
                            success: false,
                            error: `Unknown operation type: ${operationType}`
                        });
                    }
            }
        }
        catch (error) {
            console.error(`Failed to process operation group ${operationType}:`, error);
            for (const op of operations) {
                results.push({
                    operationId: op.id,
                    success: false,
                    error: error instanceof Error ? error.message : 'Unknown error'
                });
            }
        }
        return results;
    }
    /**
     * 处理卡片操作
     */
    async processCardOperations(operations, results) {
        for (const operation of operations) {
            try {
                switch (operation.operationType) {
                    case 'create':
                        await supabase_1.supabase
                            .from('cards')
                            .insert(operation.data)
                            .select()
                            .single();
                        break;
                    case 'update':
                        await supabase_1.supabase
                            .from('cards')
                            .update(operation.data)
                            .eq('id', operation.entityId);
                        break;
                    case 'delete':
                        await supabase_1.supabase
                            .from('cards')
                            .delete()
                            .eq('id', operation.entityId);
                        break;
                }
                results.push({
                    operationId: operation.id,
                    success: true
                });
            }
            catch (error) {
                results.push({
                    operationId: operation.id,
                    success: false,
                    error: error instanceof Error ? error.message : 'Unknown error'
                });
            }
        }
    }
    /**
     * 处理文件夹操作
     */
    async processFolderOperations(operations, results) {
        for (const operation of operations) {
            try {
                switch (operation.operationType) {
                    case 'create':
                        await supabase_1.supabase
                            .from('folders')
                            .insert(operation.data)
                            .select()
                            .single();
                        break;
                    case 'update':
                        await supabase_1.supabase
                            .from('folders')
                            .update(operation.data)
                            .eq('id', operation.entityId);
                        break;
                    case 'delete':
                        await supabase_1.supabase
                            .from('folders')
                            .delete()
                            .eq('id', operation.entityId);
                        break;
                }
                results.push({
                    operationId: operation.id,
                    success: true
                });
            }
            catch (error) {
                results.push({
                    operationId: operation.id,
                    success: false,
                    error: error instanceof Error ? error.message : 'Unknown error'
                });
            }
        }
    }
    /**
     * 处理标签操作
     */
    async processTagOperations(operations, results) {
        for (const operation of operations) {
            try {
                switch (operation.operationType) {
                    case 'create':
                        await supabase_1.supabase
                            .from('tags')
                            .insert(operation.data)
                            .select()
                            .single();
                        break;
                    case 'update':
                        await supabase_1.supabase
                            .from('tags')
                            .update(operation.data)
                            .eq('id', operation.entityId);
                        break;
                    case 'delete':
                        await supabase_1.supabase
                            .from('tags')
                            .delete()
                            .eq('id', operation.entityId);
                        break;
                }
                results.push({
                    operationId: operation.id,
                    success: true
                });
            }
            catch (error) {
                results.push({
                    operationId: operation.id,
                    success: false,
                    error: error instanceof Error ? error.message : 'Unknown error'
                });
            }
        }
    }
    /**
     * 从本地操作服务获取待同步的操作
     */
    async getLocalSyncOperations() {
        return await local_operation_1.localOperationService.getPendingSyncOperations();
    }
    /**
     * 触发本地操作队列处理
     */
    async triggerLocalSyncProcessing() {
        if (this.syncInProgress) {
            console.log('Sync already in progress, skipping local sync processing');
            return;
        }
        await this.processLocalSyncQueue();
    }
    // ============================================================================
    // 数据同步实现
    // ============================================================================
    async syncFromCloud() {
        if (!this.authService?.isAuthenticated())
            return;
        const user = this.authService.getCurrentUser();
        if (!user)
            return;
        const lastSync = this.lastFullSync || new Date(0);
        // 使用查询优化器并行获取数据
        const [cards, folders, tags] = await Promise.all([
            this.getCloudData('cards', user.id, lastSync),
            this.getCloudData('folders', user.id, lastSync),
            this.getCloudData('tags', user.id, lastSync)
        ]);
        // 并行处理数据合并
        await Promise.all([
            this.mergeCloudCards(cards),
            this.mergeCloudFolders(folders),
            this.mergeCloudTags(tags)
        ]);
    }
    async getCloudData(table, userId, since) {
        const cacheKey = `${table}_${userId}_${since.toISOString()}`;
        // 检查缓存
        if (this.syncCache.has(cacheKey)) {
            this.updateCacheHitRate(true);
            return this.syncCache.get(cacheKey);
        }
        this.updateCacheHitRate(false);
        // 使用查询优化器
        const query = supabase_1.supabase
            .from(table)
            .select('*')
            .eq('user_id', userId)
            .gte('updated_at', since.toISOString());
        const { data, error } = await query;
        if (error)
            throw error;
        // 缓存结果
        this.syncCache.set(cacheKey, data || []);
        return data || [];
    }
    async mergeCloudCards(cloudCards) {
        for (const cloudCard of cloudCards) {
            const localCard = await database_1.db.cards?.get(cloudCard.id);
            if (!localCard) {
                // 新卡片，直接添加
                await database_1.db.cards?.add(data_converter_1.dataConverter.fromCloudCard(cloudCard));
            }
            else {
                // 使用最后写入获胜策略
                await this.resolveCardConflict(localCard, cloudCard);
            }
        }
    }
    async mergeCloudFolders(cloudFolders) {
        for (const cloudFolder of cloudFolders) {
            const localFolder = await database_1.db.folders?.get(cloudFolder.id);
            if (!localFolder) {
                await database_1.db.folders?.add(data_converter_1.dataConverter.fromCloudFolder(cloudFolder));
            }
            else {
                await this.resolveFolderConflict(localFolder, cloudFolder);
            }
        }
    }
    async mergeCloudTags(cloudTags) {
        for (const cloudTag of cloudTags) {
            const localTag = await database_1.db.tags?.get(cloudTag.id);
            if (!localTag) {
                await database_1.db.tags?.add(data_converter_1.dataConverter.fromCloudTag(cloudTag));
            }
            else {
                await this.resolveTagConflict(localTag, cloudTag);
            }
        }
    }
    // ============================================================================
    // 冲突处理
    // ============================================================================
    async detectAndResolveConflicts() {
        const conflicts = await this.detectConflicts();
        for (const conflict of conflicts) {
            await this.resolveConflict(conflict);
        }
    }
    async detectConflicts() {
        const conflicts = [];
        // 检测卡片冲突
        const cardConflicts = await this.detectCardConflicts();
        conflicts.push(...cardConflicts);
        // 检测文件夹冲突
        const folderConflicts = await this.detectFolderConflicts();
        conflicts.push(...folderConflicts);
        // 检测标签冲突
        const tagConflicts = await this.detectTagConflicts();
        conflicts.push(...tagConflicts);
        return conflicts;
    }
    async resolveCardConflict(localCard, cloudCard) {
        const localTime = new Date(localCard.updatedAt).getTime();
        const cloudTime = new Date(cloudCard.updated_at).getTime();
        if (cloudTime > localTime) {
            // 云端数据更新
            await database_1.db.cards?.update(cloudCard.id, data_converter_1.dataConverter.fromCloudCard(cloudCard));
        }
        else if (localTime > cloudTime && localCard.pendingSync) {
            // 本地数据更新，加入同步队列
            await this.addOperation({
                type: 'update',
                entity: 'card',
                entityId: localCard.id,
                data: localCard,
                priority: 'normal',
                userId: localCard.userId
            });
        }
    }
    async resolveFolderConflict(localFolder, cloudFolder) {
        const localTime = new Date(localFolder.updatedAt).getTime();
        const cloudTime = new Date(cloudFolder.updated_at).getTime();
        if (cloudTime > localTime) {
            await database_1.db.folders?.update(cloudFolder.id, data_converter_1.dataConverter.fromCloudFolder(cloudFolder));
        }
        else if (localTime > cloudTime && localFolder.pendingSync) {
            await this.addOperation({
                type: 'update',
                entity: 'folder',
                entityId: localFolder.id,
                data: localFolder,
                priority: 'normal',
                userId: localFolder.userId
            });
        }
    }
    async resolveTagConflict(localTag, cloudTag) {
        const localTime = new Date(localTag.updatedAt).getTime();
        const cloudTime = new Date(cloudTag.updated_at).getTime();
        if (cloudTime > localTime) {
            await database_1.db.tags?.update(cloudTag.id, data_converter_1.dataConverter.fromCloudTag(cloudTag));
        }
        else if (localTime > cloudTime && localTag.pendingSync) {
            await this.addOperation({
                type: 'update',
                entity: 'tag',
                entityId: localTag.id,
                data: localTag,
                priority: 'normal',
                userId: localTag.userId
            });
        }
    }
    // ============================================================================
    // 队列处理
    // ============================================================================
    async processSyncQueue() {
        // 委托给同步队列管理器
        // 队列管理器会自动处理优先级、重试和批处理
    }
    async processNextOperations() {
        if (this.syncInProgress)
            return;
        this.syncInProgress = true;
        try {
            await sync_queue_1.syncQueueManager.processNextBatch();
        }
        finally {
            this.syncInProgress = false;
        }
    }
    async processHighPriorityOperations() {
        const highPriorityOps = await sync_queue_1.syncQueueManager.getOperations({
            priority: 'high',
            limit: 5
        });
        if (highPriorityOps.length > 0) {
            await this.processNextOperations();
        }
    }
    // ============================================================================
    // 网络和状态管理
    // ============================================================================
    handleNetworkStateChange(state) {
        this.isOnline = state.isOnline;
        if (state.isOnline && state.canSync) {
            // 网络恢复，立即同步
            this.performIncrementalSync();
        }
        this.notifyStatusChange();
    }
    handleNetworkError(error, context) {
        console.warn('Network error in sync service:', error.message, context);
        // 根据错误类型调整策略
        if (error.type === 'connection_lost') {
            sync_queue_1.syncQueueManager.pause();
        }
    }
    handleSyncCompleted(request, response) {
        if (response.success) {
            this.metrics.lastSyncTime = new Date();
        }
    }
    handleSyncStrategyChanged(strategy) {
        console.log('Sync strategy changed:', strategy);
    }
    handleOperationComplete(operation, success) {
        if (success) {
            this.updateMetrics({
                successfulOperations: this.metrics.successfulOperations + 1
            });
        }
        else {
            this.updateMetrics({
                failedOperations: this.metrics.failedOperations + 1
            });
        }
    }
    handleBatchComplete(result) {
        console.log('Batch sync completed:', result);
    }
    handleQueueError(error) {
        console.error('Queue error:', error);
    }
    handleQueueStatusChange(stats) {
        this.notifyStatusChange();
    }
    // ============================================================================
    // 辅助方法
    // ============================================================================
    canSync() {
        const networkState = network_state_detector_1.networkStateDetector.getCurrentState();
        return this.isOnline &&
            this.authService?.isAuthenticated() &&
            networkState.canSync;
    }
    shouldProcessImmediately() {
        return this.canSync() && !this.syncInProgress;
    }
    shouldPerformBackgroundSync() {
        const networkState = network_state_detector_1.networkStateDetector.getCurrentState();
        return networkState.canSync &&
            !this.syncInProgress &&
            this.authService?.isAuthenticated();
    }
    getAdaptiveSyncInterval() {
        const networkState = network_state_detector_1.networkStateDetector.getCurrentState();
        switch (networkState.quality) {
            case 'excellent': return 60 * 1000; // 1分钟
            case 'good': return 2 * 60 * 1000; // 2分钟
            case 'fair': return 5 * 60 * 1000; // 5分钟
            case 'poor': return 10 * 60 * 1000; // 10分钟
            default: return 5 * 60 * 1000;
        }
    }
    getMaxRetries(priority) {
        switch (priority) {
            case 'high': return 5;
            case 'normal': return 3;
            case 'low': return 1;
        }
    }
    getOperationDependencies(operation) {
        // 根据操作类型确定依赖关系
        const dependencies = [];
        if (operation.entity === 'card' && operation.data.folderId) {
            // 卡片操作可能依赖文件夹操作
            dependencies.push(`folder_${operation.data.folderId}`);
        }
        return dependencies;
    }
    updateCacheHitRate(isHit) {
        // 简单的缓存命中率计算
        const total = this.metrics.totalOperations || 1;
        const hits = isHit ? (this.metrics.cacheHitRate * total + 1) : (this.metrics.cacheHitRate * total);
        this.updateMetrics({ cacheHitRate: hits / (total + 1) });
    }
    updateMetrics(updates) {
        this.metrics = { ...this.metrics, ...updates };
    }
    cleanupCache() {
        // 清理过期缓存
        const now = Date.now();
        const maxAge = 5 * 60 * 1000; // 5分钟
        for (const [key, value] of this.syncCache.entries()) {
            if (now - value.timestamp > maxAge) {
                this.syncCache.delete(key);
            }
        }
    }
    async checkCloudUpdates() {
        // 检查云端更新，使用增量同步
        if (this.lastFullSync) {
            const timeSinceLastSync = Date.now() - this.lastFullSync.getTime();
            // 如果超过30分钟，执行完整同步
            if (timeSinceLastSync > 30 * 60 * 1000) {
                await this.performFullSync();
            }
        }
    }
    async verifyDataConsistency() {
        // 验证本地和云端数据一致性
        // 这里可以实现数据校验逻辑
    }
    // ============================================================================
    // 事件监听器
    // ============================================================================
    setAuthService(authService) {
        this.authService = authService;
        // 监听认证状态变化
        authService.onAuthStateChange((authState) => {
            if (authState.user && this.canSync()) {
                this.performFullSync();
            }
        });
    }
    onStatusChange(callback) {
        this.listeners.add(callback);
        callback(this.getCurrentStatus());
        return () => {
            this.listeners.delete(callback);
        };
    }
    async notifyStatusChange() {
        const status = await this.getCurrentStatus();
        this.listeners.forEach(listener => listener(status));
    }
    async getCurrentStatus() {
        const networkState = network_state_detector_1.networkStateDetector.getCurrentState();
        const queueStats = await sync_queue_1.syncQueueManager.getQueueStats();
        return {
            isOnline: networkState.isOnline,
            lastSyncTime: this.metrics.lastSyncTime,
            pendingOperations: queueStats.totalOperations,
            syncInProgress: this.syncInProgress,
            hasConflicts: this.conflicts.length > 0
        };
    }
    // ============================================================================
    // 公共API
    // ============================================================================
    async getMetrics() {
        return { ...this.metrics };
    }
    async getConflicts() {
        return [...this.conflicts];
    }
    async getOperationHistory(filters) {
        let history = [...this.operationHistory];
        if (filters?.entity) {
            history = history.filter(op => op.entity === filters.entity);
        }
        if (filters?.type) {
            history = history.filter(op => op.type === filters.type);
        }
        if (filters?.limit) {
            history = history.slice(0, filters.limit);
        }
        return history;
    }
    async clearHistory(olderThan) {
        if (olderThan) {
            this.operationHistory = this.operationHistory.filter(op => op.timestamp > olderThan);
        }
        else {
            this.operationHistory = [];
        }
    }
    async forceSync() {
        await this.performFullSync();
    }
    async pauseSync() {
        sync_queue_1.syncQueueManager.pause();
        this.syncInProgress = true;
    }
    async resumeSync() {
        sync_queue_1.syncQueueManager.resume();
        this.syncInProgress = false;
        this.processNextOperations();
    }
}
exports.UnifiedSyncService = UnifiedSyncService;
// ============================================================================
// 导出单例实例
// ============================================================================
exports.unifiedSyncService = new UnifiedSyncService();
// ============================================================================
// 便利方法导出
// ============================================================================
const addSyncOperation = (operation) => exports.unifiedSyncService.addOperation(operation);
exports.addSyncOperation = addSyncOperation;
const performFullSync = () => exports.unifiedSyncService.performFullSync();
exports.performFullSync = performFullSync;
const performIncrementalSync = () => exports.unifiedSyncService.performIncrementalSync();
exports.performIncrementalSync = performIncrementalSync;
const getSyncMetrics = () => exports.unifiedSyncService.getMetrics();
exports.getSyncMetrics = getSyncMetrics;
const getSyncConflicts = () => exports.unifiedSyncService.getConflicts();
exports.getSyncConflicts = getSyncConflicts;
const getSyncHistory = (filters) => exports.unifiedSyncService.getOperationHistory(filters);
exports.getSyncHistory = getSyncHistory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcc2VydmljZXNcXHVuaWZpZWQtc3luYy1zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7OztBQUVILHlDQUFzRDtBQUN0RCx5Q0FBK0I7QUFDL0IsNkNBQTBGO0FBQzFGLHFFQUErRDtBQUMvRCxxREFBZ0Q7QUFFaEQsdURBQWtGO0FBQ2xGLHVEQUEyRjtBQTZDM0YsK0VBQStFO0FBQy9FLFVBQVU7QUFDViwrRUFBK0U7QUFFL0UsTUFBYSxrQkFBa0I7SUFZN0I7UUFYUTs7OzttQkFBZ0IsS0FBSztXQUFBO1FBQ3JCOzs7O21CQUFtQixJQUFJO1dBQUE7UUFDdkI7Ozs7bUJBQVcsS0FBSztXQUFBO1FBQ2hCOzs7O21CQUFpQixLQUFLO1dBQUE7UUFDdEI7Ozs7bUJBQTRCLEVBQUU7V0FBQTtRQUM5Qjs7OzttQkFBdUIsSUFBSSxDQUFDLGlCQUFpQixFQUFFO1dBQUE7UUFDL0M7Ozs7bUJBQStDLElBQUksR0FBRyxFQUFFO1dBQUE7UUFDeEQ7Ozs7bUJBQTJDLEVBQUU7V0FBQTtRQUM3Qzs7OzttQkFBWSxJQUFJLEdBQUcsRUFBZTtXQUFBO1FBQ2xDOzs7O21CQUE0QixJQUFJO1dBQUE7UUFHdEMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO1FBQ2pCLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFBO0lBQ2hDLENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsT0FBTztZQUNMLGVBQWUsRUFBRSxDQUFDO1lBQ2xCLG9CQUFvQixFQUFFLENBQUM7WUFDdkIsZ0JBQWdCLEVBQUUsQ0FBQztZQUNuQixlQUFlLEVBQUUsQ0FBQztZQUNsQixZQUFZLEVBQUUsSUFBSTtZQUNsQixjQUFjLEVBQUUsQ0FBQztZQUNqQixjQUFjLEVBQUUsTUFBTTtZQUN0QixZQUFZLEVBQUUsQ0FBQztTQUNoQixDQUFBO0lBQ0gsQ0FBQztJQUVELCtFQUErRTtJQUMvRSxTQUFTO0lBQ1QsK0VBQStFO0lBRXZF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dGhpbmdcXGNhcmRhbGwtcHJvdG90eXBlXFxzcmNcXHNlcnZpY2VzXFx1bmlmaWVkLXN5bmMtc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog57uf5LiA5ZCM5q2l5pyN5Yqh5pW05ZCI5bGCXHJcbiAqIOWQiOW5tmNsb3VkLXN5bmMudHPlkoxvcHRpbWl6ZWQtY2xvdWQtc3luYy50c+eahOWKn+iDve+8jOa2iOmZpOWGl+S9mVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IHN1cGFiYXNlLCB0eXBlIFN5bmNTdGF0dXMgfSBmcm9tICcuL3N1cGFiYXNlJ1xyXG5pbXBvcnQgeyBkYiB9IGZyb20gJy4vZGF0YWJhc2UnXHJcbmltcG9ydCB7IHN5bmNRdWV1ZU1hbmFnZXIsIHR5cGUgUXVldWVPcGVyYXRpb24sIHR5cGUgQmF0Y2hTeW5jUmVzdWx0IH0gZnJvbSAnLi9zeW5jLXF1ZXVlJ1xyXG5pbXBvcnQgeyBuZXR3b3JrU3RhdGVEZXRlY3RvciB9IGZyb20gJy4vbmV0d29yay1zdGF0ZS1kZXRlY3RvcidcclxuaW1wb3J0IHsgZGF0YUNvbnZlcnRlciB9IGZyb20gJy4vZGF0YS1jb252ZXJ0ZXInXHJcbmltcG9ydCB7IHF1ZXJ5T3B0aW1pemVyIH0gZnJvbSAnLi9xdWVyeS1vcHRpbWl6ZXInXHJcbmltcG9ydCB7IGxvY2FsT3BlcmF0aW9uU2VydmljZSwgdHlwZSBMb2NhbFN5bmNPcGVyYXRpb24gfSBmcm9tICcuL2xvY2FsLW9wZXJhdGlvbidcclxuaW1wb3J0IHsgb2ZmbGluZU1hbmFnZXIsIHR5cGUgT2ZmbGluZU9wZXJhdGlvbiwgdHlwZSBOZXR3b3JrSW5mbyB9IGZyb20gJy4vb2ZmbGluZS1tYW5hZ2VyJ1xyXG5pbXBvcnQgdHlwZSB7IERiQ2FyZCwgRGJGb2xkZXIsIERiVGFnIH0gZnJvbSAnLi9kYXRhYmFzZSdcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8g57uf5LiA5ZCM5q2l5pON5L2c5o6l5Y+jXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVW5pZmllZFN5bmNPcGVyYXRpb24ge1xyXG4gIGlkOiBzdHJpbmdcclxuICB0eXBlOiAnY3JlYXRlJyB8ICd1cGRhdGUnIHwgJ2RlbGV0ZSdcclxuICBlbnRpdHk6ICdjYXJkJyB8ICdmb2xkZXInIHwgJ3RhZycgfCAnaW1hZ2UnXHJcbiAgZW50aXR5SWQ6IHN0cmluZ1xyXG4gIGRhdGE6IGFueVxyXG4gIHByaW9yaXR5OiAnaGlnaCcgfCAnbm9ybWFsJyB8ICdsb3cnXHJcbiAgdGltZXN0YW1wOiBEYXRlXHJcbiAgdXNlcklkPzogc3RyaW5nXHJcbiAgbWV0YWRhdGE/OiB7XHJcbiAgICBzb3VyY2U6ICd1c2VyJyB8ICdzeW5jJyB8ICdzeXN0ZW0nXHJcbiAgICBjb25mbGljdFJlc29sdXRpb24/OiAnbG9jYWwnIHwgJ2Nsb3VkJyB8ICdtZXJnZSdcclxuICAgIHJldHJ5U3RyYXRlZ3k/OiAnaW1tZWRpYXRlJyB8ICdkZWxheWVkJyB8ICdleHBvbmVudGlhbCdcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU3luY0NvbmZsaWN0IHtcclxuICBpZDogc3RyaW5nXHJcbiAgZW50aXR5OiBzdHJpbmdcclxuICBlbnRpdHlJZDogc3RyaW5nXHJcbiAgbG9jYWxEYXRhOiBhbnlcclxuICBjbG91ZERhdGE6IGFueVxyXG4gIGNvbmZsaWN0VHlwZTogJ3ZlcnNpb24nIHwgJ2NvbnRlbnQnIHwgJ3N0cnVjdHVyZSdcclxuICByZXNvbHV0aW9uOiAncGVuZGluZycgfCAnbG9jYWwnIHwgJ2Nsb3VkJyB8ICdtZXJnZScgfCAnbWFudWFsJ1xyXG4gIHRpbWVzdGFtcDogRGF0ZVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFN5bmNNZXRyaWNzIHtcclxuICB0b3RhbE9wZXJhdGlvbnM6IG51bWJlclxyXG4gIHN1Y2Nlc3NmdWxPcGVyYXRpb25zOiBudW1iZXJcclxuICBmYWlsZWRPcGVyYXRpb25zOiBudW1iZXJcclxuICBhdmVyYWdlU3luY1RpbWU6IG51bWJlclxyXG4gIGxhc3RTeW5jVGltZTogRGF0ZSB8IG51bGxcclxuICBjb25mbGljdHNDb3VudDogbnVtYmVyXHJcbiAgbmV0d29ya1F1YWxpdHk6ICdleGNlbGxlbnQnIHwgJ2dvb2QnIHwgJ2ZhaXInIHwgJ3Bvb3InXHJcbiAgY2FjaGVIaXRSYXRlOiBudW1iZXJcclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDnu5/kuIDlkIzmraXmnI3liqHnsbtcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZXhwb3J0IGNsYXNzIFVuaWZpZWRTeW5jU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBpc0luaXRpYWxpemVkID0gZmFsc2VcclxuICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBhbnkgPSBudWxsXHJcbiAgcHJpdmF0ZSBpc09ubGluZSA9IGZhbHNlXHJcbiAgcHJpdmF0ZSBzeW5jSW5Qcm9ncmVzcyA9IGZhbHNlXHJcbiAgcHJpdmF0ZSBjb25mbGljdHM6IFN5bmNDb25mbGljdFtdID0gW11cclxuICBwcml2YXRlIG1ldHJpY3M6IFN5bmNNZXRyaWNzID0gdGhpcy5nZXREZWZhdWx0TWV0cmljcygpXHJcbiAgcHJpdmF0ZSBsaXN0ZW5lcnM6IFNldDwoc3RhdHVzOiBTeW5jU3RhdHVzKSA9PiB2b2lkPiA9IG5ldyBTZXQoKVxyXG4gIHByaXZhdGUgb3BlcmF0aW9uSGlzdG9yeTogVW5pZmllZFN5bmNPcGVyYXRpb25bXSA9IFtdXHJcbiAgcHJpdmF0ZSBzeW5jQ2FjaGUgPSBuZXcgTWFwPHN0cmluZywgYW55PigpXHJcbiAgcHJpdmF0ZSBsYXN0RnVsbFN5bmM6IERhdGUgfCBudWxsID0gbnVsbFxyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZSgpXHJcbiAgICB0aGlzLnNldHVwT2ZmbGluZUludGVncmF0aW9uKClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RGVmYXVsdE1ldHJpY3MoKTogU3luY01ldHJpY3Mge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG90YWxPcGVyYXRpb25zOiAwLFxyXG4gICAgICBzdWNjZXNzZnVsT3BlcmF0aW9uczogMCxcclxuICAgICAgZmFpbGVkT3BlcmF0aW9uczogMCxcclxuICAgICAgYXZlcmFnZVN5bmNUaW1lOiAwLFxyXG4gICAgICBsYXN0U3luY1RpbWU6IG51bGwsXHJcbiAgICAgIGNvbmZsaWN0c0NvdW50OiAwLFxyXG4gICAgICBuZXR3b3JrUXVhbGl0eTogJ2dvb2QnLFxyXG4gICAgICBjYWNoZUhpdFJhdGU6IDBcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyDliJ3lp4vljJblkozphY3nva5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQpIHJldHVyblxyXG5cclxuICAgIC8vIOmbhuaIkOe9kee7nOeKtuaAgeajgOa1i1xyXG4gICAgdGhpcy5pbml0aWFsaXplTmV0d29ya0ludGVncmF0aW9uKClcclxuICAgIFxyXG4gICAgLy8g6ZuG5oiQ5ZCM5q2l6Zif5YiX566h55CGXHJcbiAgICB0aGlzLmluaXRpYWxpemVRdWV1ZUludGVncmF0aW9uKClcclxuICAgIFxyXG4gICAgLy8g5ZCv5Yqo5ZCO5Y+w5ZCM5q2lXHJcbiAgICB0aGlzLnN0YXJ0QmFja2dyb3VuZFN5bmMoKVxyXG4gICAgXHJcbiAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlXHJcbiAgICBjb25zb2xlLmxvZygnVW5pZmllZCBzeW5jIHNlcnZpY2UgaW5pdGlhbGl6ZWQnKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplTmV0d29ya0ludGVncmF0aW9uKCk6IHZvaWQge1xyXG4gICAgbmV0d29ya1N0YXRlRGV0ZWN0b3IuYWRkTGlzdGVuZXIoe1xyXG4gICAgICBvbk5ldHdvcmtTdGF0ZUNoYW5nZWQ6IHRoaXMuaGFuZGxlTmV0d29ya1N0YXRlQ2hhbmdlLmJpbmQodGhpcyksXHJcbiAgICAgIG9uTmV0d29ya0Vycm9yOiB0aGlzLmhhbmRsZU5ldHdvcmtFcnJvci5iaW5kKHRoaXMpLFxyXG4gICAgICBvblN5bmNDb21wbGV0ZWQ6IHRoaXMuaGFuZGxlU3luY0NvbXBsZXRlZC5iaW5kKHRoaXMpLFxyXG4gICAgICBvblN5bmNTdHJhdGVneUNoYW5nZWQ6IHRoaXMuaGFuZGxlU3luY1N0cmF0ZWd5Q2hhbmdlZC5iaW5kKHRoaXMpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplUXVldWVJbnRlZ3JhdGlvbigpOiB2b2lkIHtcclxuICAgIC8vIOiuvue9rumYn+WIl+S6i+S7tuebkeWQrOWZqFxyXG4gICAgc3luY1F1ZXVlTWFuYWdlci5zZXRFdmVudExpc3RlbmVycyh7XHJcbiAgICAgIG9uT3BlcmF0aW9uQ29tcGxldGU6IHRoaXMuaGFuZGxlT3BlcmF0aW9uQ29tcGxldGUuYmluZCh0aGlzKSxcclxuICAgICAgb25CYXRjaENvbXBsZXRlOiB0aGlzLmhhbmRsZUJhdGNoQ29tcGxldGUuYmluZCh0aGlzKSxcclxuICAgICAgb25RdWV1ZUVycm9yOiB0aGlzLmhhbmRsZVF1ZXVlRXJyb3IuYmluZCh0aGlzKSxcclxuICAgICAgb25TdGF0dXNDaGFuZ2U6IHRoaXMuaGFuZGxlUXVldWVTdGF0dXNDaGFuZ2UuYmluZCh0aGlzKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhcnRCYWNrZ3JvdW5kU3luYygpOiB2b2lkIHtcclxuICAgIC8vIOWfuuS6jue9kee7nOi0qOmHj+eahOaZuuiDveWQjOatpemXtOmalFxyXG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zaG91bGRQZXJmb3JtQmFja2dyb3VuZFN5bmMoKSkge1xyXG4gICAgICAgIHRoaXMucGVyZm9ybUluY3JlbWVudGFsU3luYygpXHJcbiAgICAgIH1cclxuICAgIH0sIHRoaXMuZ2V0QWRhcHRpdmVTeW5jSW50ZXJ2YWwoKSlcclxuICAgIFxyXG4gICAgLy8g5a6a5pyf5aSE55CG5pys5Zyw5ZCM5q2l6Zif5YiX77yI5pu06aKR57mB55qE5pys5Zyw5pON5L2c5aSE55CG77yJXHJcbiAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmlzT25saW5lICYmICF0aGlzLnN5bmNJblByb2dyZXNzKSB7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzTG9jYWxTeW5jUXVldWUoKS5jYXRjaChjb25zb2xlLmVycm9yKVxyXG4gICAgICB9XHJcbiAgICB9LCAzMDAwMCkgLy8g5q+PMzDnp5LlpITnkIbkuIDmrKHmnKzlnLDlkIzmraXpmJ/liJdcclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyDnprvnur/nrqHnkIbpm4bmiJBcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIHByaXZhdGUgc2V0dXBPZmZsaW5lSW50ZWdyYXRpb24oKTogdm9pZCB7XHJcbiAgICAvLyDorr7nva7nprvnur/nrqHnkIblmajkuovku7bnm5HlkKzlmahcclxuICAgIG9mZmxpbmVNYW5hZ2VyLnNldEV2ZW50TGlzdGVuZXJzKHtcclxuICAgICAgb25OZXR3b3JrQ2hhbmdlOiAoaW5mbzogTmV0d29ya0luZm8pID0+IHRoaXMuaGFuZGxlT2ZmbGluZU5ldHdvcmtDaGFuZ2UoaW5mbyksXHJcbiAgICAgIG9uT2ZmbGluZU9wZXJhdGlvbjogKG9wZXJhdGlvbjogT2ZmbGluZU9wZXJhdGlvbikgPT4gdGhpcy5oYW5kbGVPZmZsaW5lT3BlcmF0aW9uKG9wZXJhdGlvbiksXHJcbiAgICAgIG9uU3luY1Byb2dyZXNzOiAocHJvZ3Jlc3MpID0+IHRoaXMuaGFuZGxlT2ZmbGluZVN5bmNQcm9ncmVzcyhwcm9ncmVzcyksXHJcbiAgICAgIG9uQ29uZmxpY3Q6IChjb25mbGljdCkgPT4gdGhpcy5oYW5kbGVPZmZsaW5lQ29uZmxpY3QoY29uZmxpY3QpLFxyXG4gICAgICBvblN5bmNDb21wbGV0ZTogKHN0YXRzKSA9PiB0aGlzLmhhbmRsZU9mZmxpbmVTeW5jQ29tcGxldGUoc3RhdHMpLFxyXG4gICAgICBvbkVycm9yOiAoZXJyb3IpID0+IHRoaXMuaGFuZGxlT2ZmbGluZUVycm9yKGVycm9yKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlT2ZmbGluZU5ldHdvcmtDaGFuZ2UoaW5mbzogTmV0d29ya0luZm8pOiB2b2lkIHtcclxuICAgIHRoaXMuaXNPbmxpbmUgPSBpbmZvLnN0YXR1cyA9PT0gJ29ubGluZSdcclxuICAgIHRoaXMubm90aWZ5U3RhdHVzQ2hhbmdlKClcclxuICAgIFxyXG4gICAgaWYgKHRoaXMuaXNPbmxpbmUpIHtcclxuICAgICAgLy8g572R57uc5oGi5aSN77yM6Kem5Y+R5ZCM5q2lXHJcbiAgICAgIHRoaXMucGVyZm9ybUluY3JlbWVudGFsU3luYygpLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZU9mZmxpbmVPcGVyYXRpb24ob3BlcmF0aW9uOiBPZmZsaW5lT3BlcmF0aW9uKTogdm9pZCB7XHJcbiAgICAvLyDlsIbnprvnur/mk43kvZzovazmjaLkuLrnu5/kuIDlkIzmraXmk43kvZxcclxuICAgIGNvbnN0IHVuaWZpZWRPcGVyYXRpb246IFVuaWZpZWRTeW5jT3BlcmF0aW9uID0ge1xyXG4gICAgICBpZDogb3BlcmF0aW9uLmlkLFxyXG4gICAgICB0eXBlOiBvcGVyYXRpb24udHlwZSBhcyBhbnksXHJcbiAgICAgIGVudGl0eTogb3BlcmF0aW9uLmVudGl0eSxcclxuICAgICAgZW50aXR5SWQ6IG9wZXJhdGlvbi5lbnRpdHlJZCB8fCAnJyxcclxuICAgICAgZGF0YTogb3BlcmF0aW9uLmRhdGEsXHJcbiAgICAgIHByaW9yaXR5OiB0aGlzLm1hcE9mZmxpbmVQcmlvcml0eVRvU3luY1ByaW9yaXR5KG9wZXJhdGlvbi5wcmlvcml0eSksXHJcbiAgICAgIHRpbWVzdGFtcDogb3BlcmF0aW9uLnRpbWVzdGFtcCxcclxuICAgICAgdXNlcklkOiBvcGVyYXRpb24udXNlcklkLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIHNvdXJjZTogJ3VzZXInLFxyXG4gICAgICAgIGNvbmZsaWN0UmVzb2x1dGlvbjogb3BlcmF0aW9uLm1ldGFkYXRhPy5jb25mbGljdFJlc29sdXRpb24sXHJcbiAgICAgICAgcmV0cnlTdHJhdGVneTogJ2RlbGF5ZWQnXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5re75Yqg5Yiw5pON5L2c5Y6G5Y+yXHJcbiAgICB0aGlzLm9wZXJhdGlvbkhpc3RvcnkucHVzaCh1bmlmaWVkT3BlcmF0aW9uKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVPZmZsaW5lU3luY1Byb2dyZXNzKHByb2dyZXNzOiB7IGNvbXBsZXRlZDogbnVtYmVyOyB0b3RhbDogbnVtYmVyIH0pOiB2b2lkIHtcclxuICAgIC8vIOabtOaWsOWQjOatpeeKtuaAgVxyXG4gICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoe1xyXG4gICAgICBzdGF0dXM6ICdzeW5jaW5nJyxcclxuICAgICAgcHJvZ3Jlc3M6IChwcm9ncmVzcy5jb21wbGV0ZWQgLyBwcm9ncmVzcy50b3RhbCkgKiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6IGDnprvnur/lkIzmraXov5vluqY6ICR7cHJvZ3Jlc3MuY29tcGxldGVkfS8ke3Byb2dyZXNzLnRvdGFsfWBcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZU9mZmxpbmVDb25mbGljdChjb25mbGljdDogYW55KTogdm9pZCB7XHJcbiAgICAvLyDlsIbnprvnur/lhrLnqoHovazmjaLkuLrnu5/kuIDlhrLnqoHmoLzlvI9cclxuICAgIGNvbnN0IHVuaWZpZWRDb25mbGljdDogU3luY0NvbmZsaWN0ID0ge1xyXG4gICAgICBpZDogY29uZmxpY3QuaWQsXHJcbiAgICAgIGVudGl0eTogY29uZmxpY3QuZW50aXR5VHlwZSxcclxuICAgICAgZW50aXR5SWQ6IGNvbmZsaWN0LmVudGl0eUlkLFxyXG4gICAgICBsb2NhbERhdGE6IGNvbmZsaWN0LmxvY2FsRGF0YSxcclxuICAgICAgY2xvdWREYXRhOiBjb25mbGljdC5yZW1vdGVEYXRhLFxyXG4gICAgICBjb25mbGljdFR5cGU6IHRoaXMubWFwT2ZmbGluZUNvbmZsaWN0VHlwZShjb25mbGljdC5jb25mbGljdFR5cGUpLFxyXG4gICAgICByZXNvbHV0aW9uOiBjb25mbGljdC5yZXNvbHV0aW9uIGFzIGFueSxcclxuICAgICAgdGltZXN0YW1wOiBjb25mbGljdC50aW1lc3RhbXBcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhpcy5jb25mbGljdHMucHVzaCh1bmlmaWVkQ29uZmxpY3QpXHJcbiAgICB0aGlzLm5vdGlmeVN0YXR1c0NoYW5nZSgpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZU9mZmxpbmVTeW5jQ29tcGxldGUoc3RhdHM6IGFueSk6IHZvaWQge1xyXG4gICAgLy8g5pu05paw5ZCM5q2l5oyH5qCHXHJcbiAgICB0aGlzLm1ldHJpY3MudG90YWxPcGVyYXRpb25zICs9IHN0YXRzLmNvbXBsZXRlZE9mZmxpbmVPcGVyYXRpb25zXHJcbiAgICB0aGlzLm1ldHJpY3Muc3VjY2Vzc2Z1bE9wZXJhdGlvbnMgKz0gc3RhdHMuY29tcGxldGVkT2ZmbGluZU9wZXJhdGlvbnNcclxuICAgIHRoaXMubWV0cmljcy5mYWlsZWRPcGVyYXRpb25zICs9IHN0YXRzLmZhaWxlZE9wZXJhdGlvbnNcclxuICAgIHRoaXMubWV0cmljcy5sYXN0U3luY1RpbWUgPSBzdGF0cy5sYXN0U3luY1RpbWVcclxuICAgIFxyXG4gICAgLy8g6YCa55+l5ZCM5q2l5a6M5oiQXHJcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyh7XHJcbiAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXHJcbiAgICAgIHByb2dyZXNzOiAxMDAsXHJcbiAgICAgIG1lc3NhZ2U6ICfnprvnur/lkIzmraXlrozmiJAnXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVPZmZsaW5lRXJyb3IoZXJyb3I6IEVycm9yKTogdm9pZCB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfnprvnur/nrqHnkIblmajplJnor686JywgZXJyb3IpXHJcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyh7XHJcbiAgICAgIHN0YXR1czogJ2Vycm9yJyxcclxuICAgICAgcHJvZ3Jlc3M6IDAsXHJcbiAgICAgIG1lc3NhZ2U6IGDnprvnur/mk43kvZzplJnor686ICR7ZXJyb3IubWVzc2FnZX1gXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBtYXBPZmZsaW5lUHJpb3JpdHlUb1N5bmNQcmlvcml0eShwcmlvcml0eTogc3RyaW5nKTogJ2hpZ2gnIHwgJ25vcm1hbCcgfCAnbG93JyB7XHJcbiAgICBzd2l0Y2ggKHByaW9yaXR5KSB7XHJcbiAgICAgIGNhc2UgJ2NyaXRpY2FsJzpcclxuICAgICAgY2FzZSAnaGlnaCc6XHJcbiAgICAgICAgcmV0dXJuICdoaWdoJ1xyXG4gICAgICBjYXNlICdub3JtYWwnOlxyXG4gICAgICAgIHJldHVybiAnbm9ybWFsJ1xyXG4gICAgICBjYXNlICdsb3cnOlxyXG4gICAgICAgIHJldHVybiAnbG93J1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiAnbm9ybWFsJ1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBtYXBPZmZsaW5lQ29uZmxpY3RUeXBlKGNvbmZsaWN0VHlwZTogc3RyaW5nKTogJ3ZlcnNpb24nIHwgJ2NvbnRlbnQnIHwgJ3N0cnVjdHVyZScge1xyXG4gICAgc3dpdGNoIChjb25mbGljdFR5cGUpIHtcclxuICAgICAgY2FzZSAnc2ltdWx0YW5lb3VzX2VkaXQnOlxyXG4gICAgICAgIHJldHVybiAnY29udGVudCdcclxuICAgICAgY2FzZSAnZGVsZXRlX2NvbmZsaWN0JzpcclxuICAgICAgICByZXR1cm4gJ3ZlcnNpb24nXHJcbiAgICAgIGNhc2UgJ3N0cnVjdHVyZV9jb25mbGljdCc6XHJcbiAgICAgICAgcmV0dXJuICdzdHJ1Y3R1cmUnXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuICdjb250ZW50J1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gIC8vIOaguOW/g+WQjOatpeWKn+iDvVxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgLyoqXHJcbiAgICog5re75Yqg5ZCM5q2l5pON5L2cXHJcbiAgICovXHJcbiAgYXN5bmMgYWRkT3BlcmF0aW9uKG9wZXJhdGlvbjogT21pdDxVbmlmaWVkU3luY09wZXJhdGlvbiwgJ2lkJyB8ICd0aW1lc3RhbXAnPik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBjb25zdCB1bmlmaWVkT3A6IFVuaWZpZWRTeW5jT3BlcmF0aW9uID0ge1xyXG4gICAgICAuLi5vcGVyYXRpb24sXHJcbiAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyDovazmjaLkuLrpmJ/liJfmk43kvZzmoLzlvI9cclxuICAgICAgY29uc3QgcXVldWVPcDogT21pdDxRdWV1ZU9wZXJhdGlvbiwgJ2lkJyB8ICdzdGF0dXMnIHwgJ3RpbWVzdGFtcCc+ID0ge1xyXG4gICAgICAgIHR5cGU6IG9wZXJhdGlvbi50eXBlLFxyXG4gICAgICAgIGVudGl0eTogb3BlcmF0aW9uLmVudGl0eSxcclxuICAgICAgICBlbnRpdHlJZDogb3BlcmF0aW9uLmVudGl0eUlkLFxyXG4gICAgICAgIHVzZXJJZDogb3BlcmF0aW9uLnVzZXJJZCxcclxuICAgICAgICBkYXRhOiBvcGVyYXRpb24uZGF0YSxcclxuICAgICAgICBwcmlvcml0eTogb3BlcmF0aW9uLnByaW9yaXR5LFxyXG4gICAgICAgIHJldHJ5Q291bnQ6IDAsXHJcbiAgICAgICAgbWF4UmV0cmllczogdGhpcy5nZXRNYXhSZXRyaWVzKG9wZXJhdGlvbi5wcmlvcml0eSksXHJcbiAgICAgICAgZGVwZW5kZW5jaWVzOiB0aGlzLmdldE9wZXJhdGlvbkRlcGVuZGVuY2llcyhvcGVyYXRpb24pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOa3u+WKoOWIsOmYn+WIl1xyXG4gICAgICBjb25zdCBvcGVyYXRpb25JZCA9IGF3YWl0IHN5bmNRdWV1ZU1hbmFnZXIuZW5xdWV1ZU9wZXJhdGlvbihxdWV1ZU9wKVxyXG4gICAgICBcclxuICAgICAgLy8g6K6w5b2V5pON5L2c5Y6G5Y+yXHJcbiAgICAgIHRoaXMub3BlcmF0aW9uSGlzdG9yeS5wdXNoKHVuaWZpZWRPcClcclxuICAgICAgXHJcbiAgICAgIC8vIOabtOaWsOaMh+agh1xyXG4gICAgICB0aGlzLnVwZGF0ZU1ldHJpY3MoeyB0b3RhbE9wZXJhdGlvbnM6IHRoaXMubWV0cmljcy50b3RhbE9wZXJhdGlvbnMgKyAxIH0pXHJcbiAgICAgIFxyXG4gICAgICAvLyDlpoLmnpzmnaHku7blhYHorrjvvIznq4vljbPlpITnkIZcclxuICAgICAgaWYgKHRoaXMuc2hvdWxkUHJvY2Vzc0ltbWVkaWF0ZWx5KCkpIHtcclxuICAgICAgICB0aGlzLnByb2Nlc3NOZXh0T3BlcmF0aW9ucygpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBvcGVyYXRpb25JZFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGFkZCBzeW5jIG9wZXJhdGlvbjonLCBlcnJvcilcclxuICAgICAgdGhyb3cgZXJyb3JcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJp+ihjOWujOaVtOWQjOatpVxyXG4gICAqL1xyXG4gIGFzeW5jIHBlcmZvcm1GdWxsU3luYygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICh0aGlzLnN5bmNJblByb2dyZXNzIHx8ICF0aGlzLmNhblN5bmMoKSkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnN5bmNJblByb2dyZXNzID0gdHJ1ZVxyXG4gICAgdGhpcy5ub3RpZnlTdGF0dXNDaGFuZ2UoKVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpXHJcbiAgICAgIFxyXG4gICAgICAvLyDlpITnkIbmnKzlnLDlkIzmraXpmJ/liJfvvIjkvJjlhYjlpITnkIbnlKjmiLfmnKzlnLDmk43kvZzvvIlcclxuICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzTG9jYWxTeW5jUXVldWUoKVxyXG4gICAgICBcclxuICAgICAgLy8g5LiL6KGM5ZCM5q2l77ya5LuO5LqR56uv6I635Y+W5pyA5paw5pWw5o2uXHJcbiAgICAgIGF3YWl0IHRoaXMuc3luY0Zyb21DbG91ZCgpXHJcbiAgICAgIFxyXG4gICAgICAvLyDkuIrooYzlkIzmraXvvJrlpITnkIbmnKzlnLDpmJ/liJdcclxuICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzU3luY1F1ZXVlKClcclxuICAgICAgXHJcbiAgICAgIC8vIOWGsueqgeajgOa1i+WSjOino+WGs1xyXG4gICAgICBhd2FpdCB0aGlzLmRldGVjdEFuZFJlc29sdmVDb25mbGljdHMoKVxyXG4gICAgICBcclxuICAgICAgLy8g5pWw5o2u5LiA6Ie05oCn5qOA5p+lXHJcbiAgICAgIGF3YWl0IHRoaXMudmVyaWZ5RGF0YUNvbnNpc3RlbmN5KClcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHN5bmNUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWVcclxuICAgICAgdGhpcy5sYXN0RnVsbFN5bmMgPSBuZXcgRGF0ZSgpXHJcbiAgICAgIFxyXG4gICAgICAvLyDmm7TmlrDmjIfmoIdcclxuICAgICAgdGhpcy51cGRhdGVNZXRyaWNzKHtcclxuICAgICAgICBsYXN0U3luY1RpbWU6IHRoaXMubGFzdEZ1bGxTeW5jLFxyXG4gICAgICAgIGF2ZXJhZ2VTeW5jVGltZTogKHRoaXMubWV0cmljcy5hdmVyYWdlU3luY1RpbWUgKyBzeW5jVGltZSkgLyAyXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgRnVsbCBzeW5jIGNvbXBsZXRlZCBpbiAke3N5bmNUaW1lfW1zYClcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGdWxsIHN5bmMgZmFpbGVkOicsIGVycm9yKVxyXG4gICAgICB0aHJvdyBlcnJvclxyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgdGhpcy5zeW5jSW5Qcm9ncmVzcyA9IGZhbHNlXHJcbiAgICAgIHRoaXMubm90aWZ5U3RhdHVzQ2hhbmdlKClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJp+ihjOWinumHj+WQjOatpVxyXG4gICAqL1xyXG4gIGFzeW5jIHBlcmZvcm1JbmNyZW1lbnRhbFN5bmMoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBpZiAodGhpcy5zeW5jSW5Qcm9ncmVzcyB8fCAhdGhpcy5jYW5TeW5jKCkpIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g5aSE55CG5pys5Zyw5ZCM5q2l6Zif5YiX77yI5LyY5YWI57qn5pyA6auY77yJXHJcbiAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc0xvY2FsU3luY1F1ZXVlKClcclxuICAgICAgXHJcbiAgICAgIC8vIOWPquWkhOeQhumrmOS8mOWFiOe6p+aTjeS9nFxyXG4gICAgICBhd2FpdCB0aGlzLnByb2Nlc3NIaWdoUHJpb3JpdHlPcGVyYXRpb25zKClcclxuICAgICAgXHJcbiAgICAgIC8vIOajgOafpeS6keerr+abtOaWsFxyXG4gICAgICBhd2FpdCB0aGlzLmNoZWNrQ2xvdWRVcGRhdGVzKClcclxuICAgICAgXHJcbiAgICAgIC8vIOa4heeQhue8k+WtmFxyXG4gICAgICB0aGlzLmNsZWFudXBDYWNoZSgpXHJcbiAgICAgIFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignSW5jcmVtZW50YWwgc3luYyBmYWlsZWQ6JywgZXJyb3IpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8g5pys5Zyw5pON5L2c5pyN5Yqh6ZuG5oiQXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgXHJcbiAgLyoqXHJcbiAgICog5aSE55CG5pys5Zyw5pON5L2c6Zif5YiX5Lit55qE5ZCM5q2l5pON5L2cXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzTG9jYWxTeW5jUXVldWUoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBpZiAoIXRoaXMuaXNPbmxpbmUpIHJldHVyblxyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyDku47mnKzlnLDmk43kvZzmnI3liqHojrflj5blvoXlpITnkIbnmoTmk43kvZxcclxuICAgICAgY29uc3QgcGVuZGluZ09wZXJhdGlvbnMgPSBhd2FpdCBsb2NhbE9wZXJhdGlvblNlcnZpY2UuZ2V0UGVuZGluZ1N5bmNPcGVyYXRpb25zKClcclxuICAgICAgXHJcbiAgICAgIGlmIChwZW5kaW5nT3BlcmF0aW9ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm5cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc29sZS5sb2coYFByb2Nlc3NpbmcgJHtwZW5kaW5nT3BlcmF0aW9ucy5sZW5ndGh9IGxvY2FsIHN5bmMgb3BlcmF0aW9uc2ApXHJcbiAgICAgIFxyXG4gICAgICAvLyDmibnph4/lpITnkIbmnKzlnLDmk43kvZxcclxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMucHJvY2Vzc0JhdGNoTG9jYWxPcGVyYXRpb25zKHBlbmRpbmdPcGVyYXRpb25zKVxyXG4gICAgICBcclxuICAgICAgLy8g5pu05paw5pys5Zyw5pON5L2c54q25oCBXHJcbiAgICAgIGF3YWl0IGxvY2FsT3BlcmF0aW9uU2VydmljZS51cGRhdGVPcGVyYXRpb25TdGF0dXNlcyhyZXN1bHRzKVxyXG4gICAgICBcclxuICAgICAgLy8g5pu05paw5ZCM5q2l57uf6K6hXHJcbiAgICAgIHRoaXMubWV0cmljcy50b3RhbE9wZXJhdGlvbnMgKz0gcmVzdWx0cy5sZW5ndGhcclxuICAgICAgdGhpcy5tZXRyaWNzLnN1Y2Nlc3NmdWxPcGVyYXRpb25zICs9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5zdWNjZXNzKS5sZW5ndGhcclxuICAgICAgdGhpcy5tZXRyaWNzLmZhaWxlZE9wZXJhdGlvbnMgKz0gcmVzdWx0cy5maWx0ZXIociA9PiAhci5zdWNjZXNzKS5sZW5ndGhcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcHJvY2VzcyBsb2NhbCBzeW5jIHF1ZXVlOicsIGVycm9yKVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDmibnph4/lpITnkIbmnKzlnLDlkIzmraXmk43kvZxcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NCYXRjaExvY2FsT3BlcmF0aW9ucyhvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSk6IFByb21pc2U8e1xyXG4gICAgb3BlcmF0aW9uSWQ6IHN0cmluZ1xyXG4gICAgc3VjY2VzczogYm9vbGVhblxyXG4gICAgZXJyb3I/OiBzdHJpbmdcclxuICB9W10+IHtcclxuICAgIGNvbnN0IHJlc3VsdHM6IHtcclxuICAgICAgb3BlcmF0aW9uSWQ6IHN0cmluZ1xyXG4gICAgICBzdWNjZXNzOiBib29sZWFuXHJcbiAgICAgIGVycm9yPzogc3RyaW5nXHJcbiAgICB9W10gPSBbXVxyXG4gICAgXHJcbiAgICAvLyDmjInmk43kvZznsbvlnovliIbnu4RcclxuICAgIGNvbnN0IG9wZXJhdGlvbkdyb3VwcyA9IHRoaXMuZ3JvdXBMb2NhbE9wZXJhdGlvbnNCeVR5cGUob3BlcmF0aW9ucylcclxuICAgIFxyXG4gICAgLy8g5aSE55CG5q+P5Liq5pON5L2c57uEXHJcbiAgICBmb3IgKGNvbnN0IFtvcGVyYXRpb25UeXBlLCB0eXBlT3BlcmF0aW9uc10gb2YgT2JqZWN0LmVudHJpZXMob3BlcmF0aW9uR3JvdXBzKSkge1xyXG4gICAgICBjb25zdCBncm91cFJlc3VsdHMgPSBhd2FpdCB0aGlzLnByb2Nlc3NMb2NhbE9wZXJhdGlvbkdyb3VwKG9wZXJhdGlvblR5cGUsIHR5cGVPcGVyYXRpb25zKVxyXG4gICAgICByZXN1bHRzLnB1c2goLi4uZ3JvdXBSZXN1bHRzKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzdWx0c1xyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDmjInnsbvlnovliIbnu4TmnKzlnLDmk43kvZxcclxuICAgKi9cclxuICBwcml2YXRlIGdyb3VwTG9jYWxPcGVyYXRpb25zQnlUeXBlKG9wZXJhdGlvbnM6IExvY2FsU3luY09wZXJhdGlvbltdKTogUmVjb3JkPHN0cmluZywgTG9jYWxTeW5jT3BlcmF0aW9uW10+IHtcclxuICAgIGNvbnN0IGdyb3VwczogUmVjb3JkPHN0cmluZywgTG9jYWxTeW5jT3BlcmF0aW9uW10+ID0ge31cclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2Ygb3BlcmF0aW9ucykge1xyXG4gICAgICBjb25zdCBrZXkgPSBgJHtvcGVyYXRpb24uZW50aXR5VHlwZX1fJHtvcGVyYXRpb24ub3BlcmF0aW9uVHlwZX1gXHJcbiAgICAgIGlmICghZ3JvdXBzW2tleV0pIHtcclxuICAgICAgICBncm91cHNba2V5XSA9IFtdXHJcbiAgICAgIH1cclxuICAgICAgZ3JvdXBzW2tleV0ucHVzaChvcGVyYXRpb24pXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBncm91cHNcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICog5aSE55CG5pys5Zyw5pON5L2c57uEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzTG9jYWxPcGVyYXRpb25Hcm91cChcclxuICAgIG9wZXJhdGlvblR5cGU6IHN0cmluZywgXHJcbiAgICBvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXVxyXG4gICk6IFByb21pc2U8e1xyXG4gICAgb3BlcmF0aW9uSWQ6IHN0cmluZ1xyXG4gICAgc3VjY2VzczogYm9vbGVhblxyXG4gICAgZXJyb3I/OiBzdHJpbmdcclxuICB9W10+IHtcclxuICAgIGNvbnN0IHJlc3VsdHM6IHtcclxuICAgICAgb3BlcmF0aW9uSWQ6IHN0cmluZ1xyXG4gICAgICBzdWNjZXNzOiBib29sZWFuXHJcbiAgICAgIGVycm9yPzogc3RyaW5nXHJcbiAgICB9W10gPSBbXVxyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBzd2l0Y2ggKG9wZXJhdGlvblR5cGUpIHtcclxuICAgICAgICBjYXNlICdjYXJkX2NyZWF0ZSc6XHJcbiAgICAgICAgY2FzZSAnY2FyZF91cGRhdGUnOlxyXG4gICAgICAgIGNhc2UgJ2NhcmRfZGVsZXRlJzpcclxuICAgICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc0NhcmRPcGVyYXRpb25zKG9wZXJhdGlvbnMsIHJlc3VsdHMpXHJcbiAgICAgICAgICBicmVha1xyXG4gICAgICAgIGNhc2UgJ2ZvbGRlcl9jcmVhdGUnOlxyXG4gICAgICAgIGNhc2UgJ2ZvbGRlcl91cGRhdGUnOlxyXG4gICAgICAgIGNhc2UgJ2ZvbGRlcl9kZWxldGUnOlxyXG4gICAgICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzRm9sZGVyT3BlcmF0aW9ucyhvcGVyYXRpb25zLCByZXN1bHRzKVxyXG4gICAgICAgICAgYnJlYWtcclxuICAgICAgICBjYXNlICd0YWdfY3JlYXRlJzpcclxuICAgICAgICBjYXNlICd0YWdfdXBkYXRlJzpcclxuICAgICAgICBjYXNlICd0YWdfZGVsZXRlJzpcclxuICAgICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc1RhZ09wZXJhdGlvbnMob3BlcmF0aW9ucywgcmVzdWx0cylcclxuICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGNvbnNvbGUud2FybihgVW5rbm93biBvcGVyYXRpb24gdHlwZTogJHtvcGVyYXRpb25UeXBlfWApXHJcbiAgICAgICAgICBmb3IgKGNvbnN0IG9wIG9mIG9wZXJhdGlvbnMpIHtcclxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgICAgICBvcGVyYXRpb25JZDogb3AuaWQsXHJcbiAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgZXJyb3I6IGBVbmtub3duIG9wZXJhdGlvbiB0eXBlOiAke29wZXJhdGlvblR5cGV9YFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gcHJvY2VzcyBvcGVyYXRpb24gZ3JvdXAgJHtvcGVyYXRpb25UeXBlfTpgLCBlcnJvcilcclxuICAgICAgZm9yIChjb25zdCBvcCBvZiBvcGVyYXRpb25zKSB7XHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgIG9wZXJhdGlvbklkOiBvcC5pZCxcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzdWx0c1xyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDlpITnkIbljaHniYfmk43kvZxcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NDYXJkT3BlcmF0aW9ucyhcclxuICAgIG9wZXJhdGlvbnM6IExvY2FsU3luY09wZXJhdGlvbltdLCBcclxuICAgIHJlc3VsdHM6IHtcclxuICAgICAgb3BlcmF0aW9uSWQ6IHN0cmluZ1xyXG4gICAgICBzdWNjZXNzOiBib29sZWFuXHJcbiAgICAgIGVycm9yPzogc3RyaW5nXHJcbiAgICB9W11cclxuICApOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGZvciAoY29uc3Qgb3BlcmF0aW9uIG9mIG9wZXJhdGlvbnMpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBzd2l0Y2ggKG9wZXJhdGlvbi5vcGVyYXRpb25UeXBlKSB7XHJcbiAgICAgICAgICBjYXNlICdjcmVhdGUnOlxyXG4gICAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAgIC5mcm9tKCdjYXJkcycpXHJcbiAgICAgICAgICAgICAgLmluc2VydChvcGVyYXRpb24uZGF0YSlcclxuICAgICAgICAgICAgICAuc2VsZWN0KClcclxuICAgICAgICAgICAgICAuc2luZ2xlKClcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgIGNhc2UgJ3VwZGF0ZSc6XHJcbiAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgLmZyb20oJ2NhcmRzJylcclxuICAgICAgICAgICAgICAudXBkYXRlKG9wZXJhdGlvbi5kYXRhKVxyXG4gICAgICAgICAgICAgIC5lcSgnaWQnLCBvcGVyYXRpb24uZW50aXR5SWQpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICBjYXNlICdkZWxldGUnOlxyXG4gICAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAgIC5mcm9tKCdjYXJkcycpXHJcbiAgICAgICAgICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgICAgICAgICAgLmVxKCdpZCcsIG9wZXJhdGlvbi5lbnRpdHlJZClcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb24uaWQsXHJcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlXHJcbiAgICAgICAgfSlcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXN1bHRzLnB1c2goe1xyXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IG9wZXJhdGlvbi5pZCxcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDlpITnkIbmlofku7blpLnmk43kvZxcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NGb2xkZXJPcGVyYXRpb25zKFxyXG4gICAgb3BlcmF0aW9uczogTG9jYWxTeW5jT3BlcmF0aW9uW10sIFxyXG4gICAgcmVzdWx0czoge1xyXG4gICAgICBvcGVyYXRpb25JZDogc3RyaW5nXHJcbiAgICAgIHN1Y2Nlc3M6IGJvb2xlYW5cclxuICAgICAgZXJyb3I/OiBzdHJpbmdcclxuICAgIH1bXVxyXG4gICk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2Ygb3BlcmF0aW9ucykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHN3aXRjaCAob3BlcmF0aW9uLm9wZXJhdGlvblR5cGUpIHtcclxuICAgICAgICAgIGNhc2UgJ2NyZWF0ZSc6XHJcbiAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgLmZyb20oJ2ZvbGRlcnMnKVxyXG4gICAgICAgICAgICAgIC5pbnNlcnQob3BlcmF0aW9uLmRhdGEpXHJcbiAgICAgICAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgICAgICAgLnNpbmdsZSgpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICBjYXNlICd1cGRhdGUnOlxyXG4gICAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAgIC5mcm9tKCdmb2xkZXJzJylcclxuICAgICAgICAgICAgICAudXBkYXRlKG9wZXJhdGlvbi5kYXRhKVxyXG4gICAgICAgICAgICAgIC5lcSgnaWQnLCBvcGVyYXRpb24uZW50aXR5SWQpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICBjYXNlICdkZWxldGUnOlxyXG4gICAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAgIC5mcm9tKCdmb2xkZXJzJylcclxuICAgICAgICAgICAgICAuZGVsZXRlKClcclxuICAgICAgICAgICAgICAuZXEoJ2lkJywgb3BlcmF0aW9uLmVudGl0eUlkKVxyXG4gICAgICAgICAgICBicmVha1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXN1bHRzLnB1c2goe1xyXG4gICAgICAgICAgb3BlcmF0aW9uSWQ6IG9wZXJhdGlvbi5pZCxcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWVcclxuICAgICAgICB9KVxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaCh7XHJcbiAgICAgICAgICBvcGVyYXRpb25JZDogb3BlcmF0aW9uLmlkLFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuagh+etvuaTjeS9nFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc1RhZ09wZXJhdGlvbnMoXHJcbiAgICBvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSwgXHJcbiAgICByZXN1bHRzOiB7XHJcbiAgICAgIG9wZXJhdGlvbklkOiBzdHJpbmdcclxuICAgICAgc3VjY2VzczogYm9vbGVhblxyXG4gICAgICBlcnJvcj86IHN0cmluZ1xyXG4gICAgfVtdXHJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiBvcGVyYXRpb25zKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgc3dpdGNoIChvcGVyYXRpb24ub3BlcmF0aW9uVHlwZSkge1xyXG4gICAgICAgICAgY2FzZSAnY3JlYXRlJzpcclxuICAgICAgICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgICAuZnJvbSgndGFncycpXHJcbiAgICAgICAgICAgICAgLmluc2VydChvcGVyYXRpb24uZGF0YSlcclxuICAgICAgICAgICAgICAuc2VsZWN0KClcclxuICAgICAgICAgICAgICAuc2luZ2xlKClcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgIGNhc2UgJ3VwZGF0ZSc6XHJcbiAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgLmZyb20oJ3RhZ3MnKVxyXG4gICAgICAgICAgICAgIC51cGRhdGUob3BlcmF0aW9uLmRhdGEpXHJcbiAgICAgICAgICAgICAgLmVxKCdpZCcsIG9wZXJhdGlvbi5lbnRpdHlJZClcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgIGNhc2UgJ2RlbGV0ZSc6XHJcbiAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAgICAgLmZyb20oJ3RhZ3MnKVxyXG4gICAgICAgICAgICAgIC5kZWxldGUoKVxyXG4gICAgICAgICAgICAgIC5lcSgnaWQnLCBvcGVyYXRpb24uZW50aXR5SWQpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJlc3VsdHMucHVzaCh7XHJcbiAgICAgICAgICBvcGVyYXRpb25JZDogb3BlcmF0aW9uLmlkLFxyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgIG9wZXJhdGlvbklkOiBvcGVyYXRpb24uaWQsXHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICog5LuO5pys5Zyw5pON5L2c5pyN5Yqh6I635Y+W5b6F5ZCM5q2l55qE5pON5L2cXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0TG9jYWxTeW5jT3BlcmF0aW9ucygpOiBQcm9taXNlPExvY2FsU3luY09wZXJhdGlvbltdPiB7XHJcbiAgICByZXR1cm4gYXdhaXQgbG9jYWxPcGVyYXRpb25TZXJ2aWNlLmdldFBlbmRpbmdTeW5jT3BlcmF0aW9ucygpXHJcbiAgfVxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIOinpuWPkeacrOWcsOaTjeS9nOmYn+WIl+WkhOeQhlxyXG4gICAqL1xyXG4gIGFzeW5jIHRyaWdnZXJMb2NhbFN5bmNQcm9jZXNzaW5nKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKHRoaXMuc3luY0luUHJvZ3Jlc3MpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1N5bmMgYWxyZWFkeSBpbiBwcm9ncmVzcywgc2tpcHBpbmcgbG9jYWwgc3luYyBwcm9jZXNzaW5nJylcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGF3YWl0IHRoaXMucHJvY2Vzc0xvY2FsU3luY1F1ZXVlKClcclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyDmlbDmja7lkIzmraXlrp7njrBcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgc3luY0Zyb21DbG91ZCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICghdGhpcy5hdXRoU2VydmljZT8uaXNBdXRoZW50aWNhdGVkKCkpIHJldHVyblxyXG5cclxuICAgIGNvbnN0IHVzZXIgPSB0aGlzLmF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKClcclxuICAgIGlmICghdXNlcikgcmV0dXJuXHJcblxyXG4gICAgY29uc3QgbGFzdFN5bmMgPSB0aGlzLmxhc3RGdWxsU3luYyB8fCBuZXcgRGF0ZSgwKVxyXG5cclxuICAgIC8vIOS9v+eUqOafpeivouS8mOWMluWZqOW5tuihjOiOt+WPluaVsOaNrlxyXG4gICAgY29uc3QgW2NhcmRzLCBmb2xkZXJzLCB0YWdzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgdGhpcy5nZXRDbG91ZERhdGEoJ2NhcmRzJywgdXNlci5pZCwgbGFzdFN5bmMpLFxyXG4gICAgICB0aGlzLmdldENsb3VkRGF0YSgnZm9sZGVycycsIHVzZXIuaWQsIGxhc3RTeW5jKSxcclxuICAgICAgdGhpcy5nZXRDbG91ZERhdGEoJ3RhZ3MnLCB1c2VyLmlkLCBsYXN0U3luYylcclxuICAgIF0pXHJcblxyXG4gICAgLy8g5bm26KGM5aSE55CG5pWw5o2u5ZCI5bm2XHJcbiAgICBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgIHRoaXMubWVyZ2VDbG91ZENhcmRzKGNhcmRzKSxcclxuICAgICAgdGhpcy5tZXJnZUNsb3VkRm9sZGVycyhmb2xkZXJzKSxcclxuICAgICAgdGhpcy5tZXJnZUNsb3VkVGFncyh0YWdzKVxyXG4gICAgXSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q2xvdWREYXRhKHRhYmxlOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nLCBzaW5jZTogRGF0ZSk6IFByb21pc2U8YW55W10+IHtcclxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7dGFibGV9XyR7dXNlcklkfV8ke3NpbmNlLnRvSVNPU3RyaW5nKCl9YFxyXG4gICAgXHJcbiAgICAvLyDmo4Dmn6XnvJPlrZhcclxuICAgIGlmICh0aGlzLnN5bmNDYWNoZS5oYXMoY2FjaGVLZXkpKSB7XHJcbiAgICAgIHRoaXMudXBkYXRlQ2FjaGVIaXRSYXRlKHRydWUpXHJcbiAgICAgIHJldHVybiB0aGlzLnN5bmNDYWNoZS5nZXQoY2FjaGVLZXkpXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy51cGRhdGVDYWNoZUhpdFJhdGUoZmFsc2UpXHJcblxyXG4gICAgLy8g5L2/55So5p+l6K+i5LyY5YyW5ZmoXHJcbiAgICBjb25zdCBxdWVyeSA9IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKHRhYmxlKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxyXG4gICAgICAuZ3RlKCd1cGRhdGVkX2F0Jywgc2luY2UudG9JU09TdHJpbmcoKSlcclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeVxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvclxyXG5cclxuICAgIC8vIOe8k+WtmOe7k+aenFxyXG4gICAgdGhpcy5zeW5jQ2FjaGUuc2V0KGNhY2hlS2V5LCBkYXRhIHx8IFtdKVxyXG4gICAgcmV0dXJuIGRhdGEgfHwgW11cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgbWVyZ2VDbG91ZENhcmRzKGNsb3VkQ2FyZHM6IGFueVtdKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBmb3IgKGNvbnN0IGNsb3VkQ2FyZCBvZiBjbG91ZENhcmRzKSB7XHJcbiAgICAgIGNvbnN0IGxvY2FsQ2FyZCA9IGF3YWl0IGRiLmNhcmRzPy5nZXQoY2xvdWRDYXJkLmlkKVxyXG4gICAgICBcclxuICAgICAgaWYgKCFsb2NhbENhcmQpIHtcclxuICAgICAgICAvLyDmlrDljaHniYfvvIznm7TmjqXmt7vliqBcclxuICAgICAgICBhd2FpdCBkYi5jYXJkcz8uYWRkKGRhdGFDb252ZXJ0ZXIuZnJvbUNsb3VkQ2FyZChjbG91ZENhcmQpKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS9v+eUqOacgOWQjuWGmeWFpeiOt+iDnOetlueVpVxyXG4gICAgICAgIGF3YWl0IHRoaXMucmVzb2x2ZUNhcmRDb25mbGljdChsb2NhbENhcmQsIGNsb3VkQ2FyZClcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBtZXJnZUNsb3VkRm9sZGVycyhjbG91ZEZvbGRlcnM6IGFueVtdKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBmb3IgKGNvbnN0IGNsb3VkRm9sZGVyIG9mIGNsb3VkRm9sZGVycykge1xyXG4gICAgICBjb25zdCBsb2NhbEZvbGRlciA9IGF3YWl0IGRiLmZvbGRlcnM/LmdldChjbG91ZEZvbGRlci5pZClcclxuICAgICAgXHJcbiAgICAgIGlmICghbG9jYWxGb2xkZXIpIHtcclxuICAgICAgICBhd2FpdCBkYi5mb2xkZXJzPy5hZGQoZGF0YUNvbnZlcnRlci5mcm9tQ2xvdWRGb2xkZXIoY2xvdWRGb2xkZXIpKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IHRoaXMucmVzb2x2ZUZvbGRlckNvbmZsaWN0KGxvY2FsRm9sZGVyLCBjbG91ZEZvbGRlcilcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBtZXJnZUNsb3VkVGFncyhjbG91ZFRhZ3M6IGFueVtdKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBmb3IgKGNvbnN0IGNsb3VkVGFnIG9mIGNsb3VkVGFncykge1xyXG4gICAgICBjb25zdCBsb2NhbFRhZyA9IGF3YWl0IGRiLnRhZ3M/LmdldChjbG91ZFRhZy5pZClcclxuICAgICAgXHJcbiAgICAgIGlmICghbG9jYWxUYWcpIHtcclxuICAgICAgICBhd2FpdCBkYi50YWdzPy5hZGQoZGF0YUNvbnZlcnRlci5mcm9tQ2xvdWRUYWcoY2xvdWRUYWcpKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IHRoaXMucmVzb2x2ZVRhZ0NvbmZsaWN0KGxvY2FsVGFnLCBjbG91ZFRhZylcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gIC8vIOWGsueqgeWkhOeQhlxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RBbmRSZXNvbHZlQ29uZmxpY3RzKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgY29uZmxpY3RzID0gYXdhaXQgdGhpcy5kZXRlY3RDb25mbGljdHMoKVxyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IGNvbmZsaWN0IG9mIGNvbmZsaWN0cykge1xyXG4gICAgICBhd2FpdCB0aGlzLnJlc29sdmVDb25mbGljdChjb25mbGljdClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZGV0ZWN0Q29uZmxpY3RzKCk6IFByb21pc2U8U3luY0NvbmZsaWN0W10+IHtcclxuICAgIGNvbnN0IGNvbmZsaWN0czogU3luY0NvbmZsaWN0W10gPSBbXVxyXG4gICAgXHJcbiAgICAvLyDmo4DmtYvljaHniYflhrLnqoFcclxuICAgIGNvbnN0IGNhcmRDb25mbGljdHMgPSBhd2FpdCB0aGlzLmRldGVjdENhcmRDb25mbGljdHMoKVxyXG4gICAgY29uZmxpY3RzLnB1c2goLi4uY2FyZENvbmZsaWN0cylcclxuICAgIFxyXG4gICAgLy8g5qOA5rWL5paH5Lu25aS55Yay56qBXHJcbiAgICBjb25zdCBmb2xkZXJDb25mbGljdHMgPSBhd2FpdCB0aGlzLmRldGVjdEZvbGRlckNvbmZsaWN0cygpXHJcbiAgICBjb25mbGljdHMucHVzaCguLi5mb2xkZXJDb25mbGljdHMpXHJcbiAgICBcclxuICAgIC8vIOajgOa1i+agh+etvuWGsueqgVxyXG4gICAgY29uc3QgdGFnQ29uZmxpY3RzID0gYXdhaXQgdGhpcy5kZXRlY3RUYWdDb25mbGljdHMoKVxyXG4gICAgY29uZmxpY3RzLnB1c2goLi4udGFnQ29uZmxpY3RzKVxyXG4gICAgXHJcbiAgICByZXR1cm4gY29uZmxpY3RzXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHJlc29sdmVDYXJkQ29uZmxpY3QobG9jYWxDYXJkOiBEYkNhcmQsIGNsb3VkQ2FyZDogYW55KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBsb2NhbFRpbWUgPSBuZXcgRGF0ZShsb2NhbENhcmQudXBkYXRlZEF0KS5nZXRUaW1lKClcclxuICAgIGNvbnN0IGNsb3VkVGltZSA9IG5ldyBEYXRlKGNsb3VkQ2FyZC51cGRhdGVkX2F0KS5nZXRUaW1lKClcclxuICAgIFxyXG4gICAgaWYgKGNsb3VkVGltZSA+IGxvY2FsVGltZSkge1xyXG4gICAgICAvLyDkupHnq6/mlbDmja7mm7TmlrBcclxuICAgICAgYXdhaXQgZGIuY2FyZHM/LnVwZGF0ZShjbG91ZENhcmQuaWQsIGRhdGFDb252ZXJ0ZXIuZnJvbUNsb3VkQ2FyZChjbG91ZENhcmQpKVxyXG4gICAgfSBlbHNlIGlmIChsb2NhbFRpbWUgPiBjbG91ZFRpbWUgJiYgbG9jYWxDYXJkLnBlbmRpbmdTeW5jKSB7XHJcbiAgICAgIC8vIOacrOWcsOaVsOaNruabtOaWsO+8jOWKoOWFpeWQjOatpemYn+WIl1xyXG4gICAgICBhd2FpdCB0aGlzLmFkZE9wZXJhdGlvbih7XHJcbiAgICAgICAgdHlwZTogJ3VwZGF0ZScsXHJcbiAgICAgICAgZW50aXR5OiAnY2FyZCcsXHJcbiAgICAgICAgZW50aXR5SWQ6IGxvY2FsQ2FyZC5pZCxcclxuICAgICAgICBkYXRhOiBsb2NhbENhcmQsXHJcbiAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxyXG4gICAgICAgIHVzZXJJZDogbG9jYWxDYXJkLnVzZXJJZFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyByZXNvbHZlRm9sZGVyQ29uZmxpY3QobG9jYWxGb2xkZXI6IERiRm9sZGVyLCBjbG91ZEZvbGRlcjogYW55KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBsb2NhbFRpbWUgPSBuZXcgRGF0ZShsb2NhbEZvbGRlci51cGRhdGVkQXQpLmdldFRpbWUoKVxyXG4gICAgY29uc3QgY2xvdWRUaW1lID0gbmV3IERhdGUoY2xvdWRGb2xkZXIudXBkYXRlZF9hdCkuZ2V0VGltZSgpXHJcbiAgICBcclxuICAgIGlmIChjbG91ZFRpbWUgPiBsb2NhbFRpbWUpIHtcclxuICAgICAgYXdhaXQgZGIuZm9sZGVycz8udXBkYXRlKGNsb3VkRm9sZGVyLmlkLCBkYXRhQ29udmVydGVyLmZyb21DbG91ZEZvbGRlcihjbG91ZEZvbGRlcikpXHJcbiAgICB9IGVsc2UgaWYgKGxvY2FsVGltZSA+IGNsb3VkVGltZSAmJiBsb2NhbEZvbGRlci5wZW5kaW5nU3luYykge1xyXG4gICAgICBhd2FpdCB0aGlzLmFkZE9wZXJhdGlvbih7XHJcbiAgICAgICAgdHlwZTogJ3VwZGF0ZScsXHJcbiAgICAgICAgZW50aXR5OiAnZm9sZGVyJyxcclxuICAgICAgICBlbnRpdHlJZDogbG9jYWxGb2xkZXIuaWQsXHJcbiAgICAgICAgZGF0YTogbG9jYWxGb2xkZXIsXHJcbiAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxyXG4gICAgICAgIHVzZXJJZDogbG9jYWxGb2xkZXIudXNlcklkXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHJlc29sdmVUYWdDb25mbGljdChsb2NhbFRhZzogRGJUYWcsIGNsb3VkVGFnOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGxvY2FsVGltZSA9IG5ldyBEYXRlKGxvY2FsVGFnLnVwZGF0ZWRBdCkuZ2V0VGltZSgpXHJcbiAgICBjb25zdCBjbG91ZFRpbWUgPSBuZXcgRGF0ZShjbG91ZFRhZy51cGRhdGVkX2F0KS5nZXRUaW1lKClcclxuICAgIFxyXG4gICAgaWYgKGNsb3VkVGltZSA+IGxvY2FsVGltZSkge1xyXG4gICAgICBhd2FpdCBkYi50YWdzPy51cGRhdGUoY2xvdWRUYWcuaWQsIGRhdGFDb252ZXJ0ZXIuZnJvbUNsb3VkVGFnKGNsb3VkVGFnKSlcclxuICAgIH0gZWxzZSBpZiAobG9jYWxUaW1lID4gY2xvdWRUaW1lICYmIGxvY2FsVGFnLnBlbmRpbmdTeW5jKSB7XHJcbiAgICAgIGF3YWl0IHRoaXMuYWRkT3BlcmF0aW9uKHtcclxuICAgICAgICB0eXBlOiAndXBkYXRlJyxcclxuICAgICAgICBlbnRpdHk6ICd0YWcnLFxyXG4gICAgICAgIGVudGl0eUlkOiBsb2NhbFRhZy5pZCxcclxuICAgICAgICBkYXRhOiBsb2NhbFRhZyxcclxuICAgICAgICBwcmlvcml0eTogJ25vcm1hbCcsXHJcbiAgICAgICAgdXNlcklkOiBsb2NhbFRhZy51c2VySWRcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyDpmJ/liJflpITnkIZcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc1N5bmNRdWV1ZSgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIC8vIOWnlOaJmOe7meWQjOatpemYn+WIl+euoeeQhuWZqFxyXG4gICAgLy8g6Zif5YiX566h55CG5Zmo5Lya6Ieq5Yqo5aSE55CG5LyY5YWI57qn44CB6YeN6K+V5ZKM5om55aSE55CGXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NOZXh0T3BlcmF0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICh0aGlzLnN5bmNJblByb2dyZXNzKSByZXR1cm5cclxuICAgIFxyXG4gICAgdGhpcy5zeW5jSW5Qcm9ncmVzcyA9IHRydWVcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHN5bmNRdWV1ZU1hbmFnZXIucHJvY2Vzc05leHRCYXRjaCgpXHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICB0aGlzLnN5bmNJblByb2dyZXNzID0gZmFsc2VcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0hpZ2hQcmlvcml0eU9wZXJhdGlvbnMoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBoaWdoUHJpb3JpdHlPcHMgPSBhd2FpdCBzeW5jUXVldWVNYW5hZ2VyLmdldE9wZXJhdGlvbnMoe1xyXG4gICAgICBwcmlvcml0eTogJ2hpZ2gnLFxyXG4gICAgICBsaW1pdDogNVxyXG4gICAgfSlcclxuICAgIFxyXG4gICAgaWYgKGhpZ2hQcmlvcml0eU9wcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc05leHRPcGVyYXRpb25zKClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyDnvZHnu5zlkoznirbmgIHnrqHnkIZcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTmV0d29ya1N0YXRlQ2hhbmdlKHN0YXRlOiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMuaXNPbmxpbmUgPSBzdGF0ZS5pc09ubGluZVxyXG4gICAgXHJcbiAgICBpZiAoc3RhdGUuaXNPbmxpbmUgJiYgc3RhdGUuY2FuU3luYykge1xyXG4gICAgICAvLyDnvZHnu5zmgaLlpI3vvIznq4vljbPlkIzmraVcclxuICAgICAgdGhpcy5wZXJmb3JtSW5jcmVtZW50YWxTeW5jKClcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhpcy5ub3RpZnlTdGF0dXNDaGFuZ2UoKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVOZXR3b3JrRXJyb3IoZXJyb3I6IGFueSwgY29udGV4dD86IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc29sZS53YXJuKCdOZXR3b3JrIGVycm9yIGluIHN5bmMgc2VydmljZTonLCBlcnJvci5tZXNzYWdlLCBjb250ZXh0KVxyXG4gICAgXHJcbiAgICAvLyDmoLnmja7plJnor6/nsbvlnovosIPmlbTnrZbnlaVcclxuICAgIGlmIChlcnJvci50eXBlID09PSAnY29ubmVjdGlvbl9sb3N0Jykge1xyXG4gICAgICBzeW5jUXVldWVNYW5hZ2VyLnBhdXNlKClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlU3luY0NvbXBsZXRlZChyZXF1ZXN0OiBhbnksIHJlc3BvbnNlOiBhbnkpOiB2b2lkIHtcclxuICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XHJcbiAgICAgIHRoaXMubWV0cmljcy5sYXN0U3luY1RpbWUgPSBuZXcgRGF0ZSgpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZVN5bmNTdHJhdGVneUNoYW5nZWQoc3RyYXRlZ3k6IGFueSk6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coJ1N5bmMgc3RyYXRlZ3kgY2hhbmdlZDonLCBzdHJhdGVneSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlT3BlcmF0aW9uQ29tcGxldGUob3BlcmF0aW9uOiBRdWV1ZU9wZXJhdGlvbiwgc3VjY2VzczogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgdGhpcy51cGRhdGVNZXRyaWNzKHtcclxuICAgICAgICBzdWNjZXNzZnVsT3BlcmF0aW9uczogdGhpcy5tZXRyaWNzLnN1Y2Nlc3NmdWxPcGVyYXRpb25zICsgMVxyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy51cGRhdGVNZXRyaWNzKHtcclxuICAgICAgICBmYWlsZWRPcGVyYXRpb25zOiB0aGlzLm1ldHJpY3MuZmFpbGVkT3BlcmF0aW9ucyArIDFcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlQmF0Y2hDb21wbGV0ZShyZXN1bHQ6IEJhdGNoU3luY1Jlc3VsdCk6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coJ0JhdGNoIHN5bmMgY29tcGxldGVkOicsIHJlc3VsdClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlUXVldWVFcnJvcihlcnJvcjogRXJyb3IpOiB2b2lkIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1F1ZXVlIGVycm9yOicsIGVycm9yKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVRdWV1ZVN0YXR1c0NoYW5nZShzdGF0czogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLm5vdGlmeVN0YXR1c0NoYW5nZSgpXHJcbiAgfVxyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8g6L6F5Yqp5pa55rOVXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICBwcml2YXRlIGNhblN5bmMoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBuZXR3b3JrU3RhdGUgPSBuZXR3b3JrU3RhdGVEZXRlY3Rvci5nZXRDdXJyZW50U3RhdGUoKVxyXG4gICAgcmV0dXJuIHRoaXMuaXNPbmxpbmUgJiYgXHJcbiAgICAgICAgICAgdGhpcy5hdXRoU2VydmljZT8uaXNBdXRoZW50aWNhdGVkKCkgJiYgXHJcbiAgICAgICAgICAgbmV0d29ya1N0YXRlLmNhblN5bmNcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2hvdWxkUHJvY2Vzc0ltbWVkaWF0ZWx5KCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY2FuU3luYygpICYmICF0aGlzLnN5bmNJblByb2dyZXNzXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNob3VsZFBlcmZvcm1CYWNrZ3JvdW5kU3luYygpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IG5ldHdvcmtTdGF0ZSA9IG5ldHdvcmtTdGF0ZURldGVjdG9yLmdldEN1cnJlbnRTdGF0ZSgpXHJcbiAgICByZXR1cm4gbmV0d29ya1N0YXRlLmNhblN5bmMgJiYgXHJcbiAgICAgICAgICAgIXRoaXMuc3luY0luUHJvZ3Jlc3MgJiYgXHJcbiAgICAgICAgICAgdGhpcy5hdXRoU2VydmljZT8uaXNBdXRoZW50aWNhdGVkKClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0QWRhcHRpdmVTeW5jSW50ZXJ2YWwoKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IG5ldHdvcmtTdGF0ZSA9IG5ldHdvcmtTdGF0ZURldGVjdG9yLmdldEN1cnJlbnRTdGF0ZSgpXHJcbiAgICBcclxuICAgIHN3aXRjaCAobmV0d29ya1N0YXRlLnF1YWxpdHkpIHtcclxuICAgICAgY2FzZSAnZXhjZWxsZW50JzogcmV0dXJuIDYwICogMTAwMCAvLyAx5YiG6ZKfXHJcbiAgICAgIGNhc2UgJ2dvb2QnOiByZXR1cm4gMiAqIDYwICogMTAwMCAvLyAy5YiG6ZKfXHJcbiAgICAgIGNhc2UgJ2ZhaXInOiByZXR1cm4gNSAqIDYwICogMTAwMCAvLyA15YiG6ZKfXHJcbiAgICAgIGNhc2UgJ3Bvb3InOiByZXR1cm4gMTAgKiA2MCAqIDEwMDAgLy8gMTDliIbpkp9cclxuICAgICAgZGVmYXVsdDogcmV0dXJuIDUgKiA2MCAqIDEwMDBcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TWF4UmV0cmllcyhwcmlvcml0eTogJ2hpZ2gnIHwgJ25vcm1hbCcgfCAnbG93Jyk6IG51bWJlciB7XHJcbiAgICBzd2l0Y2ggKHByaW9yaXR5KSB7XHJcbiAgICAgIGNhc2UgJ2hpZ2gnOiByZXR1cm4gNVxyXG4gICAgICBjYXNlICdub3JtYWwnOiByZXR1cm4gM1xyXG4gICAgICBjYXNlICdsb3cnOiByZXR1cm4gMVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRPcGVyYXRpb25EZXBlbmRlbmNpZXMob3BlcmF0aW9uOiBVbmlmaWVkU3luY09wZXJhdGlvbik6IHN0cmluZ1tdIHtcclxuICAgIC8vIOagueaNruaTjeS9nOexu+Wei+ehruWumuS+nei1luWFs+ezu1xyXG4gICAgY29uc3QgZGVwZW5kZW5jaWVzOiBzdHJpbmdbXSA9IFtdXHJcbiAgICBcclxuICAgIGlmIChvcGVyYXRpb24uZW50aXR5ID09PSAnY2FyZCcgJiYgb3BlcmF0aW9uLmRhdGEuZm9sZGVySWQpIHtcclxuICAgICAgLy8g5Y2h54mH5pON5L2c5Y+v6IO95L6d6LWW5paH5Lu25aS55pON5L2cXHJcbiAgICAgIGRlcGVuZGVuY2llcy5wdXNoKGBmb2xkZXJfJHtvcGVyYXRpb24uZGF0YS5mb2xkZXJJZH1gKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZGVwZW5kZW5jaWVzXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZUNhY2hlSGl0UmF0ZShpc0hpdDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgLy8g566A5Y2V55qE57yT5a2Y5ZG95Lit546H6K6h566XXHJcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMubWV0cmljcy50b3RhbE9wZXJhdGlvbnMgfHwgMVxyXG4gICAgY29uc3QgaGl0cyA9IGlzSGl0ID8gKHRoaXMubWV0cmljcy5jYWNoZUhpdFJhdGUgKiB0b3RhbCArIDEpIDogKHRoaXMubWV0cmljcy5jYWNoZUhpdFJhdGUgKiB0b3RhbClcclxuICAgIHRoaXMudXBkYXRlTWV0cmljcyh7IGNhY2hlSGl0UmF0ZTogaGl0cyAvICh0b3RhbCArIDEpIH0pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZU1ldHJpY3ModXBkYXRlczogUGFydGlhbDxTeW5jTWV0cmljcz4pOiB2b2lkIHtcclxuICAgIHRoaXMubWV0cmljcyA9IHsgLi4udGhpcy5tZXRyaWNzLCAuLi51cGRhdGVzIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xlYW51cENhY2hlKCk6IHZvaWQge1xyXG4gICAgLy8g5riF55CG6L+H5pyf57yT5a2YXHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXHJcbiAgICBjb25zdCBtYXhBZ2UgPSA1ICogNjAgKiAxMDAwIC8vIDXliIbpkp9cclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5zeW5jQ2FjaGUuZW50cmllcygpKSB7XHJcbiAgICAgIGlmIChub3cgLSB2YWx1ZS50aW1lc3RhbXAgPiBtYXhBZ2UpIHtcclxuICAgICAgICB0aGlzLnN5bmNDYWNoZS5kZWxldGUoa2V5KVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGNoZWNrQ2xvdWRVcGRhdGVzKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgLy8g5qOA5p+l5LqR56uv5pu05paw77yM5L2/55So5aKe6YeP5ZCM5q2lXHJcbiAgICBpZiAodGhpcy5sYXN0RnVsbFN5bmMpIHtcclxuICAgICAgY29uc3QgdGltZVNpbmNlTGFzdFN5bmMgPSBEYXRlLm5vdygpIC0gdGhpcy5sYXN0RnVsbFN5bmMuZ2V0VGltZSgpXHJcbiAgICAgIFxyXG4gICAgICAvLyDlpoLmnpzotoXov4czMOWIhumSn++8jOaJp+ihjOWujOaVtOWQjOatpVxyXG4gICAgICBpZiAodGltZVNpbmNlTGFzdFN5bmMgPiAzMCAqIDYwICogMTAwMCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMucGVyZm9ybUZ1bGxTeW5jKClcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB2ZXJpZnlEYXRhQ29uc2lzdGVuY3koKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAvLyDpqozor4HmnKzlnLDlkozkupHnq6/mlbDmja7kuIDoh7TmgKdcclxuICAgIC8vIOi/memHjOWPr+S7peWunueOsOaVsOaNruagoemqjOmAu+i+kVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gIC8vIOS6i+S7tuebkeWQrOWZqFxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgc2V0QXV0aFNlcnZpY2UoYXV0aFNlcnZpY2U6IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5hdXRoU2VydmljZSA9IGF1dGhTZXJ2aWNlXHJcbiAgICBcclxuICAgIC8vIOebkeWQrOiupOivgeeKtuaAgeWPmOWMllxyXG4gICAgYXV0aFNlcnZpY2Uub25BdXRoU3RhdGVDaGFuZ2UoKGF1dGhTdGF0ZTogYW55KSA9PiB7XHJcbiAgICAgIGlmIChhdXRoU3RhdGUudXNlciAmJiB0aGlzLmNhblN5bmMoKSkge1xyXG4gICAgICAgIHRoaXMucGVyZm9ybUZ1bGxTeW5jKClcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIG9uU3RhdHVzQ2hhbmdlKGNhbGxiYWNrOiAoc3RhdHVzOiBTeW5jU3RhdHVzKSA9PiB2b2lkKTogKCkgPT4gdm9pZCB7XHJcbiAgICB0aGlzLmxpc3RlbmVycy5hZGQoY2FsbGJhY2spXHJcbiAgICBjYWxsYmFjayh0aGlzLmdldEN1cnJlbnRTdGF0dXMoKSlcclxuICAgIFxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgdGhpcy5saXN0ZW5lcnMuZGVsZXRlKGNhbGxiYWNrKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBub3RpZnlTdGF0dXNDaGFuZ2UoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRTdGF0dXMoKVxyXG4gICAgdGhpcy5saXN0ZW5lcnMuZm9yRWFjaChsaXN0ZW5lciA9PiBsaXN0ZW5lcihzdGF0dXMpKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Q3VycmVudFN0YXR1cygpOiBQcm9taXNlPFN5bmNTdGF0dXM+IHtcclxuICAgIGNvbnN0IG5ldHdvcmtTdGF0ZSA9IG5ldHdvcmtTdGF0ZURldGVjdG9yLmdldEN1cnJlbnRTdGF0ZSgpXHJcbiAgICBjb25zdCBxdWV1ZVN0YXRzID0gYXdhaXQgc3luY1F1ZXVlTWFuYWdlci5nZXRRdWV1ZVN0YXRzKClcclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXNPbmxpbmU6IG5ldHdvcmtTdGF0ZS5pc09ubGluZSxcclxuICAgICAgbGFzdFN5bmNUaW1lOiB0aGlzLm1ldHJpY3MubGFzdFN5bmNUaW1lLFxyXG4gICAgICBwZW5kaW5nT3BlcmF0aW9uczogcXVldWVTdGF0cy50b3RhbE9wZXJhdGlvbnMsXHJcbiAgICAgIHN5bmNJblByb2dyZXNzOiB0aGlzLnN5bmNJblByb2dyZXNzLFxyXG4gICAgICBoYXNDb25mbGljdHM6IHRoaXMuY29uZmxpY3RzLmxlbmd0aCA+IDBcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyDlhazlhbFBUElcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIGFzeW5jIGdldE1ldHJpY3MoKTogUHJvbWlzZTxTeW5jTWV0cmljcz4ge1xyXG4gICAgcmV0dXJuIHsgLi4udGhpcy5tZXRyaWNzIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENvbmZsaWN0cygpOiBQcm9taXNlPFN5bmNDb25mbGljdFtdPiB7XHJcbiAgICByZXR1cm4gWy4uLnRoaXMuY29uZmxpY3RzXVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0T3BlcmF0aW9uSGlzdG9yeShmaWx0ZXJzPzoge1xyXG4gICAgZW50aXR5Pzogc3RyaW5nXHJcbiAgICB0eXBlPzogc3RyaW5nXHJcbiAgICBsaW1pdD86IG51bWJlclxyXG4gIH0pOiBQcm9taXNlPFVuaWZpZWRTeW5jT3BlcmF0aW9uW10+IHtcclxuICAgIGxldCBoaXN0b3J5ID0gWy4uLnRoaXMub3BlcmF0aW9uSGlzdG9yeV1cclxuICAgIFxyXG4gICAgaWYgKGZpbHRlcnM/LmVudGl0eSkge1xyXG4gICAgICBoaXN0b3J5ID0gaGlzdG9yeS5maWx0ZXIob3AgPT4gb3AuZW50aXR5ID09PSBmaWx0ZXJzLmVudGl0eSlcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGZpbHRlcnM/LnR5cGUpIHtcclxuICAgICAgaGlzdG9yeSA9IGhpc3RvcnkuZmlsdGVyKG9wID0+IG9wLnR5cGUgPT09IGZpbHRlcnMudHlwZSlcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGZpbHRlcnM/LmxpbWl0KSB7XHJcbiAgICAgIGhpc3RvcnkgPSBoaXN0b3J5LnNsaWNlKDAsIGZpbHRlcnMubGltaXQpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBoaXN0b3J5XHJcbiAgfVxyXG5cclxuICBhc3luYyBjbGVhckhpc3Rvcnkob2xkZXJUaGFuPzogRGF0ZSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKG9sZGVyVGhhbikge1xyXG4gICAgICB0aGlzLm9wZXJhdGlvbkhpc3RvcnkgPSB0aGlzLm9wZXJhdGlvbkhpc3RvcnkuZmlsdGVyKFxyXG4gICAgICAgIG9wID0+IG9wLnRpbWVzdGFtcCA+IG9sZGVyVGhhblxyXG4gICAgICApXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm9wZXJhdGlvbkhpc3RvcnkgPSBbXVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZm9yY2VTeW5jKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgYXdhaXQgdGhpcy5wZXJmb3JtRnVsbFN5bmMoKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgcGF1c2VTeW5jKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgc3luY1F1ZXVlTWFuYWdlci5wYXVzZSgpXHJcbiAgICB0aGlzLnN5bmNJblByb2dyZXNzID0gdHJ1ZVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVzdW1lU3luYygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHN5bmNRdWV1ZU1hbmFnZXIucmVzdW1lKClcclxuICAgIHRoaXMuc3luY0luUHJvZ3Jlc3MgPSBmYWxzZVxyXG4gICAgdGhpcy5wcm9jZXNzTmV4dE9wZXJhdGlvbnMoKVxyXG4gIH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDlr7zlh7rljZXkvovlrp7kvotcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZXhwb3J0IGNvbnN0IHVuaWZpZWRTeW5jU2VydmljZSA9IG5ldyBVbmlmaWVkU3luY1NlcnZpY2UoKVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyDkvr/liKnmlrnms5Xlr7zlh7pcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZXhwb3J0IGNvbnN0IGFkZFN5bmNPcGVyYXRpb24gPSAob3BlcmF0aW9uOiBPbWl0PFVuaWZpZWRTeW5jT3BlcmF0aW9uLCAnaWQnIHwgJ3RpbWVzdGFtcCc+KSA9PiBcclxuICB1bmlmaWVkU3luY1NlcnZpY2UuYWRkT3BlcmF0aW9uKG9wZXJhdGlvbilcclxuXHJcbmV4cG9ydCBjb25zdCBwZXJmb3JtRnVsbFN5bmMgPSAoKSA9PiB1bmlmaWVkU3luY1NlcnZpY2UucGVyZm9ybUZ1bGxTeW5jKClcclxuZXhwb3J0IGNvbnN0IHBlcmZvcm1JbmNyZW1lbnRhbFN5bmMgPSAoKSA9PiB1bmlmaWVkU3luY1NlcnZpY2UucGVyZm9ybUluY3JlbWVudGFsU3luYygpXHJcbmV4cG9ydCBjb25zdCBnZXRTeW5jTWV0cmljcyA9ICgpID0+IHVuaWZpZWRTeW5jU2VydmljZS5nZXRNZXRyaWNzKClcclxuZXhwb3J0IGNvbnN0IGdldFN5bmNDb25mbGljdHMgPSAoKSA9PiB1bmlmaWVkU3luY1NlcnZpY2UuZ2V0Q29uZmxpY3RzKClcclxuZXhwb3J0IGNvbnN0IGdldFN5bmNIaXN0b3J5ID0gKGZpbHRlcnM/OiBhbnkpID0+IHVuaWZpZWRTeW5jU2VydmljZS5nZXRPcGVyYXRpb25IaXN0b3J5KGZpbHRlcnMpIl0sInZlcnNpb24iOjN9