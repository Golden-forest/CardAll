f18efb9203c124d48e1f2373480bd4a4
"use strict";
// 统一错误处理器
// CardEverything 错误处理和恢复机制核心实现
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.handleError = exports.createErrorContext = exports.unifiedErrorHandler = exports.UnifiedErrorHandler = exports.ErrorClassifier = void 0;
const network_state_detector_1 = require("../network-state-detector");
// 导入统一类型定义
__exportStar(require("./types"), exports);
// 错误分类器
class ErrorClassifier {
    constructor() {
        Object.defineProperty(this, "patterns", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Map()
        });
        this.initializePatterns();
    }
    static getInstance() {
        if (!ErrorClassifier.instance) {
            ErrorClassifier.instance = new ErrorClassifier();
        }
        return ErrorClassifier.instance;
    }
    /**
     * 分类错误
     */
    classify(error, context) {
        // 如果已经是统一错误，直接返回
        if (this.isUnifiedError(error)) {
            return error;
        }
        // 尝试匹配已知模式
        for (const [name, pattern] of this.patterns) {
            const classified = pattern(error);
            if (classified) {
                return this.enrichWithContext(classified, context);
            }
        }
        // 默认分类
        return this.createDefaultError(error, context);
    }
    /**
     * 初始化错误模式
     */
    initializePatterns() {
        // 网络错误模式
        this.patterns.set('network', (error) => {
            if (this.isNetworkError(error)) {
                return this.createNetworkError(error);
            }
            return null;
        });
        // 协议错误模式
        this.patterns.set('protocol', (error) => {
            if (this.isProtocolError(error)) {
                return this.createProtocolError(error);
            }
            return null;
        });
        // 数据错误模式
        this.patterns.set('data', (error) => {
            if (this.isDataError(error)) {
                return this.createDataError(error);
            }
            return null;
        });
        // 系统错误模式
        this.patterns.set('system', (error) => {
            if (this.isSystemError(error)) {
                return this.createSystemError(error);
            }
            return null;
        });
    }
    /**
     * 判断是否为网络错误
     */
    isNetworkError(error) {
        return error?.name?.includes('Network') ||
            error?.message?.includes('network') ||
            error?.message?.includes('connection') ||
            error?.message?.includes('offline') ||
            error?.code === 'NETWORK_ERROR';
    }
    /**
     * 判断是否为协议错误
     */
    isProtocolError(error) {
        return error?.status >= 400 ||
            error?.name?.includes('HTTP') ||
            error?.message?.includes('http') ||
            error?.code === 'HTTP_ERROR';
    }
    /**
     * 判断是否为数据错误
     */
    isDataError(error) {
        return error?.name?.includes('Data') ||
            error?.message?.includes('data') ||
            error?.message?.includes('validation') ||
            error?.message?.includes('conflict') ||
            error?.code === 'DATA_ERROR';
    }
    /**
     * 判断是否为系统错误
     */
    isSystemError(error) {
        return error?.name?.includes('System') ||
            error?.message?.includes('system') ||
            error?.message?.includes('memory') ||
            error?.message?.includes('resource') ||
            error?.code === 'SYSTEM_ERROR';
    }
    /**
     * 判断是否为统一错误
     */
    isUnifiedError(error) {
        return error &&
            typeof error.id === 'string' &&
            typeof error.code === 'string' &&
            Object.values(ErrorLevel).includes(error.level) &&
            Object.values(ErrorCategory).includes(error.category);
    }
    /**
     * 创建网络错误
     */
    createNetworkError(error) {
        const subCategory = this.determineNetworkSubCategory(error);
        return {
            id: crypto.randomUUID(),
            code: `SYNC_NET_${this.generateErrorCode(subCategory)}`,
            level: ErrorLevel.ERROR,
            category: ErrorCategory.NETWORK,
            subCategory,
            message: error.message || 'Network error occurred',
            details: error,
            stack: error.stack,
            timestamp: new Date(),
            retryable: this.isNetworkErrorRetryable(subCategory),
            maxRetries: 3
        };
    }
    /**
     * 创建协议错误
     */
    createProtocolError(error) {
        const subCategory = this.determineProtocolSubCategory(error);
        return {
            id: crypto.randomUUID(),
            code: `SYNC_PROTO_${this.generateErrorCode(subCategory)}`,
            level: ErrorLevel.ERROR,
            category: ErrorCategory.PROTOCOL,
            subCategory,
            message: error.message || 'Protocol error occurred',
            details: error,
            stack: error.stack,
            timestamp: new Date(),
            retryable: this.isProtocolErrorRetryable(subCategory),
            maxRetries: 2
        };
    }
    /**
     * 创建数据错误
     */
    createDataError(error) {
        const subCategory = this.determineDataSubCategory(error);
        return {
            id: crypto.randomUUID(),
            code: `SYNC_DATA_${this.generateErrorCode(subCategory)}`,
            level: ErrorLevel.ERROR,
            category: ErrorCategory.DATA,
            subCategory,
            message: error.message || 'Data error occurred',
            details: error,
            stack: error.stack,
            timestamp: new Date(),
            retryable: this.isDataErrorRetryable(subCategory),
            maxRetries: 1
        };
    }
    /**
     * 创建系统错误
     */
    createSystemError(error) {
        const subCategory = this.determineSystemSubCategory(error);
        return {
            id: crypto.randomUUID(),
            code: `SYNC_SYS_${this.generateErrorCode(subCategory)}`,
            level: ErrorLevel.CRITICAL,
            category: ErrorCategory.SYSTEM,
            subCategory,
            message: error.message || 'System error occurred',
            details: error,
            stack: error.stack,
            timestamp: new Date(),
            retryable: false,
            maxRetries: 0
        };
    }
    /**
     * 创建默认错误
     */
    createDefaultError(error, context) {
        return {
            id: crypto.randomUUID(),
            code: 'SYNC_UNKNOWN_001',
            level: ErrorLevel.WARNING,
            category: ErrorCategory.APPLICATION,
            subCategory: ErrorSubCategory.BUSINESS_LOGIC_ERROR,
            message: error.message || 'Unknown error occurred',
            details: error,
            stack: error.stack,
            timestamp: new Date(),
            retryable: true,
            maxRetries: 1
        };
    }
    /**
     * 确定网络错误子类别
     */
    determineNetworkSubCategory(error) {
        if (error.message?.includes('timeout')) {
            return ErrorSubCategory.NETWORK_TIMEOUT;
        }
        if (error.message?.includes('connection') || error.message?.includes('offline')) {
            return ErrorSubCategory.CONNECTION_LOST;
        }
        if (error.message?.includes('bandwidth') || error.message?.includes('limit')) {
            return ErrorSubCategory.BANDWIDTH_LIMIT;
        }
        if (error.message?.includes('dns') || error.message?.includes('resolve')) {
            return ErrorSubCategory.DNS_FAILURE;
        }
        return ErrorSubCategory.CONNECTION_LOST;
    }
    /**
     * 确定协议错误子类别
     */
    determineProtocolSubCategory(error) {
        if (error.status === 401 || error.status === 403) {
            return ErrorSubCategory.AUTH_ERROR;
        }
        if (error.message?.includes('ssl') || error.message?.includes('tls') || error.message?.includes('certificate')) {
            return ErrorSubCategory.SSL_ERROR;
        }
        return ErrorSubCategory.HTTP_ERROR;
    }
    /**
     * 确定数据错误子类别
     */
    determineDataSubCategory(error) {
        if (error.message?.includes('conflict') || error.message?.includes('concurrent')) {
            return ErrorSubCategory.DATA_CONFLICT;
        }
        if (error.message?.includes('corruption') || error.message?.includes('corrupt')) {
            return ErrorSubCategory.DATA_CORRUPTION;
        }
        if (error.message?.includes('loss') || error.message?.includes('missing')) {
            return ErrorSubCategory.DATA_LOSS;
        }
        return ErrorSubCategory.VALIDATION_ERROR;
    }
    /**
     * 确定系统错误子类别
     */
    determineSystemSubCategory(error) {
        if (error.message?.includes('overload') || error.message?.includes('overloaded')) {
            return ErrorSubCategory.SYSTEM_OVERLOAD;
        }
        if (error.message?.includes('memory') || error.message?.includes('resource')) {
            return ErrorSubCategory.RESOURCE_EXHAUSTED;
        }
        if (error.message?.includes('config') || error.message?.includes('configuration')) {
            return ErrorSubCategory.CONFIGURATION_ERROR;
        }
        return ErrorSubCategory.SYSTEM_OVERLOAD;
    }
    /**
     * 生成错误代码
     */
    generateErrorCode(subCategory) {
        const codeMap = {
            [ErrorSubCategory.CONNECTION_LOST]: 'CONN_001',
            [ErrorSubCategory.NETWORK_TIMEOUT]: 'TIME_001',
            [ErrorSubCategory.BANDWIDTH_LIMIT]: 'BAND_001',
            [ErrorSubCategory.DNS_FAILURE]: 'DNS_001',
            [ErrorSubCategory.HTTP_ERROR]: 'HTTP_001',
            [ErrorSubCategory.SSL_ERROR]: 'SSL_001',
            [ErrorSubCategory.AUTH_ERROR]: 'AUTH_001',
            [ErrorSubCategory.VALIDATION_ERROR]: 'VAL_001',
            [ErrorSubCategory.BUSINESS_LOGIC_ERROR]: 'LOGIC_001',
            [ErrorSubCategory.PERMISSION_ERROR]: 'PERM_001',
            [ErrorSubCategory.DATA_CONFLICT]: 'CONF_001',
            [ErrorSubCategory.DATA_CORRUPTION]: 'CORR_001',
            [ErrorSubCategory.DATA_LOSS]: 'LOSS_001',
            [ErrorSubCategory.SYSTEM_OVERLOAD]: 'OVER_001',
            [ErrorSubCategory.RESOURCE_EXHAUSTED]: 'RES_001',
            [ErrorSubCategory.CONFIGURATION_ERROR]: 'CONF_001'
        };
        return codeMap[subCategory] || 'UNKN_001';
    }
    /**
     * 判断网络错误是否可重试
     */
    isNetworkErrorRetryable(subCategory) {
        return [
            ErrorSubCategory.CONNECTION_LOST,
            ErrorSubCategory.NETWORK_TIMEOUT,
            ErrorSubCategory.BANDWIDTH_LIMIT
        ].includes(subCategory);
    }
    /**
     * 判断协议错误是否可重试
     */
    isProtocolErrorRetryable(subCategory) {
        return subCategory === ErrorSubCategory.HTTP_ERROR;
    }
    /**
     * 判断数据错误是否可重试
     */
    isDataErrorRetryable(subCategory) {
        return subCategory === ErrorSubCategory.DATA_CONFLICT;
    }
    /**
     * 使用上下文信息丰富错误
     */
    enrichWithContext(error, context) {
        if (!context)
            return error;
        return {
            ...error,
            userId: context.userId,
            operation: context.request?.operation,
            details: {
                ...error.details,
                context: {
                    environment: context.environment,
                    deviceInfo: context.deviceInfo,
                    networkState: context.networkState
                }
            }
        };
    }
}
exports.ErrorClassifier = ErrorClassifier;
// 统一错误处理器
class UnifiedErrorHandler {
    constructor() {
        Object.defineProperty(this, "handlers", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "classifier", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "logger", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "recoveryManager", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        this.classifier = ErrorClassifier.getInstance();
        this.logger = ErrorLogger.getInstance();
        this.recoveryManager = RecoveryManager.getInstance();
        this.initializeHandlers();
    }
    static getInstance() {
        if (!UnifiedErrorHandler.instance) {
            UnifiedErrorHandler.instance = new UnifiedErrorHandler();
        }
        return UnifiedErrorHandler.instance;
    }
    /**
     * 处理错误
     */
    async handleError(error, context) {
        const startTime = performance.now();
        try {
            // 1. 分类错误
            const unifiedError = this.classifier.classify(error, context);
            // 2. 记录错误日志
            await this.logger.logError(unifiedError, context);
            // 3. 查找合适的处理器
            const handler = this.findHandler(unifiedError);
            if (handler) {
                // 4. 执行错误处理
                const result = await handler.handle(unifiedError, context);
                // 5. 记录处理结果
                await this.logger.logHandlingResult(unifiedError, result);
                return {
                    ...result,
                    metrics: {
                        handlingTime: performance.now() - startTime,
                        attempts: result.metrics?.attempts || 1,
                        memoryUsage: this.getMemoryUsage()
                    }
                };
            }
            // 6. 默认处理
            return await this.defaultHandle(unifiedError, context);
        }
        catch (handlingError) {
            // 处理错误本身出现异常
            console.error('Error handling failed:', handlingError);
            return {
                handled: false,
                error: this.classifier.classify(handlingError, context),
                metrics: {
                    handlingTime: performance.now() - startTime,
                    attempts: 1,
                    memoryUsage: this.getMemoryUsage()
                }
            };
        }
    }
    /**
     * 注册错误处理器
     */
    registerHandler(handler) {
        this.handlers.push(handler);
        this.handlers.sort((a, b) => b.priority - a.priority);
    }
    /**
     * 查找合适的错误处理器
     */
    findHandler(error) {
        return this.handlers.find(handler => handler.canHandle(error));
    }
    /**
     * 默认错误处理
     */
    async defaultHandle(error, context) {
        try {
            // 尝试恢复
            const recoveryResult = await this.recoveryManager.attemptRecovery(error, context);
            if (recoveryResult.success) {
                return {
                    handled: true,
                    error,
                    action: recoveryResult.action,
                    resolution: recoveryResult.message
                };
            }
            // 无法恢复
            return {
                handled: false,
                error,
                action: 'manual',
                resolution: 'Manual intervention required'
            };
        }
        catch (recoveryError) {
            return {
                handled: false,
                error,
                action: 'skip',
                resolution: 'Recovery failed'
            };
        }
    }
    /**
     * 初始化错误处理器
     */
    initializeHandlers() {
        // 网络错误处理器
        this.registerHandler(new NetworkErrorHandler());
        // 数据错误处理器
        this.registerHandler(new DataErrorHandler());
        // 系统错误处理器
        this.registerHandler(new SystemErrorHandler());
        // 默认错误处理器
        this.registerHandler(new DefaultErrorHandler());
    }
    /**
     * 获取内存使用情况
     */
    getMemoryUsage() {
        if (typeof performance !== 'undefined' && performance.memory) {
            const memory = performance.memory;
            return memory.usedJSHeapSize;
        }
        return 0;
    }
}
exports.UnifiedErrorHandler = UnifiedErrorHandler;
// 错误日志器
class ErrorLogger {
    constructor() {
        Object.defineProperty(this, "logs", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "maxLogEntries", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 1000
        });
    }
    static getInstance() {
        if (!ErrorLogger.instance) {
            ErrorLogger.instance = new ErrorLogger();
        }
        return ErrorLogger.instance;
    }
    /**
     * 记录错误日志
     */
    async logError(error, context) {
        const log = {
            id: crypto.randomUUID(),
            timestamp: error.timestamp,
            level: error.level,
            category: error.category,
            code: error.code,
            message: error.message,
            stack: error.stack,
            details: error.details,
            userId: context.userId,
            sessionId: context.sessionId,
            operation: context.request?.operation,
            entityId: context.request?.entityId,
            environment: context.environment,
            deviceInfo: context.deviceInfo,
            networkInfo: context.networkState,
            resolved: false
        };
        this.logs.push(log);
        // 保持日志数量限制
        if (this.logs.length > this.maxLogEntries) {
            this.logs = this.logs.slice(-this.maxLogEntries);
        }
        // 持久化到本地存储
        await this.persistLog(log);
        // 实时上报关键错误
        if (error.level === ErrorLevel.CRITICAL || error.level === ErrorLevel.ERROR) {
            await this.reportError(log);
        }
    }
    /**
     * 记录处理结果
     */
    async logHandlingResult(error, result) {
        const log = this.logs.find(l => l.code === error.code);
        if (log) {
            log.handled = result.handled;
            log.recoveryAction = result.action;
            log.resolutionTime = new Date();
            log.resolution = result.resolution;
            await this.persistLog(log);
        }
    }
    /**
     * 持久化日志
     */
    async persistLog(log) {
        try {
            const logs = this.getStoredLogs();
            logs.push(log);
            // 限制本地存储的日志数量
            if (logs.length > 500) {
                logs.splice(0, logs.length - 500);
            }
            localStorage.setItem('cardall_error_logs', JSON.stringify(logs));
        }
        catch (error) {
            console.error('Failed to persist error log:', error);
        }
    }
    /**
     * 获取存储的日志
     */
    getStoredLogs() {
        try {
            const stored = localStorage.getItem('cardall_error_logs');
            return stored ? JSON.parse(stored) : [];
        }
        catch {
            return [];
        }
    }
    /**
     * 上报错误
     */
    async reportError(log) {
        try {
            // 这里可以实现错误上报到服务器的逻辑
            console.log('Reporting error:', log);
        }
        catch (error) {
            console.error('Failed to report error:', error);
        }
    }
    /**
     * 获取错误统计
     */
    getErrorStatistics() {
        const totalErrors = this.logs.length;
        const errorByLevel = {};
        const errorByCategory = {};
        // 初始化统计
        Object.values(ErrorLevel).forEach(level => {
            errorByLevel[level] = 0;
        });
        Object.values(ErrorCategory).forEach(category => {
            errorByCategory[category] = 0;
        });
        // 统计错误
        this.logs.forEach(log => {
            errorByLevel[log.level]++;
            errorByCategory[log.category]++;
        });
        // 计算恢复率
        const resolvedErrors = this.logs.filter(log => log.resolved).length;
        const recoveryRate = totalErrors > 0 ? resolvedErrors / totalErrors : 0;
        return {
            totalErrors,
            errorByLevel,
            errorByCategory,
            recoveryRate
        };
    }
}
// 恢复管理器
class RecoveryManager {
    constructor() { }
    static getInstance() {
        if (!RecoveryManager.instance) {
            RecoveryManager.instance = new RecoveryManager();
        }
        return RecoveryManager.instance;
    }
    /**
     * 尝试恢复
     */
    async attemptRecovery(error, context) {
        if (!error.retryable) {
            return {
                success: false,
                message: 'Error is not retryable'
            };
        }
        // 根据错误类型选择恢复策略
        switch (error.category) {
            case ErrorCategory.NETWORK:
                return await this.recoverNetworkError(error, context);
            case ErrorCategory.PROTOCOL:
                return await this.recoverProtocolError(error, context);
            case ErrorCategory.DATA:
                return await this.recoverDataError(error, context);
            default:
                return await this.recoverDefaultError(error, context);
        }
    }
    /**
     * 恢复网络错误
     */
    async recoverNetworkError(error, context) {
        // 检查网络状态
        const networkState = network_state_detector_1.networkStateDetector.getCurrentState();
        if (!networkState.isOnline) {
            return {
                success: false,
                action: 'manual',
                message: 'Network is offline, please check connection'
            };
        }
        // 尝试重试
        if (error.retryCount < (error.maxRetries || 3)) {
            return {
                success: true,
                action: 'retry',
                message: 'Will retry network operation'
            };
        }
        return {
            success: false,
            action: 'fallback',
            message: 'Network retry limit exceeded, falling back to local data'
        };
    }
    /**
     * 恢复协议错误
     */
    async recoverProtocolError(error, context) {
        // 认证错误需要重新登录
        if (error.subCategory === ErrorSubCategory.AUTH_ERROR) {
            return {
                success: false,
                action: 'manual',
                message: 'Authentication failed, please re-login'
            };
        }
        // 其他协议错误尝试重试
        if (error.retryCount < (error.maxRetries || 2)) {
            return {
                success: true,
                action: 'retry',
                message: 'Will retry protocol operation'
            };
        }
        return {
            success: false,
            action: 'skip',
            message: 'Protocol error recovery failed'
        };
    }
    /**
     * 恢复数据错误
     */
    async recoverDataError(error, context) {
        // 数据冲突尝试智能解决
        if (error.subCategory === ErrorSubCategory.DATA_CONFLICT) {
            try {
                // 这里可以调用智能冲突解决器
                return {
                    success: true,
                    action: 'repair',
                    message: 'Attempting intelligent conflict resolution'
                };
            }
            catch {
                return {
                    success: false,
                    action: 'manual',
                    message: 'Conflict resolution failed, manual intervention required'
                };
            }
        }
        // 数据损坏尝试回滚
        if (error.subCategory === ErrorSubCategory.DATA_CORRUPTION) {
            return {
                success: true,
                action: 'rollback',
                message: 'Attempting data rollback'
            };
        }
        return {
            success: false,
            action: 'skip',
            message: 'Data error recovery failed'
        };
    }
    /**
     * 默认恢复
     */
    async recoverDefaultError(error, context) {
        if (error.retryable && error.retryCount < (error.maxRetries || 1)) {
            return {
                success: true,
                action: 'retry',
                message: 'Will retry operation'
            };
        }
        return {
            success: false,
            action: 'skip',
            message: 'Default recovery failed'
        };
    }
}
// 具体错误处理器实现
// 网络错误处理器
class NetworkErrorHandler {
    constructor() {
        Object.defineProperty(this, "priority", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 100
        });
    }
    canHandle(error) {
        return error.category === ErrorCategory.NETWORK;
    }
    async handle(error, context) {
        // 更新重试计数
        error.retryCount = (error.retryCount || 0) + 1;
        // 检查是否超过重试限制
        if (error.retryCount >= (error.maxRetries || 3)) {
            return {
                handled: false,
                error,
                action: 'fallback',
                resolution: 'Network retry limit exceeded'
            };
        }
        // 计算重试延迟
        const delay = this.calculateRetryDelay(error.retryCount);
        return {
            handled: true,
            error,
            action: 'retry',
            resolution: `Network error, will retry after ${delay}ms`,
            metrics: {
                handlingTime: 10,
                attempts: error.retryCount,
                memoryUsage: 0
            }
        };
    }
    calculateRetryDelay(attempt) {
        return Math.min(1000 * Math.pow(2, attempt), 30000);
    }
}
// 数据错误处理器
class DataErrorHandler {
    constructor() {
        Object.defineProperty(this, "priority", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 90
        });
    }
    canHandle(error) {
        return error.category === ErrorCategory.DATA;
    }
    async handle(error, context) {
        // 数据冲突处理
        if (error.subCategory === ErrorSubCategory.DATA_CONFLICT) {
            return {
                handled: true,
                error,
                action: 'repair',
                resolution: 'Data conflict detected, attempting resolution',
                metrics: {
                    handlingTime: 50,
                    attempts: 1,
                    memoryUsage: 0
                }
            };
        }
        // 数据损坏处理
        if (error.subCategory === ErrorSubCategory.DATA_CORRUPTION) {
            return {
                handled: true,
                error,
                action: 'rollback',
                resolution: 'Data corruption detected, attempting rollback',
                metrics: {
                    handlingTime: 100,
                    attempts: 1,
                    memoryUsage: 0
                }
            };
        }
        return {
            handled: false,
            error,
            action: 'manual',
            resolution: 'Data error requires manual intervention',
            metrics: {
                handlingTime: 20,
                attempts: 1,
                memoryUsage: 0
            }
        };
    }
}
// 系统错误处理器
class SystemErrorHandler {
    constructor() {
        Object.defineProperty(this, "priority", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 80
        });
    }
    canHandle(error) {
        return error.category === ErrorCategory.SYSTEM;
    }
    async handle(error, context) {
        // 系统错误通常需要重启或降级
        return {
            handled: false,
            error,
            action: 'manual',
            resolution: 'System error requires manual intervention',
            metrics: {
                handlingTime: 5,
                attempts: 1,
                memoryUsage: 0
            }
        };
    }
}
// 默认错误处理器
class DefaultErrorHandler {
    constructor() {
        Object.defineProperty(this, "priority", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: 10
        });
    }
    canHandle(error) {
        return true; // 处理所有错误
    }
    async handle(error, context) {
        return {
            handled: false,
            error,
            action: 'skip',
            resolution: 'No specific handler found for this error',
            metrics: {
                handlingTime: 5,
                attempts: 1,
                memoryUsage: 0
            }
        };
    }
}
// 导出实例
exports.unifiedErrorHandler = UnifiedErrorHandler.getInstance();
// 导出工具函数
const createErrorContext = (request, userId, environment = 'development') => ({
    request,
    userId,
    environment,
    deviceInfo: getDeviceInfo(),
    networkState: network_state_detector_1.networkStateDetector.getCurrentState()
});
exports.createErrorContext = createErrorContext;
function getDeviceInfo() {
    if (typeof navigator !== 'undefined') {
        return {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language
        };
    }
    return {};
}
const handleError = async (error, context) => {
    const fullContext = {
        environment: 'development',
        ...context
    };
    return exports.unifiedErrorHandler.handleError(error, fullContext);
};
exports.handleError = handleError;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcc2VydmljZXNcXGVycm9yLWhhbmRsaW5nXFx1bmlmaWVkLWVycm9yLWhhbmRsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBLFVBQVU7QUFDViwrQkFBK0I7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRS9CLHNFQUFnRTtBQUtoRSxXQUFXO0FBQ1gsMENBQXVCO0FBRXZCLFFBQVE7QUFDUixNQUFhLGVBQWU7SUFJMUI7UUFGUTs7OzttQkFBNkQsSUFBSSxHQUFHLEVBQUU7V0FBQTtRQUc1RSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQTtJQUMzQixDQUFDO0lBRU0sTUFBTSxDQUFDLFdBQVc7UUFDdkIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUM5QixlQUFlLENBQUMsUUFBUSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUE7UUFDbEQsQ0FBQztRQUNELE9BQU8sZUFBZSxDQUFDLFFBQVEsQ0FBQTtJQUNqQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxRQUFRLENBQUMsS0FBVSxFQUFFLE9BQXNCO1FBQ2hELGlCQUFpQjtRQUNqQixJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUMvQixPQUFPLEtBQUssQ0FBQTtRQUNkLENBQUM7UUFFRCxXQUFXO1FBQ1gsS0FBSyxNQUFNLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUM1QyxNQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDakMsSUFBSSxVQUFVLEVBQUUsQ0FBQztnQkFDZixPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUE7WUFDcEQsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPO1FBQ1AsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FB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Q2hDLE1BQU0sV0FBVyxHQUFpQjtRQUNoQyxXQUFXLEVBQUUsYUFBYTtRQUMxQixHQUFHLE9BQU87S0FDWCxDQUFBO0lBRUQsT0FBTywyQkFBbUIsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFBO0FBQzVELENBQUMsQ0FBQTtBQVZZLFFBQUEsV0FBVyxlQVV2QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXENhcmRFdmVyeXRoaW5nXFxjYXJkYWxsLXByb3RvdHlwZVxcc3JjXFxzZXJ2aWNlc1xcZXJyb3ItaGFuZGxpbmdcXHVuaWZpZWQtZXJyb3ItaGFuZGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyDnu5/kuIDplJnor6/lpITnkIblmahcbi8vIENhcmRFdmVyeXRoaW5nIOmUmeivr+WkhOeQhuWSjOaBouWkjeacuuWItuaguOW/g+WunueOsFxuXG5pbXBvcnQgeyBuZXR3b3JrU3RhdGVEZXRlY3RvciB9IGZyb20gJy4uL25ldHdvcmstc3RhdGUtZGV0ZWN0b3InXG5pbXBvcnQgeyBlcnJvclJlY292ZXJ5U3RyYXRlZ3kgfSBmcm9tICcuLi9uZXR3b3JrLWVycm9yLWhhbmRsZXInXG5pbXBvcnQgeyBpbnRlbGxpZ2VudENvbmZsaWN0UmVzb2x2ZXIgfSBmcm9tICcuLi9zeW5jL2NvbmZsaWN0L2ludGVsbGlnZW50LWNvbmZsaWN0LXJlc29sdmVyJ1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYXRhYmFzZS11bmlmaWVkJ1xuXG4vLyDlr7zlhaXnu5/kuIDnsbvlnovlrprkuYlcbmV4cG9ydCAqIGZyb20gJy4vdHlwZXMnXG5cbi8vIOmUmeivr+WIhuexu+WZqFxuZXhwb3J0IGNsYXNzIEVycm9yQ2xhc3NpZmllciB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBFcnJvckNsYXNzaWZpZXJcbiAgcHJpdmF0ZSBwYXR0ZXJuczogTWFwPHN0cmluZywgKGVycm9yOiBhbnkpID0+IFVuaWZpZWRFcnJvciB8IG51bGw+ID0gbmV3IE1hcCgpXG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmluaXRpYWxpemVQYXR0ZXJucygpXG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IEVycm9yQ2xhc3NpZmllciB7XG4gICAgaWYgKCFFcnJvckNsYXNzaWZpZXIuaW5zdGFuY2UpIHtcbiAgICAgIEVycm9yQ2xhc3NpZmllci5pbnN0YW5jZSA9IG5ldyBFcnJvckNsYXNzaWZpZXIoKVxuICAgIH1cbiAgICByZXR1cm4gRXJyb3JDbGFzc2lmaWVyLmluc3RhbmNlXG4gIH1cblxuICAvKipcbiAgICog5YiG57G76ZSZ6K+vXG4gICAqL1xuICBwdWJsaWMgY2xhc3NpZnkoZXJyb3I6IGFueSwgY29udGV4dD86IEVycm9yQ29udGV4dCk6IFVuaWZpZWRFcnJvciB7XG4gICAgLy8g5aaC5p6c5bey57uP5piv57uf5LiA6ZSZ6K+v77yM55u05o6l6L+U5ZueXG4gICAgaWYgKHRoaXMuaXNVbmlmaWVkRXJyb3IoZXJyb3IpKSB7XG4gICAgICByZXR1cm4gZXJyb3JcbiAgICB9XG5cbiAgICAvLyDlsJ3or5XljLnphY3lt7Lnn6XmqKHlvI9cbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBwYXR0ZXJuXSBvZiB0aGlzLnBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBjbGFzc2lmaWVkID0gcGF0dGVybihlcnJvcilcbiAgICAgIGlmIChjbGFzc2lmaWVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVucmljaFdpdGhDb250ZXh0KGNsYXNzaWZpZWQsIGNvbnRleHQpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g6buY6K6k5YiG57G7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlRGVmYXVsdEVycm9yKGVycm9yLCBjb250ZXh0KVxuICB9XG5cbiAgLyoqXG4gICAqIOWIneWni+WMlumUmeivr+aooeW8j1xuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplUGF0dGVybnMoKTogdm9pZCB7XG4gICAgLy8g572R57uc6ZSZ6K+v5qih5byPXG4gICAgdGhpcy5wYXR0ZXJucy5zZXQoJ25ldHdvcmsnLCAoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgaWYgKHRoaXMuaXNOZXR3b3JrRXJyb3IoZXJyb3IpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZU5ldHdvcmtFcnJvcihlcnJvcilcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsXG4gICAgfSlcblxuICAgIC8vIOWNj+iurumUmeivr+aooeW8j1xuICAgIHRoaXMucGF0dGVybnMuc2V0KCdwcm90b2NvbCcsIChlcnJvcjogYW55KSA9PiB7XG4gICAgICBpZiAodGhpcy5pc1Byb3RvY29sRXJyb3IoZXJyb3IpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVByb3RvY29sRXJyb3IoZXJyb3IpXG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH0pXG5cbiAgICAvLyDmlbDmja7plJnor6/mqKHlvI9cbiAgICB0aGlzLnBhdHRlcm5zLnNldCgnZGF0YScsIChlcnJvcjogYW55KSA9PiB7XG4gICAgICBpZiAodGhpcy5pc0RhdGFFcnJvcihlcnJvcikpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRGF0YUVycm9yKGVycm9yKVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9KVxuXG4gICAgLy8g57O757uf6ZSZ6K+v5qih5byPXG4gICAgdGhpcy5wYXR0ZXJucy5zZXQoJ3N5c3RlbScsIChlcnJvcjogYW55KSA9PiB7XG4gICAgICBpZiAodGhpcy5pc1N5c3RlbUVycm9yKGVycm9yKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTeXN0ZW1FcnJvcihlcnJvcilcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDliKTmlq3mmK/lkKbkuLrnvZHnu5zplJnor69cbiAgICovXG4gIHByaXZhdGUgaXNOZXR3b3JrRXJyb3IoZXJyb3I6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBlcnJvcj8ubmFtZT8uaW5jbHVkZXMoJ05ldHdvcmsnKSB8fFxuICAgICAgICAgICBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ25ldHdvcmsnKSB8fFxuICAgICAgICAgICBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ2Nvbm5lY3Rpb24nKSB8fFxuICAgICAgICAgICBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ29mZmxpbmUnKSB8fFxuICAgICAgICAgICBlcnJvcj8uY29kZSA9PT0gJ05FVFdPUktfRVJST1InXG4gIH1cblxuICAvKipcbiAgICog5Yik5pat5piv5ZCm5Li65Y2P6K6u6ZSZ6K+vXG4gICAqL1xuICBwcml2YXRlIGlzUHJvdG9jb2xFcnJvcihlcnJvcjogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGVycm9yPy5zdGF0dXMgPj0gNDAwIHx8XG4gICAgICAgICAgIGVycm9yPy5uYW1lPy5pbmNsdWRlcygnSFRUUCcpIHx8XG4gICAgICAgICAgIGVycm9yPy5tZXNzYWdlPy5pbmNsdWRlcygnaHR0cCcpIHx8XG4gICAgICAgICAgIGVycm9yPy5jb2RlID09PSAnSFRUUF9FUlJPUidcbiAgfVxuXG4gIC8qKlxuICAgKiDliKTmlq3mmK/lkKbkuLrmlbDmja7plJnor69cbiAgICovXG4gIHByaXZhdGUgaXNEYXRhRXJyb3IoZXJyb3I6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBlcnJvcj8ubmFtZT8uaW5jbHVkZXMoJ0RhdGEnKSB8fFxuICAgICAgICAgICBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ2RhdGEnKSB8fFxuICAgICAgICAgICBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ3ZhbGlkYXRpb24nKSB8fFxuICAgICAgICAgICBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ2NvbmZsaWN0JykgfHxcbiAgICAgICAgICAgZXJyb3I/LmNvZGUgPT09ICdEQVRBX0VSUk9SJ1xuICB9XG5cbiAgLyoqXG4gICAqIOWIpOaWreaYr+WQpuS4uuezu+e7n+mUmeivr1xuICAgKi9cbiAgcHJpdmF0ZSBpc1N5c3RlbUVycm9yKGVycm9yOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZXJyb3I/Lm5hbWU/LmluY2x1ZGVzKCdTeXN0ZW0nKSB8fFxuICAgICAgICAgICBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ3N5c3RlbScpIHx8XG4gICAgICAgICAgIGVycm9yPy5tZXNzYWdlPy5pbmNsdWRlcygnbWVtb3J5JykgfHxcbiAgICAgICAgICAgZXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCdyZXNvdXJjZScpIHx8XG4gICAgICAgICAgIGVycm9yPy5jb2RlID09PSAnU1lTVEVNX0VSUk9SJ1xuICB9XG5cbiAgLyoqXG4gICAqIOWIpOaWreaYr+WQpuS4uue7n+S4gOmUmeivr1xuICAgKi9cbiAgcHJpdmF0ZSBpc1VuaWZpZWRFcnJvcihlcnJvcjogYW55KTogZXJyb3IgaXMgVW5pZmllZEVycm9yIHtcbiAgICByZXR1cm4gZXJyb3IgJiZcbiAgICAgICAgICAgdHlwZW9mIGVycm9yLmlkID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICB0eXBlb2YgZXJyb3IuY29kZSA9PT0gJ3N0cmluZycgJiZcbiAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhFcnJvckxldmVsKS5pbmNsdWRlcyhlcnJvci5sZXZlbCkgJiZcbiAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhFcnJvckNhdGVnb3J5KS5pbmNsdWRlcyhlcnJvci5jYXRlZ29yeSlcbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rnvZHnu5zplJnor69cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlTmV0d29ya0Vycm9yKGVycm9yOiBhbnkpOiBVbmlmaWVkRXJyb3Ige1xuICAgIGNvbnN0IHN1YkNhdGVnb3J5ID0gdGhpcy5kZXRlcm1pbmVOZXR3b3JrU3ViQ2F0ZWdvcnkoZXJyb3IpXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICBjb2RlOiBgU1lOQ19ORVRfJHt0aGlzLmdlbmVyYXRlRXJyb3JDb2RlKHN1YkNhdGVnb3J5KX1gLFxuICAgICAgbGV2ZWw6IEVycm9yTGV2ZWwuRVJST1IsXG4gICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5ORVRXT1JLLFxuICAgICAgc3ViQ2F0ZWdvcnksXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdOZXR3b3JrIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgcmV0cnlhYmxlOiB0aGlzLmlzTmV0d29ya0Vycm9yUmV0cnlhYmxlKHN1YkNhdGVnb3J5KSxcbiAgICAgIG1heFJldHJpZXM6IDNcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yib5bu65Y2P6K6u6ZSZ6K+vXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZVByb3RvY29sRXJyb3IoZXJyb3I6IGFueSk6IFVuaWZpZWRFcnJvciB7XG4gICAgY29uc3Qgc3ViQ2F0ZWdvcnkgPSB0aGlzLmRldGVybWluZVByb3RvY29sU3ViQ2F0ZWdvcnkoZXJyb3IpXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICBjb2RlOiBgU1lOQ19QUk9UT18ke3RoaXMuZ2VuZXJhdGVFcnJvckNvZGUoc3ViQ2F0ZWdvcnkpfWAsXG4gICAgICBsZXZlbDogRXJyb3JMZXZlbC5FUlJPUixcbiAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LlBST1RPQ09MLFxuICAgICAgc3ViQ2F0ZWdvcnksXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdQcm90b2NvbCBlcnJvciBvY2N1cnJlZCcsXG4gICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHJldHJ5YWJsZTogdGhpcy5pc1Byb3RvY29sRXJyb3JSZXRyeWFibGUoc3ViQ2F0ZWdvcnkpLFxuICAgICAgbWF4UmV0cmllczogMlxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliJvlu7rmlbDmja7plJnor69cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlRGF0YUVycm9yKGVycm9yOiBhbnkpOiBVbmlmaWVkRXJyb3Ige1xuICAgIGNvbnN0IHN1YkNhdGVnb3J5ID0gdGhpcy5kZXRlcm1pbmVEYXRhU3ViQ2F0ZWdvcnkoZXJyb3IpXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICBjb2RlOiBgU1lOQ19EQVRBXyR7dGhpcy5nZW5lcmF0ZUVycm9yQ29kZShzdWJDYXRlZ29yeSl9YCxcbiAgICAgIGxldmVsOiBFcnJvckxldmVsLkVSUk9SLFxuICAgICAgY2F0ZWdvcnk6IEVycm9yQ2F0ZWdvcnkuREFUQSxcbiAgICAgIHN1YkNhdGVnb3J5LFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRGF0YSBlcnJvciBvY2N1cnJlZCcsXG4gICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHJldHJ5YWJsZTogdGhpcy5pc0RhdGFFcnJvclJldHJ5YWJsZShzdWJDYXRlZ29yeSksXG4gICAgICBtYXhSZXRyaWVzOiAxXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uuezu+e7n+mUmeivr1xuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVTeXN0ZW1FcnJvcihlcnJvcjogYW55KTogVW5pZmllZEVycm9yIHtcbiAgICBjb25zdCBzdWJDYXRlZ29yeSA9IHRoaXMuZGV0ZXJtaW5lU3lzdGVtU3ViQ2F0ZWdvcnkoZXJyb3IpXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICBjb2RlOiBgU1lOQ19TWVNfJHt0aGlzLmdlbmVyYXRlRXJyb3JDb2RlKHN1YkNhdGVnb3J5KX1gLFxuICAgICAgbGV2ZWw6IEVycm9yTGV2ZWwuQ1JJVElDQUwsXG4gICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5TWVNURU0sXG4gICAgICBzdWJDYXRlZ29yeSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ1N5c3RlbSBlcnJvciBvY2N1cnJlZCcsXG4gICAgICBkZXRhaWxzOiBlcnJvcixcbiAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHJldHJ5YWJsZTogZmFsc2UsXG4gICAgICBtYXhSZXRyaWVzOiAwXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIm+W7uum7mOiupOmUmeivr1xuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVEZWZhdWx0RXJyb3IoZXJyb3I6IGFueSwgY29udGV4dD86IEVycm9yQ29udGV4dCk6IFVuaWZpZWRFcnJvciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgY29kZTogJ1NZTkNfVU5LTk9XTl8wMDEnLFxuICAgICAgbGV2ZWw6IEVycm9yTGV2ZWwuV0FSTklORyxcbiAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LkFQUExJQ0FUSU9OLFxuICAgICAgc3ViQ2F0ZWdvcnk6IEVycm9yU3ViQ2F0ZWdvcnkuQlVTSU5FU1NfTE9HSUNfRVJST1IsXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIGRldGFpbHM6IGVycm9yLFxuICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgcmV0cnlhYmxlOiB0cnVlLFxuICAgICAgbWF4UmV0cmllczogMVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDnoa7lrprnvZHnu5zplJnor6/lrZDnsbvliKtcbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lTmV0d29ya1N1YkNhdGVnb3J5KGVycm9yOiBhbnkpOiBFcnJvclN1YkNhdGVnb3J5IHtcbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ3RpbWVvdXQnKSkge1xuICAgICAgcmV0dXJuIEVycm9yU3ViQ2F0ZWdvcnkuTkVUV09SS19USU1FT1VUXG4gICAgfVxuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnY29ubmVjdGlvbicpIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdvZmZsaW5lJykpIHtcbiAgICAgIHJldHVybiBFcnJvclN1YkNhdGVnb3J5LkNPTk5FQ1RJT05fTE9TVFxuICAgIH1cbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2JhbmR3aWR0aCcpIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdsaW1pdCcpKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5CQU5EV0lEVEhfTElNSVRcbiAgICB9XG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdkbnMnKSB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncmVzb2x2ZScpKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5ETlNfRkFJTFVSRVxuICAgIH1cbiAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5DT05ORUNUSU9OX0xPU1RcbiAgfVxuXG4gIC8qKlxuICAgKiDnoa7lrprljY/orq7plJnor6/lrZDnsbvliKtcbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lUHJvdG9jb2xTdWJDYXRlZ29yeShlcnJvcjogYW55KTogRXJyb3JTdWJDYXRlZ29yeSB7XG4gICAgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDAxIHx8IGVycm9yLnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5BVVRIX0VSUk9SXG4gICAgfVxuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnc3NsJykgfHwgZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ3RscycpIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdjZXJ0aWZpY2F0ZScpKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5TU0xfRVJST1JcbiAgICB9XG4gICAgcmV0dXJuIEVycm9yU3ViQ2F0ZWdvcnkuSFRUUF9FUlJPUlxuICB9XG5cbiAgLyoqXG4gICAqIOehruWumuaVsOaNrumUmeivr+WtkOexu+WIq1xuICAgKi9cbiAgcHJpdmF0ZSBkZXRlcm1pbmVEYXRhU3ViQ2F0ZWdvcnkoZXJyb3I6IGFueSk6IEVycm9yU3ViQ2F0ZWdvcnkge1xuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnY29uZmxpY3QnKSB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnY29uY3VycmVudCcpKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5EQVRBX0NPTkZMSUNUXG4gICAgfVxuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnY29ycnVwdGlvbicpIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdjb3JydXB0JykpIHtcbiAgICAgIHJldHVybiBFcnJvclN1YkNhdGVnb3J5LkRBVEFfQ09SUlVQVElPTlxuICAgIH1cbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2xvc3MnKSB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbWlzc2luZycpKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5EQVRBX0xPU1NcbiAgICB9XG4gICAgcmV0dXJuIEVycm9yU3ViQ2F0ZWdvcnkuVkFMSURBVElPTl9FUlJPUlxuICB9XG5cbiAgLyoqXG4gICAqIOehruWumuezu+e7n+mUmeivr+WtkOexu+WIq1xuICAgKi9cbiAgcHJpdmF0ZSBkZXRlcm1pbmVTeXN0ZW1TdWJDYXRlZ29yeShlcnJvcjogYW55KTogRXJyb3JTdWJDYXRlZ29yeSB7XG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdvdmVybG9hZCcpIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdvdmVybG9hZGVkJykpIHtcbiAgICAgIHJldHVybiBFcnJvclN1YkNhdGVnb3J5LlNZU1RFTV9PVkVSTE9BRFxuICAgIH1cbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ21lbW9yeScpIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdyZXNvdXJjZScpKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5SRVNPVVJDRV9FWEhBVVNURURcbiAgICB9XG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdjb25maWcnKSB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnY29uZmlndXJhdGlvbicpKSB7XG4gICAgICByZXR1cm4gRXJyb3JTdWJDYXRlZ29yeS5DT05GSUdVUkFUSU9OX0VSUk9SXG4gICAgfVxuICAgIHJldHVybiBFcnJvclN1YkNhdGVnb3J5LlNZU1RFTV9PVkVSTE9BRFxuICB9XG5cbiAgLyoqXG4gICAqIOeUn+aIkOmUmeivr+S7o+eggVxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUVycm9yQ29kZShzdWJDYXRlZ29yeTogRXJyb3JTdWJDYXRlZ29yeSk6IHN0cmluZyB7XG4gICAgY29uc3QgY29kZU1hcDogUmVjb3JkPEVycm9yU3ViQ2F0ZWdvcnksIHN0cmluZz4gPSB7XG4gICAgICBbRXJyb3JTdWJDYXRlZ29yeS5DT05ORUNUSU9OX0xPU1RdOiAnQ09OTl8wMDEnLFxuICAgICAgW0Vycm9yU3ViQ2F0ZWdvcnkuTkVUV09SS19USU1FT1VUXTogJ1RJTUVfMDAxJyxcbiAgICAgIFtFcnJvclN1YkNhdGVnb3J5LkJBTkRXSURUSF9MSU1JVF06ICdCQU5EXzAwMScsXG4gICAgICBbRXJyb3JTdWJDYXRlZ29yeS5ETlNfRkFJTFVSRV06ICdETlNfMDAxJyxcbiAgICAgIFtFcnJvclN1YkNhdGVnb3J5LkhUVFBfRVJST1JdOiAnSFRUUF8wMDEnLFxuICAgICAgW0Vycm9yU3ViQ2F0ZWdvcnkuU1NMX0VSUk9SXTogJ1NTTF8wMDEnLFxuICAgICAgW0Vycm9yU3ViQ2F0ZWdvcnkuQVVUSF9FUlJPUl06ICdBVVRIXzAwMScsXG4gICAgICBbRXJyb3JTdWJDYXRlZ29yeS5WQUxJREFUSU9OX0VSUk9SXTogJ1ZBTF8wMDEnLFxuICAgICAgW0Vycm9yU3ViQ2F0ZWdvcnkuQlVTSU5FU1NfTE9HSUNfRVJST1JdOiAnTE9HSUNfMDAxJyxcbiAgICAgIFtFcnJvclN1YkNhdGVnb3J5LlBFUk1JU1NJT05fRVJST1JdOiAnUEVSTV8wMDEnLFxuICAgICAgW0Vycm9yU3ViQ2F0ZWdvcnkuREFUQV9DT05GTElDVF06ICdDT05GXzAwMScsXG4gICAgICBbRXJyb3JTdWJDYXRlZ29yeS5EQVRBX0NPUlJVUFRJT05dOiAnQ09SUl8wMDEnLFxuICAgICAgW0Vycm9yU3ViQ2F0ZWdvcnkuREFUQV9MT1NTXTogJ0xPU1NfMDAxJyxcbiAgICAgIFtFcnJvclN1YkNhdGVnb3J5LlNZU1RFTV9PVkVSTE9BRF06ICdPVkVSXzAwMScsXG4gICAgICBbRXJyb3JTdWJDYXRlZ29yeS5SRVNPVVJDRV9FWEhBVVNURURdOiAnUkVTXzAwMScsXG4gICAgICBbRXJyb3JTdWJDYXRlZ29yeS5DT05GSUdVUkFUSU9OX0VSUk9SXTogJ0NPTkZfMDAxJ1xuICAgIH1cblxuICAgIHJldHVybiBjb2RlTWFwW3N1YkNhdGVnb3J5XSB8fCAnVU5LTl8wMDEnXG4gIH1cblxuICAvKipcbiAgICog5Yik5pat572R57uc6ZSZ6K+v5piv5ZCm5Y+v6YeN6K+VXG4gICAqL1xuICBwcml2YXRlIGlzTmV0d29ya0Vycm9yUmV0cnlhYmxlKHN1YkNhdGVnb3J5OiBFcnJvclN1YkNhdGVnb3J5KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIFtcbiAgICAgIEVycm9yU3ViQ2F0ZWdvcnkuQ09OTkVDVElPTl9MT1NULFxuICAgICAgRXJyb3JTdWJDYXRlZ29yeS5ORVRXT1JLX1RJTUVPVVQsXG4gICAgICBFcnJvclN1YkNhdGVnb3J5LkJBTkRXSURUSF9MSU1JVFxuICAgIF0uaW5jbHVkZXMoc3ViQ2F0ZWdvcnkpXG4gIH1cblxuICAvKipcbiAgICog5Yik5pat5Y2P6K6u6ZSZ6K+v5piv5ZCm5Y+v6YeN6K+VXG4gICAqL1xuICBwcml2YXRlIGlzUHJvdG9jb2xFcnJvclJldHJ5YWJsZShzdWJDYXRlZ29yeTogRXJyb3JTdWJDYXRlZ29yeSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBzdWJDYXRlZ29yeSA9PT0gRXJyb3JTdWJDYXRlZ29yeS5IVFRQX0VSUk9SXG4gIH1cblxuICAvKipcbiAgICog5Yik5pat5pWw5o2u6ZSZ6K+v5piv5ZCm5Y+v6YeN6K+VXG4gICAqL1xuICBwcml2YXRlIGlzRGF0YUVycm9yUmV0cnlhYmxlKHN1YkNhdGVnb3J5OiBFcnJvclN1YkNhdGVnb3J5KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHN1YkNhdGVnb3J5ID09PSBFcnJvclN1YkNhdGVnb3J5LkRBVEFfQ09ORkxJQ1RcbiAgfVxuXG4gIC8qKlxuICAgKiDkvb/nlKjkuIrkuIvmlofkv6Hmga/kuLDlr4zplJnor69cbiAgICovXG4gIHByaXZhdGUgZW5yaWNoV2l0aENvbnRleHQoZXJyb3I6IFVuaWZpZWRFcnJvciwgY29udGV4dD86IEVycm9yQ29udGV4dCk6IFVuaWZpZWRFcnJvciB7XG4gICAgaWYgKCFjb250ZXh0KSByZXR1cm4gZXJyb3JcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5lcnJvcixcbiAgICAgIHVzZXJJZDogY29udGV4dC51c2VySWQsXG4gICAgICBvcGVyYXRpb246IGNvbnRleHQucmVxdWVzdD8ub3BlcmF0aW9uLFxuICAgICAgZGV0YWlsczoge1xuICAgICAgICAuLi5lcnJvci5kZXRhaWxzLFxuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgZW52aXJvbm1lbnQ6IGNvbnRleHQuZW52aXJvbm1lbnQsXG4gICAgICAgICAgZGV2aWNlSW5mbzogY29udGV4dC5kZXZpY2VJbmZvLFxuICAgICAgICAgIG5ldHdvcmtTdGF0ZTogY29udGV4dC5uZXR3b3JrU3RhdGVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vLyDnu5/kuIDplJnor6/lpITnkIblmahcbmV4cG9ydCBjbGFzcyBVbmlmaWVkRXJyb3JIYW5kbGVyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFVuaWZpZWRFcnJvckhhbmRsZXJcbiAgcHJpdmF0ZSBoYW5kbGVyczogRXJyb3JIYW5kbGVyW10gPSBbXVxuICBwcml2YXRlIGNsYXNzaWZpZXI6IEVycm9yQ2xhc3NpZmllclxuICBwcml2YXRlIGxvZ2dlcjogRXJyb3JMb2dnZXJcbiAgcHJpdmF0ZSByZWNvdmVyeU1hbmFnZXI6IFJlY292ZXJ5TWFuYWdlclxuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jbGFzc2lmaWVyID0gRXJyb3JDbGFzc2lmaWVyLmdldEluc3RhbmNlKClcbiAgICB0aGlzLmxvZ2dlciA9IEVycm9yTG9nZ2VyLmdldEluc3RhbmNlKClcbiAgICB0aGlzLnJlY292ZXJ5TWFuYWdlciA9IFJlY292ZXJ5TWFuYWdlci5nZXRJbnN0YW5jZSgpXG4gICAgdGhpcy5pbml0aWFsaXplSGFuZGxlcnMoKVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBVbmlmaWVkRXJyb3JIYW5kbGVyIHtcbiAgICBpZiAoIVVuaWZpZWRFcnJvckhhbmRsZXIuaW5zdGFuY2UpIHtcbiAgICAgIFVuaWZpZWRFcnJvckhhbmRsZXIuaW5zdGFuY2UgPSBuZXcgVW5pZmllZEVycm9ySGFuZGxlcigpXG4gICAgfVxuICAgIHJldHVybiBVbmlmaWVkRXJyb3JIYW5kbGVyLmluc3RhbmNlXG4gIH1cblxuICAvKipcbiAgICog5aSE55CG6ZSZ6K+vXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgaGFuZGxlRXJyb3IoXG4gICAgZXJyb3I6IGFueSxcbiAgICBjb250ZXh0OiBFcnJvckNvbnRleHRcbiAgKTogUHJvbWlzZTxFcnJvckhhbmRsaW5nUmVzdWx0PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KClcblxuICAgIHRyeSB7XG4gICAgICAvLyAxLiDliIbnsbvplJnor69cbiAgICAgIGNvbnN0IHVuaWZpZWRFcnJvciA9IHRoaXMuY2xhc3NpZmllci5jbGFzc2lmeShlcnJvciwgY29udGV4dClcblxuICAgICAgLy8gMi4g6K6w5b2V6ZSZ6K+v5pel5b+XXG4gICAgICBhd2FpdCB0aGlzLmxvZ2dlci5sb2dFcnJvcih1bmlmaWVkRXJyb3IsIGNvbnRleHQpXG5cbiAgICAgIC8vIDMuIOafpeaJvuWQiOmAgueahOWkhOeQhuWZqFxuICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuZmluZEhhbmRsZXIodW5pZmllZEVycm9yKVxuXG4gICAgICBpZiAoaGFuZGxlcikge1xuICAgICAgICAvLyA0LiDmiafooYzplJnor6/lpITnkIZcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlci5oYW5kbGUodW5pZmllZEVycm9yLCBjb250ZXh0KVxuXG4gICAgICAgIC8vIDUuIOiusOW9leWkhOeQhue7k+aenFxuICAgICAgICBhd2FpdCB0aGlzLmxvZ2dlci5sb2dIYW5kbGluZ1Jlc3VsdCh1bmlmaWVkRXJyb3IsIHJlc3VsdClcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgICBoYW5kbGluZ1RpbWU6IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgICAgYXR0ZW1wdHM6IHJlc3VsdC5tZXRyaWNzPy5hdHRlbXB0cyB8fCAxLFxuICAgICAgICAgICAgbWVtb3J5VXNhZ2U6IHRoaXMuZ2V0TWVtb3J5VXNhZ2UoKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyA2LiDpu5jorqTlpITnkIZcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmRlZmF1bHRIYW5kbGUodW5pZmllZEVycm9yLCBjb250ZXh0KVxuXG4gICAgfSBjYXRjaCAoaGFuZGxpbmdFcnJvcikge1xuICAgICAgLy8g5aSE55CG6ZSZ6K+v5pys6Lqr5Ye6546w5byC5bi4XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBoYW5kbGluZyBmYWlsZWQ6JywgaGFuZGxpbmdFcnJvcilcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGFuZGxlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiB0aGlzLmNsYXNzaWZpZXIuY2xhc3NpZnkoaGFuZGxpbmdFcnJvciwgY29udGV4dCksXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICBoYW5kbGluZ1RpbWU6IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgIGF0dGVtcHRzOiAxLFxuICAgICAgICAgIG1lbW9yeVVzYWdlOiB0aGlzLmdldE1lbW9yeVVzYWdlKClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDms6jlhozplJnor6/lpITnkIblmahcbiAgICovXG4gIHB1YmxpYyByZWdpc3RlckhhbmRsZXIoaGFuZGxlcjogRXJyb3JIYW5kbGVyKTogdm9pZCB7XG4gICAgdGhpcy5oYW5kbGVycy5wdXNoKGhhbmRsZXIpXG4gICAgdGhpcy5oYW5kbGVycy5zb3J0KChhLCBiKSA9PiBiLnByaW9yaXR5IC0gYS5wcmlvcml0eSlcbiAgfVxuXG4gIC8qKlxuICAgKiDmn6Xmib7lkIjpgILnmoTplJnor6/lpITnkIblmahcbiAgICovXG4gIHByaXZhdGUgZmluZEhhbmRsZXIoZXJyb3I6IFVuaWZpZWRFcnJvcik6IEVycm9ySGFuZGxlciB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmhhbmRsZXJzLmZpbmQoaGFuZGxlciA9PiBoYW5kbGVyLmNhbkhhbmRsZShlcnJvcikpXG4gIH1cblxuICAvKipcbiAgICog6buY6K6k6ZSZ6K+v5aSE55CGXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGRlZmF1bHRIYW5kbGUoXG4gICAgZXJyb3I6IFVuaWZpZWRFcnJvcixcbiAgICBjb250ZXh0OiBFcnJvckNvbnRleHRcbiAgKTogUHJvbWlzZTxFcnJvckhhbmRsaW5nUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIOWwneivleaBouWkjVxuICAgICAgY29uc3QgcmVjb3ZlcnlSZXN1bHQgPSBhd2FpdCB0aGlzLnJlY292ZXJ5TWFuYWdlci5hdHRlbXB0UmVjb3ZlcnkoZXJyb3IsIGNvbnRleHQpXG5cbiAgICAgIGlmIChyZWNvdmVyeVJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaGFuZGxlZDogdHJ1ZSxcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBhY3Rpb246IHJlY292ZXJ5UmVzdWx0LmFjdGlvbixcbiAgICAgICAgICByZXNvbHV0aW9uOiByZWNvdmVyeVJlc3VsdC5tZXNzYWdlXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8g5peg5rOV5oGi5aSNXG4gICAgICByZXR1cm4ge1xuICAgICAgICBoYW5kbGVkOiBmYWxzZSxcbiAgICAgICAgZXJyb3IsXG4gICAgICAgIGFjdGlvbjogJ21hbnVhbCcsXG4gICAgICAgIHJlc29sdXRpb246ICdNYW51YWwgaW50ZXJ2ZW50aW9uIHJlcXVpcmVkJ1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAocmVjb3ZlcnlFcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGFuZGxlZDogZmFsc2UsXG4gICAgICAgIGVycm9yLFxuICAgICAgICBhY3Rpb246ICdza2lwJyxcbiAgICAgICAgcmVzb2x1dGlvbjogJ1JlY292ZXJ5IGZhaWxlZCdcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yid5aeL5YyW6ZSZ6K+v5aSE55CG5ZmoXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVIYW5kbGVycygpOiB2b2lkIHtcbiAgICAvLyDnvZHnu5zplJnor6/lpITnkIblmahcbiAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcihuZXcgTmV0d29ya0Vycm9ySGFuZGxlcigpKVxuXG4gICAgLy8g5pWw5o2u6ZSZ6K+v5aSE55CG5ZmoXG4gICAgdGhpcy5yZWdpc3RlckhhbmRsZXIobmV3IERhdGFFcnJvckhhbmRsZXIoKSlcblxuICAgIC8vIOezu+e7n+mUmeivr+WkhOeQhuWZqFxuICAgIHRoaXMucmVnaXN0ZXJIYW5kbGVyKG5ldyBTeXN0ZW1FcnJvckhhbmRsZXIoKSlcblxuICAgIC8vIOm7mOiupOmUmeivr+WkhOeQhuWZqFxuICAgIHRoaXMucmVnaXN0ZXJIYW5kbGVyKG5ldyBEZWZhdWx0RXJyb3JIYW5kbGVyKCkpXG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5YaF5a2Y5L2/55So5oOF5Ya1XG4gICAqL1xuICBwcml2YXRlIGdldE1lbW9yeVVzYWdlKCk6IG51bWJlciB7XG4gICAgaWYgKHR5cGVvZiBwZXJmb3JtYW5jZSAhPT0gJ3VuZGVmaW5lZCcgJiYgKHBlcmZvcm1hbmNlIGFzIGFueSkubWVtb3J5KSB7XG4gICAgICBjb25zdCBtZW1vcnkgPSAocGVyZm9ybWFuY2UgYXMgYW55KS5tZW1vcnlcbiAgICAgIHJldHVybiBtZW1vcnkudXNlZEpTSGVhcFNpemVcbiAgICB9XG4gICAgcmV0dXJuIDBcbiAgfVxufVxuXG4vLyDplJnor6/ml6Xlv5flmahcbmNsYXNzIEVycm9yTG9nZ2VyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IEVycm9yTG9nZ2VyXG4gIHByaXZhdGUgbG9nczogRXJyb3JMb2dbXSA9IFtdXG4gIHByaXZhdGUgbWF4TG9nRW50cmllcyA9IDEwMDBcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge31cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IEVycm9yTG9nZ2VyIHtcbiAgICBpZiAoIUVycm9yTG9nZ2VyLmluc3RhbmNlKSB7XG4gICAgICBFcnJvckxvZ2dlci5pbnN0YW5jZSA9IG5ldyBFcnJvckxvZ2dlcigpXG4gICAgfVxuICAgIHJldHVybiBFcnJvckxvZ2dlci5pbnN0YW5jZVxuICB9XG5cbiAgLyoqXG4gICAqIOiusOW9lemUmeivr+aXpeW/l1xuICAgKi9cbiAgcHVibGljIGFzeW5jIGxvZ0Vycm9yKGVycm9yOiBVbmlmaWVkRXJyb3IsIGNvbnRleHQ6IEVycm9yQ29udGV4dCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGxvZzogRXJyb3JMb2cgPSB7XG4gICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgIHRpbWVzdGFtcDogZXJyb3IudGltZXN0YW1wLFxuICAgICAgbGV2ZWw6IGVycm9yLmxldmVsLFxuICAgICAgY2F0ZWdvcnk6IGVycm9yLmNhdGVnb3J5LFxuICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICBzdGFjazogZXJyb3Iuc3RhY2ssXG4gICAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzLFxuICAgICAgdXNlcklkOiBjb250ZXh0LnVzZXJJZCxcbiAgICAgIHNlc3Npb25JZDogY29udGV4dC5zZXNzaW9uSWQsXG4gICAgICBvcGVyYXRpb246IGNvbnRleHQucmVxdWVzdD8ub3BlcmF0aW9uLFxuICAgICAgZW50aXR5SWQ6IGNvbnRleHQucmVxdWVzdD8uZW50aXR5SWQsXG4gICAgICBlbnZpcm9ubWVudDogY29udGV4dC5lbnZpcm9ubWVudCxcbiAgICAgIGRldmljZUluZm86IGNvbnRleHQuZGV2aWNlSW5mbyxcbiAgICAgIG5ldHdvcmtJbmZvOiBjb250ZXh0Lm5ldHdvcmtTdGF0ZSxcbiAgICAgIHJlc29sdmVkOiBmYWxzZVxuICAgIH1cblxuICAgIHRoaXMubG9ncy5wdXNoKGxvZylcblxuICAgIC8vIOS/neaMgeaXpeW/l+aVsOmHj+mZkOWItlxuICAgIGlmICh0aGlzLmxvZ3MubGVuZ3RoID4gdGhpcy5tYXhMb2dFbnRyaWVzKSB7XG4gICAgICB0aGlzLmxvZ3MgPSB0aGlzLmxvZ3Muc2xpY2UoLXRoaXMubWF4TG9nRW50cmllcylcbiAgICB9XG5cbiAgICAvLyDmjIHkuYXljJbliLDmnKzlnLDlrZjlgqhcbiAgICBhd2FpdCB0aGlzLnBlcnNpc3RMb2cobG9nKVxuXG4gICAgLy8g5a6e5pe25LiK5oql5YWz6ZSu6ZSZ6K+vXG4gICAgaWYgKGVycm9yLmxldmVsID09PSBFcnJvckxldmVsLkNSSVRJQ0FMIHx8IGVycm9yLmxldmVsID09PSBFcnJvckxldmVsLkVSUk9SKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlcG9ydEVycm9yKGxvZylcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6K6w5b2V5aSE55CG57uT5p6cXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgbG9nSGFuZGxpbmdSZXN1bHQoZXJyb3I6IFVuaWZpZWRFcnJvciwgcmVzdWx0OiBFcnJvckhhbmRsaW5nUmVzdWx0KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgbG9nID0gdGhpcy5sb2dzLmZpbmQobCA9PiBsLmNvZGUgPT09IGVycm9yLmNvZGUpXG4gICAgaWYgKGxvZykge1xuICAgICAgbG9nLmhhbmRsZWQgPSByZXN1bHQuaGFuZGxlZFxuICAgICAgbG9nLnJlY292ZXJ5QWN0aW9uID0gcmVzdWx0LmFjdGlvblxuICAgICAgbG9nLnJlc29sdXRpb25UaW1lID0gbmV3IERhdGUoKVxuICAgICAgbG9nLnJlc29sdXRpb24gPSByZXN1bHQucmVzb2x1dGlvblxuICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0TG9nKGxvZylcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5oyB5LmF5YyW5pel5b+XXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHBlcnNpc3RMb2cobG9nOiBFcnJvckxvZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBsb2dzID0gdGhpcy5nZXRTdG9yZWRMb2dzKClcbiAgICAgIGxvZ3MucHVzaChsb2cpXG5cbiAgICAgIC8vIOmZkOWItuacrOWcsOWtmOWCqOeahOaXpeW/l+aVsOmHj1xuICAgICAgaWYgKGxvZ3MubGVuZ3RoID4gNTAwKSB7XG4gICAgICAgIGxvZ3Muc3BsaWNlKDAsIGxvZ3MubGVuZ3RoIC0gNTAwKVxuICAgICAgfVxuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FyZGFsbF9lcnJvcl9sb2dzJywgSlNPTi5zdHJpbmdpZnkobG9ncykpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwZXJzaXN0IGVycm9yIGxvZzonLCBlcnJvcilcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5a2Y5YKo55qE5pel5b+XXG4gICAqL1xuICBwcml2YXRlIGdldFN0b3JlZExvZ3MoKTogRXJyb3JMb2dbXSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0b3JlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYXJkYWxsX2Vycm9yX2xvZ3MnKVxuICAgICAgcmV0dXJuIHN0b3JlZCA/IEpTT04ucGFyc2Uoc3RvcmVkKSA6IFtdXG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5LiK5oql6ZSZ6K+vXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlcG9ydEVycm9yKGxvZzogRXJyb3JMb2cpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8g6L+Z6YeM5Y+v5Lul5a6e546w6ZSZ6K+v5LiK5oql5Yiw5pyN5Yqh5Zmo55qE6YC76L6RXG4gICAgICBjb25zb2xlLmxvZygnUmVwb3J0aW5nIGVycm9yOicsIGxvZylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHJlcG9ydCBlcnJvcjonLCBlcnJvcilcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W6ZSZ6K+v57uf6K6hXG4gICAqL1xuICBwdWJsaWMgZ2V0RXJyb3JTdGF0aXN0aWNzKCk6IHtcbiAgICB0b3RhbEVycm9yczogbnVtYmVyXG4gICAgZXJyb3JCeUxldmVsOiBSZWNvcmQ8RXJyb3JMZXZlbCwgbnVtYmVyPlxuICAgIGVycm9yQnlDYXRlZ29yeTogUmVjb3JkPEVycm9yQ2F0ZWdvcnksIG51bWJlcj5cbiAgICByZWNvdmVyeVJhdGU6IG51bWJlclxuICB9IHtcbiAgICBjb25zdCB0b3RhbEVycm9ycyA9IHRoaXMubG9ncy5sZW5ndGhcbiAgICBjb25zdCBlcnJvckJ5TGV2ZWw6IFJlY29yZDxFcnJvckxldmVsLCBudW1iZXI+ID0ge30gYXMgYW55XG4gICAgY29uc3QgZXJyb3JCeUNhdGVnb3J5OiBSZWNvcmQ8RXJyb3JDYXRlZ29yeSwgbnVtYmVyPiA9IHt9IGFzIGFueVxuXG4gICAgLy8g5Yid5aeL5YyW57uf6K6hXG4gICAgT2JqZWN0LnZhbHVlcyhFcnJvckxldmVsKS5mb3JFYWNoKGxldmVsID0+IHtcbiAgICAgIGVycm9yQnlMZXZlbFtsZXZlbF0gPSAwXG4gICAgfSlcbiAgICBPYmplY3QudmFsdWVzKEVycm9yQ2F0ZWdvcnkpLmZvckVhY2goY2F0ZWdvcnkgPT4ge1xuICAgICAgZXJyb3JCeUNhdGVnb3J5W2NhdGVnb3J5XSA9IDBcbiAgICB9KVxuXG4gICAgLy8g57uf6K6h6ZSZ6K+vXG4gICAgdGhpcy5sb2dzLmZvckVhY2gobG9nID0+IHtcbiAgICAgIGVycm9yQnlMZXZlbFtsb2cubGV2ZWxdKytcbiAgICAgIGVycm9yQnlDYXRlZ29yeVtsb2cuY2F0ZWdvcnldKytcbiAgICB9KVxuXG4gICAgLy8g6K6h566X5oGi5aSN546HXG4gICAgY29uc3QgcmVzb2x2ZWRFcnJvcnMgPSB0aGlzLmxvZ3MuZmlsdGVyKGxvZyA9PiBsb2cucmVzb2x2ZWQpLmxlbmd0aFxuICAgIGNvbnN0IHJlY292ZXJ5UmF0ZSA9IHRvdGFsRXJyb3JzID4gMCA/IHJlc29sdmVkRXJyb3JzIC8gdG90YWxFcnJvcnMgOiAwXG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxFcnJvcnMsXG4gICAgICBlcnJvckJ5TGV2ZWwsXG4gICAgICBlcnJvckJ5Q2F0ZWdvcnksXG4gICAgICByZWNvdmVyeVJhdGVcbiAgICB9XG4gIH1cbn1cblxuLy8g5oGi5aSN566h55CG5ZmoXG5jbGFzcyBSZWNvdmVyeU1hbmFnZXIge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUmVjb3ZlcnlNYW5hZ2VyXG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBSZWNvdmVyeU1hbmFnZXIge1xuICAgIGlmICghUmVjb3ZlcnlNYW5hZ2VyLmluc3RhbmNlKSB7XG4gICAgICBSZWNvdmVyeU1hbmFnZXIuaW5zdGFuY2UgPSBuZXcgUmVjb3ZlcnlNYW5hZ2VyKClcbiAgICB9XG4gICAgcmV0dXJuIFJlY292ZXJ5TWFuYWdlci5pbnN0YW5jZVxuICB9XG5cbiAgLyoqXG4gICAqIOWwneivleaBouWkjVxuICAgKi9cbiAgcHVibGljIGFzeW5jIGF0dGVtcHRSZWNvdmVyeShcbiAgICBlcnJvcjogVW5pZmllZEVycm9yLFxuICAgIGNvbnRleHQ6IEVycm9yQ29udGV4dFxuICApOiBQcm9taXNlPHtcbiAgICBzdWNjZXNzOiBib29sZWFuXG4gICAgYWN0aW9uPzogUmVjb3ZlcnlBY3Rpb25cbiAgICBtZXNzYWdlOiBzdHJpbmdcbiAgfT4ge1xuICAgIGlmICghZXJyb3IucmV0cnlhYmxlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0Vycm9yIGlzIG5vdCByZXRyeWFibGUnXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5qC55o2u6ZSZ6K+v57G75Z6L6YCJ5oup5oGi5aSN562W55WlXG4gICAgc3dpdGNoIChlcnJvci5jYXRlZ29yeSkge1xuICAgICAgY2FzZSBFcnJvckNhdGVnb3J5Lk5FVFdPUks6XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlY292ZXJOZXR3b3JrRXJyb3IoZXJyb3IsIGNvbnRleHQpXG5cbiAgICAgIGNhc2UgRXJyb3JDYXRlZ29yeS5QUk9UT0NPTDpcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucmVjb3ZlclByb3RvY29sRXJyb3IoZXJyb3IsIGNvbnRleHQpXG5cbiAgICAgIGNhc2UgRXJyb3JDYXRlZ29yeS5EQVRBOlxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZWNvdmVyRGF0YUVycm9yKGVycm9yLCBjb250ZXh0KVxuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZWNvdmVyRGVmYXVsdEVycm9yKGVycm9yLCBjb250ZXh0KVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmgaLlpI3nvZHnu5zplJnor69cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcmVjb3Zlck5ldHdvcmtFcnJvcihcbiAgICBlcnJvcjogVW5pZmllZEVycm9yLFxuICAgIGNvbnRleHQ6IEVycm9yQ29udGV4dFxuICApOiBQcm9taXNlPHtcbiAgICBzdWNjZXNzOiBib29sZWFuXG4gICAgYWN0aW9uPzogUmVjb3ZlcnlBY3Rpb25cbiAgICBtZXNzYWdlOiBzdHJpbmdcbiAgfT4ge1xuICAgIC8vIOajgOafpee9kee7nOeKtuaAgVxuICAgIGNvbnN0IG5ldHdvcmtTdGF0ZSA9IG5ldHdvcmtTdGF0ZURldGVjdG9yLmdldEN1cnJlbnRTdGF0ZSgpXG5cbiAgICBpZiAoIW5ldHdvcmtTdGF0ZS5pc09ubGluZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGFjdGlvbjogJ21hbnVhbCcsXG4gICAgICAgIG1lc3NhZ2U6ICdOZXR3b3JrIGlzIG9mZmxpbmUsIHBsZWFzZSBjaGVjayBjb25uZWN0aW9uJ1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOWwneivlemHjeivlVxuICAgIGlmIChlcnJvci5yZXRyeUNvdW50IDwgKGVycm9yLm1heFJldHJpZXMgfHwgMykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGFjdGlvbjogJ3JldHJ5JyxcbiAgICAgICAgbWVzc2FnZTogJ1dpbGwgcmV0cnkgbmV0d29yayBvcGVyYXRpb24nXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgYWN0aW9uOiAnZmFsbGJhY2snLFxuICAgICAgbWVzc2FnZTogJ05ldHdvcmsgcmV0cnkgbGltaXQgZXhjZWVkZWQsIGZhbGxpbmcgYmFjayB0byBsb2NhbCBkYXRhJ1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmgaLlpI3ljY/orq7plJnor69cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcmVjb3ZlclByb3RvY29sRXJyb3IoXG4gICAgZXJyb3I6IFVuaWZpZWRFcnJvcixcbiAgICBjb250ZXh0OiBFcnJvckNvbnRleHRcbiAgKTogUHJvbWlzZTx7XG4gICAgc3VjY2VzczogYm9vbGVhblxuICAgIGFjdGlvbj86IFJlY292ZXJ5QWN0aW9uXG4gICAgbWVzc2FnZTogc3RyaW5nXG4gIH0+IHtcbiAgICAvLyDorqTor4HplJnor6/pnIDopoHph43mlrDnmbvlvZVcbiAgICBpZiAoZXJyb3Iuc3ViQ2F0ZWdvcnkgPT09IEVycm9yU3ViQ2F0ZWdvcnkuQVVUSF9FUlJPUikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGFjdGlvbjogJ21hbnVhbCcsXG4gICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiBmYWlsZWQsIHBsZWFzZSByZS1sb2dpbidcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDlhbbku5bljY/orq7plJnor6/lsJ3or5Xph43or5VcbiAgICBpZiAoZXJyb3IucmV0cnlDb3VudCA8IChlcnJvci5tYXhSZXRyaWVzIHx8IDIpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBhY3Rpb246ICdyZXRyeScsXG4gICAgICAgIG1lc3NhZ2U6ICdXaWxsIHJldHJ5IHByb3RvY29sIG9wZXJhdGlvbidcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBhY3Rpb246ICdza2lwJyxcbiAgICAgIG1lc3NhZ2U6ICdQcm90b2NvbCBlcnJvciByZWNvdmVyeSBmYWlsZWQnXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOaBouWkjeaVsOaNrumUmeivr1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyByZWNvdmVyRGF0YUVycm9yKFxuICAgIGVycm9yOiBVbmlmaWVkRXJyb3IsXG4gICAgY29udGV4dDogRXJyb3JDb250ZXh0XG4gICk6IFByb21pc2U8e1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgICBhY3Rpb24/OiBSZWNvdmVyeUFjdGlvblxuICAgIG1lc3NhZ2U6IHN0cmluZ1xuICB9PiB7XG4gICAgLy8g5pWw5o2u5Yay56qB5bCd6K+V5pm66IO96Kej5YazXG4gICAgaWYgKGVycm9yLnN1YkNhdGVnb3J5ID09PSBFcnJvclN1YkNhdGVnb3J5LkRBVEFfQ09ORkxJQ1QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIOi/memHjOWPr+S7peiwg+eUqOaZuuiDveWGsueqgeino+WGs+WZqFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgYWN0aW9uOiAncmVwYWlyJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQXR0ZW1wdGluZyBpbnRlbGxpZ2VudCBjb25mbGljdCByZXNvbHV0aW9uJ1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBhY3Rpb246ICdtYW51YWwnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdDb25mbGljdCByZXNvbHV0aW9uIGZhaWxlZCwgbWFudWFsIGludGVydmVudGlvbiByZXF1aXJlZCdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOaVsOaNruaNn+Wdj+WwneivleWbnua7mlxuICAgIGlmIChlcnJvci5zdWJDYXRlZ29yeSA9PT0gRXJyb3JTdWJDYXRlZ29yeS5EQVRBX0NPUlJVUFRJT04pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGFjdGlvbjogJ3JvbGxiYWNrJyxcbiAgICAgICAgbWVzc2FnZTogJ0F0dGVtcHRpbmcgZGF0YSByb2xsYmFjaydcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBhY3Rpb246ICdza2lwJyxcbiAgICAgIG1lc3NhZ2U6ICdEYXRhIGVycm9yIHJlY292ZXJ5IGZhaWxlZCdcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6buY6K6k5oGi5aSNXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlY292ZXJEZWZhdWx0RXJyb3IoXG4gICAgZXJyb3I6IFVuaWZpZWRFcnJvcixcbiAgICBjb250ZXh0OiBFcnJvckNvbnRleHRcbiAgKTogUHJvbWlzZTx7XG4gICAgc3VjY2VzczogYm9vbGVhblxuICAgIGFjdGlvbj86IFJlY292ZXJ5QWN0aW9uXG4gICAgbWVzc2FnZTogc3RyaW5nXG4gIH0+IHtcbiAgICBpZiAoZXJyb3IucmV0cnlhYmxlICYmIGVycm9yLnJldHJ5Q291bnQgPCAoZXJyb3IubWF4UmV0cmllcyB8fCAxKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgYWN0aW9uOiAncmV0cnknLFxuICAgICAgICBtZXNzYWdlOiAnV2lsbCByZXRyeSBvcGVyYXRpb24nXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgYWN0aW9uOiAnc2tpcCcsXG4gICAgICBtZXNzYWdlOiAnRGVmYXVsdCByZWNvdmVyeSBmYWlsZWQnXG4gICAgfVxuICB9XG59XG5cbi8vIOmUmeivr+aXpeW/l+aOpeWPo1xuaW50ZXJmYWNlIEVycm9yTG9nIHtcbiAgaWQ6IHN0cmluZ1xuICB0aW1lc3RhbXA6IERhdGVcbiAgbGV2ZWw6IEVycm9yTGV2ZWxcbiAgY2F0ZWdvcnk6IEVycm9yQ2F0ZWdvcnlcbiAgY29kZTogc3RyaW5nXG4gIG1lc3NhZ2U6IHN0cmluZ1xuICBzdGFjaz86IHN0cmluZ1xuICBkZXRhaWxzPzogYW55XG4gIHVzZXJJZD86IHN0cmluZ1xuICBzZXNzaW9uSWQ/OiBzdHJpbmdcbiAgb3BlcmF0aW9uPzogc3RyaW5nXG4gIGVudGl0eUlkPzogc3RyaW5nXG4gIGVudmlyb25tZW50OiAnZGV2ZWxvcG1lbnQnIHwgJ3N0YWdpbmcnIHwgJ3Byb2R1Y3Rpb24nXG4gIGRldmljZUluZm8/OiBhbnlcbiAgbmV0d29ya0luZm8/OiBhbnlcbiAgaGFuZGxlZD86IGJvb2xlYW5cbiAgcmVjb3ZlcnlBY3Rpb24/OiBSZWNvdmVyeUFjdGlvblxuICByZXNvbHV0aW9uPzogc3RyaW5nXG4gIHJlc29sdXRpb25UaW1lPzogRGF0ZVxufVxuXG4vLyDlhbfkvZPplJnor6/lpITnkIblmajlrp7njrBcblxuLy8g572R57uc6ZSZ6K+v5aSE55CG5ZmoXG5jbGFzcyBOZXR3b3JrRXJyb3JIYW5kbGVyIGltcGxlbWVudHMgRXJyb3JIYW5kbGVyIHtcbiAgcHJpb3JpdHkgPSAxMDBcblxuICBjYW5IYW5kbGUoZXJyb3I6IFVuaWZpZWRFcnJvcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBlcnJvci5jYXRlZ29yeSA9PT0gRXJyb3JDYXRlZ29yeS5ORVRXT1JLXG4gIH1cblxuICBhc3luYyBoYW5kbGUoZXJyb3I6IFVuaWZpZWRFcnJvciwgY29udGV4dDogRXJyb3JDb250ZXh0KTogUHJvbWlzZTxFcnJvckhhbmRsaW5nUmVzdWx0PiB7XG4gICAgLy8g5pu05paw6YeN6K+V6K6h5pWwXG4gICAgZXJyb3IucmV0cnlDb3VudCA9IChlcnJvci5yZXRyeUNvdW50IHx8IDApICsgMVxuXG4gICAgLy8g5qOA5p+l5piv5ZCm6LaF6L+H6YeN6K+V6ZmQ5Yi2XG4gICAgaWYgKGVycm9yLnJldHJ5Q291bnQgPj0gKGVycm9yLm1heFJldHJpZXMgfHwgMykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGhhbmRsZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcixcbiAgICAgICAgYWN0aW9uOiAnZmFsbGJhY2snLFxuICAgICAgICByZXNvbHV0aW9uOiAnTmV0d29yayByZXRyeSBsaW1pdCBleGNlZWRlZCdcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDorqHnrpfph43or5Xlu7bov59cbiAgICBjb25zdCBkZWxheSA9IHRoaXMuY2FsY3VsYXRlUmV0cnlEZWxheShlcnJvci5yZXRyeUNvdW50KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGhhbmRsZWQ6IHRydWUsXG4gICAgICBlcnJvcixcbiAgICAgIGFjdGlvbjogJ3JldHJ5JyxcbiAgICAgIHJlc29sdXRpb246IGBOZXR3b3JrIGVycm9yLCB3aWxsIHJldHJ5IGFmdGVyICR7ZGVsYXl9bXNgLFxuICAgICAgbWV0cmljczoge1xuICAgICAgICBoYW5kbGluZ1RpbWU6IDEwLFxuICAgICAgICBhdHRlbXB0czogZXJyb3IucmV0cnlDb3VudCxcbiAgICAgICAgbWVtb3J5VXNhZ2U6IDBcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVJldHJ5RGVsYXkoYXR0ZW1wdDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gTWF0aC5taW4oMTAwMCAqIE1hdGgucG93KDIsIGF0dGVtcHQpLCAzMDAwMClcbiAgfVxufVxuXG4vLyDmlbDmja7plJnor6/lpITnkIblmahcbmNsYXNzIERhdGFFcnJvckhhbmRsZXIgaW1wbGVtZW50cyBFcnJvckhhbmRsZXIge1xuICBwcmlvcml0eSA9IDkwXG5cbiAgY2FuSGFuZGxlKGVycm9yOiBVbmlmaWVkRXJyb3IpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZXJyb3IuY2F0ZWdvcnkgPT09IEVycm9yQ2F0ZWdvcnkuREFUQVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlKGVycm9yOiBVbmlmaWVkRXJyb3IsIGNvbnRleHQ6IEVycm9yQ29udGV4dCk6IFByb21pc2U8RXJyb3JIYW5kbGluZ1Jlc3VsdD4ge1xuICAgIC8vIOaVsOaNruWGsueqgeWkhOeQhlxuICAgIGlmIChlcnJvci5zdWJDYXRlZ29yeSA9PT0gRXJyb3JTdWJDYXRlZ29yeS5EQVRBX0NPTkZMSUNUKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBoYW5kbGVkOiB0cnVlLFxuICAgICAgICBlcnJvcixcbiAgICAgICAgYWN0aW9uOiAncmVwYWlyJyxcbiAgICAgICAgcmVzb2x1dGlvbjogJ0RhdGEgY29uZmxpY3QgZGV0ZWN0ZWQsIGF0dGVtcHRpbmcgcmVzb2x1dGlvbicsXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICBoYW5kbGluZ1RpbWU6IDUwLFxuICAgICAgICAgIGF0dGVtcHRzOiAxLFxuICAgICAgICAgIG1lbW9yeVVzYWdlOiAwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmlbDmja7mjZ/lnY/lpITnkIZcbiAgICBpZiAoZXJyb3Iuc3ViQ2F0ZWdvcnkgPT09IEVycm9yU3ViQ2F0ZWdvcnkuREFUQV9DT1JSVVBUSU9OKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBoYW5kbGVkOiB0cnVlLFxuICAgICAgICBlcnJvcixcbiAgICAgICAgYWN0aW9uOiAncm9sbGJhY2snLFxuICAgICAgICByZXNvbHV0aW9uOiAnRGF0YSBjb3JydXB0aW9uIGRldGVjdGVkLCBhdHRlbXB0aW5nIHJvbGxiYWNrJyxcbiAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgIGhhbmRsaW5nVGltZTogMTAwLFxuICAgICAgICAgIGF0dGVtcHRzOiAxLFxuICAgICAgICAgIG1lbW9yeVVzYWdlOiAwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaGFuZGxlZDogZmFsc2UsXG4gICAgICBlcnJvcixcbiAgICAgIGFjdGlvbjogJ21hbnVhbCcsXG4gICAgICByZXNvbHV0aW9uOiAnRGF0YSBlcnJvciByZXF1aXJlcyBtYW51YWwgaW50ZXJ2ZW50aW9uJyxcbiAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgaGFuZGxpbmdUaW1lOiAyMCxcbiAgICAgICAgYXR0ZW1wdHM6IDEsXG4gICAgICAgIG1lbW9yeVVzYWdlOiAwXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8vIOezu+e7n+mUmeivr+WkhOeQhuWZqFxuY2xhc3MgU3lzdGVtRXJyb3JIYW5kbGVyIGltcGxlbWVudHMgRXJyb3JIYW5kbGVyIHtcbiAgcHJpb3JpdHkgPSA4MFxuXG4gIGNhbkhhbmRsZShlcnJvcjogVW5pZmllZEVycm9yKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGVycm9yLmNhdGVnb3J5ID09PSBFcnJvckNhdGVnb3J5LlNZU1RFTVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlKGVycm9yOiBVbmlmaWVkRXJyb3IsIGNvbnRleHQ6IEVycm9yQ29udGV4dCk6IFByb21pc2U8RXJyb3JIYW5kbGluZ1Jlc3VsdD4ge1xuICAgIC8vIOezu+e7n+mUmeivr+mAmuW4uOmcgOimgemHjeWQr+aIlumZjee6p1xuICAgIHJldHVybiB7XG4gICAgICBoYW5kbGVkOiBmYWxzZSxcbiAgICAgIGVycm9yLFxuICAgICAgYWN0aW9uOiAnbWFudWFsJyxcbiAgICAgIHJlc29sdXRpb246ICdTeXN0ZW0gZXJyb3IgcmVxdWlyZXMgbWFudWFsIGludGVydmVudGlvbicsXG4gICAgICBtZXRyaWNzOiB7XG4gICAgICAgIGhhbmRsaW5nVGltZTogNSxcbiAgICAgICAgYXR0ZW1wdHM6IDEsXG4gICAgICAgIG1lbW9yeVVzYWdlOiAwXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8vIOm7mOiupOmUmeivr+WkhOeQhuWZqFxuY2xhc3MgRGVmYXVsdEVycm9ySGFuZGxlciBpbXBsZW1lbnRzIEVycm9ySGFuZGxlciB7XG4gIHByaW9yaXR5ID0gMTBcblxuICBjYW5IYW5kbGUoZXJyb3I6IFVuaWZpZWRFcnJvcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlIC8vIOWkhOeQhuaJgOaciemUmeivr1xuICB9XG5cbiAgYXN5bmMgaGFuZGxlKGVycm9yOiBVbmlmaWVkRXJyb3IsIGNvbnRleHQ6IEVycm9yQ29udGV4dCk6IFByb21pc2U8RXJyb3JIYW5kbGluZ1Jlc3VsdD4ge1xuICAgIHJldHVybiB7XG4gICAgICBoYW5kbGVkOiBmYWxzZSxcbiAgICAgIGVycm9yLFxuICAgICAgYWN0aW9uOiAnc2tpcCcsXG4gICAgICByZXNvbHV0aW9uOiAnTm8gc3BlY2lmaWMgaGFuZGxlciBmb3VuZCBmb3IgdGhpcyBlcnJvcicsXG4gICAgICBtZXRyaWNzOiB7XG4gICAgICAgIGhhbmRsaW5nVGltZTogNSxcbiAgICAgICAgYXR0ZW1wdHM6IDEsXG4gICAgICAgIG1lbW9yeVVzYWdlOiAwXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8vIOWvvOWHuuWunuS+i1xuZXhwb3J0IGNvbnN0IHVuaWZpZWRFcnJvckhhbmRsZXIgPSBVbmlmaWVkRXJyb3JIYW5kbGVyLmdldEluc3RhbmNlKClcblxuLy8g5a+85Ye65bel5YW35Ye95pWwXG5leHBvcnQgY29uc3QgY3JlYXRlRXJyb3JDb250ZXh0ID0gKFxuICByZXF1ZXN0PzogYW55LFxuICB1c2VySWQ/OiBzdHJpbmcsXG4gIGVudmlyb25tZW50OiAnZGV2ZWxvcG1lbnQnIHwgJ3N0YWdpbmcnIHwgJ3Byb2R1Y3Rpb24nID0gJ2RldmVsb3BtZW50J1xuKTogRXJyb3JDb250ZXh0ID0+ICh7XG4gIHJlcXVlc3QsXG4gIHVzZXJJZCxcbiAgZW52aXJvbm1lbnQsXG4gIGRldmljZUluZm86IGdldERldmljZUluZm8oKSxcbiAgbmV0d29ya1N0YXRlOiBuZXR3b3JrU3RhdGVEZXRlY3Rvci5nZXRDdXJyZW50U3RhdGUoKVxufSlcblxuZnVuY3Rpb24gZ2V0RGV2aWNlSW5mbygpOiBhbnkge1xuICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlckFnZW50OiBuYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgcGxhdGZvcm06IG5hdmlnYXRvci5wbGF0Zm9ybSxcbiAgICAgIGxhbmd1YWdlOiBuYXZpZ2F0b3IubGFuZ3VhZ2VcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHt9XG59XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVFcnJvciA9IGFzeW5jIChcbiAgZXJyb3I6IGFueSxcbiAgY29udGV4dD86IFBhcnRpYWw8RXJyb3JDb250ZXh0PlxuKTogUHJvbWlzZTxFcnJvckhhbmRsaW5nUmVzdWx0PiA9PiB7XG4gIGNvbnN0IGZ1bGxDb250ZXh0OiBFcnJvckNvbnRleHQgPSB7XG4gICAgZW52aXJvbm1lbnQ6ICdkZXZlbG9wbWVudCcsXG4gICAgLi4uY29udGV4dFxuICB9XG5cbiAgcmV0dXJuIHVuaWZpZWRFcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIGZ1bGxDb250ZXh0KVxufSJdLCJ2ZXJzaW9uIjozfQ==