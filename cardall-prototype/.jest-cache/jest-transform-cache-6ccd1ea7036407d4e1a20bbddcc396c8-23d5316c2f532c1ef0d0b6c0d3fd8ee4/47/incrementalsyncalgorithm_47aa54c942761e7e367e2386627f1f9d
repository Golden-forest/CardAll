e1a719b7fb565f5766924ccfb4eca679
"use strict";
// 增量同步算法实现
// Week 3 Day 11-13 同步机制重构 - Project-Brainstormer
Object.defineProperty(exports, "__esModule", { value: true });
exports.incrementalSyncAlgorithm = exports.IncrementalSyncAlgorithm = void 0;
const supabase_1 = require("../supabase");
const database_unified_1 = require("../database-unified");
class IncrementalSyncAlgorithm {
    constructor() {
        Object.defineProperty(this, "syncHistory", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "lastSyncVersion", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        Object.defineProperty(this, "compressionEnabled", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: true
        });
        this.initializeSyncHistory();
    }
    async initializeSyncHistory() {
        try {
            // 从本地存储加载同步历史
            const stored = localStorage.getItem('cardall_sync_history');
            if (stored) {
                this.syncHistory = JSON.parse(stored);
                this.lastSyncVersion = this.syncHistory[this.syncHistory.length - 1]?.id || null;
            }
        }
        catch (error) {
            console.error('Failed to initialize sync history:', error);
        }
    }
    /**
     * 执行增量同步
     * 核心算法：基于版本号的增量检测和智能批量处理
     */
    async performIncrementalSync(userId) {
        const startTime = performance.now();
        const result = {
            success: true,
            processedCount: 0,
            failedCount: 0,
            conflicts: [],
            errors: [],
            duration: 0,
            bytesTransferred: 0
        };
        try {
            // 第1步：获取云端增量变更
            const cloudChanges = await this.getCloudIncrementalChanges(userId);
            // 第2步：获取本地待同步操作
            const localOperations = await this.getLocalPendingOperations(userId);
            // 第3步：冲突检测和解决
            const conflicts = await this.detectAndResolveConflicts(cloudChanges, localOperations);
            result.conflicts = conflicts;
            // 第4步：应用云端变更
            const cloudResult = await this.applyCloudChanges(cloudChanges, conflicts);
            result.processedCount += cloudResult.processed;
            result.failedCount += cloudResult.failed;
            result.conflicts.push(...cloudResult.conflicts);
            // 第5步：上传本地变更
            const localResult = await this.uploadLocalChanges(localOperations, conflicts);
            result.processedCount += localResult.processed;
            result.failedCount += localResult.failed;
            result.errors.push(...localResult.errors);
            // 第6步：创建同步版本点
            if (result.processedCount > 0 || result.conflicts.length > 0) {
                await this.createSyncVersionPoint(userId, cloudChanges, localOperations, result);
            }
            result.success = result.failedCount === 0;
            result.duration = performance.now() - startTime;
        }
        catch (error) {
            result.success = false;
            result.errors.push({
                id: crypto.randomUUID(),
                operationId: 'incremental-sync',
                errorType: 'server_error',
                message: error instanceof Error ? error.message : 'Unknown error',
                timestamp: new Date(),
                retryable: true,
                resolved: false
            });
            result.duration = performance.now() - startTime;
        }
        return result;
    }
    /**
     * 获取云端增量变更
     * 使用时间戳 + 版本号的双重检测机制
     */
    async getCloudIncrementalChanges(userId) {
        const lastSyncTime = this.getLastSyncTime();
        const changes = [];
        try {
            // 并行查询各种实体的变更
            const [cardChanges, folderChanges, tagChanges] = await Promise.all([
                this.getEntityChanges('cards', userId, lastSyncTime),
                this.getEntityChanges('folders', userId, lastSyncTime),
                this.getEntityChanges('tags', userId, lastSyncTime)
            ]);
            // 合并并排序变更
            changes.push(...cardChanges, ...folderChanges, ...tagChanges);
            changes.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());
            console.log(`📥 检测到 ${changes.length} 个云端变更`);
            return changes;
        }
        catch (error) {
            console.error('Failed to get cloud changes:', error);
            return [];
        }
    }
    /**
     * 获取特定实体的变更
     * 增量查询优化：只获取必要的字段
     */
    async getEntityChanges(entity, userId, since) {
        const { data, error } = await supabase_1.supabase
            .from(entity)
            .select(`
        id,
        created_at,
        updated_at,
        sync_version,
        is_deleted,
        user_id,
        ${entity === 'cards' ? 'front_content, back_content, style, folder_id' : ''}
        ${entity === 'folders' ? 'name, parent_id' : ''}
        ${entity === 'tags' ? 'name, color' : ''}
      `)
            .eq('user_id', userId)
            .gt('updated_at', since.toISOString())
            .order('updated_at', { ascending: true });
        if (error) {
            throw error;
        }
        return (data || []).map(item => ({
            id: crypto.randomUUID(),
            type: item.is_deleted ? 'delete' : 'update',
            entity: entity.slice(0, -1), // 移除复数形式的 's'
            entityId: item.id,
            data: this.transformCloudData(item, entity),
            timestamp: new Date(item.updated_at),
            retryCount: 0,
            priority: this.calculatePriority(item),
            userId: item.user_id,
            syncVersion: item.sync_version,
            metadata: {
                source: 'cloud',
                operation: item.is_deleted ? 'delete' : 'update',
                entityVersion: item.sync_version
            }
        }));
    }
    /**
     * 获取本地待同步操作
     * 从数据库的同步队列中获取
     */
    async getLocalPendingOperations(userId) {
        try {
            const operations = await database_unified_1.db.syncQueue
                .where('userId')
                .equals(userId)
                .and(op => op.status === 'pending' || op.status === 'retry')
                .toArray();
            // 按优先级和时间排序
            return operations
                .map(op => ({
                id: op.id,
                type: op.type,
                entity: op.entity,
                entityId: op.entityId,
                data: op.data,
                timestamp: op.timestamp,
                retryCount: op.retryCount,
                priority: op.priority,
                userId: op.userId,
                syncVersion: op.syncVersion,
                metadata: op.metadata
            }))
                .sort((a, b) => {
                // 优先级排序
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                const priorityDiff = priorityOrder[b.priority] - priorityOrder[a.priority];
                if (priorityDiff !== 0)
                    return priorityDiff;
                // 时间排序
                return new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime();
            });
        }
        catch (error) {
            console.error('Failed to get local operations:', error);
            return [];
        }
    }
    /**
     * 智能冲突检测和解决
     * 基于实体类型、时间戳和变更内容的综合分析
     */
    async detectAndResolveConflicts(cloudChanges, localOperations) {
        const conflicts = [];
        // 构建实体变更映射
        const cloudEntityMap = new Map();
        const localEntityMap = new Map();
        cloudChanges.forEach(op => cloudEntityMap.set(`${op.entity}-${op.entityId}`, op));
        localOperations.forEach(op => localEntityMap.set(`${op.entity}-${op.entityId}`, op));
        // 检测冲突
        for (const [entityKey, cloudOp] of cloudEntityMap) {
            const localOp = localEntityMap.get(entityKey);
            if (localOp) {
                // 检测并发修改冲突
                const conflict = await this.analyzeConflict(cloudOp, localOp);
                if (conflict) {
                    conflicts.push(conflict);
                    // 尝试自动解决
                    const resolution = await this.attemptAutoResolution(conflict);
                    if (resolution) {
                        conflict.resolution = resolution;
                        conflict.autoResolved = true;
                    }
                }
            }
        }
        console.log(`🔍 检测到 ${conflicts.length} 个冲突，自动解决 ${conflicts.filter(c => c.autoResolved).length} 个`);
        return conflicts;
    }
    /**
     * 分析冲突类型和严重程度
     */
    async analyzeConflict(cloudOp, localOp) {
        const cloudTime = new Date(cloudOp.timestamp).getTime();
        const localTime = new Date(localOp.timestamp).getTime();
        const timeDiff = Math.abs(cloudTime - localTime);
        // 时间差异小于1秒，认为是并发修改
        if (timeDiff < 1000) {
            return {
                id: crypto.randomUUID(),
                entityId: cloudOp.entityId,
                entityType: cloudOp.entity,
                localData: localOp.data,
                cloudData: cloudOp.data,
                conflictType: 'concurrent_modification',
                severity: 'medium',
                timestamp: new Date(),
                autoResolved: false
            };
        }
        // 版本不匹配
        if (cloudOp.syncVersion !== localOp.syncVersion) {
            return {
                id: crypto.randomUUID(),
                entityId: cloudOp.entityId,
                entityType: cloudOp.entity,
                localData: localOp.data,
                cloudData: cloudOp.data,
                conflictType: 'version_mismatch',
                severity: 'high',
                timestamp: new Date(),
                autoResolved: false
            };
        }
        return null;
    }
    /**
     * 尝试自动解决冲突
     * 基于实体类型和变更内容的智能策略
     */
    async attemptAutoResolution(conflict) {
        // 对于删除操作，总是采用删除（优先保留删除操作）
        if (conflict.localData.isDeleted || conflict.cloudData.isDeleted) {
            return 'local_wins'; // 本地删除操作优先
        }
        // 对于不同实体类型采用不同策略
        switch (conflict.entityType) {
            case 'card':
                // 卡片内容合并：比较内容复杂度
                return await this.resolveCardConflict(conflict);
            case 'folder':
                // 文件夹：基于名称和层级
                return await this.resolveFolderConflict(conflict);
            case 'tag':
                // 标签：基于名称和颜色
                return await this.resolveTagConflict(conflict);
            default:
                // 默认策略：最后写入获胜
                const cloudTime = new Date(conflict.cloudData.updatedAt).getTime();
                const localTime = new Date(conflict.localData.updatedAt).getTime();
                return cloudTime > localTime ? 'cloud_wins' : 'local_wins';
        }
    }
    /**
     * 卡片冲突解决策略
     */
    async resolveCardConflict(conflict) {
        const localContent = conflict.localData.frontContent + conflict.localData.backContent;
        const cloudContent = conflict.cloudData.frontContent + conflict.cloudData.backContent;
        // 如果内容差异很小，采用云端版本
        const contentDiff = this.calculateContentDifference(localContent, cloudContent);
        if (contentDiff < 0.1) { // 10% 差异阈值
            return 'cloud_wins';
        }
        // 复杂冲突，需要手动解决
        return null;
    }
    /**
     * 文件夹冲突解决策略
     */
    async resolveFolderConflict(conflict) {
        // 文件夹名称冲突，采用时间较新的
        const cloudTime = new Date(conflict.cloudData.updatedAt).getTime();
        const localTime = new Date(conflict.localData.updatedAt).getTime();
        return cloudTime > localTime ? 'cloud_wins' : 'local_wins';
    }
    /**
     * 标签冲突解决策略
     */
    async resolveTagConflict(conflict) {
        // 标签主要看名称，名称相同则合并其他属性
        if (conflict.localData.name === conflict.cloudData.name) {
            return 'merge';
        }
        // 名称不同，创建新标签
        return 'local_wins';
    }
    /**
     * 应用云端变更到本地
     * 批量处理和事务保证
     */
    async applyCloudChanges(changes, conflicts) {
        let processed = 0;
        let failed = 0;
        const newConflicts = [];
        try {
            // 按实体类型分组处理
            const groupedChanges = this.groupOperationsByEntity(changes);
            for (const [entityType, ops] of groupedChanges.entries()) {
                const result = await this.applyEntityChanges(entityType, ops, conflicts);
                processed += result.processed;
                failed += result.failed;
                newConflicts.push(...result.conflicts);
            }
        }
        catch (error) {
            console.error('Failed to apply cloud changes:', error);
            failed = changes.length;
        }
        return { processed, failed, conflicts: newConflicts };
    }
    /**
     * 上传本地变更到云端
     * 智能批量上传和网络优化
     */
    async uploadLocalChanges(operations, conflicts) {
        let processed = 0;
        let failed = 0;
        const errors = [];
        try {
            // 过滤掉有冲突的操作
            const conflictEntities = new Set(conflicts.map(c => `${c.entityType}-${c.entityId}`));
            const filteredOps = operations.filter(op => !conflictEntities.has(`${op.entity}-${op.entityId}`));
            // 批量上传优化
            const batchSize = 10; // 每批10个操作
            for (let i = 0; i < filteredOps.length; i += batchSize) {
                const batch = filteredOps.slice(i, i + batchSize);
                const result = await this.uploadBatch(batch);
                processed += result.processed;
                failed += result.failed;
                errors.push(...result.errors);
            }
        }
        catch (error) {
            console.error('Failed to upload local changes:', error);
            failed = operations.length;
        }
        return { processed, failed, errors };
    }
    // 辅助方法
    getLastSyncTime() {
        return this.syncHistory.length > 0
            ? new Date(this.syncHistory[this.syncHistory.length - 1].timestamp)
            : new Date(0);
    }
    transformCloudData(item, entity) {
        // 根据实体类型转换云端数据格式
        switch (entity) {
            case 'cards':
                return {
                    frontContent: item.front_content,
                    backContent: item.back_content,
                    style: item.style,
                    folderId: item.folder_id,
                    isDeleted: item.is_deleted,
                    syncVersion: item.sync_version,
                    updatedAt: item.updated_at
                };
            case 'folders':
                return {
                    name: item.name,
                    parentId: item.parent_id,
                    isDeleted: item.is_deleted,
                    syncVersion: item.sync_version,
                    updatedAt: item.updated_at
                };
            case 'tags':
                return {
                    name: item.name,
                    color: item.color,
                    isDeleted: item.is_deleted,
                    syncVersion: item.sync_version,
                    updatedAt: item.updated_at
                };
            default:
                return item;
        }
    }
    calculatePriority(item) {
        // 根据实体类型和操作类型计算优先级
        if (item.is_deleted)
            return 'high';
        if (item.entity === 'folder')
            return 'medium';
        return 'low';
    }
    calculateContentDifference(content1, content2) {
        // 简单的内容差异计算
        const longer = Math.max(content1.length, content2.length);
        if (longer === 0)
            return 0;
        const distance = this.levenshteinDistance(content1, content2);
        return distance / longer;
    }
    levenshteinDistance(str1, str2) {
        const matrix = Array(str2.length + 1).fill(null).map(() => Array(str1.length + 1).fill(null));
        for (let i = 0; i <= str1.length; i++)
            matrix[0][i] = i;
        for (let j = 0; j <= str2.length; j++)
            matrix[j][0] = j;
        for (let j = 1; j <= str2.length; j++) {
            for (let i = 1; i <= str1.length; i++) {
                const indicator = str1[i - 1] === str2[j - 1] ? 0 : 1;
                matrix[j][i] = Math.min(matrix[j][i - 1] + 1, matrix[j - 1][i] + 1, matrix[j - 1][i - 1] + indicator);
            }
        }
        return matrix[str2.length][str1.length];
    }
    groupOperationsByEntity(operations) {
        const groups = new Map();
        operations.forEach(op => {
            if (!groups.has(op.entity)) {
                groups.set(op.entity, []);
            }
            groups.get(op.entity).push(op);
        });
        return groups;
    }
    async applyEntityChanges(entityType, operations, conflicts) {
        // 具体实现根据实体类型而定
        // 这里简化处理，实际需要根据不同实体类型实现
        return {
            processed: operations.length,
            failed: 0,
            conflicts: []
        };
    }
    async uploadBatch(operations) {
        // 批量上传实现
        // 这里简化处理，实际需要实现Supabase批量操作
        return {
            processed: operations.length,
            failed: 0,
            errors: []
        };
    }
    async createSyncVersionPoint(userId, cloudChanges, localOperations, result) {
        const version = {
            id: crypto.randomUUID(),
            timestamp: new Date(),
            operations: [...cloudChanges, ...localOperations],
            checksum: this.calculateChecksum([...cloudChanges, ...localOperations]),
            description: `Incremental sync - ${result.processedCount} operations`,
            rollbackPoint: result.failedCount === 0
        };
        this.syncHistory.push(version);
        // 保持最近100个版本点
        if (this.syncHistory.length > 100) {
            this.syncHistory = this.syncHistory.slice(-100);
        }
        // 持久化保存
        try {
            localStorage.setItem('cardall_sync_history', JSON.stringify(this.syncHistory));
            this.lastSyncVersion = version.id;
        }
        catch (error) {
            console.error('Failed to save sync history:', error);
        }
    }
    calculateChecksum(operations) {
        // 简单的校验和计算
        const data = JSON.stringify(operations.map(op => ({
            id: op.id,
            type: op.type,
            entity: op.entity,
            entityId: op.entityId,
            timestamp: op.timestamp
        })));
        let hash = 0;
        for (let i = 0; i < data.length; i++) {
            const char = data.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // 转换为32位整数
        }
        return Math.abs(hash).toString(16);
    }
    /**
     * 获取同步指标
     */
    getSyncMetrics() {
        const totalOps = this.syncHistory.reduce((sum, version) => sum + version.operations.length, 0);
        const successfulOps = this.syncHistory.filter(v => v.rollbackPoint).length;
        return {
            totalOperations: totalOps,
            successRate: totalOps > 0 ? successfulOps / this.syncHistory.length : 1,
            averageResponseTime: 0, // 需要从实际同步中计算
            bandwidthUsage: 0, // 需要从实际传输中计算
            conflictRate: 0, // 需要从冲突统计中计算
            retryCount: 0, // 需要从重试统计中计算
            lastSyncTimestamp: this.syncHistory.length > 0
                ? new Date(this.syncHistory[this.syncHistory.length - 1].timestamp)
                : new Date(0)
        };
    }
    /**
     * 清理旧的同步历史
     */
    async cleanupSyncHistory(keepDays = 30) {
        const cutoffDate = new Date(Date.now() - keepDays * 24 * 60 * 60 * 1000);
        this.syncHistory = this.syncHistory.filter(version => new Date(version.timestamp) > cutoffDate);
        try {
            localStorage.setItem('cardall_sync_history', JSON.stringify(this.syncHistory));
        }
        catch (error) {
            console.error('Failed to cleanup sync history:', error);
        }
    }
}
exports.IncrementalSyncAlgorithm = IncrementalSyncAlgorithm;
// 导出单例实例
exports.incrementalSyncAlgorithm = new IncrementalSyncAlgorithm();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcc2VydmljZXNcXHN5bmNcXGFsZ29yaXRobXNcXGluY3JlbWVudGFsLXN5bmMtYWxnb3JpdGhtLnRzIiwibWFwcGluZ3MiOiI7QUFBQSxXQUFXO0FBQ1gsaURBQWlEOzs7QUFHakQsMENBQXNDO0FBQ3RDLDBEQUF3QztBQUV4QyxNQUFhLHdCQUF3QjtJQUtuQztRQUpROzs7O21CQUE2QixFQUFFO1dBQUE7UUFDL0I7Ozs7bUJBQWlDLElBQUk7V0FBQTtRQUNyQzs7OzttQkFBcUIsSUFBSTtXQUFBO1FBRy9CLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFBO0lBQzlCLENBQUM7SUFFTyxLQUFLLENBQUMscUJBQXFCO1FBQ2pDLElBQUksQ0FBQztZQUNILGNBQWM7WUFDZCxNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUE7WUFDM0QsSUFBSSxNQUFNLEVBQUUsQ0FBQztnQkFDWCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUE7Z0JBQ3JDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLElBQUksSUFBSSxDQUFBO1lBQ2xGLENBQUM7UUFDSCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDNUQsQ0FBQztJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsc0JBQXNCLENBQUMsTUFBYztRQUN6QyxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUE7UUFDbkMsTUFBTSxNQUFNLEdBQWU7WUFDekIsT0FBTyxFQUFFLElBQUk7WUFDYixjQUFjLEVBQUUs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LFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUNuRSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ2hCLENBQUE7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsa0JBQWtCLENBQUMsV0FBbUIsRUFBRTtRQUM1QyxNQUFNLFVBQVUsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsUUFBUSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBRXhFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FDbkQsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLFVBQVUsQ0FDekMsQ0FBQTtRQUVELElBQUksQ0FBQztZQUNILFlBQVksQ0FBQyxPQUFPLENBQUMsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQTtRQUNoRixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUNBQWlDLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDekQsQ0FBQztJQUNILENBQUM7Q0FDRjtBQTFvQkQsNERBMG9CQztBQUVELFNBQVM7QUFDSSxRQUFBLHdCQUF3QixHQUFHLElBQUksd0JBQXdCLEVBQUUsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXENhcmRFdmVyeXRoaW5nXFxjYXJkYWxsLXByb3RvdHlwZVxcc3JjXFxzZXJ2aWNlc1xcc3luY1xcYWxnb3JpdGhtc1xcaW5jcmVtZW50YWwtc3luYy1hbGdvcml0aG0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8g5aKe6YeP5ZCM5q2l566X5rOV5a6e546wXHJcbi8vIFdlZWsgMyBEYXkgMTEtMTMg5ZCM5q2l5py65Yi26YeN5p6EIC0gUHJvamVjdC1CcmFpbnN0b3JtZXJcclxuXHJcbmltcG9ydCB7IHR5cGUgU3luY09wZXJhdGlvbiwgdHlwZSBTeW5jUmVzdWx0LCB0eXBlIFN5bmNWZXJzaW9uLCB0eXBlIFN5bmNNZXRyaWNzIH0gZnJvbSAnLi4vdHlwZXMvc3luYy10eXBlcydcclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9zdXBhYmFzZSdcclxuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYXRhYmFzZS11bmlmaWVkJ1xyXG5cclxuZXhwb3J0IGNsYXNzIEluY3JlbWVudGFsU3luY0FsZ29yaXRobSB7XHJcbiAgcHJpdmF0ZSBzeW5jSGlzdG9yeTogU3luY1ZlcnNpb25bXSA9IFtdXHJcbiAgcHJpdmF0ZSBsYXN0U3luY1ZlcnNpb246IHN0cmluZyB8IG51bGwgPSBudWxsXHJcbiAgcHJpdmF0ZSBjb21wcmVzc2lvbkVuYWJsZWQgPSB0cnVlXHJcbiAgXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmluaXRpYWxpemVTeW5jSGlzdG9yeSgpXHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZVN5bmNIaXN0b3J5KCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g5LuO5pys5Zyw5a2Y5YKo5Yqg6L295ZCM5q2l5Y6G5Y+yXHJcbiAgICAgIGNvbnN0IHN0b3JlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYXJkYWxsX3N5bmNfaGlzdG9yeScpXHJcbiAgICAgIGlmIChzdG9yZWQpIHtcclxuICAgICAgICB0aGlzLnN5bmNIaXN0b3J5ID0gSlNPTi5wYXJzZShzdG9yZWQpXHJcbiAgICAgICAgdGhpcy5sYXN0U3luY1ZlcnNpb24gPSB0aGlzLnN5bmNIaXN0b3J5W3RoaXMuc3luY0hpc3RvcnkubGVuZ3RoIC0gMV0/LmlkIHx8IG51bGxcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgc3luYyBoaXN0b3J5OicsIGVycm9yKVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDmiafooYzlop7ph4/lkIzmraVcclxuICAgKiDmoLjlv4Pnrpfms5XvvJrln7rkuo7niYjmnKzlj7fnmoTlop7ph4/mo4DmtYvlkozmmbrog73mibnph4/lpITnkIZcclxuICAgKi9cclxuICBhc3luYyBwZXJmb3JtSW5jcmVtZW50YWxTeW5jKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTeW5jUmVzdWx0PiB7XHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKVxyXG4gICAgY29uc3QgcmVzdWx0OiBTeW5jUmVzdWx0ID0ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBwcm9jZXNzZWRDb3VudDogMCxcclxuICAgICAgZmFpbGVkQ291bnQ6IDAsXHJcbiAgICAgIGNvbmZsaWN0czogW10sXHJcbiAgICAgIGVycm9yczogW10sXHJcbiAgICAgIGR1cmF0aW9uOiAwLFxyXG4gICAgICBieXRlc1RyYW5zZmVycmVkOiAwXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIOesrDHmraXvvJrojrflj5bkupHnq6/lop7ph4/lj5jmm7RcclxuICAgICAgY29uc3QgY2xvdWRDaGFuZ2VzID0gYXdhaXQgdGhpcy5nZXRDbG91ZEluY3JlbWVudGFsQ2hhbmdlcyh1c2VySWQpXHJcbiAgICAgIFxyXG4gICAgICAvLyDnrKwy5q2l77ya6I635Y+W5pys5Zyw5b6F5ZCM5q2l5pON5L2cXHJcbiAgICAgIGNvbnN0IGxvY2FsT3BlcmF0aW9ucyA9IGF3YWl0IHRoaXMuZ2V0TG9jYWxQZW5kaW5nT3BlcmF0aW9ucyh1c2VySWQpXHJcbiAgICAgIFxyXG4gICAgICAvLyDnrKwz5q2l77ya5Yay56qB5qOA5rWL5ZKM6Kej5YazXHJcbiAgICAgIGNvbnN0IGNvbmZsaWN0cyA9IGF3YWl0IHRoaXMuZGV0ZWN0QW5kUmVzb2x2ZUNvbmZsaWN0cyhjbG91ZENoYW5nZXMsIGxvY2FsT3BlcmF0aW9ucylcclxuICAgICAgcmVzdWx0LmNvbmZsaWN0cyA9IGNvbmZsaWN0c1xyXG4gICAgICBcclxuICAgICAgLy8g56ysNOatpe+8muW6lOeUqOS6keerr+WPmOabtFxyXG4gICAgICBjb25zdCBjbG91ZFJlc3VsdCA9IGF3YWl0IHRoaXMuYXBwbHlDbG91ZENoYW5nZXMoY2xvdWRDaGFuZ2VzLCBjb25mbGljdHMpXHJcbiAgICAgIHJlc3VsdC5wcm9jZXNzZWRDb3VudCArPSBjbG91ZFJlc3VsdC5wcm9jZXNzZWRcclxuICAgICAgcmVzdWx0LmZhaWxlZENvdW50ICs9IGNsb3VkUmVzdWx0LmZhaWxlZFxyXG4gICAgICByZXN1bHQuY29uZmxpY3RzLnB1c2goLi4uY2xvdWRSZXN1bHQuY29uZmxpY3RzKVxyXG4gICAgICBcclxuICAgICAgLy8g56ysNeatpe+8muS4iuS8oOacrOWcsOWPmOabtFxyXG4gICAgICBjb25zdCBsb2NhbFJlc3VsdCA9IGF3YWl0IHRoaXMudXBsb2FkTG9jYWxDaGFuZ2VzKGxvY2FsT3BlcmF0aW9ucywgY29uZmxpY3RzKVxyXG4gICAgICByZXN1bHQucHJvY2Vzc2VkQ291bnQgKz0gbG9jYWxSZXN1bHQucHJvY2Vzc2VkXHJcbiAgICAgIHJlc3VsdC5mYWlsZWRDb3VudCArPSBsb2NhbFJlc3VsdC5mYWlsZWRcclxuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKC4uLmxvY2FsUmVzdWx0LmVycm9ycylcclxuICAgICAgXHJcbiAgICAgIC8vIOesrDbmraXvvJrliJvlu7rlkIzmraXniYjmnKzngrlcclxuICAgICAgaWYgKHJlc3VsdC5wcm9jZXNzZWRDb3VudCA+IDAgfHwgcmVzdWx0LmNvbmZsaWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5jcmVhdGVTeW5jVmVyc2lvblBvaW50KHVzZXJJZCwgY2xvdWRDaGFuZ2VzLCBsb2NhbE9wZXJhdGlvbnMsIHJlc3VsdClcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmVzdWx0LnN1Y2Nlc3MgPSByZXN1bHQuZmFpbGVkQ291bnQgPT09IDBcclxuICAgICAgcmVzdWx0LmR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWVcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXN1bHQuc3VjY2VzcyA9IGZhbHNlXHJcbiAgICAgIHJlc3VsdC5lcnJvcnMucHVzaCh7XHJcbiAgICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXHJcbiAgICAgICAgb3BlcmF0aW9uSWQ6ICdpbmNyZW1lbnRhbC1zeW5jJyxcclxuICAgICAgICBlcnJvclR5cGU6ICdzZXJ2ZXJfZXJyb3InLFxyXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgICByZXRyeWFibGU6IHRydWUsXHJcbiAgICAgICAgcmVzb2x2ZWQ6IGZhbHNlXHJcbiAgICAgIH0pXHJcbiAgICAgIHJlc3VsdC5kdXJhdGlvbiA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiByZXN1bHRcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5LqR56uv5aKe6YeP5Y+Y5pu0XHJcbiAgICog5L2/55So5pe26Ze05oizICsg54mI5pys5Y+355qE5Y+M6YeN5qOA5rWL5py65Yi2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRDbG91ZEluY3JlbWVudGFsQ2hhbmdlcyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U3luY09wZXJhdGlvbltdPiB7XHJcbiAgICBjb25zdCBsYXN0U3luY1RpbWUgPSB0aGlzLmdldExhc3RTeW5jVGltZSgpXHJcbiAgICBjb25zdCBjaGFuZ2VzOiBTeW5jT3BlcmF0aW9uW10gPSBbXVxyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyDlubbooYzmn6Xor6LlkITnp43lrp7kvZPnmoTlj5jmm7RcclxuICAgICAgY29uc3QgW2NhcmRDaGFuZ2VzLCBmb2xkZXJDaGFuZ2VzLCB0YWdDaGFuZ2VzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICB0aGlzLmdldEVudGl0eUNoYW5nZXMoJ2NhcmRzJywgdXNlcklkLCBsYXN0U3luY1RpbWUpLFxyXG4gICAgICAgIHRoaXMuZ2V0RW50aXR5Q2hhbmdlcygnZm9sZGVycycsIHVzZXJJZCwgbGFzdFN5bmNUaW1lKSxcclxuICAgICAgICB0aGlzLmdldEVudGl0eUNoYW5nZXMoJ3RhZ3MnLCB1c2VySWQsIGxhc3RTeW5jVGltZSlcclxuICAgICAgXSlcclxuICAgICAgXHJcbiAgICAgIC8vIOWQiOW5tuW5tuaOkuW6j+WPmOabtFxyXG4gICAgICBjaGFuZ2VzLnB1c2goLi4uY2FyZENoYW5nZXMsIC4uLmZvbGRlckNoYW5nZXMsIC4uLnRhZ0NoYW5nZXMpXHJcbiAgICAgIGNoYW5nZXMuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS50aW1lc3RhbXApLmdldFRpbWUoKSAtIG5ldyBEYXRlKGIudGltZXN0YW1wKS5nZXRUaW1lKCkpXHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhg8J+TpSDmo4DmtYvliLAgJHtjaGFuZ2VzLmxlbmd0aH0g5Liq5LqR56uv5Y+Y5pu0YClcclxuICAgICAgcmV0dXJuIGNoYW5nZXNcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGNsb3VkIGNoYW5nZXM6JywgZXJyb3IpXHJcbiAgICAgIHJldHVybiBbXVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDojrflj5bnibnlrprlrp7kvZPnmoTlj5jmm7RcclxuICAgKiDlop7ph4/mn6Xor6LkvJjljJbvvJrlj6rojrflj5blv4XopoHnmoTlrZfmrrVcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldEVudGl0eUNoYW5nZXMoXHJcbiAgICBlbnRpdHk6IHN0cmluZywgXHJcbiAgICB1c2VySWQ6IHN0cmluZywgXHJcbiAgICBzaW5jZTogRGF0ZVxyXG4gICk6IFByb21pc2U8U3luY09wZXJhdGlvbltdPiB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbShlbnRpdHkpXHJcbiAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgIGlkLFxyXG4gICAgICAgIGNyZWF0ZWRfYXQsXHJcbiAgICAgICAgdXBkYXRlZF9hdCxcclxuICAgICAgICBzeW5jX3ZlcnNpb24sXHJcbiAgICAgICAgaXNfZGVsZXRlZCxcclxuICAgICAgICB1c2VyX2lkLFxyXG4gICAgICAgICR7ZW50aXR5ID09PSAnY2FyZHMnID8gJ2Zyb250X2NvbnRlbnQsIGJhY2tfY29udGVudCwgc3R5bGUsIGZvbGRlcl9pZCcgOiAnJ31cclxuICAgICAgICAke2VudGl0eSA9PT0gJ2ZvbGRlcnMnID8gJ25hbWUsIHBhcmVudF9pZCcgOiAnJ31cclxuICAgICAgICAke2VudGl0eSA9PT0gJ3RhZ3MnID8gJ25hbWUsIGNvbG9yJyA6ICcnfVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXHJcbiAgICAgIC5ndCgndXBkYXRlZF9hdCcsIHNpbmNlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgIC5vcmRlcigndXBkYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiB0cnVlIH0pXHJcbiAgICBcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBlcnJvclxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gKGRhdGEgfHwgW10pLm1hcChpdGVtID0+ICh7XHJcbiAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxyXG4gICAgICB0eXBlOiBpdGVtLmlzX2RlbGV0ZWQgPyAnZGVsZXRlJyA6ICd1cGRhdGUnLFxyXG4gICAgICBlbnRpdHk6IGVudGl0eS5zbGljZSgwLCAtMSkgYXMgYW55LCAvLyDnp7vpmaTlpI3mlbDlvaLlvI/nmoQgJ3MnXHJcbiAgICAgIGVudGl0eUlkOiBpdGVtLmlkLFxyXG4gICAgICBkYXRhOiB0aGlzLnRyYW5zZm9ybUNsb3VkRGF0YShpdGVtLCBlbnRpdHkpLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKGl0ZW0udXBkYXRlZF9hdCksXHJcbiAgICAgIHJldHJ5Q291bnQ6IDAsXHJcbiAgICAgIHByaW9yaXR5OiB0aGlzLmNhbGN1bGF0ZVByaW9yaXR5KGl0ZW0pLFxyXG4gICAgICB1c2VySWQ6IGl0ZW0udXNlcl9pZCxcclxuICAgICAgc3luY1ZlcnNpb246IGl0ZW0uc3luY192ZXJzaW9uLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIHNvdXJjZTogJ2Nsb3VkJyxcclxuICAgICAgICBvcGVyYXRpb246IGl0ZW0uaXNfZGVsZXRlZCA/ICdkZWxldGUnIDogJ3VwZGF0ZScsXHJcbiAgICAgICAgZW50aXR5VmVyc2lvbjogaXRlbS5zeW5jX3ZlcnNpb25cclxuICAgICAgfVxyXG4gICAgfSkpXHJcbiAgfVxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluacrOWcsOW+heWQjOatpeaTjeS9nFxyXG4gICAqIOS7juaVsOaNruW6k+eahOWQjOatpemYn+WIl+S4reiOt+WPllxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgZ2V0TG9jYWxQZW5kaW5nT3BlcmF0aW9ucyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U3luY09wZXJhdGlvbltdPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBvcGVyYXRpb25zID0gYXdhaXQgZGIuc3luY1F1ZXVlXHJcbiAgICAgICAgLndoZXJlKCd1c2VySWQnKVxyXG4gICAgICAgIC5lcXVhbHModXNlcklkKVxyXG4gICAgICAgIC5hbmQob3AgPT4gb3Auc3RhdHVzID09PSAncGVuZGluZycgfHwgb3Auc3RhdHVzID09PSAncmV0cnknKVxyXG4gICAgICAgIC50b0FycmF5KClcclxuICAgICAgXHJcbiAgICAgIC8vIOaMieS8mOWFiOe6p+WSjOaXtumXtOaOkuW6j1xyXG4gICAgICByZXR1cm4gb3BlcmF0aW9uc1xyXG4gICAgICAgIC5tYXAob3AgPT4gKHtcclxuICAgICAgICAgIGlkOiBvcC5pZCxcclxuICAgICAgICAgIHR5cGU6IG9wLnR5cGUsXHJcbiAgICAgICAgICBlbnRpdHk6IG9wLmVudGl0eSxcclxuICAgICAgICAgIGVudGl0eUlkOiBvcC5lbnRpdHlJZCxcclxuICAgICAgICAgIGRhdGE6IG9wLmRhdGEsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG9wLnRpbWVzdGFtcCxcclxuICAgICAgICAgIHJldHJ5Q291bnQ6IG9wLnJldHJ5Q291bnQsXHJcbiAgICAgICAgICBwcmlvcml0eTogb3AucHJpb3JpdHksXHJcbiAgICAgICAgICB1c2VySWQ6IG9wLnVzZXJJZCxcclxuICAgICAgICAgIHN5bmNWZXJzaW9uOiBvcC5zeW5jVmVyc2lvbixcclxuICAgICAgICAgIG1ldGFkYXRhOiBvcC5tZXRhZGF0YVxyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAvLyDkvJjlhYjnuqfmjpLluo9cclxuICAgICAgICAgIGNvbnN0IHByaW9yaXR5T3JkZXIgPSB7IGhpZ2g6IDMsIG1lZGl1bTogMiwgbG93OiAxIH1cclxuICAgICAgICAgIGNvbnN0IHByaW9yaXR5RGlmZiA9IHByaW9yaXR5T3JkZXJbYi5wcmlvcml0eV0gLSBwcmlvcml0eU9yZGVyW2EucHJpb3JpdHldXHJcbiAgICAgICAgICBpZiAocHJpb3JpdHlEaWZmICE9PSAwKSByZXR1cm4gcHJpb3JpdHlEaWZmXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIOaXtumXtOaOkuW6j1xyXG4gICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGEudGltZXN0YW1wKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLnRpbWVzdGFtcCkuZ2V0VGltZSgpXHJcbiAgICAgICAgfSlcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGxvY2FsIG9wZXJhdGlvbnM6JywgZXJyb3IpXHJcbiAgICAgIHJldHVybiBbXVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDmmbrog73lhrLnqoHmo4DmtYvlkozop6PlhrNcclxuICAgKiDln7rkuo7lrp7kvZPnsbvlnovjgIHml7bpl7TmiLPlkozlj5jmm7TlhoXlrrnnmoTnu7zlkIjliIbmnpBcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGRldGVjdEFuZFJlc29sdmVDb25mbGljdHMoXHJcbiAgICBjbG91ZENoYW5nZXM6IFN5bmNPcGVyYXRpb25bXSxcclxuICAgIGxvY2FsT3BlcmF0aW9uczogU3luY09wZXJhdGlvbltdXHJcbiAgKSB7XHJcbiAgICBjb25zdCBjb25mbGljdHM6IGFueVtdID0gW11cclxuICAgIFxyXG4gICAgLy8g5p6E5bu65a6e5L2T5Y+Y5pu05pig5bCEXHJcbiAgICBjb25zdCBjbG91ZEVudGl0eU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBTeW5jT3BlcmF0aW9uPigpXHJcbiAgICBjb25zdCBsb2NhbEVudGl0eU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBTeW5jT3BlcmF0aW9uPigpXHJcbiAgICBcclxuICAgIGNsb3VkQ2hhbmdlcy5mb3JFYWNoKG9wID0+IGNsb3VkRW50aXR5TWFwLnNldChgJHtvcC5lbnRpdHl9LSR7b3AuZW50aXR5SWR9YCwgb3ApKVxyXG4gICAgbG9jYWxPcGVyYXRpb25zLmZvckVhY2gob3AgPT4gbG9jYWxFbnRpdHlNYXAuc2V0KGAke29wLmVudGl0eX0tJHtvcC5lbnRpdHlJZH1gLCBvcCkpXHJcbiAgICBcclxuICAgIC8vIOajgOa1i+WGsueqgVxyXG4gICAgZm9yIChjb25zdCBbZW50aXR5S2V5LCBjbG91ZE9wXSBvZiBjbG91ZEVudGl0eU1hcCkge1xyXG4gICAgICBjb25zdCBsb2NhbE9wID0gbG9jYWxFbnRpdHlNYXAuZ2V0KGVudGl0eUtleSlcclxuICAgICAgXHJcbiAgICAgIGlmIChsb2NhbE9wKSB7XHJcbiAgICAgICAgLy8g5qOA5rWL5bm25Y+R5L+u5pS55Yay56qBXHJcbiAgICAgICAgY29uc3QgY29uZmxpY3QgPSBhd2FpdCB0aGlzLmFuYWx5emVDb25mbGljdChjbG91ZE9wLCBsb2NhbE9wKVxyXG4gICAgICAgIGlmIChjb25mbGljdCkge1xyXG4gICAgICAgICAgY29uZmxpY3RzLnB1c2goY29uZmxpY3QpXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIOWwneivleiHquWKqOino+WGs1xyXG4gICAgICAgICAgY29uc3QgcmVzb2x1dGlvbiA9IGF3YWl0IHRoaXMuYXR0ZW1wdEF1dG9SZXNvbHV0aW9uKGNvbmZsaWN0KVxyXG4gICAgICAgICAgaWYgKHJlc29sdXRpb24pIHtcclxuICAgICAgICAgICAgY29uZmxpY3QucmVzb2x1dGlvbiA9IHJlc29sdXRpb25cclxuICAgICAgICAgICAgY29uZmxpY3QuYXV0b1Jlc29sdmVkID0gdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhg8J+UjSDmo4DmtYvliLAgJHtjb25mbGljdHMubGVuZ3RofSDkuKrlhrLnqoHvvIzoh6rliqjop6PlhrMgJHtjb25mbGljdHMuZmlsdGVyKGMgPT4gYy5hdXRvUmVzb2x2ZWQpLmxlbmd0aH0g5LiqYClcclxuICAgIHJldHVybiBjb25mbGljdHNcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICog5YiG5p6Q5Yay56qB57G75Z6L5ZKM5Lil6YeN56iL5bqmXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplQ29uZmxpY3QoY2xvdWRPcDogU3luY09wZXJhdGlvbiwgbG9jYWxPcDogU3luY09wZXJhdGlvbikge1xyXG4gICAgY29uc3QgY2xvdWRUaW1lID0gbmV3IERhdGUoY2xvdWRPcC50aW1lc3RhbXApLmdldFRpbWUoKVxyXG4gICAgY29uc3QgbG9jYWxUaW1lID0gbmV3IERhdGUobG9jYWxPcC50aW1lc3RhbXApLmdldFRpbWUoKVxyXG4gICAgY29uc3QgdGltZURpZmYgPSBNYXRoLmFicyhjbG91ZFRpbWUgLSBsb2NhbFRpbWUpXHJcbiAgICBcclxuICAgIC8vIOaXtumXtOW3ruW8guWwj+S6jjHnp5LvvIzorqTkuLrmmK/lubblj5Hkv67mlLlcclxuICAgIGlmICh0aW1lRGlmZiA8IDEwMDApIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcclxuICAgICAgICBlbnRpdHlJZDogY2xvdWRPcC5lbnRpdHlJZCxcclxuICAgICAgICBlbnRpdHlUeXBlOiBjbG91ZE9wLmVudGl0eSxcclxuICAgICAgICBsb2NhbERhdGE6IGxvY2FsT3AuZGF0YSxcclxuICAgICAgICBjbG91ZERhdGE6IGNsb3VkT3AuZGF0YSxcclxuICAgICAgICBjb25mbGljdFR5cGU6ICdjb25jdXJyZW50X21vZGlmaWNhdGlvbicgYXMgY29uc3QsXHJcbiAgICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nIGFzIGNvbnN0LFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgICBhdXRvUmVzb2x2ZWQ6IGZhbHNlXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g54mI5pys5LiN5Yy56YWNXHJcbiAgICBpZiAoY2xvdWRPcC5zeW5jVmVyc2lvbiAhPT0gbG9jYWxPcC5zeW5jVmVyc2lvbikge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxyXG4gICAgICAgIGVudGl0eUlkOiBjbG91ZE9wLmVudGl0eUlkLFxyXG4gICAgICAgIGVudGl0eVR5cGU6IGNsb3VkT3AuZW50aXR5LFxyXG4gICAgICAgIGxvY2FsRGF0YTogbG9jYWxPcC5kYXRhLFxyXG4gICAgICAgIGNsb3VkRGF0YTogY2xvdWRPcC5kYXRhLFxyXG4gICAgICAgIGNvbmZsaWN0VHlwZTogJ3ZlcnNpb25fbWlzbWF0Y2gnIGFzIGNvbnN0LFxyXG4gICAgICAgIHNldmVyaXR5OiAnaGlnaCcgYXMgY29uc3QsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIGF1dG9SZXNvbHZlZDogZmFsc2VcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDlsJ3or5Xoh6rliqjop6PlhrPlhrLnqoFcclxuICAgKiDln7rkuo7lrp7kvZPnsbvlnovlkozlj5jmm7TlhoXlrrnnmoTmmbrog73nrZbnlaVcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGF0dGVtcHRBdXRvUmVzb2x1dGlvbihjb25mbGljdDogYW55KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XHJcbiAgICAvLyDlr7nkuo7liKDpmaTmk43kvZzvvIzmgLvmmK/ph4fnlKjliKDpmaTvvIjkvJjlhYjkv53nlZnliKDpmaTmk43kvZzvvIlcclxuICAgIGlmIChjb25mbGljdC5sb2NhbERhdGEuaXNEZWxldGVkIHx8IGNvbmZsaWN0LmNsb3VkRGF0YS5pc0RlbGV0ZWQpIHtcclxuICAgICAgcmV0dXJuICdsb2NhbF93aW5zJyAvLyDmnKzlnLDliKDpmaTmk43kvZzkvJjlhYhcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5a+55LqO5LiN5ZCM5a6e5L2T57G75Z6L6YeH55So5LiN5ZCM562W55WlXHJcbiAgICBzd2l0Y2ggKGNvbmZsaWN0LmVudGl0eVR5cGUpIHtcclxuICAgICAgY2FzZSAnY2FyZCc6XHJcbiAgICAgICAgLy8g5Y2h54mH5YaF5a655ZCI5bm277ya5q+U6L6D5YaF5a655aSN5p2C5bqmXHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucmVzb2x2ZUNhcmRDb25mbGljdChjb25mbGljdClcclxuICAgICAgXHJcbiAgICAgIGNhc2UgJ2ZvbGRlcic6XHJcbiAgICAgICAgLy8g5paH5Lu25aS577ya5Z+65LqO5ZCN56ew5ZKM5bGC57qnXHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucmVzb2x2ZUZvbGRlckNvbmZsaWN0KGNvbmZsaWN0KVxyXG4gICAgICBcclxuICAgICAgY2FzZSAndGFnJzpcclxuICAgICAgICAvLyDmoIfnrb7vvJrln7rkuo7lkI3np7DlkozpopzoibJcclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZXNvbHZlVGFnQ29uZmxpY3QoY29uZmxpY3QpXHJcbiAgICAgIFxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIC8vIOm7mOiupOetlueVpe+8muacgOWQjuWGmeWFpeiOt+iDnFxyXG4gICAgICAgIGNvbnN0IGNsb3VkVGltZSA9IG5ldyBEYXRlKGNvbmZsaWN0LmNsb3VkRGF0YS51cGRhdGVkQXQpLmdldFRpbWUoKVxyXG4gICAgICAgIGNvbnN0IGxvY2FsVGltZSA9IG5ldyBEYXRlKGNvbmZsaWN0LmxvY2FsRGF0YS51cGRhdGVkQXQpLmdldFRpbWUoKVxyXG4gICAgICAgIHJldHVybiBjbG91ZFRpbWUgPiBsb2NhbFRpbWUgPyAnY2xvdWRfd2lucycgOiAnbG9jYWxfd2lucydcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICog5Y2h54mH5Yay56qB6Kej5Yaz562W55WlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyByZXNvbHZlQ2FyZENvbmZsaWN0KGNvbmZsaWN0OiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgY29uc3QgbG9jYWxDb250ZW50ID0gY29uZmxpY3QubG9jYWxEYXRhLmZyb250Q29udGVudCArIGNvbmZsaWN0LmxvY2FsRGF0YS5iYWNrQ29udGVudFxyXG4gICAgY29uc3QgY2xvdWRDb250ZW50ID0gY29uZmxpY3QuY2xvdWREYXRhLmZyb250Q29udGVudCArIGNvbmZsaWN0LmNsb3VkRGF0YS5iYWNrQ29udGVudFxyXG4gICAgXHJcbiAgICAvLyDlpoLmnpzlhoXlrrnlt67lvILlvojlsI/vvIzph4fnlKjkupHnq6/niYjmnKxcclxuICAgIGNvbnN0IGNvbnRlbnREaWZmID0gdGhpcy5jYWxjdWxhdGVDb250ZW50RGlmZmVyZW5jZShsb2NhbENvbnRlbnQsIGNsb3VkQ29udGVudClcclxuICAgIGlmIChjb250ZW50RGlmZiA8IDAuMSkgeyAvLyAxMCUg5beu5byC6ZiI5YC8XHJcbiAgICAgIHJldHVybiAnY2xvdWRfd2lucydcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5aSN5p2C5Yay56qB77yM6ZyA6KaB5omL5Yqo6Kej5YazXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDmlofku7blpLnlhrLnqoHop6PlhrPnrZbnlaVcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHJlc29sdmVGb2xkZXJDb25mbGljdChjb25mbGljdDogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIC8vIOaWh+S7tuWkueWQjeensOWGsueqge+8jOmHh+eUqOaXtumXtOi+g+aWsOeahFxyXG4gICAgY29uc3QgY2xvdWRUaW1lID0gbmV3IERhdGUoY29uZmxpY3QuY2xvdWREYXRhLnVwZGF0ZWRBdCkuZ2V0VGltZSgpXHJcbiAgICBjb25zdCBsb2NhbFRpbWUgPSBuZXcgRGF0ZShjb25mbGljdC5sb2NhbERhdGEudXBkYXRlZEF0KS5nZXRUaW1lKClcclxuICAgIHJldHVybiBjbG91ZFRpbWUgPiBsb2NhbFRpbWUgPyAnY2xvdWRfd2lucycgOiAnbG9jYWxfd2lucydcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICog5qCH562+5Yay56qB6Kej5Yaz562W55WlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyByZXNvbHZlVGFnQ29uZmxpY3QoY29uZmxpY3Q6IGFueSk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICAvLyDmoIfnrb7kuLvopoHnnIvlkI3np7DvvIzlkI3np7Dnm7jlkIzliJnlkIjlubblhbbku5blsZ7mgKdcclxuICAgIGlmIChjb25mbGljdC5sb2NhbERhdGEubmFtZSA9PT0gY29uZmxpY3QuY2xvdWREYXRhLm5hbWUpIHtcclxuICAgICAgcmV0dXJuICdtZXJnZSdcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5ZCN56ew5LiN5ZCM77yM5Yib5bu65paw5qCH562+XHJcbiAgICByZXR1cm4gJ2xvY2FsX3dpbnMnXHJcbiAgfVxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIOW6lOeUqOS6keerr+WPmOabtOWIsOacrOWcsFxyXG4gICAqIOaJuemHj+WkhOeQhuWSjOS6i+WKoeS/neivgVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgYXBwbHlDbG91ZENoYW5nZXMoXHJcbiAgICBjaGFuZ2VzOiBTeW5jT3BlcmF0aW9uW10sIFxyXG4gICAgY29uZmxpY3RzOiBhbnlbXVxyXG4gICk6IFByb21pc2U8e1xyXG4gICAgcHJvY2Vzc2VkOiBudW1iZXJcclxuICAgIGZhaWxlZDogbnVtYmVyXHJcbiAgICBjb25mbGljdHM6IGFueVtdXHJcbiAgfT4ge1xyXG4gICAgbGV0IHByb2Nlc3NlZCA9IDBcclxuICAgIGxldCBmYWlsZWQgPSAwXHJcbiAgICBjb25zdCBuZXdDb25mbGljdHM6IGFueVtdID0gW11cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g5oyJ5a6e5L2T57G75Z6L5YiG57uE5aSE55CGXHJcbiAgICAgIGNvbnN0IGdyb3VwZWRDaGFuZ2VzID0gdGhpcy5ncm91cE9wZXJhdGlvbnNCeUVudGl0eShjaGFuZ2VzKVxyXG4gICAgICBcclxuICAgICAgZm9yIChjb25zdCBbZW50aXR5VHlwZSwgb3BzXSBvZiBncm91cGVkQ2hhbmdlcy5lbnRyaWVzKCkpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFwcGx5RW50aXR5Q2hhbmdlcyhlbnRpdHlUeXBlLCBvcHMsIGNvbmZsaWN0cylcclxuICAgICAgICBwcm9jZXNzZWQgKz0gcmVzdWx0LnByb2Nlc3NlZFxyXG4gICAgICAgIGZhaWxlZCArPSByZXN1bHQuZmFpbGVkXHJcbiAgICAgICAgbmV3Q29uZmxpY3RzLnB1c2goLi4ucmVzdWx0LmNvbmZsaWN0cylcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBhcHBseSBjbG91ZCBjaGFuZ2VzOicsIGVycm9yKVxyXG4gICAgICBmYWlsZWQgPSBjaGFuZ2VzLmxlbmd0aFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4geyBwcm9jZXNzZWQsIGZhaWxlZCwgY29uZmxpY3RzOiBuZXdDb25mbGljdHMgfVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDkuIrkvKDmnKzlnLDlj5jmm7TliLDkupHnq69cclxuICAgKiDmmbrog73mibnph4/kuIrkvKDlkoznvZHnu5zkvJjljJZcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHVwbG9hZExvY2FsQ2hhbmdlcyhcclxuICAgIG9wZXJhdGlvbnM6IFN5bmNPcGVyYXRpb25bXSwgXHJcbiAgICBjb25mbGljdHM6IGFueVtdXHJcbiAgKTogUHJvbWlzZTx7XHJcbiAgICBwcm9jZXNzZWQ6IG51bWJlclxyXG4gICAgZmFpbGVkOiBudW1iZXJcclxuICAgIGVycm9yczogYW55W11cclxuICB9PiB7XHJcbiAgICBsZXQgcHJvY2Vzc2VkID0gMFxyXG4gICAgbGV0IGZhaWxlZCA9IDBcclxuICAgIGNvbnN0IGVycm9yczogYW55W10gPSBbXVxyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyDov4fmu6TmjonmnInlhrLnqoHnmoTmk43kvZxcclxuICAgICAgY29uc3QgY29uZmxpY3RFbnRpdGllcyA9IG5ldyBTZXQoY29uZmxpY3RzLm1hcChjID0+IGAke2MuZW50aXR5VHlwZX0tJHtjLmVudGl0eUlkfWApKVxyXG4gICAgICBjb25zdCBmaWx0ZXJlZE9wcyA9IG9wZXJhdGlvbnMuZmlsdGVyKG9wID0+IFxyXG4gICAgICAgICFjb25mbGljdEVudGl0aWVzLmhhcyhgJHtvcC5lbnRpdHl9LSR7b3AuZW50aXR5SWR9YClcclxuICAgICAgKVxyXG4gICAgICBcclxuICAgICAgLy8g5om56YeP5LiK5Lyg5LyY5YyWXHJcbiAgICAgIGNvbnN0IGJhdGNoU2l6ZSA9IDEwIC8vIOavj+aJuTEw5Liq5pON5L2cXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsdGVyZWRPcHMubGVuZ3RoOyBpICs9IGJhdGNoU2l6ZSkge1xyXG4gICAgICAgIGNvbnN0IGJhdGNoID0gZmlsdGVyZWRPcHMuc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSlcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnVwbG9hZEJhdGNoKGJhdGNoKVxyXG4gICAgICAgIFxyXG4gICAgICAgIHByb2Nlc3NlZCArPSByZXN1bHQucHJvY2Vzc2VkXHJcbiAgICAgICAgZmFpbGVkICs9IHJlc3VsdC5mYWlsZWRcclxuICAgICAgICBlcnJvcnMucHVzaCguLi5yZXN1bHQuZXJyb3JzKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwbG9hZCBsb2NhbCBjaGFuZ2VzOicsIGVycm9yKVxyXG4gICAgICBmYWlsZWQgPSBvcGVyYXRpb25zLmxlbmd0aFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4geyBwcm9jZXNzZWQsIGZhaWxlZCwgZXJyb3JzIH1cclxuICB9XHJcbiAgXHJcbiAgLy8g6L6F5Yqp5pa55rOVXHJcbiAgcHJpdmF0ZSBnZXRMYXN0U3luY1RpbWUoKTogRGF0ZSB7XHJcbiAgICByZXR1cm4gdGhpcy5zeW5jSGlzdG9yeS5sZW5ndGggPiAwIFxyXG4gICAgICA/IG5ldyBEYXRlKHRoaXMuc3luY0hpc3RvcnlbdGhpcy5zeW5jSGlzdG9yeS5sZW5ndGggLSAxXS50aW1lc3RhbXApXHJcbiAgICAgIDogbmV3IERhdGUoMClcclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSB0cmFuc2Zvcm1DbG91ZERhdGEoaXRlbTogYW55LCBlbnRpdHk6IHN0cmluZyk6IGFueSB7XHJcbiAgICAvLyDmoLnmja7lrp7kvZPnsbvlnovovazmjaLkupHnq6/mlbDmja7moLzlvI9cclxuICAgIHN3aXRjaCAoZW50aXR5KSB7XHJcbiAgICAgIGNhc2UgJ2NhcmRzJzpcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgZnJvbnRDb250ZW50OiBpdGVtLmZyb250X2NvbnRlbnQsXHJcbiAgICAgICAgICBiYWNrQ29udGVudDogaXRlbS5iYWNrX2NvbnRlbnQsXHJcbiAgICAgICAgICBzdHlsZTogaXRlbS5zdHlsZSxcclxuICAgICAgICAgIGZvbGRlcklkOiBpdGVtLmZvbGRlcl9pZCxcclxuICAgICAgICAgIGlzRGVsZXRlZDogaXRlbS5pc19kZWxldGVkLFxyXG4gICAgICAgICAgc3luY1ZlcnNpb246IGl0ZW0uc3luY192ZXJzaW9uLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiBpdGVtLnVwZGF0ZWRfYXRcclxuICAgICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjYXNlICdmb2xkZXJzJzpcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgbmFtZTogaXRlbS5uYW1lLFxyXG4gICAgICAgICAgcGFyZW50SWQ6IGl0ZW0ucGFyZW50X2lkLFxyXG4gICAgICAgICAgaXNEZWxldGVkOiBpdGVtLmlzX2RlbGV0ZWQsXHJcbiAgICAgICAgICBzeW5jVmVyc2lvbjogaXRlbS5zeW5jX3ZlcnNpb24sXHJcbiAgICAgICAgICB1cGRhdGVkQXQ6IGl0ZW0udXBkYXRlZF9hdFxyXG4gICAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNhc2UgJ3RhZ3MnOlxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBuYW1lOiBpdGVtLm5hbWUsXHJcbiAgICAgICAgICBjb2xvcjogaXRlbS5jb2xvcixcclxuICAgICAgICAgIGlzRGVsZXRlZDogaXRlbS5pc19kZWxldGVkLFxyXG4gICAgICAgICAgc3luY1ZlcnNpb246IGl0ZW0uc3luY192ZXJzaW9uLFxyXG4gICAgICAgICAgdXBkYXRlZEF0OiBpdGVtLnVwZGF0ZWRfYXRcclxuICAgICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiBpdGVtXHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgY2FsY3VsYXRlUHJpb3JpdHkoaXRlbTogYW55KTogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JyB7XHJcbiAgICAvLyDmoLnmja7lrp7kvZPnsbvlnovlkozmk43kvZznsbvlnovorqHnrpfkvJjlhYjnuqdcclxuICAgIGlmIChpdGVtLmlzX2RlbGV0ZWQpIHJldHVybiAnaGlnaCdcclxuICAgIGlmIChpdGVtLmVudGl0eSA9PT0gJ2ZvbGRlcicpIHJldHVybiAnbWVkaXVtJ1xyXG4gICAgcmV0dXJuICdsb3cnXHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29udGVudERpZmZlcmVuY2UoY29udGVudDE6IHN0cmluZywgY29udGVudDI6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICAvLyDnroDljZXnmoTlhoXlrrnlt67lvILorqHnrpdcclxuICAgIGNvbnN0IGxvbmdlciA9IE1hdGgubWF4KGNvbnRlbnQxLmxlbmd0aCwgY29udGVudDIubGVuZ3RoKVxyXG4gICAgaWYgKGxvbmdlciA9PT0gMCkgcmV0dXJuIDBcclxuICAgIFxyXG4gICAgY29uc3QgZGlzdGFuY2UgPSB0aGlzLmxldmVuc2h0ZWluRGlzdGFuY2UoY29udGVudDEsIGNvbnRlbnQyKVxyXG4gICAgcmV0dXJuIGRpc3RhbmNlIC8gbG9uZ2VyXHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgbGV2ZW5zaHRlaW5EaXN0YW5jZShzdHIxOiBzdHJpbmcsIHN0cjI6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICBjb25zdCBtYXRyaXggPSBBcnJheShzdHIyLmxlbmd0aCArIDEpLmZpbGwobnVsbCkubWFwKCgpID0+IEFycmF5KHN0cjEubGVuZ3RoICsgMSkuZmlsbChudWxsKSlcclxuICAgIFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc3RyMS5sZW5ndGg7IGkrKykgbWF0cml4WzBdW2ldID0gaVxyXG4gICAgZm9yIChsZXQgaiA9IDA7IGogPD0gc3RyMi5sZW5ndGg7IGorKykgbWF0cml4W2pdWzBdID0galxyXG4gICAgXHJcbiAgICBmb3IgKGxldCBqID0gMTsgaiA8PSBzdHIyLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHN0cjEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb25zdCBpbmRpY2F0b3IgPSBzdHIxW2kgLSAxXSA9PT0gc3RyMltqIC0gMV0gPyAwIDogMVxyXG4gICAgICAgIG1hdHJpeFtqXVtpXSA9IE1hdGgubWluKFxyXG4gICAgICAgICAgbWF0cml4W2pdW2kgLSAxXSArIDEsXHJcbiAgICAgICAgICBtYXRyaXhbaiAtIDFdW2ldICsgMSxcclxuICAgICAgICAgIG1hdHJpeFtqIC0gMV1baSAtIDFdICsgaW5kaWNhdG9yXHJcbiAgICAgICAgKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBtYXRyaXhbc3RyMi5sZW5ndGhdW3N0cjEubGVuZ3RoXVxyXG4gIH1cclxuICBcclxuICBwcml2YXRlIGdyb3VwT3BlcmF0aW9uc0J5RW50aXR5KG9wZXJhdGlvbnM6IFN5bmNPcGVyYXRpb25bXSk6IE1hcDxzdHJpbmcsIFN5bmNPcGVyYXRpb25bXT4ge1xyXG4gICAgY29uc3QgZ3JvdXBzID0gbmV3IE1hcDxzdHJpbmcsIFN5bmNPcGVyYXRpb25bXT4oKVxyXG4gICAgXHJcbiAgICBvcGVyYXRpb25zLmZvckVhY2gob3AgPT4ge1xyXG4gICAgICBpZiAoIWdyb3Vwcy5oYXMob3AuZW50aXR5KSkge1xyXG4gICAgICAgIGdyb3Vwcy5zZXQob3AuZW50aXR5LCBbXSlcclxuICAgICAgfVxyXG4gICAgICBncm91cHMuZ2V0KG9wLmVudGl0eSkhLnB1c2gob3ApXHJcbiAgICB9KVxyXG4gICAgXHJcbiAgICByZXR1cm4gZ3JvdXBzXHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgYXN5bmMgYXBwbHlFbnRpdHlDaGFuZ2VzKFxyXG4gICAgZW50aXR5VHlwZTogc3RyaW5nLCBcclxuICAgIG9wZXJhdGlvbnM6IFN5bmNPcGVyYXRpb25bXSwgXHJcbiAgICBjb25mbGljdHM6IGFueVtdXHJcbiAgKTogUHJvbWlzZTx7XHJcbiAgICBwcm9jZXNzZWQ6IG51bWJlclxyXG4gICAgZmFpbGVkOiBudW1iZXJcclxuICAgIGNvbmZsaWN0czogYW55W11cclxuICB9PiB7XHJcbiAgICAvLyDlhbfkvZPlrp7njrDmoLnmja7lrp7kvZPnsbvlnovogIzlrppcclxuICAgIC8vIOi/memHjOeugOWMluWkhOeQhu+8jOWunumZhemcgOimgeagueaNruS4jeWQjOWunuS9k+exu+Wei+WunueOsFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcHJvY2Vzc2VkOiBvcGVyYXRpb25zLmxlbmd0aCxcclxuICAgICAgZmFpbGVkOiAwLFxyXG4gICAgICBjb25mbGljdHM6IFtdXHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgYXN5bmMgdXBsb2FkQmF0Y2gob3BlcmF0aW9uczogU3luY09wZXJhdGlvbltdKTogUHJvbWlzZTx7XHJcbiAgICBwcm9jZXNzZWQ6IG51bWJlclxyXG4gICAgZmFpbGVkOiBudW1iZXJcclxuICAgIGVycm9yczogYW55W11cclxuICB9PiB7XHJcbiAgICAvLyDmibnph4/kuIrkvKDlrp7njrBcclxuICAgIC8vIOi/memHjOeugOWMluWkhOeQhu+8jOWunumZhemcgOimgeWunueOsFN1cGFiYXNl5om56YeP5pON5L2cXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBwcm9jZXNzZWQ6IG9wZXJhdGlvbnMubGVuZ3RoLFxyXG4gICAgICBmYWlsZWQ6IDAsXHJcbiAgICAgIGVycm9yczogW11cclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVTeW5jVmVyc2lvblBvaW50KFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgICBjbG91ZENoYW5nZXM6IFN5bmNPcGVyYXRpb25bXSxcclxuICAgIGxvY2FsT3BlcmF0aW9uczogU3luY09wZXJhdGlvbltdLFxyXG4gICAgcmVzdWx0OiBhbnlcclxuICApOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IHZlcnNpb246IFN5bmNWZXJzaW9uID0ge1xyXG4gICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICBvcGVyYXRpb25zOiBbLi4uY2xvdWRDaGFuZ2VzLCAuLi5sb2NhbE9wZXJhdGlvbnNdLFxyXG4gICAgICBjaGVja3N1bTogdGhpcy5jYWxjdWxhdGVDaGVja3N1bShbLi4uY2xvdWRDaGFuZ2VzLCAuLi5sb2NhbE9wZXJhdGlvbnNdKSxcclxuICAgICAgZGVzY3JpcHRpb246IGBJbmNyZW1lbnRhbCBzeW5jIC0gJHtyZXN1bHQucHJvY2Vzc2VkQ291bnR9IG9wZXJhdGlvbnNgLFxyXG4gICAgICByb2xsYmFja1BvaW50OiByZXN1bHQuZmFpbGVkQ291bnQgPT09IDBcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhpcy5zeW5jSGlzdG9yeS5wdXNoKHZlcnNpb24pXHJcbiAgICBcclxuICAgIC8vIOS/neaMgeacgOi/kTEwMOS4queJiOacrOeCuVxyXG4gICAgaWYgKHRoaXMuc3luY0hpc3RvcnkubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgIHRoaXMuc3luY0hpc3RvcnkgPSB0aGlzLnN5bmNIaXN0b3J5LnNsaWNlKC0xMDApXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOaMgeS5heWMluS/neWtmFxyXG4gICAgdHJ5IHtcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NhcmRhbGxfc3luY19oaXN0b3J5JywgSlNPTi5zdHJpbmdpZnkodGhpcy5zeW5jSGlzdG9yeSkpXHJcbiAgICAgIHRoaXMubGFzdFN5bmNWZXJzaW9uID0gdmVyc2lvbi5pZFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgc3luYyBoaXN0b3J5OicsIGVycm9yKVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBwcml2YXRlIGNhbGN1bGF0ZUNoZWNrc3VtKG9wZXJhdGlvbnM6IFN5bmNPcGVyYXRpb25bXSk6IHN0cmluZyB7XHJcbiAgICAvLyDnroDljZXnmoTmoKHpqozlkozorqHnrpdcclxuICAgIGNvbnN0IGRhdGEgPSBKU09OLnN0cmluZ2lmeShvcGVyYXRpb25zLm1hcChvcCA9PiAoe1xyXG4gICAgICBpZDogb3AuaWQsXHJcbiAgICAgIHR5cGU6IG9wLnR5cGUsXHJcbiAgICAgIGVudGl0eTogb3AuZW50aXR5LFxyXG4gICAgICBlbnRpdHlJZDogb3AuZW50aXR5SWQsXHJcbiAgICAgIHRpbWVzdGFtcDogb3AudGltZXN0YW1wXHJcbiAgICB9KSkpXHJcbiAgICBcclxuICAgIGxldCBoYXNoID0gMFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGNoYXIgPSBkYXRhLmNoYXJDb2RlQXQoaSlcclxuICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hhclxyXG4gICAgICBoYXNoID0gaGFzaCAmIGhhc2ggLy8g6L2s5o2i5Li6MzLkvY3mlbTmlbBcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIE1hdGguYWJzKGhhc2gpLnRvU3RyaW5nKDE2KVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDojrflj5blkIzmraXmjIfmoIdcclxuICAgKi9cclxuICBnZXRTeW5jTWV0cmljcygpOiBTeW5jTWV0cmljcyB7XHJcbiAgICBjb25zdCB0b3RhbE9wcyA9IHRoaXMuc3luY0hpc3RvcnkucmVkdWNlKChzdW0sIHZlcnNpb24pID0+IHN1bSArIHZlcnNpb24ub3BlcmF0aW9ucy5sZW5ndGgsIDApXHJcbiAgICBjb25zdCBzdWNjZXNzZnVsT3BzID0gdGhpcy5zeW5jSGlzdG9yeS5maWx0ZXIodiA9PiB2LnJvbGxiYWNrUG9pbnQpLmxlbmd0aFxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RhbE9wZXJhdGlvbnM6IHRvdGFsT3BzLFxyXG4gICAgICBzdWNjZXNzUmF0ZTogdG90YWxPcHMgPiAwID8gc3VjY2Vzc2Z1bE9wcyAvIHRoaXMuc3luY0hpc3RvcnkubGVuZ3RoIDogMSxcclxuICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogMCwgLy8g6ZyA6KaB5LuO5a6e6ZmF5ZCM5q2l5Lit6K6h566XXHJcbiAgICAgIGJhbmR3aWR0aFVzYWdlOiAwLCAgICAgLy8g6ZyA6KaB5LuO5a6e6ZmF5Lyg6L6T5Lit6K6h566XXHJcbiAgICAgIGNvbmZsaWN0UmF0ZTogMCwgICAgICAgLy8g6ZyA6KaB5LuO5Yay56qB57uf6K6h5Lit6K6h566XXHJcbiAgICAgIHJldHJ5Q291bnQ6IDAsICAgICAgICAvLyDpnIDopoHku47ph43or5Xnu5/orqHkuK3orqHnrpdcclxuICAgICAgbGFzdFN5bmNUaW1lc3RhbXA6IHRoaXMuc3luY0hpc3RvcnkubGVuZ3RoID4gMCBcclxuICAgICAgICA/IG5ldyBEYXRlKHRoaXMuc3luY0hpc3RvcnlbdGhpcy5zeW5jSGlzdG9yeS5sZW5ndGggLSAxXS50aW1lc3RhbXApXHJcbiAgICAgICAgOiBuZXcgRGF0ZSgwKVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDmuIXnkIbml6fnmoTlkIzmraXljoblj7JcclxuICAgKi9cclxuICBhc3luYyBjbGVhbnVwU3luY0hpc3Rvcnkoa2VlcERheXM6IG51bWJlciA9IDMwKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIGtlZXBEYXlzICogMjQgKiA2MCAqIDYwICogMTAwMClcclxuICAgIFxyXG4gICAgdGhpcy5zeW5jSGlzdG9yeSA9IHRoaXMuc3luY0hpc3RvcnkuZmlsdGVyKHZlcnNpb24gPT4gXHJcbiAgICAgIG5ldyBEYXRlKHZlcnNpb24udGltZXN0YW1wKSA+IGN1dG9mZkRhdGVcclxuICAgIClcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NhcmRhbGxfc3luY19oaXN0b3J5JywgSlNPTi5zdHJpbmdpZnkodGhpcy5zeW5jSGlzdG9yeSkpXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCBzeW5jIGhpc3Rvcnk6JywgZXJyb3IpXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyDlr7zlh7rljZXkvovlrp7kvotcclxuZXhwb3J0IGNvbnN0IGluY3JlbWVudGFsU3luY0FsZ29yaXRobSA9IG5ldyBJbmNyZW1lbnRhbFN5bmNBbGdvcml0aG0oKSJdLCJ2ZXJzaW9uIjozfQ==