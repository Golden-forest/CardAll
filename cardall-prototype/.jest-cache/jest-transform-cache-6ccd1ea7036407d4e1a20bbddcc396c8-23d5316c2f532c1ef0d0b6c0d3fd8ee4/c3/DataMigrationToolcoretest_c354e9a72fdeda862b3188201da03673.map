{"file":"D:\\Projects\\CardEverything\\cardall-prototype\\src\\__tests__\\services\\data-migration\\DataMigrationTool.core.test.ts","mappings":"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","names":[],"sources":["D:\\Projects\\CardEverything\\cardall-prototype\\src\\__tests__\\services\\data-migration\\DataMigrationTool.core.test.ts"],"sourcesContent":["/**\n * 数据迁移工具核心功能测试\n */\n\nimport { dataMigrationTool } from '@/services/data-migration-tool'\nimport { TestDataFactory, MigrationTestHelpers } from './test-utils'\nimport { setup } from './setup'\n\ndescribe('DataMigrationTool - 核心功能测试', () => {\n  const { validateMigrationResult, validateMigrationPlan, createProgressListener } = MigrationTestHelpers\n\n  describe('基本初始化和状态管理', () => {\n    test('应该正确初始化数据迁移工具', () => {\n      expect(dataMigrationTool).toBeDefined()\n      expect(dataMigrationTool).toBeInstanceOf(Object)\n    })\n\n    test('应该检查系统状态', async () => {\n      const status = await dataMigrationTool.getSystemStatus()\n\n      expect(status).toBeDefined()\n      expect(status.isMigrating).toBe(false)\n      expect(Array.isArray(status.activeMigrations)).toBe(true)\n      expect(typeof status.databaseHealthy).toBe('boolean')\n      expect(status.storageQuota).toBeDefined()\n      expect(typeof status.storageQuota.used).toBe('number')\n      expect(typeof status.storageQuota.total).toBe('number')\n    })\n\n    test('应该检查迁移需求', async () => {\n      try {\n        const needs = await dataMigrationTool.checkMigrationNeeds()\n        console.log('迁移需求检查结果:', needs)\n\n        expect(needs).toBeDefined()\n        expect(typeof needs.needsMigration).toBe('boolean')\n        expect(Array.isArray(needs.sources)).toBe(true)\n        expect(Array.isArray(needs.recommendations)).toBe(true)\n      } catch (error) {\n        console.error('迁移需求检查失败:', error)\n        throw error\n      }\n    })\n\n    test('应该获取迁移建议', async () => {\n      try {\n        const recommendations = await dataMigrationTool.getMigrationRecommendations()\n        console.log('迁移建议结果:', recommendations)\n\n        expect(recommendations).toBeDefined()\n        expect(Array.isArray(recommendations)).toBe(true)\n\n        if (recommendations.length > 0) {\n          const firstRec = recommendations[0]\n          expect(['high', 'medium', 'low']).toContain(firstRec.priority)\n          expect(firstRec.source).toBeDefined()\n          expect(typeof firstRec.reason).toBe('string')\n          expect(typeof firstRec.estimatedTime).toBe('number')\n          expect(['low', 'medium', 'high']).toContain(firstRec.risk)\n        }\n      } catch (error) {\n        console.error('获取迁移建议失败:', error)\n        throw error\n      }\n    })\n  })\n\n  describe('迁移进度管理', () => {\n    test('应该注册和移除进度回调', () => {\n      const callback = jest.fn()\n      const removeCallback = dataMigrationTool.onProgress(callback)\n\n      expect(typeof removeCallback).toBe('function')\n\n      // 测试回调注册\n      expect(callback).not.toHaveBeenCalled()\n\n      // 移除回调\n      removeCallback()\n    })\n\n    test('应该获取迁移进度', () => {\n      const planId = 'test-plan-id'\n      const progress = dataMigrationTool.getMigrationProgress(planId)\n\n      // 初始状态应该返回undefined\n      expect(progress).toBeUndefined()\n    })\n\n    test('应该能够取消迁移', async () => {\n      const planId = 'test-plan-id'\n      const result = await dataMigrationTool.cancelMigration(planId)\n\n      // 对于不存在的迁移，应该返回false\n      expect(result).toBe(false)\n    })\n  })\n\n  describe('迁移历史管理', () => {\n    test('应该获取迁移历史', async () => {\n      const history = await dataMigrationTool.getMigrationHistory()\n\n      expect(Array.isArray(history)).toBe(true)\n\n      // 如果有历史记录，验证其结构\n      if (history.length > 0) {\n        const firstResult = history[0]\n        expect(firstResult).toHaveProperty('planId')\n        expect(firstResult).toHaveProperty('executedAt')\n        expect(firstResult).toHaveProperty('duration')\n        expect(firstResult).toHaveProperty('success')\n        expect(firstResult.executedAt).toBeInstanceOf(Date)\n      }\n    })\n  })\n\n  describe('验证报告功能', () => {\n    test('应该创建验证报告', async () => {\n      const report = await dataMigrationTool.createValidationReport()\n\n      expect(report).toBeDefined()\n      expect(report).toHaveProperty('success')\n      expect(report).toHaveProperty('integrity')\n      expect(report).toHaveProperty('consistency')\n      expect(report).toHaveProperty('performance')\n      expect(report).toHaveProperty('issues')\n      expect(report).toHaveProperty('recommendations')\n\n      // 验证完整性检查\n      expect(report.integrity).toHaveProperty('cardsValid')\n      expect(report.integrity).toHaveProperty('cardsInvalid')\n      expect(report.integrity).toHaveProperty('foldersValid')\n      expect(report.integrity).toHaveProperty('foldersInvalid')\n      expect(report.integrity).toHaveProperty('tagsValid')\n      expect(report.integrity).toHaveProperty('tagsInvalid')\n      expect(report.integrity).toHaveProperty('imagesValid')\n      expect(report.integrity).toHaveProperty('imagesInvalid')\n\n      // 验证一致性检查\n      expect(report.consistency).toHaveProperty('referencesValid')\n      expect(report.consistency).toHaveProperty('duplicatesFound')\n      expect(report.consistency).toHaveProperty('orphansFound')\n\n      // 验证性能数据\n      expect(report.performance).toHaveProperty('totalTime')\n      expect(report.performance).toHaveProperty('dataSize')\n      expect(report.performance).toHaveProperty('throughput')\n\n      // 验证数组和属性类型\n      expect(Array.isArray(report.issues)).toBe(true)\n      expect(Array.isArray(report.recommendations)).toBe(true)\n      expect(typeof report.success).toBe('boolean')\n    })\n  })\n\n  describe('并发迁移管理', () => {\n    test('应该防止并发迁移', async () => {\n      // 创建一个简单的测试源\n      const source = {\n        type: 'localStorage' as const,\n        version: '1.0'\n      }\n\n      // 创建迁移计划\n      const plan = await dataMigrationTool.analyzeAndCreatePlan(source)\n\n      // 模拟一个正在运行的迁移\n      ;(dataMigrationTool as any).isMigrating = true\n\n      // 尝试执行第二个迁移\n      await expect(dataMigrationTool.executeMigration(plan))\n        .rejects.toThrow('Migration already in progress')\n\n      // 清理状态\n      ;(dataMigrationTool as any).isMigrating = false\n    })\n\n    test('应该正确管理多个迁移任务', async () => {\n      const source1 = { type: 'localStorage' as const, version: '1.0' }\n      const source2 = { type: 'database-simple' as const, version: '1.0' }\n\n      // 创建多个迁移计划\n      const plan1 = await dataMigrationTool.analyzeAndCreatePlan(source1)\n      const plan2 = await dataMigrationTool.analyzeAndCreatePlan(source2)\n\n      // 验证计划ID唯一性\n      expect(plan1.id).not.toBe(plan2.id)\n      expect(plan1.id).toBeDefined()\n      expect(plan2.id).toBeDefined()\n\n      // 验证基本结构\n      validateMigrationPlan(plan1, {\n        sourceType: 'localStorage',\n        backupRequired: true,\n        rollbackEnabled: true,\n        minSteps: 1\n      })\n\n      validateMigrationPlan(plan2, {\n        sourceType: 'database-simple',\n        backupRequired: true,\n        rollbackEnabled: true,\n        minSteps: 1\n      })\n    })\n  })\n\n  describe('错误处理和恢复', () => {\n    test('应该优雅处理无效输入', async () => {\n      // 测试无效的迁移源\n      const invalidSource = {\n        type: 'invalid-type' as any,\n        version: '1.0'\n      }\n\n      await expect(dataMigrationTool.analyzeAndCreatePlan(invalidSource))\n        .rejects.toThrow('Unknown migration source')\n\n      // 测试null输入\n      await expect(dataMigrationTool.analyzeAndCreatePlan(null as any))\n        .rejects.toThrow()\n    })\n\n    test('应该处理数据库连接错误', async () => {\n      // 模拟数据库连接失败\n      const originalDb = (global as any).db\n      ;(global as any).db = {\n        getStats: jest.fn().mockRejectedValue(new Error('Connection failed')),\n        healthCheck: jest.fn().mockRejectedValue(new Error('Connection failed'))\n      }\n\n      try {\n        await expect(dataMigrationTool.getSystemStatus())\n          .resolves.toMatchObject({\n            isMigrating: false,\n            databaseHealthy: false\n          })\n      } finally {\n        // 恢复原始数据库\n        if (originalDb) {\n          ;(global as any).db = originalDb\n        }\n      }\n    })\n  })\n\n  describe('工具函数', () => {\n    test('应该生成有效的搜索向量', () => {\n      const testCard = TestDataFactory.createTestCard({\n        frontContent: {\n          title: '测试标题',\n          text: '测试内容',\n          tags: ['标签1', '标签2'],\n          images: []\n        },\n        backContent: {\n          title: '背面标题',\n          text: '背面内容',\n          tags: ['标签3', '标签4'],\n          images: []\n        }\n      })\n\n      // 通过私有方法测试搜索向量生成\n      const searchVector = (dataMigrationTool as any).generateSearchVector(testCard)\n\n      expect(typeof searchVector).toBe('string')\n      expect(searchVector.toLowerCase()).toBe(searchVector) // 应该是小写的\n      expect(searchVector).toContain('测试标题')\n      expect(searchVector).toContain('测试内容')\n      expect(searchVector).toContain('背面标题')\n      expect(searchVector).toContain('背面内容')\n      expect(searchVector).toContain('标签1')\n      expect(searchVector).toContain('标签2')\n      expect(searchVector).toContain('标签3')\n      expect(searchVector).toContain('标签4')\n    })\n\n    test('应该计算文件夹深度', () => {\n      // 测试根文件夹\n      const rootFolder = TestDataFactory.createTestFolder({ parentId: null })\n      const rootDepth = (dataMigrationTool as any).calculateDepth(rootFolder)\n      expect(rootDepth).toBe(0)\n\n      // 测试子文件夹\n      const subFolder = TestDataFactory.createTestFolder({ parentId: 'parent-id' })\n      const subDepth = (dataMigrationTool as any).calculateDepth(subFolder)\n      expect(subDepth).toBe(1)\n    })\n\n    test('应该生成文件夹完整路径', () => {\n      const folder = TestDataFactory.createTestFolder({ name: '测试文件夹' })\n      const fullPath = (dataMigrationTool as any).generateFullPath(folder)\n\n      expect(typeof fullPath).toBe('string')\n      expect(fullPath).toContain('测试文件夹')\n    })\n\n    test('应该正确转换base64到Blob', async () => {\n      const base64Data = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k='\n\n      // 模拟fetch响应\n      global.fetch = jest.fn().mockResolvedValue({\n        blob: () => new Blob(['test'], { type: 'image/jpeg' })\n      }) as any\n\n      const blob = await (dataMigrationTool as any).base64ToBlob(base64Data)\n\n      expect(blob).toBeInstanceOf(Blob)\n      expect(blob.type).toBe('image/jpeg')\n\n      // 清理mock\n      jest.restoreAllMocks()\n    })\n  })\n\n  describe('性能测试', () => {\n    test('应该在合理时间内完成基本操作', async () => {\n      const startTime = performance.now()\n\n      // 测试系统状态检查\n      await dataMigrationTool.getSystemStatus()\n\n      // 测试迁移需求检查\n      await dataMigrationTool.checkMigrationNeeds()\n\n      // 测试验证报告生成\n      await dataMigrationTool.createValidationReport()\n\n      const endTime = performance.now()\n      const duration = endTime - startTime\n\n      // 这些操作应该在1秒内完成\n      expect(duration).toBeLessThan(1000)\n      console.log(`基本操作耗时: ${duration.toFixed(2)}ms`)\n    })\n\n    test('应该能够处理大量数据的状态查询', async () => {\n      // 创建大量测试数据\n      const bulkData = TestDataFactory.createBulkTestData(1000, 100, 200)\n\n      // 设置localStorage数据\n      MigrationTestHelpers.setupLocalStorageData(bulkData)\n\n      // 测试大数据量的迁移需求检查\n      const startTime = performance.now()\n      const needs = await dataMigrationTool.checkMigrationNeeds()\n      const endTime = performance.now()\n\n      const duration = endTime - startTime\n      console.log(`大数据量检查耗时: ${duration.toFixed(2)}ms`)\n\n      // 验证结果\n      expect(needs.needsMigration).toBe(true)\n      expect(needs.sources.length).toBeGreaterThan(0)\n\n      // 应该在合理时间内完成（5秒内）\n      expect(duration).toBeLessThan(5000)\n\n      // 清理\n      MigrationTestHelpers.cleanupLocalStorage()\n    })\n  })\n})"],"version":3}