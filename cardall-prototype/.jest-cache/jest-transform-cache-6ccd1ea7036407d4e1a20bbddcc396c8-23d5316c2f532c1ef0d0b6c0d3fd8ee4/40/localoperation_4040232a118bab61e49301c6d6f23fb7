85870acbc45052a30648aab296d0a36f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createImageOperation = exports.createTagOperation = exports.createFolderOperation = exports.createCardOperation = exports.localOperationService = exports.LocalOperationService = exports.DEFAULT_QUEUE_CONFIG = void 0;
const database_1 = require("./database");
// 默认队列配置
exports.DEFAULT_QUEUE_CONFIG = {
    maxRetries: 5,
    initialRetryDelay: 1000, // 1秒
    maxRetryDelay: 300000, // 5分钟
    retryBackoffMultiplier: 2,
    batchSize: 10,
    batchTimeout: 5000, // 5秒
    maxConcurrentBatches: 3,
    processingTimeout: 30000, // 30秒
    idleCheckInterval: 10000, // 10秒
    cleanupInterval: 300000, // 5分钟
    networkAware: true,
    offlineMode: true,
    requireWifiForLargeFiles: true,
    maxQueueSize: 10000,
    maxAge: 7 * 24 * 60 * 60 * 1000 // 7天
};
// ============================================================================
// 本地操作服务 - 核心队列管理
// ============================================================================
class LocalOperationService {
    constructor(config = {}) {
        Object.defineProperty(this, "config", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "isProcessing", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: false
        });
        Object.defineProperty(this, "processingTimer", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        Object.defineProperty(this, "cleanupTimer", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
        Object.defineProperty(this, "currentBatches", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Map()
        });
        // 事件监听器
        Object.defineProperty(this, "listeners", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: {}
        });
        this.config = { ...exports.DEFAULT_QUEUE_CONFIG, ...config };
        this.initialize();
    }
    // 初始化服务
    async initialize() {
        try {
            // 确保数据库已初始化
            await database_1.db.open();
            // 从本地存储恢复队列
            await this.restoreQueueFromStorage();
            // 启动定期处理
            this.startProcessing();
            // 启动定期清理
            this.startCleanup();
            console.log('LocalOperationService initialized successfully');
        }
        catch (error) {
            console.error('Failed to initialize LocalOperationService:', error);
        }
    }
    // 从本地存储恢复队列
    async restoreQueueFromStorage() {
        try {
            const storedQueue = localStorage.getItem('syncQueue');
            if (storedQueue) {
                const queue = JSON.parse(storedQueue);
                // 将存储的操作添加到数据库
                for (const operation of queue) {
                    // 转换旧格式到新格式（如果需要）
                    const convertedOperation = this.convertOperationFormat(operation);
                    try {
                        await database_1.db.syncQueue.add(convertedOperation);
                    }
                    catch (error) {
                        // 如果操作已存在，跳过
                        console.warn('Operation already exists in database, skipping:', operation.id);
                    }
                }
                // 清空本地存储
                localStorage.removeItem('syncQueue');
                console.log(`Restored ${queue.length} operations from local storage`);
            }
        }
        catch (error) {
            console.error('Failed to restore queue from storage:', error);
        }
    }
    // 转换操作格式（旧格式到新格式）
    convertOperationFormat(operation) {
        // 如果是新格式，直接返回
        if (operation.entityType && operation.operationType && operation.entityId) {
            return operation;
        }
        // 转换旧格式到新格式
        return {
            id: operation.id,
            entityType: operation.table === 'cards' ? 'card' :
                operation.table === 'folders' ? 'folder' :
                    operation.table === 'tags' ? 'tag' : 'image',
            operationType: operation.type,
            entityId: operation.localId,
            data: operation.data,
            timestamp: operation.timestamp,
            retryCount: operation.retryCount || 0,
            status: operation.status || 'pending',
            localVersion: operation.localVersion || 1,
            priority: operation.priority || 'normal',
            dependsOn: operation.dependsOn || []
        };
    }
    // ============================================================================
    // 核心队列操作
    // ============================================================================
    // 添加操作到队列
    async addOperation(operation) {
        // 验证必需字段
        if (!operation.entityId || operation.entityId.trim() === '') {
            throw new Error('Local ID is required');
        }
        if (!operation.entityType || !['card', 'folder', 'tag', 'image'].includes(operation.entityType)) {
            throw new Error('Invalid entity type');
        }
        if (!operation.operationType || !['create', 'update', 'delete'].includes(operation.operationType)) {
            throw new Error('Invalid operation type');
        }
        if (!operation.data) {
            throw new Error('Operation data is required');
        }
        const id = crypto.randomUUID();
        const now = new Date();
        const fullOperation = {
            ...operation,
            id,
            timestamp: now,
            retryCount: 0,
            status: 'pending',
            localVersion: Date.now(), // 使用时间戳作为本地版本
            retryDelay: this.config.initialRetryDelay,
            maxRetries: this.config.maxRetries
        };
        // 获取当前网络信息
        if (this.config.networkAware) {
            fullOperation.networkInfo = await this.getNetworkInfo();
        }
        // 检查重复操作
        const existingOperation = await database_1.db.syncQueue
            .where('entityId')
            .equals(operation.entityId)
            .and(op => op.entityType === operation.entityType && op.status === 'pending')
            .first();
        try {
            if (existingOperation) {
                // 更新现有操作而不是创建新操作
                await database_1.db.syncQueue.update(existingOperation.id, {
                    data: operation.data,
                    previousData: operation.previousData,
                    timestamp: now,
                    localVersion: Date.now()
                });
                console.log(`Operation updated in queue: ${existingOperation.id}`);
                return existingOperation.id;
            }
            await database_1.db.syncQueue.add(fullOperation);
            // 通知监听器
            this.notifyListeners('operationAdded', fullOperation);
            // 更新统计信息
            await this.updateQueueStats();
            console.log(`Operation added to queue: ${id}`);
            return id;
        }
        catch (error) {
            console.error('Failed to add operation to queue:', error);
            throw error;
        }
    }
    // 获取待处理操作
    async getPendingOperations(limit = this.config.batchSize, priorityFilter) {
        try {
            let query = database_1.db.syncQueue
                .where('status')
                .equals('pending')
                .orderBy('priority') // 按优先级排序
                .reverse(); // 高优先级在前
            // 应用优先级过滤
            if (priorityFilter && priorityFilter.length > 0) {
                query = query.filter(op => priorityFilter.includes(op.priority));
            }
            const operations = await query.limit(limit).toArray();
            // 检查依赖关系
            const readyOperations = await this.filterReadyOperations(operations);
            return readyOperations;
        }
        catch (error) {
            console.error('Failed to get pending operations:', error);
            return [];
        }
    }
    // 标记操作为处理中
    async markOperationProcessing(operationId) {
        try {
            await database_1.db.syncQueue.update(operationId, {
                status: 'processing',
                processingStartedAt: new Date()
            });
        }
        catch (error) {
            console.error(`Failed to mark operation ${operationId} as processing:`, error);
        }
    }
    // 标记操作完成
    async markOperationCompleted(operationId) {
        try {
            const operation = await database_1.db.syncQueue.get(operationId);
            if (!operation)
                return;
            await database_1.db.syncQueue.update(operationId, {
                status: 'completed'
            });
            // 通知监听器
            this.notifyListeners('operationCompleted', operation);
            // 更新统计信息
            await this.updateQueueStats();
        }
        catch (error) {
            console.error(`Failed to mark operation ${operationId} as completed:`, error);
        }
    }
    // 标记操作失败
    async markOperationFailed(operationId, error) {
        try {
            const operation = await database_1.db.syncQueue.get(operationId);
            if (!operation)
                return;
            const retryCount = operation.retryCount + 1;
            const nextRetryDelay = Math.min(operation.retryDelay * this.config.retryBackoffMultiplier, this.config.maxRetryDelay);
            const update = {
                retryCount,
                retryDelay: nextRetryDelay,
                lastError: error.message
            };
            // 检查是否超过最大重试次数
            if (retryCount >= operation.maxRetries) {
                update.status = 'failed';
            }
            else {
                // 重置为pending以便重试
                update.status = 'pending';
            }
            await database_1.db.syncQueue.update(operationId, update);
            // 通知监听器
            this.notifyListeners('operationFailed', operation, error);
            // 更新统计信息
            await this.updateQueueStats();
        }
        catch (error) {
            console.error(`Failed to mark operation ${operationId} as failed:`, error);
        }
    }
    // 取消操作
    async cancelOperation(operationId, reason) {
        try {
            const operation = await database_1.db.syncQueue.get(operationId);
            if (!operation)
                return;
            await database_1.db.syncQueue.update(operationId, {
                status: 'cancelled',
                lastError: reason || 'Cancelled by user'
            });
            // 通知监听器
            this.notifyListeners('operationFailed', operation, new Error(reason || 'Operation cancelled'));
            // 更新统计信息
            await this.updateQueueStats();
        }
        catch (error) {
            console.error(`Failed to cancel operation ${operationId}:`, error);
        }
    }
    // ============================================================================
    // 批处理和队列管理
    // ============================================================================
    // 开始处理队列
    startProcessing() {
        if (this.processingTimer) {
            clearInterval(this.processingTimer);
        }
        this.processingTimer = setInterval(async () => {
            if (!this.isProcessing) {
                await this.processQueue();
            }
        }, this.config.idleCheckInterval);
    }
    // 处理队列
    async processQueue() {
        if (this.isProcessing || this.currentBatches.size >= this.config.maxConcurrentBatches) {
            return;
        }
        this.isProcessing = true;
        try {
            // 获取待处理操作
            const operations = await this.getPendingOperations();
            if (operations.length === 0) {
                return;
            }
            // 分批处理
            const batches = await this.createBatches(operations);
            for (const batch of batches) {
                const batchId = crypto.randomUUID();
                const batchPromise = this.processBatch(batch, batchId);
                this.currentBatches.set(batchId, batchPromise);
                batchPromise
                    .catch(error => {
                    console.error(`Batch ${batchId} failed:`, error);
                })
                    .finally(() => {
                    this.currentBatches.delete(batchId);
                });
            }
        }
        catch (error) {
            console.error('Error processing queue:', error);
        }
        finally {
            this.isProcessing = false;
        }
    }
    // 创建批处理组
    async createBatches(operations) {
        const batches = [];
        let currentBatch = [];
        // 按优先级排序
        const sortedOperations = [...operations].sort((a, b) => {
            const priorityOrder = { critical: 4, high: 3, normal: 2, low: 1 };
            return priorityOrder[b.priority] - priorityOrder[a.priority];
        });
        for (const operation of sortedOperations) {
            // 检查批次大小限制
            if (currentBatch.length >= this.config.batchSize) {
                batches.push(currentBatch);
                currentBatch = [];
            }
            // 检查网络限制
            if (this.config.requireWifiForLargeFiles && operation.entityType === 'image') {
                const networkInfo = await this.getNetworkInfo();
                if (networkInfo.connectionType !== 'wifi') {
                    continue; // 跳过大文件操作
                }
            }
            currentBatch.push(operation);
        }
        if (currentBatch.length > 0) {
            batches.push(currentBatch);
        }
        return batches;
    }
    // 处理批次
    async processBatch(operations, batchId) {
        const batchStartTime = Date.now();
        try {
            // 标记所有操作为处理中
            await Promise.all(operations.map(op => this.markOperationProcessing(op.id)));
            // 通知监听器
            operations.forEach(op => {
                this.notifyListeners('operationStarted', op);
            });
            // 调用实际的同步逻辑
            await this.executeBatchSync(operations, batchId);
            // 标记所有操作为完成
            await Promise.all(operations.map(op => this.markOperationCompleted(op.id)));
            console.log(`Batch ${batchId} processed successfully (${operations.length} operations)`);
        }
        catch (error) {
            console.error(`Batch ${batchId} failed:`, error);
            // 标记所有操作为失败
            await Promise.all(operations.map(op => this.markOperationFailed(op.id, error)));
        }
    }
    // 执行批处理同步逻辑
    async executeBatchSync(operations, batchId) {
        try {
            // 导入统一同步服务（延迟导入避免循环依赖）
            const { unifiedSyncService } = await Promise.resolve().then(() => require('./unified-sync-service'));
            // 按操作类型分组处理
            const operationGroups = this.groupOperationsByType(operations);
            // 处理每个操作组
            for (const [entityType, entityOperations] of Object.entries(operationGroups)) {
                await this.processEntityGroup(entityType, entityOperations, unifiedSyncService);
            }
            console.log(`Batch ${batchId} sync execution completed`);
        }
        catch (error) {
            console.error(`Batch ${batchId} sync execution failed:`, error);
            throw error;
        }
    }
    // 按实体类型分组操作
    groupOperationsByType(operations) {
        const groups = {};
        for (const operation of operations) {
            if (!groups[operation.entityType]) {
                groups[operation.entityType] = [];
            }
            groups[operation.entityType].push(operation);
        }
        return groups;
    }
    // 处理实体操作组
    async processEntityGroup(entityType, operations, syncService) {
        switch (entityType) {
            case 'card':
                await this.processCardOperations(operations, syncService);
                break;
            case 'folder':
                await this.processFolderOperations(operations, syncService);
                break;
            case 'tag':
                await this.processTagOperations(operations, syncService);
                break;
            case 'image':
                await this.processImageOperations(operations, syncService);
                break;
            default:
                console.warn(`Unknown entity type: ${entityType}`);
        }
    }
    // 处理卡片操作
    async processCardOperations(operations, syncService) {
        for (const operation of operations) {
            try {
                switch (operation.operationType) {
                    case 'create':
                        await syncService.addOperation({
                            type: 'create',
                            entity: 'card',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'update':
                        await syncService.addOperation({
                            type: 'update',
                            entity: 'card',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'delete':
                        await syncService.addOperation({
                            type: 'delete',
                            entity: 'card',
                            entityId: operation.entityId,
                            data: { userId: operation.userId },
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                }
            }
            catch (error) {
                console.error(`Failed to process card operation ${operation.id}:`, error);
                throw error;
            }
        }
    }
    // 处理文件夹操作
    async processFolderOperations(operations, syncService) {
        for (const operation of operations) {
            try {
                switch (operation.operationType) {
                    case 'create':
                        await syncService.addOperation({
                            type: 'create',
                            entity: 'folder',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'update':
                        await syncService.addOperation({
                            type: 'update',
                            entity: 'folder',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'delete':
                        await syncService.addOperation({
                            type: 'delete',
                            entity: 'folder',
                            entityId: operation.entityId,
                            data: { userId: operation.userId },
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                }
            }
            catch (error) {
                console.error(`Failed to process folder operation ${operation.id}:`, error);
                throw error;
            }
        }
    }
    // 处理标签操作
    async processTagOperations(operations, syncService) {
        for (const operation of operations) {
            try {
                switch (operation.operationType) {
                    case 'create':
                        await syncService.addOperation({
                            type: 'create',
                            entity: 'tag',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'update':
                        await syncService.addOperation({
                            type: 'update',
                            entity: 'tag',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'delete':
                        await syncService.addOperation({
                            type: 'delete',
                            entity: 'tag',
                            entityId: operation.entityId,
                            data: { userId: operation.userId },
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                }
            }
            catch (error) {
                console.error(`Failed to process tag operation ${operation.id}:`, error);
                throw error;
            }
        }
    }
    // 处理图片操作
    async processImageOperations(operations, syncService) {
        for (const operation of operations) {
            try {
                switch (operation.operationType) {
                    case 'create':
                        await syncService.addOperation({
                            type: 'create',
                            entity: 'image',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'update':
                        await syncService.addOperation({
                            type: 'update',
                            entity: 'image',
                            entityId: operation.entityId,
                            data: operation.data,
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                    case 'delete':
                        await syncService.addOperation({
                            type: 'delete',
                            entity: 'image',
                            entityId: operation.entityId,
                            data: { userId: operation.userId },
                            priority: operation.priority,
                            userId: operation.userId
                        });
                        break;
                }
            }
            catch (error) {
                console.error(`Failed to process image operation ${operation.id}:`, error);
                throw error;
            }
        }
    }
    // ============================================================================
    // 清理和维护
    // ============================================================================
    // 启动定期清理
    startCleanup() {
        if (this.cleanupTimer) {
            clearInterval(this.cleanupTimer);
        }
        this.cleanupTimer = setInterval(async () => {
            await this.cleanupQueue();
        }, this.config.cleanupInterval);
    }
    // 清理队列
    async cleanupQueue() {
        try {
            const now = Date.now();
            // 清理过期的操作
            const expiredDate = new Date(now - this.config.maxAge);
            await database_1.db.syncQueue
                .where('timestamp')
                .below(expiredDate)
                .delete();
            // 清理已完成操作（保留最近的1000条用于统计）
            const completedOperations = await database_1.db.syncQueue
                .where('status')
                .equals('completed')
                .orderBy('timestamp')
                .reverse()
                .offset(1000)
                .toArray();
            if (completedOperations.length > 0) {
                await database_1.db.syncQueue.bulkDelete(completedOperations.map(op => op.id));
            }
            // 检查队列大小限制
            const totalCount = await database_1.db.syncQueue.count();
            if (totalCount > this.config.maxQueueSize) {
                const excess = totalCount - this.config.maxQueueSize;
                const oldestOperations = await database_1.db.syncQueue
                    .orderBy('timestamp')
                    .limit(excess)
                    .toArray();
                await database_1.db.syncQueue.bulkDelete(oldestOperations.map(op => op.id));
            }
            console.log('Queue cleanup completed');
        }
        catch (error) {
            console.error('Queue cleanup failed:', error);
        }
    }
    // ============================================================================
    // 网络状态检测
    // ============================================================================
    // 获取网络信息
    async getNetworkInfo() {
        if (!('connection' in navigator)) {
            return {
                online: navigator.onLine,
                connectionType: 'none',
                effectiveType: '4g'
            };
        }
        const connection = navigator.connection;
        return {
            online: navigator.onLine,
            connectionType: this.getConnectionType(connection),
            effectiveType: connection.effectiveType || '4g',
            rtt: connection.rtt,
            downlink: connection.downlink
        };
    }
    // 获取连接类型
    getConnectionType(connection) {
        if (!connection)
            return 'none';
        switch (connection.type) {
            case 'wifi':
            case 'ethernet':
                return 'wifi';
            case 'cellular':
            case 'bluetooth':
                return 'cellular';
            default:
                return 'none';
        }
    }
    // ============================================================================
    // 依赖关系检查
    // ============================================================================
    // 检查操作是否准备就绪（依赖关系已满足）
    async filterReadyOperations(operations) {
        const readyOperations = [];
        for (const operation of operations) {
            if (!operation.dependsOn || operation.dependsOn.length === 0) {
                readyOperations.push(operation);
                continue;
            }
            // 检查所有依赖操作是否已完成
            const dependencies = await database_1.db.syncQueue
                .where('id')
                .anyOf(operation.dependsOn)
                .toArray();
            const allDependenciesCompleted = dependencies.every(dep => dep.status === 'completed');
            if (allDependenciesCompleted) {
                readyOperations.push(operation);
            }
        }
        return readyOperations;
    }
    // ============================================================================
    // 统计和监控
    // ============================================================================
    // 获取队列统计信息
    async getQueueStats() {
        try {
            const allOperations = await database_1.db.syncQueue.toArray();
            const stats = {
                totalOperations: allOperations.length,
                pendingOperations: 0,
                processingOperations: 0,
                failedOperations: 0,
                completedOperations: 0,
                byType: {
                    card: 0,
                    folder: 0,
                    tag: 0,
                    image: 0
                },
                byPriority: {
                    critical: 0,
                    high: 0,
                    normal: 0,
                    low: 0
                },
                byStatus: {
                    pending: 0,
                    processing: 0,
                    completed: 0,
                    failed: 0,
                    cancelled: 0
                },
                averageProcessingTime: 0,
                failureRate: 0,
                oldestPendingAge: 0,
                averageRetryCount: 0
            };
            // 计算各类统计
            for (const operation of allOperations) {
                // 按类型统计
                stats.byType[operation.entityType]++;
                // 按优先级统计
                stats.byPriority[operation.priority]++;
                // 按状态统计
                stats.byStatus[operation.status]++;
                // 计算处理时间
                if (operation.status === 'completed' && operation.processingStartedAt) {
                    const processingTime = operation.timestamp.getTime() - operation.processingStartedAt.getTime();
                    stats.averageProcessingTime += processingTime;
                }
                // 计算平均重试次数
                stats.averageRetryCount += operation.retryCount;
            }
            // 计算衍生统计
            stats.pendingOperations = stats.byStatus.pending;
            stats.processingOperations = stats.byStatus.processing;
            stats.failedOperations = stats.byStatus.failed;
            stats.completedOperations = stats.byStatus.completed;
            // 计算平均处理时间
            const completedCount = stats.byStatus.completed;
            if (completedCount > 0) {
                stats.averageProcessingTime /= completedCount;
            }
            // 计算平均重试次数
            if (allOperations.length > 0) {
                stats.averageRetryCount /= allOperations.length;
            }
            // 计算失败率
            const totalWithStatus = allOperations.filter(op => ['completed', 'failed'].includes(op.status)).length;
            if (totalWithStatus > 0) {
                stats.failureRate = stats.failedOperations / totalWithStatus;
            }
            // 计算最老的待处理操作年龄
            const pendingOperations = allOperations.filter(op => op.status === 'pending');
            if (pendingOperations.length > 0) {
                const oldest = pendingOperations.reduce((oldest, current) => current.timestamp < oldest.timestamp ? current : oldest);
                stats.oldestPendingAge = Date.now() - oldest.timestamp.getTime();
            }
            return stats;
        }
        catch (error) {
            console.error('Failed to get queue stats:', error);
            return this.getEmptyStats();
        }
    }
    // 获取空统计信息
    getEmptyStats() {
        return {
            totalOperations: 0,
            pendingOperations: 0,
            processingOperations: 0,
            failedOperations: 0,
            completedOperations: 0,
            byType: { card: 0, folder: 0, tag: 0, image: 0 },
            byPriority: { critical: 0, high: 0, normal: 0, low: 0 },
            byStatus: { pending: 0, processing: 0, completed: 0, failed: 0, cancelled: 0 },
            averageProcessingTime: 0,
            failureRate: 0,
            oldestPendingAge: 0,
            averageRetryCount: 0
        };
    }
    // 更新队列统计信息并通知监听器
    async updateQueueStats() {
        try {
            const stats = await this.getQueueStats();
            this.notifyListeners('queueStatsChanged', stats);
        }
        catch (error) {
            console.error('Failed to update queue stats:', error);
        }
    }
    // ============================================================================
    // 事件监听器管理
    // ============================================================================
    // 添加事件监听器
    addEventListener(event, callback) {
        this.listeners[event] = callback;
    }
    // 移除事件监听器
    removeEventListener(event) {
        delete this.listeners[event];
    }
    // 通知监听器
    notifyListeners(event, ...args) {
        const listener = this.listeners[event];
        if (listener) {
            try {
                listener(...args);
            }
            catch (error) {
                console.error(`Error in ${event} listener:`, error);
            }
        }
    }
    // ============================================================================
    // 便利方法
    // ============================================================================
    // 清空队列
    async clearQueue() {
        try {
            await database_1.db.syncQueue.clear();
            await this.updateQueueStats();
            console.log('Queue cleared successfully');
        }
        catch (error) {
            console.error('Failed to clear queue:', error);
        }
    }
    // 获取操作详情
    async getOperation(id) {
        try {
            return await database_1.db.syncQueue.get(id);
        }
        catch (error) {
            console.error(`Failed to get operation ${id}:`, error);
            return undefined;
        }
    }
    // 删除操作
    async removeOperation(id) {
        try {
            await database_1.db.syncQueue.delete(id);
            await this.updateQueueStats();
        }
        catch (error) {
            console.error(`Failed to remove operation ${id}:`, error);
            throw error;
        }
    }
    // 重试失败的操作
    async retryFailedOperations() {
        try {
            const failedOperations = await database_1.db.syncQueue
                .where('status')
                .equals('failed')
                .toArray();
            for (const operation of failedOperations) {
                await database_1.db.syncQueue.update(operation.id, {
                    status: 'pending',
                    retryCount: 0,
                    retryDelay: this.config.initialRetryDelay,
                    lastError: undefined
                });
            }
            await this.updateQueueStats();
            console.log(`Retried ${failedOperations.length} failed operations`);
            return failedOperations.length;
        }
        catch (error) {
            console.error('Failed to retry failed operations:', error);
            return 0;
        }
    }
    // 清理已完成的操作
    async clearCompletedOperations() {
        try {
            const completedOperations = await database_1.db.syncQueue
                .where('status')
                .equals('completed')
                .toArray();
            // 保留最近完成的操作用于历史记录
            const keepRecentCount = 100;
            const operationsToDelete = completedOperations.slice(0, -keepRecentCount);
            for (const operation of operationsToDelete) {
                await database_1.db.syncQueue.delete(operation.id);
            }
            await this.updateQueueStats();
            console.log(`Cleared ${operationsToDelete.length} completed operations, kept ${completedOperations.length - operationsToDelete.length} recent ones`);
            return operationsToDelete.length;
        }
        catch (error) {
            console.error('Failed to clear completed operations:', error);
            return 0;
        }
    }
    // 更新配置
    updateConfig(newConfig) {
        // 验证配置参数
        if (newConfig.maxRetries !== undefined && newConfig.maxRetries < 0) {
            throw new Error('maxRetries must be non-negative');
        }
        if (newConfig.batchSize !== undefined && newConfig.batchSize <= 0) {
            throw new Error('batchSize must be positive');
        }
        if (newConfig.maxQueueSize !== undefined && newConfig.maxQueueSize < 0) {
            throw new Error('maxQueueSize must be non-negative');
        }
        if (newConfig.processingTimeout !== undefined && newConfig.processingTimeout <= 0) {
            throw new Error('processingTimeout must be positive');
        }
        if (newConfig.idleCheckInterval !== undefined && newConfig.idleCheckInterval <= 0) {
            throw new Error('idleCheckInterval must be positive');
        }
        // 更新配置
        this.config = { ...this.config, ...newConfig };
        // 如果定时器间隔改变，重新启动定时器
        if (newConfig.idleCheckInterval !== undefined) {
            this.startProcessing();
        }
        if (newConfig.cleanupInterval !== undefined) {
            this.startCleanup();
        }
        console.log('LocalOperationService config updated');
    }
    // 销毁服务
    destroy() {
        if (this.processingTimer) {
            clearInterval(this.processingTimer);
        }
        if (this.cleanupTimer) {
            clearInterval(this.cleanupTimer);
        }
        // 等待当前批次完成
        Promise.all(this.currentBatches.values()).then(() => {
            console.log('LocalOperationService destroyed');
        });
    }
}
exports.LocalOperationService = LocalOperationService;
// 导出单例实例
exports.localOperationService = new LocalOperationService();
// ============================================================================
// 导出工具函数
// ============================================================================
// 创建卡片操作
const createCardOperation = (operationType, cardData, userId, previousData) => {
    return {
        entityType: 'card',
        operationType,
        entityId: cardData.id,
        data: cardData,
        previousData,
        userId,
        priority: operationType === 'delete' ? 'high' : 'normal',
        maxRetries: 5
    };
};
exports.createCardOperation = createCardOperation;
// 创建文件夹操作
const createFolderOperation = (operationType, folderData, userId, previousData) => {
    return {
        entityType: 'folder',
        operationType,
        entityId: folderData.id,
        data: folderData,
        previousData,
        userId,
        priority: operationType === 'delete' ? 'high' : 'normal',
        maxRetries: 5
    };
};
exports.createFolderOperation = createFolderOperation;
// 创建标签操作
const createTagOperation = (operationType, tagData, userId, previousData) => {
    return {
        entityType: 'tag',
        operationType,
        entityId: tagData.id,
        data: tagData,
        previousData,
        userId,
        priority: 'normal',
        maxRetries: 3
    };
};
exports.createTagOperation = createTagOperation;
// 创建图片操作
const createImageOperation = (operationType, imageData, userId, previousData) => {
    return {
        entityType: 'image',
        operationType,
        entityId: imageData.id,
        data: imageData,
        previousData,
        userId,
        priority: operationType === 'delete' ? 'high' : 'low',
        maxRetries: 3
    };
};
exports.createImageOperation = createImageOperation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFByb2plY3RzXFxDYXJkRXZlcnl0aGluZ1xcY2FyZGFsbC1wcm90b3R5cGVcXHNyY1xcc2VydmljZXNcXGxvY2FsLW9wZXJhdGlvbi50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSx5Q0FBeUc7QUF3SHpHLFNBQVM7QUFDSSxRQUFBLG9CQUFvQixHQUFnQjtJQUMvQyxVQUFVLEVBQUUsQ0FBQztJQUNiLGlCQUFpQixFQUFFLElBQUksRUFBRSxLQUFLO0lBQzlCLGFBQWEsRUFBRSxNQUFNLEVBQUUsTUFBTTtJQUM3QixzQkFBc0IsRUFBRSxDQUFDO0lBRXpCLFNBQVMsRUFBRSxFQUFFO0lBQ2IsWUFBWSxFQUFFLElBQUksRUFBRSxLQUFLO0lBQ3pCLG9CQUFvQixFQUFFLENBQUM7SUFFdkIsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLE1BQU07SUFDaEMsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLE1BQU07SUFDaEMsZUFBZSxFQUFFLE1BQU0sRUFBRSxNQUFNO0lBRS9CLFlBQVksRUFBRSxJQUFJO0lBQ2xCLFdBQVcsRUFBRSxJQUFJO0lBQ2pCLHdCQUF3QixFQUFFLElBQUk7SUFFOUIsWUFBWSxFQUFFLEtBQUs7SUFDbkIsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSztDQUN0QyxDQUFBO0FBRUQsK0VBQStFO0FBQy9FLGtCQUFrQjtBQUNsQiwrRUFBK0U7QUFFL0UsTUFBYSxxQkFBcUI7SUFnQmhDLFlBQVksU0FBK0IsRUFBRTtRQWZyQzs7Ozs7V0FBbUI7UUFDbkI7Ozs7bUJBQWUsS0FBSztXQUFBO1FBQ3BCOzs7O21CQUF5QyxJQUFJO1dBQUE7UUFDN0M7Ozs7bUJBQXNDLElBQUk7V0FBQTtRQUMxQzs7OzttQkFBNkMsSUFBSSxHQUFHLEVBQUU7V0FBQTtRQUU5RCxRQUFRO1FBQ0E7Ozs7bUJBTUosRUFBRTtXQUFBO1FBR0osSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsNEJBQW9CLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQTtRQUNwRCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7SUFDbkIsQ0FBQztJQUVELFFBQVE7SUFDQSxLQUFLLENBQUMsVUFBVTtRQUN0QixJQUFJLENBQUM7WUFDSCxZQUFZO1lBQ1osTUFBTSxhQUFFLENBQUMsSUFBSSxFQUFFLENBQUE7WUFFZixZQUFZO1lBQ1osTUFBTSxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQTtZQUVwQyxTQUFTO1lBQ1QsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFBO1lBRXRCLFNBQVM7WUFDVCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7WUFFbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnREFBZ0QsQ0FBQyxDQUFBO1FBQy9ELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyw2Q0FBNkMsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNyRSxDQUFDO0lBQ0gsQ0FBQztJQUVELFlBQVk7SUFDSixLQUFLLENBQUMsdUJBQXVCO1FBQ25DLElBQUksQ0FBQztZQUNILE1BQU0sV0FBVyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUE7WUFDckQsSUFBSSxXQUFXLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQTtnQkFFckMsZUFBZTtnQkFDZixLQUFLLE1BQU0sU0FBUyxJQUFJLEtBQUssRUFBRSxDQUFDO29CQUM5QixrQkFBa0I7b0JBQ2xCLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFNBQVMsQ0FBQyxDQUFBO29CQUVqRSxJQUFJLENBQUM7d0JBQ0gsTUFBTSxhQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO29CQUM1QyxDQUFDO29CQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7d0JBQ2YsYUFBYTt3QkFDYixPQUFPLENBQUMsSUFBSSxDQUFDLGlEQUFpRCxFQUFFLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQTtvQkFDL0UsQ0FBQztnQkFDSCxDQUFDO2dCQUVELFNBQVM7Z0JBQ1QsWUFBWSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQTtnQkFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEtBQUssQ0FBQyxNQUFNLGdDQUFnQyxDQUFDLENBQUE7WUFDdkUsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUMvRCxDQUFDO0lBQ0gsQ0FBQztJQUVELGtCQUFrQjtJQUNWLHNCQUFzQixDQUFDLFNBQWM7UUFDM0MsY0FBYztRQUNkLElBQUksU0FBUyxDQUFDLFVBQVUsSUFBSSxTQUFTLENBQUMsYUFBYSxJQUFJLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMxRSxPQUFPLFNBQStCLENBQUE7UUFDeEMsQ0FBQztRQUVELFlBQVk7UUFDWixPQUFPO1lBQ0wsRUFBRSxFQUFFLFNBQVMsQ0FBQyxFQUFFO1lBQ2hCLFVBQVUsRUFBRSxTQUFTLENBQUMsS0FBSyxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3hDLFNBQVMsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDMUMsU0FBUyxDQUFDLEtBQUssS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTztZQUN0RCxhQUFhLEVBQUUsU0FBUyxDQUFDLElBQUk7WUFDN0IsUUFBUSxFQUFFLFNBQVMsQ0FBQyxPQUFPO1lBQzNCLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSTtZQUNwQixTQUFTLEVBQUUsU0FBUyxDQUFDLFNBQVM7WUFDOUIsVUFBVSxFQUFFLFNBQVMsQ0FBQyxVQUFVLElBQUksQ0FBQztZQUNyQyxNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU0sSUFBSSxTQUFTO1lBQ3JDLFlBQVksRUFBRSxTQUFTLENBQUMsWUFBWSxJQUFJLENBQUM7WUFDekMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFRLElBQUksUUFBUTtZQUN4QyxTQUFTLEVBQUUsU0FBUyxDQUFDLFNBQVMsSUFBSSxFQUFFO1NBQ3JDLENBQUE7SUFDSCxDQUFDO0lBRUQsK0VBQStFO0lBQy9FLFNBQVM7SUFDVCwrRUFBK0U7SUFFL0UsVUFBVTtJQUNWLEtBQUssQ0FBQyxZQUFZLENBQ2hCLFNBQWtHO1FBRWxHLFNBQVM7UUFDVCxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQzVELE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQTtRQUN6QyxDQUFDO1FBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUNoRyxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUE7UUFDeEMsQ0FBQztRQUNELElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztZQUNsRyxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUE7UUFDM0MsQ0FBQztRQUNELElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFBO1FBQy9DLENBQUM7UUFFRCxNQUFNLEVBQUUsR0FBRyxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUE7UUFDOUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQTtRQUV0QixNQUFNLGFBQWEsR0FBdUI7WUFDeEMsR0FBRyxTQUFTO1lBQ1osRUFBRTtZQUNGLFNBQVMsRUFBRSxHQUFHO1lBQ2QsVUFBVSxFQUFFLENBQUM7WUFDYixNQUFNLEVBQUUsU0FBUztZQUNqQixZQUFZLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLGNBQWM7WUFDeEMsVUFBVSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCO1lBQ3pDLFVBQVUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVU7U0FDbkMsQ0FBQTtRQUVELFdBQVc7UUFDWCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDN0IsYUFBYSxDQUFDLFdBQVcsR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQTtRQUN6RCxDQUFDO1FBRUQsU0FBUztRQUNULE1BQU0saUJBQWlCLEdBQUcsTUFBTSxhQUFFLENBQUMsU0FBUzthQUN6QyxLQUFLLENBQUMsVUFBVSxDQUFDO2FBQ2pCLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO2FBQzFCLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEtBQUssU0FBUyxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQzthQUM1RSxLQUFLLEVBQUUsQ0FBQTtRQUVWLElBQUksQ0FBQztZQUNILElBQUksaUJBQWlCLEVBQUUsQ0FBQztnQkFDdEIsaUJBQWlCO2dCQUNqQixNQUFNLGFBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEVBQUcsRUFBRTtvQkFDL0MsSUFBSSxFQUFFLFNBQVMsQ0FBQyxJQUFJO29CQUNwQixZQUFZLEVBQUUsU0FBUyxDQUFDLFlBQVk7b0JBQ3BDLFNBQVMsRUFBRSxHQUFHO29CQUNkLFlBQVksRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO2lCQUN6QixDQUFDLENBQUE7Z0JBQ0YsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBK0IsaUJBQWlCLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtnQkFDbEUsT0FBTyxpQkFBaUIsQ0FBQyxFQUFHLENBQUE7WUFDOUIsQ0FBQztZQUVELE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUE7WUFFckMsUUFBUTtZQUNSLElBQUksQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLENBQUE7WUFFckQsU0FBUztZQUNULE1BQU0sSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUE7WUFFN0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsRUFBRSxFQUFFLENBQUMsQ0FBQTtZQUM5QyxPQUFPLEVBQUUsQ0FBQTtRQUNYLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUN6RCxNQUFNLEtBQUssQ0FBQTtRQUNiLENBQUM7SUFDSCxDQUFDO0lBRUQsVUFBVTtJQUNWLEtBQUssQ0FBQyxvQkFBb0IsQ0FDeEIsUUFBZ0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQ3JDLGNBQTJEO1FBRTNELElBQUksQ0FBQztZQUNILElBQUksS0FBSyxHQUFHLGFBQUUsQ0FBQyxTQUFTO2lCQUNyQixLQUFLLENBQUMsUUFBUSxDQUFDO2lCQUNmLE1BQU0sQ0FBQyxTQUFTLENBQUM7aUJBQ2pCLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTO2lCQUM3QixPQUFPLEVBQUUsQ0FBQSxDQUFDLFNBQVM7WUFFdEIsVUFBVTtZQUNWLElBQUksY0FBYyxJQUFJLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ2hELEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTtZQUNsRSxDQUFDO1lBRUQsTUFBTSxVQUFVLEdBQUcsTUFBTSxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFBO1lBRXJELFNBQVM7WUFDVCxNQUFNLGVBQWUsR0FBRyxNQUFNLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUVwRSxPQUFPLGVBQWUsQ0FBQTtRQUN4QixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUNBQW1DLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDekQsT0FBTyxFQUFFLENBQUE7UUFDWCxDQUFDO0lBQ0gsQ0FBQztJQUVELFdBQVc7SUFDWCxLQUFLLENBQUMsdUJBQXVCLENBQUMsV0FBbUI7UUFDL0MsSUFBSSxDQUFDO1lBQ0gsTUFBTSxhQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUU7Z0JBQ3JDLE1BQU0sRUFBRSxZQUFZO2dCQUNwQixtQkFBbUIsRUFBRSxJQUFJLElBQUksRUFBRTthQUNoQyxDQUFDLENBQUE7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLFdBQVcsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDaEYsQ0FBQztJQUNILENBQUM7SUFFRCxTQUFTO0lBQ1QsS0FBSyxDQUFDLHNCQUFzQixDQUFDLFdBQW1CO1FBQzlDLElBQUksQ0FBQztZQUNILE1BQU0sU0FBUyxHQUFHLE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUE7WUFDckQsSUFBSSxDQUFDLFNBQVM7Z0JBQUUsT0FBTTtZQUV0QixNQUFNLGFBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRTtnQkFDckMsTUFBTSxFQUFFLFdBQVc7YUFDcEIsQ0FBQyxDQUFBO1lBRUYsUUFBUTtZQUNSLElBQUksQ0FBQyxlQUFlLENBQUMsb0JBQW9CLEVBQUUsU0FBUyxDQUFDLENBQUE7WUFFckQsU0FBUztZQUNULE1BQU0sSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUE7UUFDL0IsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLDRCQUE0QixXQUFXLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQy9FLENBQUM7SUFDSCxDQUFDO0lBRUQsU0FBUztJQUNULEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxXQUFtQixFQUFFLEtBQVk7UUFDekQsSUFBSSxDQUFDO1lBQ0gsTUFBTSxTQUFTLEdBQUcsTUFBTSxhQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQTtZQUNyRCxJQUFJLENBQUMsU0FBUztnQkFBRSxPQUFNO1lBRXRCLE1BQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFBO1lBQzNDLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQzdCLFNBQVMsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFDekQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQzFCLENBQUE7WUFFRCxNQUFNLE1BQU0sR0FBZ0M7Z0JBQzFDLFVBQVU7Z0JBQ1YsVUFBVSxFQUFFLGNBQWM7Z0JBQzFCLFNBQVMsRUFBRSxLQUFLLENBQUMsT0FBTzthQUN6QixDQUFBO1lBRUQsZUFBZTtZQUNmLElBQUksVUFBVSxJQUFJLFNBQVMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDdkMsTUFBTSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUE7WUFDMUIsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLGlCQUFpQjtnQkFDakIsTUFBTSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUE7WUFDM0IsQ0FBQztZQUVELE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1lBRTlDLFFBQVE7WUFDUixJQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUV6RCxTQUFTO1lBQ1QsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtRQUMvQixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLFdBQVcsYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQzVFLENBQUM7SUFDSCxDQUFDO0lBRUQsT0FBTztJQUNQLEtBQUssQ0FBQyxlQUFlLENBQUMsV0FBbUIsRUFBRSxNQUFlO1FBQ3hELElBQUksQ0FBQztZQUNILE1BQU0sU0FBUyxHQUFHLE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUE7WUFDckQsSUFBSSxDQUFDLFNBQVM7Z0JBQUUsT0FBTTtZQUV0QixNQUFNLGFBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRTtnQkFDckMsTUFBTSxFQUFFLFdBQVc7Z0JBQ25CLFNBQVMsRUFBRSxNQUFNLElBQUksbUJBQW1CO2FBQ3pDLENBQUMsQ0FBQTtZQUVGLFFBQVE7WUFDUixJQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxJQUFJLEtBQUssQ0FBQyxNQUFNLElBQUkscUJBQXFCLENBQUMsQ0FBQyxDQUFBO1lBRTlGLFNBQVM7WUFDVCxNQUFNLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO1FBQy9CLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsV0FBVyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDcEUsQ0FBQztJQUNILENBQUM7SUFFRCwrRUFBK0U7SUFDL0UsV0FBVztJQUNYLCtFQUErRTtJQUUvRSxTQUFTO0lBQ0QsZUFBZTtRQUNyQixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN6QixhQUFhLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFBO1FBQ3JDLENBQUM7UUFFRCxJQUFJLENBQUMsZUFBZSxHQUFHLFdBQVcsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO2dCQUN2QixNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUMzQixDQUFDO1FBQ0gsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRUQsT0FBTztJQUNDLEtBQUssQ0FBQyxZQUFZO1FBQ3hCLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFvQixFQUFFLENBQUM7WUFDdEYsT0FBTTtRQUNSLENBQUM7UUFFRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQTtRQUV4QixJQUFJLENBQUM7WUFDSCxVQUFVO1lBQ1YsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQTtZQUVwRCxJQUFJLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzVCLE9BQU07WUFDUixDQUFDO1lBRUQsT0FBTztZQUNQLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUVwRCxLQUFLLE1BQU0sS0FBSyxJQUFJLE9BQU8sRUFBRSxDQUFDO2dCQUM1QixNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUE7Z0JBQ25DLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFBO2dCQUV0RCxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUE7Z0JBRTlDLFlBQVk7cUJBQ1QsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUNiLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxPQUFPLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQTtnQkFDbEQsQ0FBQyxDQUFDO3FCQUNELE9BQU8sQ0FBQyxHQUFHLEVBQUU7b0JBQ1osSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUE7Z0JBQ3JDLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNqRCxDQUFDO2dCQUFTLENBQUM7WUFDVCxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQTtRQUMzQixDQUFDO0lBQ0gsQ0FBQztJQUVELFNBQVM7SUFDRCxLQUFLLENBQUMsYUFBYSxDQUFDLFVBQWdDO1FBQzFELE1BQU0sT0FBTyxHQUEyQixFQUFFLENBQUE7UUFDMUMsSUFBSSxZQUFZLEdBQXlCLEVBQUUsQ0FBQTtRQUUzQyxTQUFTO1FBQ1QsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3JELE1BQU0sYUFBYSxHQUFHLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFBO1lBQ2pFLE9BQU8sYUFBYSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQzlELENBQUMsQ0FBQyxDQUFBO1FBRUYsS0FBSyxNQUFNLFNBQVMsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3pDLFdBQVc7WUFDWCxJQUFJLFlBQVksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDakQsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQTtnQkFDMUIsWUFBWSxHQUFHLEVBQUUsQ0FBQTtZQUNuQixDQUFDO1lBRUQsU0FBUztZQUNULElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyx3QkFBd0IsSUFBSSxTQUFTLENBQUMsVUFBVSxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUM3RSxNQUFNLFdBQVcsR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQTtnQkFDL0MsSUFBSSxXQUFXLENBQUMsY0FBYyxLQUFLLE1BQU0sRUFBRSxDQUFDO29CQUMxQyxTQUFRLENBQUMsVUFBVTtnQkFDckIsQ0FBQztZQUNILENBQUM7WUFFRCxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQzlCLENBQUM7UUFFRCxJQUFJLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDNUIsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQTtRQUM1QixDQUFDO1FBRUQsT0FBTyxPQUFPLENBQUE7SUFDaEIsQ0FBQztJQUVELE9BQU87SUFDQyxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQWdDLEVBQUUsT0FBZTtRQUMxRSxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUE7UUFFakMsSUFBSSxDQUFDO1lBQ0gsYUFBYTtZQUNiLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FDZixVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUMxRCxDQUFBO1lBRUQsUUFBUTtZQUNSLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ3RCLElBQUksQ0FBQyxlQUFlLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxDQUFDLENBQUE7WUFDOUMsQ0FBQyxDQUFDLENBQUE7WUFFRixZQUFZO1lBQ1osTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFBO1lBRWhELFlBQVk7WUFDWixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ2YsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FDekQsQ0FBQTtZQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxPQUFPLDRCQUE0QixVQUFVLENBQUMsTUFBTSxjQUFjLENBQUMsQ0FBQTtRQUMxRixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxPQUFPLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUVoRCxZQUFZO1lBQ1osTUFBTSxPQUFPLENBQUMsR0FBRyxDQUNmLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxLQUFjLENBQUMsQ0FBQyxDQUN0RSxDQUFBO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxZQUFZO0lBQ0osS0FBSyxDQUFDLGdCQUFnQixDQUFDLFVBQWdDLEVBQUUsT0FBZTtRQUM5RSxJQUFJLENBQUM7WUFDSCx1QkFBdUI7WUFDdkIsTUFBTSxFQUFFLGtCQUFrQixFQUFFLEdBQUcsMkNBQWEsd0JBQXdCLEVBQUMsQ0FBQTtZQUVyRSxZQUFZO1lBQ1osTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxDQUFBO1lBRTlELFVBQVU7WUFDVixLQUFLLE1BQU0sQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7Z0JBQzdFLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsRUFBRSxrQkFBa0IsQ0FBQyxDQUFBO1lBQ2pGLENBQUM7WUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsT0FBTywyQkFBMkIsQ0FBQyxDQUFBO1FBQzFELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLE9BQU8seUJBQXlCLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDL0QsTUFBTSxLQUFLLENBQUE7UUFDYixDQUFDO0lBQ0gsQ0FBQztJQUVELFlBQVk7SUFDSixxQkFBcUIsQ0FBQyxVQUFnQztRQUM1RCxNQUFNLE1BQU0sR0FBeUMsRUFBRSxDQUFBO1FBRXZELEtBQUssTUFBTSxTQUFTLElBQUksVUFBVSxFQUFFLENBQUM7WUFDbkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztnQkFDbEMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUE7WUFDbkMsQ0FBQztZQUNELE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQzlDLENBQUM7UUFFRCxPQUFPLE1BQU0sQ0FBQTtJQUNmLENBQUM7SUFFRCxVQUFVO0lBQ0YsS0FBSyxDQUFDLGtCQUFrQixDQUM5QixVQUFrQixFQUNsQixVQUFnQyxFQUNoQyxXQUFnQjtRQUVoQixRQUFRLFVBQVUsRUFBRSxDQUFDO1lBQ25CLEtBQUssTUFBTTtnQkFDVCxNQUFNLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUE7Z0JBQ3pELE1BQUs7WUFDUCxLQUFLLFFBQVE7Z0JBQ1gsTUFBTSxJQUFJLENBQUMsdUJBQXVCLENBQUMsVUFBVSxFQUFFLFdBQVcsQ0FBQyxDQUFBO2dCQUMzRCxNQUFLO1lBQ1AsS0FBSyxLQUFLO2dCQUNSLE1BQU0sSUFBSSxDQUFDLG9CQUFvQixDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQTtnQkFDeEQsTUFBSztZQUNQLEtBQUssT0FBTztnQkFDVixNQUFNLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUE7Z0JBQzFELE1BQUs7WUFDUDtnQkFDRSxPQUFPLENBQUMsSUFBSSxDQUFDLHdCQUF3QixVQUFVLEVBQUUsQ0FBQyxDQUFBO1FBQ3RELENBQUM7SUFDSCxDQUFDO0lBRUQsU0FBUztJQUNELEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxVQUFnQyxFQUFFLFdBQWdCO1FBQ3BGLEtBQUssTUFBTSxTQUFTLElBQUksVUFBVSxFQUFFLENBQUM7WUFDbkMsSUFBSSxDQUFDO2dCQUNILFFBQVEsU0FBUyxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUNoQyxLQUFLLFFBQVE7d0JBQ1gsTUFBTSxXQUFXLENBQUMsWUFBWSxDQUFDOzRCQUM3QixJQUFJLEVBQUUsUUFBUTs0QkFDZCxNQUFNLEVBQUUsTUFBTTs0QkFDZCxRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7NEJBQzVCLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSTs0QkFDcEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07eUJBQ3pCLENBQUMsQ0FBQTt3QkFDRixNQUFLO29CQUVQLEtBQUssUUFBUTt3QkFDWCxNQUFNLFdBQVcsQ0FBQyxZQUFZLENBQUM7NEJBQzdCLElBQUksRUFBRSxRQUFROzRCQUNkLE1BQU0sRUFBRSxNQUFNOzRCQUNkLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTs0QkFDNUIsSUFBSSxFQUFFLFNBQVMsQ0FBQyxJQUFJOzRCQUNwQixRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7NEJBQzVCLE1BQU0sRUFBRSxTQUFTLENBQUMsTUFBTTt5QkFDekIsQ0FBQyxDQUFBO3dCQUNGLE1BQUs7b0JBRVAsS0FBSyxRQUFRO3dCQUNYLE1BQU0sV0FBVyxDQUFDLFlBQVksQ0FBQzs0QkFDN0IsSUFBSSxFQUFFLFFBQVE7NEJBQ2QsTUFBTSxFQUFFLE1BQU07NEJBQ2QsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU0sRUFBRTs0QkFDbEMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07eUJBQ3pCLENBQUMsQ0FBQTt3QkFDRixNQUFLO2dCQUNULENBQUM7WUFDSCxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixPQUFPLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQ3pFLE1BQU0sS0FBSyxDQUFBO1lBQ2IsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRUQsVUFBVTtJQUNGLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxVQUFnQyxFQUFFLFdBQWdCO1FBQ3RGLEtBQUssTUFBTSxTQUFTLElBQUksVUFBVSxFQUFFLENBQUM7WUFDbkMsSUFBSSxDQUFDO2dCQUNILFFBQVEsU0FBUyxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUNoQyxLQUFLLFFBQVE7d0JBQ1gsTUFBTSxXQUFXLENBQUMsWUFBWSxDQUFDOzRCQUM3QixJQUFJLEVBQUUsUUFBUTs0QkFDZCxNQUFNLEVBQUUsUUFBUTs0QkFDaEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUk7NEJBQ3BCLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTs0QkFDNUIsTUFBTSxFQUFFLFNBQVMsQ0FBQyxNQUFNO3lCQUN6QixDQUFDLENBQUE7d0JBQ0YsTUFBSztvQkFFUCxLQUFLLFFBQVE7d0JBQ1gsTUFBTSxXQUFXLENBQUMsWUFBWSxDQUFDOzRCQUM3QixJQUFJLEVBQUUsUUFBUTs0QkFDZCxNQUFNLEVBQUUsUUFBUTs0QkFDaEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUk7NEJBQ3BCLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTs0QkFDNUIsTUFBTSxFQUFFLFNBQVMsQ0FBQyxNQUFNO3lCQUN6QixDQUFDLENBQUE7d0JBQ0YsTUFBSztvQkFFUCxLQUFLLFFBQVE7d0JBQ1gsTUFBTSxXQUFXLENBQUMsWUFBWSxDQUFDOzRCQUM3QixJQUFJLEVBQUUsUUFBUTs0QkFDZCxNQUFNLEVBQUUsUUFBUTs0QkFDaEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU0sRUFBRTs0QkFDbEMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07eUJBQ3pCLENBQUMsQ0FBQTt3QkFDRixNQUFLO2dCQUNULENBQUM7WUFDSCxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixPQUFPLENBQUMsS0FBSyxDQUFDLHNDQUFzQyxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQzNFLE1BQU0sS0FBSyxDQUFBO1lBQ2IsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRUQsU0FBUztJQUNELEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxVQUFnQyxFQUFFLFdBQWdCO1FBQ25GLEtBQUssTUFBTSxTQUFTLElBQUksVUFBVSxFQUFFLENBQUM7WUFDbkMsSUFBSSxDQUFDO2dCQUNILFFBQVEsU0FBUyxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUNoQyxLQUFLLFFBQVE7d0JBQ1gsTUFBTSxXQUFXLENBQUMsWUFBWSxDQUFDOzRCQUM3QixJQUFJLEVBQUUsUUFBUTs0QkFDZCxNQUFNLEVBQUUsS0FBSzs0QkFDYixRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7NEJBQzVCLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSTs0QkFDcEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07eUJBQ3pCLENBQUMsQ0FBQTt3QkFDRixNQUFLO29CQUVQLEtBQUssUUFBUTt3QkFDWCxNQUFNLFdBQVcsQ0FBQyxZQUFZLENBQUM7NEJBQzdCLElBQUksRUFBRSxRQUFROzRCQUNkLE1BQU0sRUFBRSxLQUFLOzRCQUNiLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTs0QkFDNUIsSUFBSSxFQUFFLFNBQVMsQ0FBQyxJQUFJOzRCQUNwQixRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7NEJBQzVCLE1BQU0sRUFBRSxTQUFTLENBQUMsTUFBTTt5QkFDekIsQ0FBQyxDQUFBO3dCQUNGLE1BQUs7b0JBRVAsS0FBSyxRQUFRO3dCQUNYLE1BQU0sV0FBVyxDQUFDLFlBQVksQ0FBQzs0QkFDN0IsSUFBSSxFQUFFLFFBQVE7NEJBQ2QsTUFBTSxFQUFFLEtBQUs7NEJBQ2IsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU0sRUFBRTs0QkFDbEMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07eUJBQ3pCLENBQUMsQ0FBQTt3QkFDRixNQUFLO2dCQUNULENBQUM7WUFDSCxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixPQUFPLENBQUMsS0FBSyxDQUFDLG1DQUFtQyxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQ3hFLE1BQU0sS0FBSyxDQUFBO1lBQ2IsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRUQsU0FBUztJQUNELEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxVQUFnQyxFQUFFLFdBQWdCO1FBQ3JGLEtBQUssTUFBTSxTQUFTLElBQUksVUFBVSxFQUFFLENBQUM7WUFDbkMsSUFBSSxDQUFDO2dCQUNILFFBQVEsU0FBUyxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUNoQyxLQUFLLFFBQVE7d0JBQ1gsTUFBTSxXQUFXLENBQUMsWUFBWSxDQUFDOzRCQUM3QixJQUFJLEVBQUUsUUFBUTs0QkFDZCxNQUFNLEVBQUUsT0FBTzs0QkFDZixRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7NEJBQzVCLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSTs0QkFDcEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07eUJBQ3pCLENBQUMsQ0FBQTt3QkFDRixNQUFLO29CQUVQLEtBQUssUUFBUTt3QkFDWCxNQUFNLFdBQVcsQ0FBQyxZQUFZLENBQUM7NEJBQzdCLElBQUksRUFBRSxRQUFROzRCQUNkLE1BQU0sRUFBRSxPQUFPOzRCQUNmLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTs0QkFDNUIsSUFBSSxFQUFFLFNBQVMsQ0FBQyxJQUFJOzRCQUNwQixRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7NEJBQzVCLE1BQU0sRUFBRSxTQUFTLENBQUMsTUFBTTt5QkFDekIsQ0FBQyxDQUFBO3dCQUNGLE1BQUs7b0JBRVAsS0FBSyxRQUFRO3dCQUNYLE1BQU0sV0FBVyxDQUFDLFlBQVksQ0FBQzs0QkFDN0IsSUFBSSxFQUFFLFFBQVE7NEJBQ2QsTUFBTSxFQUFFLE9BQU87NEJBQ2YsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU0sRUFBRTs0QkFDbEMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFROzRCQUM1QixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07eUJBQ3pCLENBQUMsQ0FBQTt3QkFDRixNQUFLO2dCQUNULENBQUM7WUFDSCxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixPQUFPLENBQUMsS0FBSyxDQUFDLHFDQUFxQyxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7Z0JBQzFFLE1BQU0sS0FBSyxDQUFBO1lBQ2IsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRUQsK0VBQStFO0lBQy9FLFFBQVE7SUFDUiwrRUFBK0U7SUFFL0UsU0FBUztJQUNELFlBQVk7UUFDbEIsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDdEIsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQTtRQUNsQyxDQUFDO1FBRUQsSUFBSSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDekMsTUFBTSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7UUFDM0IsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUE7SUFDakMsQ0FBQztJQUVELE9BQU87SUFDQyxLQUFLLENBQUMsWUFBWTtRQUN4QixJQUFJLENBQUM7WUFDSCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUE7WUFFdEIsVUFBVTtZQUNWLE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBQ3RELE1BQU0sYUFBRSxDQUFDLFNBQVM7aUJBQ2YsS0FBSyxDQUFDLFdBQVcsQ0FBQztpQkFDbEIsS0FBSyxDQUFDLFdBQVcsQ0FBQztpQkFDbEIsTUFBTSxFQUFFLENBQUE7WUFFWCwwQkFBMEI7WUFDMUIsTUFBTSxtQkFBbUIsR0FBRyxNQUFNLGFBQUUsQ0FBQyxTQUFTO2lCQUMzQyxLQUFLLENBQUMsUUFBUSxDQUFDO2lCQUNmLE1BQU0sQ0FBQyxXQUFXLENBQUM7aUJBQ25CLE9BQU8sQ0FBQyxXQUFXLENBQUM7aUJBQ3BCLE9BQU8sRUFBRTtpQkFDVCxNQUFNLENBQUMsSUFBSSxDQUFDO2lCQUNaLE9BQU8sRUFBRSxDQUFBO1lBRVosSUFBSSxtQkFBbUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ25DLE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUcsQ0FBQyxDQUFDLENBQUE7WUFDdEUsQ0FBQztZQUVELFdBQVc7WUFDWCxNQUFNLFVBQVUsR0FBRyxNQUFNLGFBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUE7WUFDN0MsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDMUMsTUFBTSxNQUFNLEdBQUcsVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFBO2dCQUNwRCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sYUFBRSxDQUFDLFNBQVM7cUJBQ3hDLE9BQU8sQ0FBQyxXQUFXLENBQUM7cUJBQ3BCLEtBQUssQ0FBQyxNQUFNLENBQUM7cUJBQ2IsT0FBTyxFQUFFLENBQUE7Z0JBRVosTUFBTSxhQUFFLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRyxDQUFDLENBQUMsQ0FBQTtZQUNuRSxDQUFDO1lBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFBO1FBQ3hDLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUMvQyxDQUFDO0lBQ0gsQ0FBQztJQUVELCtFQUErRTtJQUMvRSxTQUFTO0lBQ1QsK0VBQStFO0lBRS9FLFNBQVM7SUFDRCxLQUFLLENBQUMsY0FBYztRQUMxQixJQUFJLENBQUMsQ0FBQyxZQUFZLElBQUksU0FBUyxDQUFDLEVBQUUsQ0FBQztZQUNqQyxPQUFPO2dCQUNMLE1BQU0sRUFBRSxTQUFTLENBQUMsTUFBTTtnQkFDeEIsY0FBYyxFQUFFLE1BQU07Z0JBQ3RCLGFBQWEsRUFBRSxJQUFJO2FBQ3BCLENBQUE7UUFDSCxDQUFDO1FBRUQsTUFBTSxVQUFVLEdBQUksU0FBaUIsQ0FBQyxVQUFVLENBQUE7UUFFaEQsT0FBTztZQUNMLE1BQU0sRUFBRSxTQUFTLENBQUMsTUFBTTtZQUN4QixjQUFjLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQztZQUNsRCxhQUFhLEVBQUUsVUFBVSxDQUFDLGFBQWEsSUFBSSxJQUFJO1lBQy9DLEdBQUcsRUFBRSxVQUFVLENBQUMsR0FBRztZQUNuQixRQUFRLEVBQUUsVUFBVSxDQUFDLFFBQVE7U0FDOUIsQ0FBQTtJQUNILENBQUM7SUFFRCxTQUFTO0lBQ0QsaUJBQWlCLENBQUMsVUFBZTtRQUN2QyxJQUFJLENBQUMsVUFBVTtZQUFFLE9BQU8sTUFBTSxDQUFBO1FBRTlCLFFBQVEsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3hCLEtBQUssTUFBTSxDQUFDO1lBQ1osS0FBSyxVQUFVO2dCQUNiLE9BQU8sTUFBTSxDQUFBO1lBQ2YsS0FBSyxVQUFVLENBQUM7WUFDaEIsS0FBSyxXQUFXO2dCQUNkLE9BQU8sVUFBVSxDQUFBO1lBQ25CO2dCQUNFLE9BQU8sTUFBTSxDQUFBO1FBQ2pCLENBQUM7SUFDSCxDQUFDO0lBRUQsK0VBQStFO0lBQy9FLFNBQVM7SUFDVCwrRUFBK0U7SUFFL0Usc0JBQXNCO0lBQ2QsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFVBQWdDO1FBQ2xFLE1BQU0sZUFBZSxHQUF5QixFQUFFLENBQUE7UUFFaEQsS0FBSyxNQUFNLFNBQVMsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsSUFBSSxTQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDN0QsZUFBZSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtnQkFDL0IsU0FBUTtZQUNWLENBQUM7WUFFRCxnQkFBZ0I7WUFDaEIsTUFBTSxZQUFZLEdBQUcsTUFBTSxhQUFFLENBQUMsU0FBUztpQkFDcEMsS0FBSyxDQUFDLElBQUksQ0FBQztpQkFDWCxLQUFLLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQztpQkFDMUIsT0FBTyxFQUFFLENBQUE7WUFFWixNQUFNLHdCQUF3QixHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLFdBQVcsQ0FBQyxDQUFBO1lBRXRGLElBQUksd0JBQXdCLEVBQUUsQ0FBQztnQkFDN0IsZUFBZSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUNqQyxDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sZUFBZSxDQUFBO0lBQ3hCLENBQUM7SUFFRCwrRUFBK0U7SUFDL0UsUUFBUTtJQUNSLCtFQUErRTtJQUUvRSxXQUFXO0lBQ1gsS0FBSyxDQUFDLGFBQWE7UUFDakIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxhQUFhLEdBQUcsTUFBTSxhQUFFLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFBO1lBRWxELE1BQU0sS0FBSyxHQUFlO2dCQUN4QixlQUFlLEVBQUUsYUFBYSxDQUFDLE1BQU07Z0JBQ3JDLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BCLG9CQUFvQixFQUFFLENBQUM7Z0JBQ3ZCLGdCQUFnQixFQUFFLENBQUM7Z0JBQ25CLG1CQUFtQixFQUFFLENBQUM7Z0JBRXRCLE1BQU0sRUFBRTtvQkFDTixJQUFJLEVBQUUsQ0FBQztvQkFDUCxNQUFNLEVBQUUsQ0FBQztvQkFDVCxHQUFHLEVBQUUsQ0FBQztvQkFDTixLQUFLLEVBQUUsQ0FBQztpQkFDVDtnQkFFRCxVQUFVLEVBQUU7b0JBQ1YsUUFBUSxFQUFFLENBQUM7b0JBQ1gsSUFBSSxFQUFFLENBQUM7b0JBQ1AsTUFBTSxFQUFFLENBQUM7b0JBQ1QsR0FBRyxFQUFFLENBQUM7aUJBQ1A7Z0JBRUQsUUFBUSxFQUFFO29CQUNSLE9BQU8sRUFBRSxDQUFDO29CQUNWLFVBQVUsRUFBRSxDQUFDO29CQUNiLFNBQVMsRUFBRSxDQUFDO29CQUNaLE1BQU0sRUFBRSxDQUFDO29CQUNULFNBQVMsRUFBRSxDQUFDO2lCQUNiO2dCQUVELHFCQUFxQixFQUFFLENBQUM7Z0JBQ3hCLFdBQVcsRUFBRSxDQUFDO2dCQUNkLGdCQUFnQixFQUFFLENBQUM7Z0JBQ25CLGlCQUFpQixFQUFFLENBQUM7YUFDckIsQ0FBQTtZQUVELFNBQVM7WUFDVCxLQUFLLE1BQU0sU0FBUyxJQUFJLGFBQWEsRUFBRSxDQUFDO2dCQUN0QyxRQUFRO2dCQUNSLEtBQUssQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUE7Z0JBRXBDLFNBQVM7Z0JBQ1QsS0FBSyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQTtnQkFFdEMsUUFBUTtnQkFDUixLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFBO2dCQUVsQyxTQUFTO2dCQUNULElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxXQUFXLElBQUksU0FBUyxDQUFDLG1CQUFtQixFQUFFLENBQUM7b0JBQ3RFLE1BQU0sY0FBYyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLEdBQUcsU0FBUyxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxDQUFBO29CQUM5RixLQUFLLENBQUMscUJBQXFCLElBQUksY0FBYyxDQUFBO2dCQUMvQyxDQUFDO2dCQUVELFdBQVc7Z0JBQ1gsS0FBSyxDQUFDLGlCQUFpQixJQUFJLFNBQVMsQ0FBQyxVQUFVLENBQUE7WUFDakQsQ0FBQztZQUVELFNBQVM7WUFDVCxLQUFLLENBQUMsaUJBQWlCLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUE7WUFDaEQsS0FBSyxDQUFDLG9CQUFvQixHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFBO1lBQ3RELEtBQUssQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQTtZQUM5QyxLQUFLLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUE7WUFFcEQsV0FBVztZQUNYLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFBO1lBQy9DLElBQUksY0FBYyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUN2QixLQUFLLENBQUMscUJBQXFCLElBQUksY0FBYyxDQUFBO1lBQy9DLENBQUM7WUFFRCxXQUFXO1lBQ1gsSUFBSSxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUM3QixLQUFLLENBQUMsaUJBQWlCLElBQUksYUFBYSxDQUFDLE1BQU0sQ0FBQTtZQUNqRCxDQUFDO1lBRUQsUUFBUTtZQUNSLE1BQU0sZUFBZSxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FDaEQsQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FDNUMsQ0FBQyxNQUFNLENBQUE7WUFDUixJQUFJLGVBQWUsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDeEIsS0FBSyxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsZ0JBQWdCLEdBQUcsZUFBZSxDQUFBO1lBQzlELENBQUM7WUFFRCxlQUFlO1lBQ2YsTUFBTSxpQkFBaUIsR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sS0FBSyxTQUFTLENBQUMsQ0FBQTtZQUM3RSxJQUFJLGlCQUFpQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDakMsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQzFELE9BQU8sQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQ3hELENBQUE7Z0JBQ0QsS0FBSyxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFBO1lBQ2xFLENBQUM7WUFFRCxPQUFPLEtBQUssQ0FBQTtRQUNkLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUNsRCxPQUFPLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQTtRQUM3QixDQUFDO0lBQ0gsQ0FBQztJQUVELFVBQVU7SUFDRixhQUFhO1FBQ25CLE9BQU87WUFDTCxlQUFlLEVBQUUsQ0FBQztZQUNsQixpQkFBaUIsRUFBRSxDQUFDO1lBQ3BCLG9CQUFvQixFQUFFLENBQUM7WUFDdkIsZ0JBQWdCLEVBQUUsQ0FBQztZQUNuQixtQkFBbUIsRUFBRSxDQUFDO1lBQ3RCLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUU7WUFDaEQsVUFBVSxFQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtZQUN2RCxRQUFRLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7WUFDOUUscUJBQXFCLEVBQUUsQ0FBQztZQUN4QixXQUFXLEVBQUUsQ0FBQztZQUNkLGdCQUFnQixFQUFFLENBQUM7WUFDbkIsaUJBQWlCLEVBQUUsQ0FBQztTQUNyQixDQUFBO0lBQ0gsQ0FBQztJQUVELGlCQUFpQjtJQUNULEtBQUssQ0FBQyxnQkFBZ0I7UUFDNUIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7WUFDeEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxtQkFBbUIsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNsRCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsK0JBQStCLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDdkQsQ0FBQztJQUNILENBQUM7SUFFRCwrRUFBK0U7SUFDL0UsVUFBVTtJQUNWLCtFQUErRTtJQUUvRSxVQUFVO0lBQ1YsZ0JBQWdCLENBQ2QsS0FBUSxFQUNSLFFBQStDO1FBRS9DLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsUUFBZSxDQUFBO0lBQ3pDLENBQUM7SUFFRCxVQUFVO0lBQ1YsbUJBQW1CLENBQ2pCLEtBQVE7UUFFUixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVELFFBQVE7SUFDQSxlQUFlLENBQ3JCLEtBQVEsRUFDUixHQUFHLElBQVc7UUFFZCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3RDLElBQUksUUFBUSxFQUFFLENBQUM7WUFDYixJQUFJLENBQUM7Z0JBQ0YsUUFBcUIsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFBO1lBQ2pDLENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxLQUFLLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUNyRCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCwrRUFBK0U7SUFDL0UsT0FBTztJQUNQLCtFQUErRTtJQUUvRSxPQUFPO0lBQ1AsS0FBSyxDQUFDLFVBQVU7UUFDZCxJQUFJLENBQUM7WUFDSCxNQUFNLGFBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUE7WUFDMUIsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtZQUM3QixPQUFPLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUE7UUFDM0MsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ2hELENBQUM7SUFDSCxDQUFDO0lBRUQsU0FBUztJQUNULEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBVTtRQUMzQixJQUFJLENBQUM7WUFDSCxPQUFPLE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDbkMsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUN0RCxPQUFPLFNBQVMsQ0FBQTtRQUNsQixDQUFDO0lBQ0gsQ0FBQztJQUVELE9BQU87SUFDUCxLQUFLLENBQUMsZUFBZSxDQUFDLEVBQVU7UUFDOUIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxhQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQTtZQUM3QixNQUFNLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO1FBQy9CLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDekQsTUFBTSxLQUFLLENBQUE7UUFDYixDQUFDO0lBQ0gsQ0FBQztJQUVELFVBQVU7SUFDVixLQUFLLENBQUMscUJBQXFCO1FBQ3pCLElBQUksQ0FBQztZQUNILE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxhQUFFLENBQUMsU0FBUztpQkFDeEMsS0FBSyxDQUFDLFFBQVEsQ0FBQztpQkFDZixNQUFNLENBQUMsUUFBUSxDQUFDO2lCQUNoQixPQUFPLEVBQUUsQ0FBQTtZQUVaLEtBQUssTUFBTSxTQUFTLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztnQkFDekMsTUFBTSxhQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsRUFBRyxFQUFFO29CQUN2QyxNQUFNLEVBQUUsU0FBUztvQkFDakIsVUFBVSxFQUFFLENBQUM7b0JBQ2IsVUFBVSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCO29CQUN6QyxTQUFTLEVBQUUsU0FBUztpQkFDckIsQ0FBQyxDQUFBO1lBQ0osQ0FBQztZQUVELE1BQU0sSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUE7WUFDN0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLGdCQUFnQixDQUFDLE1BQU0sb0JBQW9CLENBQUMsQ0FBQTtZQUNuRSxPQUFPLGdCQUFnQixDQUFDLE1BQU0sQ0FBQTtRQUNoQyxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDMUQsT0FBTyxDQUFDLENBQUE7UUFDVixDQUFDO0lBQ0gsQ0FBQztJQUVELFdBQVc7SUFDWCxLQUFLLENBQUMsd0JBQXdCO1FBQzVCLElBQUksQ0FBQztZQUNILE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxhQUFFLENBQUMsU0FBUztpQkFDM0MsS0FBSyxDQUFDLFFBQVEsQ0FBQztpQkFDZixNQUFNLENBQUMsV0FBVyxDQUFDO2lCQUNuQixPQUFPLEVBQUUsQ0FBQTtZQUVaLGtCQUFrQjtZQUNsQixNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUE7WUFDM0IsTUFBTSxrQkFBa0IsR0FBRyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUE7WUFFekUsS0FBSyxNQUFNLFNBQVMsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO2dCQUMzQyxNQUFNLGFBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFHLENBQUMsQ0FBQTtZQUMxQyxDQUFDO1lBRUQsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtZQUM3QixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsa0JBQWtCLENBQUMsTUFBTSwrQkFBK0IsbUJBQW1CLENBQUMsTUFBTSxHQUFHLGtCQUFrQixDQUFDLE1BQU0sY0FBYyxDQUFDLENBQUE7WUFDcEosT0FBTyxrQkFBa0IsQ0FBQyxNQUFNLENBQUE7UUFDbEMsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLHVDQUF1QyxFQUFFLEtBQUssQ0FBQyxDQUFBO1lBQzdELE9BQU8sQ0FBQyxDQUFBO1FBQ1YsQ0FBQztJQUNILENBQUM7SUFFRCxPQUFPO0lBQ1AsWUFBWSxDQUFDLFNBQStCO1FBQzFDLFNBQVM7UUFDVCxJQUFJLFNBQVMsQ0FBQyxVQUFVLEtBQUssU0FBUyxJQUFJLFNBQVMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDbkUsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFBO1FBQ3BELENBQUM7UUFDRCxJQUFJLFNBQVMsQ0FBQyxTQUFTLEtBQUssU0FBUyxJQUFJLFNBQVMsQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDbEUsTUFBTSxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFBO1FBQy9DLENBQUM7UUFDRCxJQUFJLFNBQVMsQ0FBQyxZQUFZLEtBQUssU0FBUyxJQUFJLFNBQVMsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDdkUsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFBO1FBQ3RELENBQUM7UUFDRCxJQUFJLFNBQVMsQ0FBQyxpQkFBaUIsS0FBSyxTQUFTLElBQUksU0FBUyxDQUFDLGlCQUFpQixJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ2xGLE1BQU0sSUFBSSxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQTtRQUN2RCxDQUFDO1FBQ0QsSUFBSSxTQUFTLENBQUMsaUJBQWlCLEtBQUssU0FBUyxJQUFJLFNBQVMsQ0FBQyxpQkFBaUIsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNsRixNQUFNLElBQUksS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUE7UUFDdkQsQ0FBQztRQUVELE9BQU87UUFDUCxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsU0FBUyxFQUFFLENBQUE7UUFFOUMsb0JBQW9CO1FBQ3BCLElBQUksU0FBUyxDQUFDLGlCQUFpQixLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQzlDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQTtRQUN4QixDQUFDO1FBQ0QsSUFBSSxTQUFTLENBQUMsZUFBZSxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQzVDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUNyQixDQUFDO1FBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFBO0lBQ3JELENBQUM7SUFFRCxPQUFPO0lBQ1AsT0FBTztRQUNMLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3pCLGFBQWEsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUE7UUFDckMsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3RCLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7UUFDbEMsQ0FBQztRQUVELFdBQVc7UUFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQ2xELE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLENBQUMsQ0FBQTtRQUNoRCxDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRjtBQW5rQ0Qsc0RBbWtDQztBQUVELFNBQVM7QUFDSSxRQUFBLHFCQUFxQixHQUFHLElBQUkscUJBQXFCLEVBQUUsQ0FBQTtBQUVoRSwrRUFBK0U7QUFDL0UsU0FBUztBQUNULCtFQUErRTtBQUUvRSxTQUFTO0FBQ0YsTUFBTSxtQkFBbUIsR0FBRyxDQUNqQyxhQUE2QyxFQUM3QyxRQUFnQixFQUNoQixNQUFlLEVBQ2YsWUFBcUIsRUFDb0UsRUFBRTtJQUMzRixPQUFPO1FBQ0wsVUFBVSxFQUFFLE1BQU07UUFDbEIsYUFBYTtRQUNiLFFBQVEsRUFBRSxRQUFRLENBQUMsRUFBRztRQUN0QixJQUFJLEVBQUUsUUFBUTtRQUNkLFlBQVk7UUFDWixNQUFNO1FBQ04sUUFBUSxFQUFFLGFBQWEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUTtRQUN4RCxVQUFVLEVBQUUsQ0FBQztLQUNkLENBQUE7QUFDSCxDQUFDLENBQUE7QUFoQlksUUFBQSxtQkFBbUIsdUJBZ0IvQjtBQUVELFVBQVU7QUFDSCxNQUFNLHFCQUFxQixHQUFHLENBQ25DLGFBQTZDLEVBQzdDLFVBQW9CLEVBQ3BCLE1BQWUsRUFDZixZQUF1QixFQUNrRSxFQUFFO0lBQzNGLE9BQU87UUFDTCxVQUFVLEVBQUUsUUFBUTtRQUNwQixhQUFhO1FBQ2IsUUFBUSxFQUFFLFVBQVUsQ0FBQyxFQUFHO1FBQ3hCLElBQUksRUFBRSxVQUFVO1FBQ2hCLFlBQVk7UUFDWixNQUFNO1FBQ04sUUFBUSxFQUFFLGFBQWEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUTtRQUN4RCxVQUFVLEVBQUUsQ0FBQztLQUNkLENBQUE7QUFDSCxDQUFDLENBQUE7QUFoQlksUUFBQSxxQkFBcUIseUJBZ0JqQztBQUVELFNBQVM7QUFDRixNQUFNLGtCQUFrQixHQUFHLENBQ2hDLGFBQTZDLEVBQzdDLE9BQWMsRUFDZCxNQUFlLEVBQ2YsWUFBb0IsRUFDcUUsRUFBRTtJQUMzRixPQUFPO1FBQ0wsVUFBVSxFQUFFLEtBQUs7UUFDakIsYUFBYTtRQUNiLFFBQVEsRUFBRSxPQUFPLENBQUMsRUFBRztRQUNyQixJQUFJLEVBQUUsT0FBTztRQUNiLFlBQVk7UUFDWixNQUFNO1FBQ04sUUFBUSxFQUFFLFFBQVE7UUFDbEIsVUFBVSxFQUFFLENBQUM7S0FDZCxDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBaEJZLFFBQUEsa0JBQWtCLHNCQWdCOUI7QUFFRCxTQUFTO0FBQ0YsTUFBTSxvQkFBb0IsR0FBRyxDQUNsQyxhQUE2QyxFQUM3QyxTQUFrQixFQUNsQixNQUFlLEVBQ2YsWUFBc0IsRUFDbUUsRUFBRTtJQUMzRixPQUFPO1FBQ0wsVUFBVSxFQUFFLE9BQU87UUFDbkIsYUFBYTtRQUNiLFFBQVEsRUFBRSxTQUFTLENBQUMsRUFBRztRQUN2QixJQUFJLEVBQUUsU0FBUztRQUNmLFlBQVk7UUFDWixNQUFNO1FBQ04sUUFBUSxFQUFFLGFBQWEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSztRQUNyRCxVQUFVLEVBQUUsQ0FBQztLQUNkLENBQUE7QUFDSCxDQUFDLENBQUE7QUFoQlksUUFBQSxvQkFBb0Isd0JBZ0JoQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXENhcmRFdmVyeXRoaW5nXFxjYXJkYWxsLXByb3RvdHlwZVxcc3JjXFxzZXJ2aWNlc1xcbG9jYWwtb3BlcmF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRiLCB0eXBlIFN5bmNPcGVyYXRpb24sIHR5cGUgRGJDYXJkLCB0eXBlIERiRm9sZGVyLCB0eXBlIERiVGFnLCB0eXBlIERiSW1hZ2UgfSBmcm9tICcuL2RhdGFiYXNlJ1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDmnKzlnLDmk43kvZzpmJ/liJfnrqHnkIYgLSDkvJjljJbnmoTlkIzmraXpmJ/liJfns7vnu59cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLy8g5omp5bGV55qE5ZCM5q2l5pON5L2c5o6l5Y+jIC0g5pSv5oyB5pu05aSN5p2C55qE6Zif5YiX566h55CGXG5leHBvcnQgaW50ZXJmYWNlIExvY2FsU3luY09wZXJhdGlvbiBleHRlbmRzIFN5bmNPcGVyYXRpb24ge1xuICAvLyDmk43kvZzlhYPmlbDmja5cbiAgaWQ6IHN0cmluZ1xuICBlbnRpdHlJZDogc3RyaW5nXG4gIGVudGl0eVR5cGU6ICdjYXJkJyB8ICdmb2xkZXInIHwgJ3RhZycgfCAnaW1hZ2UnXG4gIG9wZXJhdGlvblR5cGU6ICdjcmVhdGUnIHwgJ3VwZGF0ZScgfCAnZGVsZXRlJ1xuICB1c2VySWQ/OiBzdHJpbmdcbiAgXG4gIC8vIOaVsOaNruW/q+eFp1xuICBkYXRhOiBhbnlcbiAgcHJldmlvdXNEYXRhPzogYW55IC8vIOeUqOS6juWbnua7muWSjOWGsueqgeajgOa1i1xuICBcbiAgLy8g5pe26Ze05oiz5ZKM54mI5pys5o6n5Yi2XG4gIHRpbWVzdGFtcDogRGF0ZVxuICBsb2NhbFZlcnNpb246IG51bWJlclxuICBleHBlY3RlZENsb3VkVmVyc2lvbj86IG51bWJlclxuICBcbiAgLy8g6YeN6K+V5ZKM6ZSZ6K+v5aSE55CGXG4gIHJldHJ5Q291bnQ6IG51bWJlclxuICBtYXhSZXRyaWVzOiBudW1iZXJcbiAgcmV0cnlEZWxheTogbnVtYmVyXG4gIGxhc3RFcnJvcj86IHN0cmluZ1xuICBcbiAgLy8g5LyY5YWI57qn5ZKM5L6d6LWW5YWz57O7XG4gIHByaW9yaXR5OiAnY3JpdGljYWwnIHwgJ2hpZ2gnIHwgJ25vcm1hbCcgfCAnbG93J1xuICBkZXBlbmRzT24/OiBzdHJpbmdbXSAvLyDkvp3otZbnmoTmk43kvZxJRFxuICBcbiAgLy8g54q25oCB566h55CGXG4gIHN0YXR1czogJ3BlbmRpbmcnIHwgJ3Byb2Nlc3NpbmcnIHwgJ2NvbXBsZXRlZCcgfCAnZmFpbGVkJyB8ICdjYW5jZWxsZWQnXG4gIHByb2Nlc3NpbmdTdGFydGVkQXQ/OiBEYXRlXG4gIFxuICAvLyDmibnlpITnkIbkv6Hmga9cbiAgYmF0Y2hJZD86IHN0cmluZ1xuICBiYXRjaFNpemU/OiBudW1iZXJcbiAgXG4gIC8vIOe9kee7nOWSjOaAp+iDveS/oeaBr1xuICBuZXR3b3JrSW5mbz86IHtcbiAgICBvbmxpbmU6IGJvb2xlYW5cbiAgICBjb25uZWN0aW9uVHlwZTogJ3dpZmknIHwgJ2NlbGx1bGFyJyB8ICdub25lJ1xuICAgIGVmZmVjdGl2ZVR5cGU6ICc0ZycgfCAnM2cnIHwgJzJnJyB8ICdzbG93LTJnJ1xuICAgIHJ0dD86IG51bWJlclxuICAgIGRvd25saW5rPzogbnVtYmVyXG4gIH1cbn1cblxuLy8g6Zif5YiX54q25oCB57uf6K6hXG5leHBvcnQgaW50ZXJmYWNlIFF1ZXVlU3RhdHMge1xuICB0b3RhbE9wZXJhdGlvbnM6IG51bWJlclxuICBwZW5kaW5nT3BlcmF0aW9uczogbnVtYmVyXG4gIHByb2Nlc3NpbmdPcGVyYXRpb25zOiBudW1iZXJcbiAgZmFpbGVkT3BlcmF0aW9uczogbnVtYmVyXG4gIGNvbXBsZXRlZE9wZXJhdGlvbnM6IG51bWJlclxuICBcbiAgLy8g5oyJ57G75Z6L57uf6K6hXG4gIGJ5VHlwZToge1xuICAgIGNhcmQ6IG51bWJlclxuICAgIGZvbGRlcjogbnVtYmVyXG4gICAgdGFnOiBudW1iZXJcbiAgICBpbWFnZTogbnVtYmVyXG4gIH1cbiAgXG4gIC8vIOaMieS8mOWFiOe6p+e7n+iuoVxuICBieVByaW9yaXR5OiB7XG4gICAgY3JpdGljYWw6IG51bWJlclxuICAgIGhpZ2g6IG51bWJlclxuICAgIG5vcm1hbDogbnVtYmVyXG4gICAgbG93OiBudW1iZXJcbiAgfVxuICBcbiAgLy8g5oyJ54q25oCB57uf6K6hXG4gIGJ5U3RhdHVzOiB7XG4gICAgcGVuZGluZzogbnVtYmVyXG4gICAgcHJvY2Vzc2luZzogbnVtYmVyXG4gICAgY29tcGxldGVkOiBudW1iZXJcbiAgICBmYWlsZWQ6IG51bWJlclxuICAgIGNhbmNlbGxlZDogbnVtYmVyXG4gIH1cbiAgXG4gIC8vIOaAp+iDveaMh+agh1xuICBhdmVyYWdlUHJvY2Vzc2luZ1RpbWU6IG51bWJlclxuICBmYWlsdXJlUmF0ZTogbnVtYmVyXG4gIG9sZGVzdFBlbmRpbmdBZ2U6IG51bWJlclxuICBhdmVyYWdlUmV0cnlDb3VudDogbnVtYmVyXG59XG5cbi8vIOmYn+WIl+mFjee9rumAiemhuVxuZXhwb3J0IGludGVyZmFjZSBRdWV1ZUNvbmZpZyB7XG4gIC8vIOmHjeivlemFjee9rlxuICBtYXhSZXRyaWVzOiBudW1iZXJcbiAgaW5pdGlhbFJldHJ5RGVsYXk6IG51bWJlclxuICBtYXhSZXRyeURlbGF5OiBudW1iZXJcbiAgcmV0cnlCYWNrb2ZmTXVsdGlwbGllcjogbnVtYmVyXG4gIFxuICAvLyDmibnlpITnkIbphY3nva5cbiAgYmF0Y2hTaXplOiBudW1iZXJcbiAgYmF0Y2hUaW1lb3V0OiBudW1iZXJcbiAgbWF4Q29uY3VycmVudEJhdGNoZXM6IG51bWJlclxuICBcbiAgLy8g5oCn6IO96YWN572uXG4gIHByb2Nlc3NpbmdUaW1lb3V0OiBudW1iZXJcbiAgaWRsZUNoZWNrSW50ZXJ2YWw6IG51bWJlclxuICBjbGVhbnVwSW50ZXJ2YWw6IG51bWJlclxuICBcbiAgLy8g572R57uc6YWN572uXG4gIG5ldHdvcmtBd2FyZTogYm9vbGVhblxuICBvZmZsaW5lTW9kZTogYm9vbGVhblxuICByZXF1aXJlV2lmaUZvckxhcmdlRmlsZXM6IGJvb2xlYW5cbiAgXG4gIC8vIOmYn+WIl+mZkOWItlxuICBtYXhRdWV1ZVNpemU6IG51bWJlclxuICBtYXhBZ2U6IG51bWJlciAvLyDmnIDlpKfmk43kvZzlubTpvoTvvIjmr6vnp5LvvIlcbn1cblxuLy8g6buY6K6k6Zif5YiX6YWN572uXG5leHBvcnQgY29uc3QgREVGQVVMVF9RVUVVRV9DT05GSUc6IFF1ZXVlQ29uZmlnID0ge1xuICBtYXhSZXRyaWVzOiA1LFxuICBpbml0aWFsUmV0cnlEZWxheTogMTAwMCwgLy8gMeenklxuICBtYXhSZXRyeURlbGF5OiAzMDAwMDAsIC8vIDXliIbpkp9cbiAgcmV0cnlCYWNrb2ZmTXVsdGlwbGllcjogMixcbiAgXG4gIGJhdGNoU2l6ZTogMTAsXG4gIGJhdGNoVGltZW91dDogNTAwMCwgLy8gNeenklxuICBtYXhDb25jdXJyZW50QmF0Y2hlczogMyxcbiAgXG4gIHByb2Nlc3NpbmdUaW1lb3V0OiAzMDAwMCwgLy8gMzDnp5JcbiAgaWRsZUNoZWNrSW50ZXJ2YWw6IDEwMDAwLCAvLyAxMOenklxuICBjbGVhbnVwSW50ZXJ2YWw6IDMwMDAwMCwgLy8gNeWIhumSn1xuICBcbiAgbmV0d29ya0F3YXJlOiB0cnVlLFxuICBvZmZsaW5lTW9kZTogdHJ1ZSxcbiAgcmVxdWlyZVdpZmlGb3JMYXJnZUZpbGVzOiB0cnVlLFxuICBcbiAgbWF4UXVldWVTaXplOiAxMDAwMCxcbiAgbWF4QWdlOiA3ICogMjQgKiA2MCAqIDYwICogMTAwMCAvLyA35aSpXG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOacrOWcsOaTjeS9nOacjeWKoSAtIOaguOW/g+mYn+WIl+euoeeQhlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgTG9jYWxPcGVyYXRpb25TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBjb25maWc6IFF1ZXVlQ29uZmlnXG4gIHByaXZhdGUgaXNQcm9jZXNzaW5nID0gZmFsc2VcbiAgcHJpdmF0ZSBwcm9jZXNzaW5nVGltZXI6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBjbGVhbnVwVGltZXI6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBjdXJyZW50QmF0Y2hlczogTWFwPHN0cmluZywgUHJvbWlzZTx2b2lkPj4gPSBuZXcgTWFwKClcbiAgXG4gIC8vIOS6i+S7tuebkeWQrOWZqFxuICBwcml2YXRlIGxpc3RlbmVyczoge1xuICAgIG9wZXJhdGlvbkFkZGVkPzogKG9wZXJhdGlvbjogTG9jYWxTeW5jT3BlcmF0aW9uKSA9PiB2b2lkXG4gICAgb3BlcmF0aW9uU3RhcnRlZD86IChvcGVyYXRpb246IExvY2FsU3luY09wZXJhdGlvbikgPT4gdm9pZFxuICAgIG9wZXJhdGlvbkNvbXBsZXRlZD86IChvcGVyYXRpb246IExvY2FsU3luY09wZXJhdGlvbikgPT4gdm9pZFxuICAgIG9wZXJhdGlvbkZhaWxlZD86IChvcGVyYXRpb246IExvY2FsU3luY09wZXJhdGlvbiwgZXJyb3I6IEVycm9yKSA9PiB2b2lkXG4gICAgcXVldWVTdGF0c0NoYW5nZWQ/OiAoc3RhdHM6IFF1ZXVlU3RhdHMpID0+IHZvaWRcbiAgfSA9IHt9XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBQYXJ0aWFsPFF1ZXVlQ29uZmlnPiA9IHt9KSB7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLkRFRkFVTFRfUVVFVUVfQ09ORklHLCAuLi5jb25maWcgfVxuICAgIHRoaXMuaW5pdGlhbGl6ZSgpXG4gIH1cblxuICAvLyDliJ3lp4vljJbmnI3liqFcbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyDnoa7kv53mlbDmja7lupPlt7LliJ3lp4vljJZcbiAgICAgIGF3YWl0IGRiLm9wZW4oKVxuICAgICAgXG4gICAgICAvLyDku47mnKzlnLDlrZjlgqjmgaLlpI3pmJ/liJdcbiAgICAgIGF3YWl0IHRoaXMucmVzdG9yZVF1ZXVlRnJvbVN0b3JhZ2UoKVxuICAgICAgXG4gICAgICAvLyDlkK/liqjlrprmnJ/lpITnkIZcbiAgICAgIHRoaXMuc3RhcnRQcm9jZXNzaW5nKClcbiAgICAgIFxuICAgICAgLy8g5ZCv5Yqo5a6a5pyf5riF55CGXG4gICAgICB0aGlzLnN0YXJ0Q2xlYW51cCgpXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdMb2NhbE9wZXJhdGlvblNlcnZpY2UgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5JylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgTG9jYWxPcGVyYXRpb25TZXJ2aWNlOicsIGVycm9yKVxuICAgIH1cbiAgfVxuXG4gIC8vIOS7juacrOWcsOWtmOWCqOaBouWkjemYn+WIl1xuICBwcml2YXRlIGFzeW5jIHJlc3RvcmVRdWV1ZUZyb21TdG9yYWdlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdG9yZWRRdWV1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzeW5jUXVldWUnKVxuICAgICAgaWYgKHN0b3JlZFF1ZXVlKSB7XG4gICAgICAgIGNvbnN0IHF1ZXVlID0gSlNPTi5wYXJzZShzdG9yZWRRdWV1ZSlcbiAgICAgICAgXG4gICAgICAgIC8vIOWwhuWtmOWCqOeahOaTjeS9nOa3u+WKoOWIsOaVsOaNruW6k1xuICAgICAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiBxdWV1ZSkge1xuICAgICAgICAgIC8vIOi9rOaNouaXp+agvOW8j+WIsOaWsOagvOW8j++8iOWmguaenOmcgOimge+8iVxuICAgICAgICAgIGNvbnN0IGNvbnZlcnRlZE9wZXJhdGlvbiA9IHRoaXMuY29udmVydE9wZXJhdGlvbkZvcm1hdChvcGVyYXRpb24pXG4gICAgICAgICAgXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGRiLnN5bmNRdWV1ZS5hZGQoY29udmVydGVkT3BlcmF0aW9uKVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzmk43kvZzlt7LlrZjlnKjvvIzot7Pov4dcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignT3BlcmF0aW9uIGFscmVhZHkgZXhpc3RzIGluIGRhdGFiYXNlLCBza2lwcGluZzonLCBvcGVyYXRpb24uaWQpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyDmuIXnqbrmnKzlnLDlrZjlgqhcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3N5bmNRdWV1ZScpXG4gICAgICAgIGNvbnNvbGUubG9nKGBSZXN0b3JlZCAke3F1ZXVlLmxlbmd0aH0gb3BlcmF0aW9ucyBmcm9tIGxvY2FsIHN0b3JhZ2VgKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcmVzdG9yZSBxdWV1ZSBmcm9tIHN0b3JhZ2U6JywgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLy8g6L2s5o2i5pON5L2c5qC85byP77yI5pen5qC85byP5Yiw5paw5qC85byP77yJXG4gIHByaXZhdGUgY29udmVydE9wZXJhdGlvbkZvcm1hdChvcGVyYXRpb246IGFueSk6IExvY2FsU3luY09wZXJhdGlvbiB7XG4gICAgLy8g5aaC5p6c5piv5paw5qC85byP77yM55u05o6l6L+U5ZueXG4gICAgaWYgKG9wZXJhdGlvbi5lbnRpdHlUeXBlICYmIG9wZXJhdGlvbi5vcGVyYXRpb25UeXBlICYmIG9wZXJhdGlvbi5lbnRpdHlJZCkge1xuICAgICAgcmV0dXJuIG9wZXJhdGlvbiBhcyBMb2NhbFN5bmNPcGVyYXRpb25cbiAgICB9XG4gICAgXG4gICAgLy8g6L2s5o2i5pen5qC85byP5Yiw5paw5qC85byPXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBvcGVyYXRpb24uaWQsXG4gICAgICBlbnRpdHlUeXBlOiBvcGVyYXRpb24udGFibGUgPT09ICdjYXJkcycgPyAnY2FyZCcgOiBcbiAgICAgICAgICAgICAgICBvcGVyYXRpb24udGFibGUgPT09ICdmb2xkZXJzJyA/ICdmb2xkZXInIDogXG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uLnRhYmxlID09PSAndGFncycgPyAndGFnJyA6ICdpbWFnZScsXG4gICAgICBvcGVyYXRpb25UeXBlOiBvcGVyYXRpb24udHlwZSxcbiAgICAgIGVudGl0eUlkOiBvcGVyYXRpb24ubG9jYWxJZCxcbiAgICAgIGRhdGE6IG9wZXJhdGlvbi5kYXRhLFxuICAgICAgdGltZXN0YW1wOiBvcGVyYXRpb24udGltZXN0YW1wLFxuICAgICAgcmV0cnlDb3VudDogb3BlcmF0aW9uLnJldHJ5Q291bnQgfHwgMCxcbiAgICAgIHN0YXR1czogb3BlcmF0aW9uLnN0YXR1cyB8fCAncGVuZGluZycsXG4gICAgICBsb2NhbFZlcnNpb246IG9wZXJhdGlvbi5sb2NhbFZlcnNpb24gfHwgMSxcbiAgICAgIHByaW9yaXR5OiBvcGVyYXRpb24ucHJpb3JpdHkgfHwgJ25vcm1hbCcsXG4gICAgICBkZXBlbmRzT246IG9wZXJhdGlvbi5kZXBlbmRzT24gfHwgW11cbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIOaguOW/g+mYn+WIl+aTjeS9nFxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLy8g5re75Yqg5pON5L2c5Yiw6Zif5YiXXG4gIGFzeW5jIGFkZE9wZXJhdGlvbihcbiAgICBvcGVyYXRpb246IE9taXQ8TG9jYWxTeW5jT3BlcmF0aW9uLCAnaWQnIHwgJ3RpbWVzdGFtcCcgfCAncmV0cnlDb3VudCcgfCAnc3RhdHVzJyB8ICdsb2NhbFZlcnNpb24nPlxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIOmqjOivgeW/hemcgOWtl+autVxuICAgIGlmICghb3BlcmF0aW9uLmVudGl0eUlkIHx8IG9wZXJhdGlvbi5lbnRpdHlJZC50cmltKCkgPT09ICcnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsIElEIGlzIHJlcXVpcmVkJylcbiAgICB9XG4gICAgaWYgKCFvcGVyYXRpb24uZW50aXR5VHlwZSB8fCAhWydjYXJkJywgJ2ZvbGRlcicsICd0YWcnLCAnaW1hZ2UnXS5pbmNsdWRlcyhvcGVyYXRpb24uZW50aXR5VHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBlbnRpdHkgdHlwZScpXG4gICAgfVxuICAgIGlmICghb3BlcmF0aW9uLm9wZXJhdGlvblR5cGUgfHwgIVsnY3JlYXRlJywgJ3VwZGF0ZScsICdkZWxldGUnXS5pbmNsdWRlcyhvcGVyYXRpb24ub3BlcmF0aW9uVHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBvcGVyYXRpb24gdHlwZScpXG4gICAgfVxuICAgIGlmICghb3BlcmF0aW9uLmRhdGEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignT3BlcmF0aW9uIGRhdGEgaXMgcmVxdWlyZWQnKVxuICAgIH1cblxuICAgIGNvbnN0IGlkID0gY3J5cHRvLnJhbmRvbVVVSUQoKVxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICBcbiAgICBjb25zdCBmdWxsT3BlcmF0aW9uOiBMb2NhbFN5bmNPcGVyYXRpb24gPSB7XG4gICAgICAuLi5vcGVyYXRpb24sXG4gICAgICBpZCxcbiAgICAgIHRpbWVzdGFtcDogbm93LFxuICAgICAgcmV0cnlDb3VudDogMCxcbiAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgbG9jYWxWZXJzaW9uOiBEYXRlLm5vdygpLCAvLyDkvb/nlKjml7bpl7TmiLPkvZzkuLrmnKzlnLDniYjmnKxcbiAgICAgIHJldHJ5RGVsYXk6IHRoaXMuY29uZmlnLmluaXRpYWxSZXRyeURlbGF5LFxuICAgICAgbWF4UmV0cmllczogdGhpcy5jb25maWcubWF4UmV0cmllc1xuICAgIH1cblxuICAgIC8vIOiOt+WPluW9k+WJjee9kee7nOS/oeaBr1xuICAgIGlmICh0aGlzLmNvbmZpZy5uZXR3b3JrQXdhcmUpIHtcbiAgICAgIGZ1bGxPcGVyYXRpb24ubmV0d29ya0luZm8gPSBhd2FpdCB0aGlzLmdldE5ldHdvcmtJbmZvKClcbiAgICB9XG5cbiAgICAvLyDmo4Dmn6Xph43lpI3mk43kvZxcbiAgICBjb25zdCBleGlzdGluZ09wZXJhdGlvbiA9IGF3YWl0IGRiLnN5bmNRdWV1ZVxuICAgICAgLndoZXJlKCdlbnRpdHlJZCcpXG4gICAgICAuZXF1YWxzKG9wZXJhdGlvbi5lbnRpdHlJZClcbiAgICAgIC5hbmQob3AgPT4gb3AuZW50aXR5VHlwZSA9PT0gb3BlcmF0aW9uLmVudGl0eVR5cGUgJiYgb3Auc3RhdHVzID09PSAncGVuZGluZycpXG4gICAgICAuZmlyc3QoKVxuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChleGlzdGluZ09wZXJhdGlvbikge1xuICAgICAgICAvLyDmm7TmlrDnjrDmnInmk43kvZzogIzkuI3mmK/liJvlu7rmlrDmk43kvZxcbiAgICAgICAgYXdhaXQgZGIuc3luY1F1ZXVlLnVwZGF0ZShleGlzdGluZ09wZXJhdGlvbi5pZCEsIHtcbiAgICAgICAgICBkYXRhOiBvcGVyYXRpb24uZGF0YSxcbiAgICAgICAgICBwcmV2aW91c0RhdGE6IG9wZXJhdGlvbi5wcmV2aW91c0RhdGEsXG4gICAgICAgICAgdGltZXN0YW1wOiBub3csXG4gICAgICAgICAgbG9jYWxWZXJzaW9uOiBEYXRlLm5vdygpXG4gICAgICAgIH0pXG4gICAgICAgIGNvbnNvbGUubG9nKGBPcGVyYXRpb24gdXBkYXRlZCBpbiBxdWV1ZTogJHtleGlzdGluZ09wZXJhdGlvbi5pZH1gKVxuICAgICAgICByZXR1cm4gZXhpc3RpbmdPcGVyYXRpb24uaWQhXG4gICAgICB9XG5cbiAgICAgIGF3YWl0IGRiLnN5bmNRdWV1ZS5hZGQoZnVsbE9wZXJhdGlvbilcbiAgICAgIFxuICAgICAgLy8g6YCa55+l55uR5ZCs5ZmoXG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygnb3BlcmF0aW9uQWRkZWQnLCBmdWxsT3BlcmF0aW9uKVxuICAgICAgXG4gICAgICAvLyDmm7TmlrDnu5/orqHkv6Hmga9cbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlUXVldWVTdGF0cygpXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBPcGVyYXRpb24gYWRkZWQgdG8gcXVldWU6ICR7aWR9YClcbiAgICAgIHJldHVybiBpZFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gYWRkIG9wZXJhdGlvbiB0byBxdWV1ZTonLCBlcnJvcilcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgLy8g6I635Y+W5b6F5aSE55CG5pON5L2cXG4gIGFzeW5jIGdldFBlbmRpbmdPcGVyYXRpb25zKFxuICAgIGxpbWl0OiBudW1iZXIgPSB0aGlzLmNvbmZpZy5iYXRjaFNpemUsXG4gICAgcHJpb3JpdHlGaWx0ZXI/OiAoJ2NyaXRpY2FsJyB8ICdoaWdoJyB8ICdub3JtYWwnIHwgJ2xvdycpW11cbiAgKTogUHJvbWlzZTxMb2NhbFN5bmNPcGVyYXRpb25bXT4ge1xuICAgIHRyeSB7XG4gICAgICBsZXQgcXVlcnkgPSBkYi5zeW5jUXVldWVcbiAgICAgICAgLndoZXJlKCdzdGF0dXMnKVxuICAgICAgICAuZXF1YWxzKCdwZW5kaW5nJylcbiAgICAgICAgLm9yZGVyQnkoJ3ByaW9yaXR5JykgLy8g5oyJ5LyY5YWI57qn5o6S5bqPXG4gICAgICAgIC5yZXZlcnNlKCkgLy8g6auY5LyY5YWI57qn5Zyo5YmNXG4gICAgICBcbiAgICAgIC8vIOW6lOeUqOS8mOWFiOe6p+i/h+a7pFxuICAgICAgaWYgKHByaW9yaXR5RmlsdGVyICYmIHByaW9yaXR5RmlsdGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5maWx0ZXIob3AgPT4gcHJpb3JpdHlGaWx0ZXIuaW5jbHVkZXMob3AucHJpb3JpdHkpKVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBvcGVyYXRpb25zID0gYXdhaXQgcXVlcnkubGltaXQobGltaXQpLnRvQXJyYXkoKVxuICAgICAgXG4gICAgICAvLyDmo4Dmn6Xkvp3otZblhbPns7tcbiAgICAgIGNvbnN0IHJlYWR5T3BlcmF0aW9ucyA9IGF3YWl0IHRoaXMuZmlsdGVyUmVhZHlPcGVyYXRpb25zKG9wZXJhdGlvbnMpXG4gICAgICBcbiAgICAgIHJldHVybiByZWFkeU9wZXJhdGlvbnNcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGdldCBwZW5kaW5nIG9wZXJhdGlvbnM6JywgZXJyb3IpXG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gIH1cblxuICAvLyDmoIforrDmk43kvZzkuLrlpITnkIbkuK1cbiAgYXN5bmMgbWFya09wZXJhdGlvblByb2Nlc3Npbmcob3BlcmF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5zeW5jUXVldWUudXBkYXRlKG9wZXJhdGlvbklkLCB7XG4gICAgICAgIHN0YXR1czogJ3Byb2Nlc3NpbmcnLFxuICAgICAgICBwcm9jZXNzaW5nU3RhcnRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICB9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbWFyayBvcGVyYXRpb24gJHtvcGVyYXRpb25JZH0gYXMgcHJvY2Vzc2luZzpgLCBlcnJvcilcbiAgICB9XG4gIH1cblxuICAvLyDmoIforrDmk43kvZzlrozmiJBcbiAgYXN5bmMgbWFya09wZXJhdGlvbkNvbXBsZXRlZChvcGVyYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGF3YWl0IGRiLnN5bmNRdWV1ZS5nZXQob3BlcmF0aW9uSWQpXG4gICAgICBpZiAoIW9wZXJhdGlvbikgcmV0dXJuXG5cbiAgICAgIGF3YWl0IGRiLnN5bmNRdWV1ZS51cGRhdGUob3BlcmF0aW9uSWQsIHtcbiAgICAgICAgc3RhdHVzOiAnY29tcGxldGVkJ1xuICAgICAgfSlcblxuICAgICAgLy8g6YCa55+l55uR5ZCs5ZmoXG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygnb3BlcmF0aW9uQ29tcGxldGVkJywgb3BlcmF0aW9uKVxuICAgICAgXG4gICAgICAvLyDmm7TmlrDnu5/orqHkv6Hmga9cbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlUXVldWVTdGF0cygpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBtYXJrIG9wZXJhdGlvbiAke29wZXJhdGlvbklkfSBhcyBjb21wbGV0ZWQ6YCwgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLy8g5qCH6K6w5pON5L2c5aSx6LSlXG4gIGFzeW5jIG1hcmtPcGVyYXRpb25GYWlsZWQob3BlcmF0aW9uSWQ6IHN0cmluZywgZXJyb3I6IEVycm9yKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGF3YWl0IGRiLnN5bmNRdWV1ZS5nZXQob3BlcmF0aW9uSWQpXG4gICAgICBpZiAoIW9wZXJhdGlvbikgcmV0dXJuXG5cbiAgICAgIGNvbnN0IHJldHJ5Q291bnQgPSBvcGVyYXRpb24ucmV0cnlDb3VudCArIDFcbiAgICAgIGNvbnN0IG5leHRSZXRyeURlbGF5ID0gTWF0aC5taW4oXG4gICAgICAgIG9wZXJhdGlvbi5yZXRyeURlbGF5ICogdGhpcy5jb25maWcucmV0cnlCYWNrb2ZmTXVsdGlwbGllcixcbiAgICAgICAgdGhpcy5jb25maWcubWF4UmV0cnlEZWxheVxuICAgICAgKVxuXG4gICAgICBjb25zdCB1cGRhdGU6IFBhcnRpYWw8TG9jYWxTeW5jT3BlcmF0aW9uPiA9IHtcbiAgICAgICAgcmV0cnlDb3VudCxcbiAgICAgICAgcmV0cnlEZWxheTogbmV4dFJldHJ5RGVsYXksXG4gICAgICAgIGxhc3RFcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfVxuXG4gICAgICAvLyDmo4Dmn6XmmK/lkKbotoXov4fmnIDlpKfph43or5XmrKHmlbBcbiAgICAgIGlmIChyZXRyeUNvdW50ID49IG9wZXJhdGlvbi5tYXhSZXRyaWVzKSB7XG4gICAgICAgIHVwZGF0ZS5zdGF0dXMgPSAnZmFpbGVkJ1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8g6YeN572u5Li6cGVuZGluZ+S7peS+v+mHjeivlVxuICAgICAgICB1cGRhdGUuc3RhdHVzID0gJ3BlbmRpbmcnXG4gICAgICB9XG5cbiAgICAgIGF3YWl0IGRiLnN5bmNRdWV1ZS51cGRhdGUob3BlcmF0aW9uSWQsIHVwZGF0ZSlcblxuICAgICAgLy8g6YCa55+l55uR5ZCs5ZmoXG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygnb3BlcmF0aW9uRmFpbGVkJywgb3BlcmF0aW9uLCBlcnJvcilcbiAgICAgIFxuICAgICAgLy8g5pu05paw57uf6K6h5L+h5oGvXG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVF1ZXVlU3RhdHMoKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbWFyayBvcGVyYXRpb24gJHtvcGVyYXRpb25JZH0gYXMgZmFpbGVkOmAsIGVycm9yKVxuICAgIH1cbiAgfVxuXG4gIC8vIOWPlua2iOaTjeS9nFxuICBhc3luYyBjYW5jZWxPcGVyYXRpb24ob3BlcmF0aW9uSWQ6IHN0cmluZywgcmVhc29uPzogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGF3YWl0IGRiLnN5bmNRdWV1ZS5nZXQob3BlcmF0aW9uSWQpXG4gICAgICBpZiAoIW9wZXJhdGlvbikgcmV0dXJuXG5cbiAgICAgIGF3YWl0IGRiLnN5bmNRdWV1ZS51cGRhdGUob3BlcmF0aW9uSWQsIHtcbiAgICAgICAgc3RhdHVzOiAnY2FuY2VsbGVkJyxcbiAgICAgICAgbGFzdEVycm9yOiByZWFzb24gfHwgJ0NhbmNlbGxlZCBieSB1c2VyJ1xuICAgICAgfSlcblxuICAgICAgLy8g6YCa55+l55uR5ZCs5ZmoXG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygnb3BlcmF0aW9uRmFpbGVkJywgb3BlcmF0aW9uLCBuZXcgRXJyb3IocmVhc29uIHx8ICdPcGVyYXRpb24gY2FuY2VsbGVkJykpXG4gICAgICBcbiAgICAgIC8vIOabtOaWsOe7n+iuoeS/oeaBr1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVRdWV1ZVN0YXRzKClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNhbmNlbCBvcGVyYXRpb24gJHtvcGVyYXRpb25JZH06YCwgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyDmibnlpITnkIblkozpmJ/liJfnrqHnkIZcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8vIOW8gOWni+WkhOeQhumYn+WIl1xuICBwcml2YXRlIHN0YXJ0UHJvY2Vzc2luZygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wcm9jZXNzaW5nVGltZXIpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wcm9jZXNzaW5nVGltZXIpXG4gICAgfVxuXG4gICAgdGhpcy5wcm9jZXNzaW5nVGltZXIgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaXNQcm9jZXNzaW5nKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc1F1ZXVlKClcbiAgICAgIH1cbiAgICB9LCB0aGlzLmNvbmZpZy5pZGxlQ2hlY2tJbnRlcnZhbClcbiAgfVxuXG4gIC8vIOWkhOeQhumYn+WIl1xuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NRdWV1ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5pc1Byb2Nlc3NpbmcgfHwgdGhpcy5jdXJyZW50QmF0Y2hlcy5zaXplID49IHRoaXMuY29uZmlnLm1heENvbmN1cnJlbnRCYXRjaGVzKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0aGlzLmlzUHJvY2Vzc2luZyA9IHRydWVcblxuICAgIHRyeSB7XG4gICAgICAvLyDojrflj5blvoXlpITnkIbmk43kvZxcbiAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSBhd2FpdCB0aGlzLmdldFBlbmRpbmdPcGVyYXRpb25zKClcbiAgICAgIFxuICAgICAgaWYgKG9wZXJhdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICAvLyDliIbmibnlpITnkIZcbiAgICAgIGNvbnN0IGJhdGNoZXMgPSBhd2FpdCB0aGlzLmNyZWF0ZUJhdGNoZXMob3BlcmF0aW9ucylcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBiYXRjaCBvZiBiYXRjaGVzKSB7XG4gICAgICAgIGNvbnN0IGJhdGNoSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpXG4gICAgICAgIGNvbnN0IGJhdGNoUHJvbWlzZSA9IHRoaXMucHJvY2Vzc0JhdGNoKGJhdGNoLCBiYXRjaElkKVxuICAgICAgICBcbiAgICAgICAgdGhpcy5jdXJyZW50QmF0Y2hlcy5zZXQoYmF0Y2hJZCwgYmF0Y2hQcm9taXNlKVxuICAgICAgICBcbiAgICAgICAgYmF0Y2hQcm9taXNlXG4gICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEJhdGNoICR7YmF0Y2hJZH0gZmFpbGVkOmAsIGVycm9yKVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50QmF0Y2hlcy5kZWxldGUoYmF0Y2hJZClcbiAgICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIHF1ZXVlOicsIGVycm9yKVxuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmlzUHJvY2Vzc2luZyA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgLy8g5Yib5bu65om55aSE55CG57uEXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlQmF0Y2hlcyhvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSk6IFByb21pc2U8TG9jYWxTeW5jT3BlcmF0aW9uW11bXT4ge1xuICAgIGNvbnN0IGJhdGNoZXM6IExvY2FsU3luY09wZXJhdGlvbltdW10gPSBbXVxuICAgIGxldCBjdXJyZW50QmF0Y2g6IExvY2FsU3luY09wZXJhdGlvbltdID0gW11cbiAgICBcbiAgICAvLyDmjInkvJjlhYjnuqfmjpLluo9cbiAgICBjb25zdCBzb3J0ZWRPcGVyYXRpb25zID0gWy4uLm9wZXJhdGlvbnNdLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IHByaW9yaXR5T3JkZXIgPSB7IGNyaXRpY2FsOiA0LCBoaWdoOiAzLCBub3JtYWw6IDIsIGxvdzogMSB9XG4gICAgICByZXR1cm4gcHJpb3JpdHlPcmRlcltiLnByaW9yaXR5XSAtIHByaW9yaXR5T3JkZXJbYS5wcmlvcml0eV1cbiAgICB9KVxuXG4gICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2Ygc29ydGVkT3BlcmF0aW9ucykge1xuICAgICAgLy8g5qOA5p+l5om55qyh5aSn5bCP6ZmQ5Yi2XG4gICAgICBpZiAoY3VycmVudEJhdGNoLmxlbmd0aCA+PSB0aGlzLmNvbmZpZy5iYXRjaFNpemUpIHtcbiAgICAgICAgYmF0Y2hlcy5wdXNoKGN1cnJlbnRCYXRjaClcbiAgICAgICAgY3VycmVudEJhdGNoID0gW11cbiAgICAgIH1cblxuICAgICAgLy8g5qOA5p+l572R57uc6ZmQ5Yi2XG4gICAgICBpZiAodGhpcy5jb25maWcucmVxdWlyZVdpZmlGb3JMYXJnZUZpbGVzICYmIG9wZXJhdGlvbi5lbnRpdHlUeXBlID09PSAnaW1hZ2UnKSB7XG4gICAgICAgIGNvbnN0IG5ldHdvcmtJbmZvID0gYXdhaXQgdGhpcy5nZXROZXR3b3JrSW5mbygpXG4gICAgICAgIGlmIChuZXR3b3JrSW5mby5jb25uZWN0aW9uVHlwZSAhPT0gJ3dpZmknKSB7XG4gICAgICAgICAgY29udGludWUgLy8g6Lez6L+H5aSn5paH5Lu25pON5L2cXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY3VycmVudEJhdGNoLnB1c2gob3BlcmF0aW9uKVxuICAgIH1cblxuICAgIGlmIChjdXJyZW50QmF0Y2gubGVuZ3RoID4gMCkge1xuICAgICAgYmF0Y2hlcy5wdXNoKGN1cnJlbnRCYXRjaClcbiAgICB9XG5cbiAgICByZXR1cm4gYmF0Y2hlc1xuICB9XG5cbiAgLy8g5aSE55CG5om55qyhXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0JhdGNoKG9wZXJhdGlvbnM6IExvY2FsU3luY09wZXJhdGlvbltdLCBiYXRjaElkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBiYXRjaFN0YXJ0VGltZSA9IERhdGUubm93KClcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8g5qCH6K6w5omA5pyJ5pON5L2c5Li65aSE55CG5LitXG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgb3BlcmF0aW9ucy5tYXAob3AgPT4gdGhpcy5tYXJrT3BlcmF0aW9uUHJvY2Vzc2luZyhvcC5pZCkpXG4gICAgICApXG5cbiAgICAgIC8vIOmAmuefpeebkeWQrOWZqFxuICAgICAgb3BlcmF0aW9ucy5mb3JFYWNoKG9wID0+IHtcbiAgICAgICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoJ29wZXJhdGlvblN0YXJ0ZWQnLCBvcClcbiAgICAgIH0pXG5cbiAgICAgIC8vIOiwg+eUqOWunumZheeahOWQjOatpemAu+i+kVxuICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQmF0Y2hTeW5jKG9wZXJhdGlvbnMsIGJhdGNoSWQpXG5cbiAgICAgIC8vIOagh+iusOaJgOacieaTjeS9nOS4uuWujOaIkFxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIG9wZXJhdGlvbnMubWFwKG9wID0+IHRoaXMubWFya09wZXJhdGlvbkNvbXBsZXRlZChvcC5pZCkpXG4gICAgICApXG5cbiAgICAgIGNvbnNvbGUubG9nKGBCYXRjaCAke2JhdGNoSWR9IHByb2Nlc3NlZCBzdWNjZXNzZnVsbHkgKCR7b3BlcmF0aW9ucy5sZW5ndGh9IG9wZXJhdGlvbnMpYClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgQmF0Y2ggJHtiYXRjaElkfSBmYWlsZWQ6YCwgZXJyb3IpXG4gICAgICBcbiAgICAgIC8vIOagh+iusOaJgOacieaTjeS9nOS4uuWksei0pVxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIG9wZXJhdGlvbnMubWFwKG9wID0+IHRoaXMubWFya09wZXJhdGlvbkZhaWxlZChvcC5pZCwgZXJyb3IgYXMgRXJyb3IpKVxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIC8vIOaJp+ihjOaJueWkhOeQhuWQjOatpemAu+i+kVxuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVCYXRjaFN5bmMob3BlcmF0aW9uczogTG9jYWxTeW5jT3BlcmF0aW9uW10sIGJhdGNoSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyDlr7zlhaXnu5/kuIDlkIzmraXmnI3liqHvvIjlu7bov5/lr7zlhaXpgb/lhY3lvqrnjq/kvp3otZbvvIlcbiAgICAgIGNvbnN0IHsgdW5pZmllZFN5bmNTZXJ2aWNlIH0gPSBhd2FpdCBpbXBvcnQoJy4vdW5pZmllZC1zeW5jLXNlcnZpY2UnKVxuICAgICAgXG4gICAgICAvLyDmjInmk43kvZznsbvlnovliIbnu4TlpITnkIZcbiAgICAgIGNvbnN0IG9wZXJhdGlvbkdyb3VwcyA9IHRoaXMuZ3JvdXBPcGVyYXRpb25zQnlUeXBlKG9wZXJhdGlvbnMpXG4gICAgICBcbiAgICAgIC8vIOWkhOeQhuavj+S4quaTjeS9nOe7hFxuICAgICAgZm9yIChjb25zdCBbZW50aXR5VHlwZSwgZW50aXR5T3BlcmF0aW9uc10gb2YgT2JqZWN0LmVudHJpZXMob3BlcmF0aW9uR3JvdXBzKSkge1xuICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NFbnRpdHlHcm91cChlbnRpdHlUeXBlLCBlbnRpdHlPcGVyYXRpb25zLCB1bmlmaWVkU3luY1NlcnZpY2UpXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBCYXRjaCAke2JhdGNoSWR9IHN5bmMgZXhlY3V0aW9uIGNvbXBsZXRlZGApXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEJhdGNoICR7YmF0Y2hJZH0gc3luYyBleGVjdXRpb24gZmFpbGVkOmAsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICAvLyDmjInlrp7kvZPnsbvlnovliIbnu4Tmk43kvZxcbiAgcHJpdmF0ZSBncm91cE9wZXJhdGlvbnNCeVR5cGUob3BlcmF0aW9uczogTG9jYWxTeW5jT3BlcmF0aW9uW10pOiBSZWNvcmQ8c3RyaW5nLCBMb2NhbFN5bmNPcGVyYXRpb25bXT4ge1xuICAgIGNvbnN0IGdyb3VwczogUmVjb3JkPHN0cmluZywgTG9jYWxTeW5jT3BlcmF0aW9uW10+ID0ge31cbiAgICBcbiAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiBvcGVyYXRpb25zKSB7XG4gICAgICBpZiAoIWdyb3Vwc1tvcGVyYXRpb24uZW50aXR5VHlwZV0pIHtcbiAgICAgICAgZ3JvdXBzW29wZXJhdGlvbi5lbnRpdHlUeXBlXSA9IFtdXG4gICAgICB9XG4gICAgICBncm91cHNbb3BlcmF0aW9uLmVudGl0eVR5cGVdLnB1c2gob3BlcmF0aW9uKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZ3JvdXBzXG4gIH1cblxuICAvLyDlpITnkIblrp7kvZPmk43kvZznu4RcbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzRW50aXR5R3JvdXAoXG4gICAgZW50aXR5VHlwZTogc3RyaW5nLCBcbiAgICBvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSwgXG4gICAgc3luY1NlcnZpY2U6IGFueVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBzd2l0Y2ggKGVudGl0eVR5cGUpIHtcbiAgICAgIGNhc2UgJ2NhcmQnOlxuICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NDYXJkT3BlcmF0aW9ucyhvcGVyYXRpb25zLCBzeW5jU2VydmljZSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2ZvbGRlcic6XG4gICAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc0ZvbGRlck9wZXJhdGlvbnMob3BlcmF0aW9ucywgc3luY1NlcnZpY2UpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICd0YWcnOlxuICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NUYWdPcGVyYXRpb25zKG9wZXJhdGlvbnMsIHN5bmNTZXJ2aWNlKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAnaW1hZ2UnOlxuICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NJbWFnZU9wZXJhdGlvbnMob3BlcmF0aW9ucywgc3luY1NlcnZpY2UpXG4gICAgICAgIGJyZWFrXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLndhcm4oYFVua25vd24gZW50aXR5IHR5cGU6ICR7ZW50aXR5VHlwZX1gKVxuICAgIH1cbiAgfVxuXG4gIC8vIOWkhOeQhuWNoeeJh+aTjeS9nFxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NDYXJkT3BlcmF0aW9ucyhvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSwgc3luY1NlcnZpY2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAoY29uc3Qgb3BlcmF0aW9uIG9mIG9wZXJhdGlvbnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHN3aXRjaCAob3BlcmF0aW9uLm9wZXJhdGlvblR5cGUpIHtcbiAgICAgICAgICBjYXNlICdjcmVhdGUnOlxuICAgICAgICAgICAgYXdhaXQgc3luY1NlcnZpY2UuYWRkT3BlcmF0aW9uKHtcbiAgICAgICAgICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICAgICAgICAgIGVudGl0eTogJ2NhcmQnLFxuICAgICAgICAgICAgICBlbnRpdHlJZDogb3BlcmF0aW9uLmVudGl0eUlkLFxuICAgICAgICAgICAgICBkYXRhOiBvcGVyYXRpb24uZGF0YSxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IG9wZXJhdGlvbi5wcmlvcml0eSxcbiAgICAgICAgICAgICAgdXNlcklkOiBvcGVyYXRpb24udXNlcklkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIFxuICAgICAgICAgIGNhc2UgJ3VwZGF0ZSc6XG4gICAgICAgICAgICBhd2FpdCBzeW5jU2VydmljZS5hZGRPcGVyYXRpb24oe1xuICAgICAgICAgICAgICB0eXBlOiAndXBkYXRlJyxcbiAgICAgICAgICAgICAgZW50aXR5OiAnY2FyZCcsXG4gICAgICAgICAgICAgIGVudGl0eUlkOiBvcGVyYXRpb24uZW50aXR5SWQsXG4gICAgICAgICAgICAgIGRhdGE6IG9wZXJhdGlvbi5kYXRhLFxuICAgICAgICAgICAgICBwcmlvcml0eTogb3BlcmF0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICB1c2VySWQ6IG9wZXJhdGlvbi51c2VySWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgXG4gICAgICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgICAgIGF3YWl0IHN5bmNTZXJ2aWNlLmFkZE9wZXJhdGlvbih7XG4gICAgICAgICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICAgICAgICBlbnRpdHk6ICdjYXJkJyxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6IG9wZXJhdGlvbi5lbnRpdHlJZCxcbiAgICAgICAgICAgICAgZGF0YTogeyB1c2VySWQ6IG9wZXJhdGlvbi51c2VySWQgfSxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IG9wZXJhdGlvbi5wcmlvcml0eSxcbiAgICAgICAgICAgICAgdXNlcklkOiBvcGVyYXRpb24udXNlcklkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHByb2Nlc3MgY2FyZCBvcGVyYXRpb24gJHtvcGVyYXRpb24uaWR9OmAsIGVycm9yKVxuICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIOWkhOeQhuaWh+S7tuWkueaTjeS9nFxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NGb2xkZXJPcGVyYXRpb25zKG9wZXJhdGlvbnM6IExvY2FsU3luY09wZXJhdGlvbltdLCBzeW5jU2VydmljZTogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2Ygb3BlcmF0aW9ucykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc3dpdGNoIChvcGVyYXRpb24ub3BlcmF0aW9uVHlwZSkge1xuICAgICAgICAgIGNhc2UgJ2NyZWF0ZSc6XG4gICAgICAgICAgICBhd2FpdCBzeW5jU2VydmljZS5hZGRPcGVyYXRpb24oe1xuICAgICAgICAgICAgICB0eXBlOiAnY3JlYXRlJyxcbiAgICAgICAgICAgICAgZW50aXR5OiAnZm9sZGVyJyxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6IG9wZXJhdGlvbi5lbnRpdHlJZCxcbiAgICAgICAgICAgICAgZGF0YTogb3BlcmF0aW9uLmRhdGEsXG4gICAgICAgICAgICAgIHByaW9yaXR5OiBvcGVyYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICAgIHVzZXJJZDogb3BlcmF0aW9uLnVzZXJJZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBcbiAgICAgICAgICBjYXNlICd1cGRhdGUnOlxuICAgICAgICAgICAgYXdhaXQgc3luY1NlcnZpY2UuYWRkT3BlcmF0aW9uKHtcbiAgICAgICAgICAgICAgdHlwZTogJ3VwZGF0ZScsXG4gICAgICAgICAgICAgIGVudGl0eTogJ2ZvbGRlcicsXG4gICAgICAgICAgICAgIGVudGl0eUlkOiBvcGVyYXRpb24uZW50aXR5SWQsXG4gICAgICAgICAgICAgIGRhdGE6IG9wZXJhdGlvbi5kYXRhLFxuICAgICAgICAgICAgICBwcmlvcml0eTogb3BlcmF0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICB1c2VySWQ6IG9wZXJhdGlvbi51c2VySWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgXG4gICAgICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgICAgIGF3YWl0IHN5bmNTZXJ2aWNlLmFkZE9wZXJhdGlvbih7XG4gICAgICAgICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICAgICAgICBlbnRpdHk6ICdmb2xkZXInLFxuICAgICAgICAgICAgICBlbnRpdHlJZDogb3BlcmF0aW9uLmVudGl0eUlkLFxuICAgICAgICAgICAgICBkYXRhOiB7IHVzZXJJZDogb3BlcmF0aW9uLnVzZXJJZCB9LFxuICAgICAgICAgICAgICBwcmlvcml0eTogb3BlcmF0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICB1c2VySWQ6IG9wZXJhdGlvbi51c2VySWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gcHJvY2VzcyBmb2xkZXIgb3BlcmF0aW9uICR7b3BlcmF0aW9uLmlkfTpgLCBlcnJvcilcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyDlpITnkIbmoIfnrb7mk43kvZxcbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzVGFnT3BlcmF0aW9ucyhvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSwgc3luY1NlcnZpY2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAoY29uc3Qgb3BlcmF0aW9uIG9mIG9wZXJhdGlvbnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHN3aXRjaCAob3BlcmF0aW9uLm9wZXJhdGlvblR5cGUpIHtcbiAgICAgICAgICBjYXNlICdjcmVhdGUnOlxuICAgICAgICAgICAgYXdhaXQgc3luY1NlcnZpY2UuYWRkT3BlcmF0aW9uKHtcbiAgICAgICAgICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICAgICAgICAgIGVudGl0eTogJ3RhZycsXG4gICAgICAgICAgICAgIGVudGl0eUlkOiBvcGVyYXRpb24uZW50aXR5SWQsXG4gICAgICAgICAgICAgIGRhdGE6IG9wZXJhdGlvbi5kYXRhLFxuICAgICAgICAgICAgICBwcmlvcml0eTogb3BlcmF0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICB1c2VySWQ6IG9wZXJhdGlvbi51c2VySWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgXG4gICAgICAgICAgY2FzZSAndXBkYXRlJzpcbiAgICAgICAgICAgIGF3YWl0IHN5bmNTZXJ2aWNlLmFkZE9wZXJhdGlvbih7XG4gICAgICAgICAgICAgIHR5cGU6ICd1cGRhdGUnLFxuICAgICAgICAgICAgICBlbnRpdHk6ICd0YWcnLFxuICAgICAgICAgICAgICBlbnRpdHlJZDogb3BlcmF0aW9uLmVudGl0eUlkLFxuICAgICAgICAgICAgICBkYXRhOiBvcGVyYXRpb24uZGF0YSxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IG9wZXJhdGlvbi5wcmlvcml0eSxcbiAgICAgICAgICAgICAgdXNlcklkOiBvcGVyYXRpb24udXNlcklkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIFxuICAgICAgICAgIGNhc2UgJ2RlbGV0ZSc6XG4gICAgICAgICAgICBhd2FpdCBzeW5jU2VydmljZS5hZGRPcGVyYXRpb24oe1xuICAgICAgICAgICAgICB0eXBlOiAnZGVsZXRlJyxcbiAgICAgICAgICAgICAgZW50aXR5OiAndGFnJyxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6IG9wZXJhdGlvbi5lbnRpdHlJZCxcbiAgICAgICAgICAgICAgZGF0YTogeyB1c2VySWQ6IG9wZXJhdGlvbi51c2VySWQgfSxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IG9wZXJhdGlvbi5wcmlvcml0eSxcbiAgICAgICAgICAgICAgdXNlcklkOiBvcGVyYXRpb24udXNlcklkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHByb2Nlc3MgdGFnIG9wZXJhdGlvbiAke29wZXJhdGlvbi5pZH06YCwgZXJyb3IpXG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8g5aSE55CG5Zu+54mH5pON5L2cXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0ltYWdlT3BlcmF0aW9ucyhvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSwgc3luY1NlcnZpY2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAoY29uc3Qgb3BlcmF0aW9uIG9mIG9wZXJhdGlvbnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHN3aXRjaCAob3BlcmF0aW9uLm9wZXJhdGlvblR5cGUpIHtcbiAgICAgICAgICBjYXNlICdjcmVhdGUnOlxuICAgICAgICAgICAgYXdhaXQgc3luY1NlcnZpY2UuYWRkT3BlcmF0aW9uKHtcbiAgICAgICAgICAgICAgdHlwZTogJ2NyZWF0ZScsXG4gICAgICAgICAgICAgIGVudGl0eTogJ2ltYWdlJyxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6IG9wZXJhdGlvbi5lbnRpdHlJZCxcbiAgICAgICAgICAgICAgZGF0YTogb3BlcmF0aW9uLmRhdGEsXG4gICAgICAgICAgICAgIHByaW9yaXR5OiBvcGVyYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICAgIHVzZXJJZDogb3BlcmF0aW9uLnVzZXJJZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBcbiAgICAgICAgICBjYXNlICd1cGRhdGUnOlxuICAgICAgICAgICAgYXdhaXQgc3luY1NlcnZpY2UuYWRkT3BlcmF0aW9uKHtcbiAgICAgICAgICAgICAgdHlwZTogJ3VwZGF0ZScsXG4gICAgICAgICAgICAgIGVudGl0eTogJ2ltYWdlJyxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6IG9wZXJhdGlvbi5lbnRpdHlJZCxcbiAgICAgICAgICAgICAgZGF0YTogb3BlcmF0aW9uLmRhdGEsXG4gICAgICAgICAgICAgIHByaW9yaXR5OiBvcGVyYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICAgIHVzZXJJZDogb3BlcmF0aW9uLnVzZXJJZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBcbiAgICAgICAgICBjYXNlICdkZWxldGUnOlxuICAgICAgICAgICAgYXdhaXQgc3luY1NlcnZpY2UuYWRkT3BlcmF0aW9uKHtcbiAgICAgICAgICAgICAgdHlwZTogJ2RlbGV0ZScsXG4gICAgICAgICAgICAgIGVudGl0eTogJ2ltYWdlJyxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6IG9wZXJhdGlvbi5lbnRpdHlJZCxcbiAgICAgICAgICAgICAgZGF0YTogeyB1c2VySWQ6IG9wZXJhdGlvbi51c2VySWQgfSxcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IG9wZXJhdGlvbi5wcmlvcml0eSxcbiAgICAgICAgICAgICAgdXNlcklkOiBvcGVyYXRpb24udXNlcklkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHByb2Nlc3MgaW1hZ2Ugb3BlcmF0aW9uICR7b3BlcmF0aW9uLmlkfTpgLCBlcnJvcilcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIOa4heeQhuWSjOe7tOaKpFxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLy8g5ZCv5Yqo5a6a5pyf5riF55CGXG4gIHByaXZhdGUgc3RhcnRDbGVhbnVwKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNsZWFudXBUaW1lcikge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBUaW1lcilcbiAgICB9XG5cbiAgICB0aGlzLmNsZWFudXBUaW1lciA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHRoaXMuY2xlYW51cFF1ZXVlKClcbiAgICB9LCB0aGlzLmNvbmZpZy5jbGVhbnVwSW50ZXJ2YWwpXG4gIH1cblxuICAvLyDmuIXnkIbpmJ/liJdcbiAgcHJpdmF0ZSBhc3luYyBjbGVhbnVwUXVldWUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgICAgIFxuICAgICAgLy8g5riF55CG6L+H5pyf55qE5pON5L2cXG4gICAgICBjb25zdCBleHBpcmVkRGF0ZSA9IG5ldyBEYXRlKG5vdyAtIHRoaXMuY29uZmlnLm1heEFnZSlcbiAgICAgIGF3YWl0IGRiLnN5bmNRdWV1ZVxuICAgICAgICAud2hlcmUoJ3RpbWVzdGFtcCcpXG4gICAgICAgIC5iZWxvdyhleHBpcmVkRGF0ZSlcbiAgICAgICAgLmRlbGV0ZSgpXG4gICAgICBcbiAgICAgIC8vIOa4heeQhuW3suWujOaIkOaTjeS9nO+8iOS/neeVmeacgOi/keeahDEwMDDmnaHnlKjkuo7nu5/orqHvvIlcbiAgICAgIGNvbnN0IGNvbXBsZXRlZE9wZXJhdGlvbnMgPSBhd2FpdCBkYi5zeW5jUXVldWVcbiAgICAgICAgLndoZXJlKCdzdGF0dXMnKVxuICAgICAgICAuZXF1YWxzKCdjb21wbGV0ZWQnKVxuICAgICAgICAub3JkZXJCeSgndGltZXN0YW1wJylcbiAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAub2Zmc2V0KDEwMDApXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgIFxuICAgICAgaWYgKGNvbXBsZXRlZE9wZXJhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICBhd2FpdCBkYi5zeW5jUXVldWUuYnVsa0RlbGV0ZShjb21wbGV0ZWRPcGVyYXRpb25zLm1hcChvcCA9PiBvcC5pZCEpKVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDmo4Dmn6XpmJ/liJflpKflsI/pmZDliLZcbiAgICAgIGNvbnN0IHRvdGFsQ291bnQgPSBhd2FpdCBkYi5zeW5jUXVldWUuY291bnQoKVxuICAgICAgaWYgKHRvdGFsQ291bnQgPiB0aGlzLmNvbmZpZy5tYXhRdWV1ZVNpemUpIHtcbiAgICAgICAgY29uc3QgZXhjZXNzID0gdG90YWxDb3VudCAtIHRoaXMuY29uZmlnLm1heFF1ZXVlU2l6ZVxuICAgICAgICBjb25zdCBvbGRlc3RPcGVyYXRpb25zID0gYXdhaXQgZGIuc3luY1F1ZXVlXG4gICAgICAgICAgLm9yZGVyQnkoJ3RpbWVzdGFtcCcpXG4gICAgICAgICAgLmxpbWl0KGV4Y2VzcylcbiAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgIFxuICAgICAgICBhd2FpdCBkYi5zeW5jUXVldWUuYnVsa0RlbGV0ZShvbGRlc3RPcGVyYXRpb25zLm1hcChvcCA9PiBvcC5pZCEpKVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnUXVldWUgY2xlYW51cCBjb21wbGV0ZWQnKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdRdWV1ZSBjbGVhbnVwIGZhaWxlZDonLCBlcnJvcilcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIOe9kee7nOeKtuaAgeajgOa1i1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLy8g6I635Y+W572R57uc5L+h5oGvXG4gIHByaXZhdGUgYXN5bmMgZ2V0TmV0d29ya0luZm8oKTogUHJvbWlzZTxMb2NhbFN5bmNPcGVyYXRpb25bJ25ldHdvcmtJbmZvJ10+IHtcbiAgICBpZiAoISgnY29ubmVjdGlvbicgaW4gbmF2aWdhdG9yKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb25saW5lOiBuYXZpZ2F0b3Iub25MaW5lLFxuICAgICAgICBjb25uZWN0aW9uVHlwZTogJ25vbmUnLFxuICAgICAgICBlZmZlY3RpdmVUeXBlOiAnNGcnXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgY29ubmVjdGlvbiA9IChuYXZpZ2F0b3IgYXMgYW55KS5jb25uZWN0aW9uXG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIG9ubGluZTogbmF2aWdhdG9yLm9uTGluZSxcbiAgICAgIGNvbm5lY3Rpb25UeXBlOiB0aGlzLmdldENvbm5lY3Rpb25UeXBlKGNvbm5lY3Rpb24pLFxuICAgICAgZWZmZWN0aXZlVHlwZTogY29ubmVjdGlvbi5lZmZlY3RpdmVUeXBlIHx8ICc0ZycsXG4gICAgICBydHQ6IGNvbm5lY3Rpb24ucnR0LFxuICAgICAgZG93bmxpbms6IGNvbm5lY3Rpb24uZG93bmxpbmtcbiAgICB9XG4gIH1cblxuICAvLyDojrflj5bov57mjqXnsbvlnotcbiAgcHJpdmF0ZSBnZXRDb25uZWN0aW9uVHlwZShjb25uZWN0aW9uOiBhbnkpOiAnd2lmaScgfCAnY2VsbHVsYXInIHwgJ25vbmUnIHtcbiAgICBpZiAoIWNvbm5lY3Rpb24pIHJldHVybiAnbm9uZSdcbiAgICBcbiAgICBzd2l0Y2ggKGNvbm5lY3Rpb24udHlwZSkge1xuICAgICAgY2FzZSAnd2lmaSc6XG4gICAgICBjYXNlICdldGhlcm5ldCc6XG4gICAgICAgIHJldHVybiAnd2lmaSdcbiAgICAgIGNhc2UgJ2NlbGx1bGFyJzpcbiAgICAgIGNhc2UgJ2JsdWV0b290aCc6XG4gICAgICAgIHJldHVybiAnY2VsbHVsYXInXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJ25vbmUnXG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyDkvp3otZblhbPns7vmo4Dmn6VcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8vIOajgOafpeaTjeS9nOaYr+WQpuWHhuWkh+Wwsee7qu+8iOS+nei1luWFs+ezu+W3sua7oei2s++8iVxuICBwcml2YXRlIGFzeW5jIGZpbHRlclJlYWR5T3BlcmF0aW9ucyhvcGVyYXRpb25zOiBMb2NhbFN5bmNPcGVyYXRpb25bXSk6IFByb21pc2U8TG9jYWxTeW5jT3BlcmF0aW9uW10+IHtcbiAgICBjb25zdCByZWFkeU9wZXJhdGlvbnM6IExvY2FsU3luY09wZXJhdGlvbltdID0gW11cbiAgICBcbiAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiBvcGVyYXRpb25zKSB7XG4gICAgICBpZiAoIW9wZXJhdGlvbi5kZXBlbmRzT24gfHwgb3BlcmF0aW9uLmRlcGVuZHNPbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVhZHlPcGVyYXRpb25zLnB1c2gob3BlcmF0aW9uKVxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuXG4gICAgICAvLyDmo4Dmn6XmiYDmnInkvp3otZbmk43kvZzmmK/lkKblt7LlrozmiJBcbiAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IGF3YWl0IGRiLnN5bmNRdWV1ZVxuICAgICAgICAud2hlcmUoJ2lkJylcbiAgICAgICAgLmFueU9mKG9wZXJhdGlvbi5kZXBlbmRzT24pXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgIFxuICAgICAgY29uc3QgYWxsRGVwZW5kZW5jaWVzQ29tcGxldGVkID0gZGVwZW5kZW5jaWVzLmV2ZXJ5KGRlcCA9PiBkZXAuc3RhdHVzID09PSAnY29tcGxldGVkJylcbiAgICAgIFxuICAgICAgaWYgKGFsbERlcGVuZGVuY2llc0NvbXBsZXRlZCkge1xuICAgICAgICByZWFkeU9wZXJhdGlvbnMucHVzaChvcGVyYXRpb24pXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiByZWFkeU9wZXJhdGlvbnNcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g57uf6K6h5ZKM55uR5o6nXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvLyDojrflj5bpmJ/liJfnu5/orqHkv6Hmga9cbiAgYXN5bmMgZ2V0UXVldWVTdGF0cygpOiBQcm9taXNlPFF1ZXVlU3RhdHM+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYWxsT3BlcmF0aW9ucyA9IGF3YWl0IGRiLnN5bmNRdWV1ZS50b0FycmF5KClcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHM6IFF1ZXVlU3RhdHMgPSB7XG4gICAgICAgIHRvdGFsT3BlcmF0aW9uczogYWxsT3BlcmF0aW9ucy5sZW5ndGgsXG4gICAgICAgIHBlbmRpbmdPcGVyYXRpb25zOiAwLFxuICAgICAgICBwcm9jZXNzaW5nT3BlcmF0aW9uczogMCxcbiAgICAgICAgZmFpbGVkT3BlcmF0aW9uczogMCxcbiAgICAgICAgY29tcGxldGVkT3BlcmF0aW9uczogMCxcbiAgICAgICAgXG4gICAgICAgIGJ5VHlwZToge1xuICAgICAgICAgIGNhcmQ6IDAsXG4gICAgICAgICAgZm9sZGVyOiAwLFxuICAgICAgICAgIHRhZzogMCxcbiAgICAgICAgICBpbWFnZTogMFxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgYnlQcmlvcml0eToge1xuICAgICAgICAgIGNyaXRpY2FsOiAwLFxuICAgICAgICAgIGhpZ2g6IDAsXG4gICAgICAgICAgbm9ybWFsOiAwLFxuICAgICAgICAgIGxvdzogMFxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgYnlTdGF0dXM6IHtcbiAgICAgICAgICBwZW5kaW5nOiAwLFxuICAgICAgICAgIHByb2Nlc3Npbmc6IDAsXG4gICAgICAgICAgY29tcGxldGVkOiAwLFxuICAgICAgICAgIGZhaWxlZDogMCxcbiAgICAgICAgICBjYW5jZWxsZWQ6IDBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGF2ZXJhZ2VQcm9jZXNzaW5nVGltZTogMCxcbiAgICAgICAgZmFpbHVyZVJhdGU6IDAsXG4gICAgICAgIG9sZGVzdFBlbmRpbmdBZ2U6IDAsXG4gICAgICAgIGF2ZXJhZ2VSZXRyeUNvdW50OiAwXG4gICAgICB9XG5cbiAgICAgIC8vIOiuoeeul+WQhOexu+e7n+iuoVxuICAgICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2YgYWxsT3BlcmF0aW9ucykge1xuICAgICAgICAvLyDmjInnsbvlnovnu5/orqFcbiAgICAgICAgc3RhdHMuYnlUeXBlW29wZXJhdGlvbi5lbnRpdHlUeXBlXSsrXG4gICAgICAgIFxuICAgICAgICAvLyDmjInkvJjlhYjnuqfnu5/orqFcbiAgICAgICAgc3RhdHMuYnlQcmlvcml0eVtvcGVyYXRpb24ucHJpb3JpdHldKytcbiAgICAgICAgXG4gICAgICAgIC8vIOaMieeKtuaAgee7n+iuoVxuICAgICAgICBzdGF0cy5ieVN0YXR1c1tvcGVyYXRpb24uc3RhdHVzXSsrXG4gICAgICAgIFxuICAgICAgICAvLyDorqHnrpflpITnkIbml7bpl7RcbiAgICAgICAgaWYgKG9wZXJhdGlvbi5zdGF0dXMgPT09ICdjb21wbGV0ZWQnICYmIG9wZXJhdGlvbi5wcm9jZXNzaW5nU3RhcnRlZEF0KSB7XG4gICAgICAgICAgY29uc3QgcHJvY2Vzc2luZ1RpbWUgPSBvcGVyYXRpb24udGltZXN0YW1wLmdldFRpbWUoKSAtIG9wZXJhdGlvbi5wcm9jZXNzaW5nU3RhcnRlZEF0LmdldFRpbWUoKVxuICAgICAgICAgIHN0YXRzLmF2ZXJhZ2VQcm9jZXNzaW5nVGltZSArPSBwcm9jZXNzaW5nVGltZVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyDorqHnrpflubPlnYfph43or5XmrKHmlbBcbiAgICAgICAgc3RhdHMuYXZlcmFnZVJldHJ5Q291bnQgKz0gb3BlcmF0aW9uLnJldHJ5Q291bnRcbiAgICAgIH1cblxuICAgICAgLy8g6K6h566X6KGN55Sf57uf6K6hXG4gICAgICBzdGF0cy5wZW5kaW5nT3BlcmF0aW9ucyA9IHN0YXRzLmJ5U3RhdHVzLnBlbmRpbmdcbiAgICAgIHN0YXRzLnByb2Nlc3NpbmdPcGVyYXRpb25zID0gc3RhdHMuYnlTdGF0dXMucHJvY2Vzc2luZ1xuICAgICAgc3RhdHMuZmFpbGVkT3BlcmF0aW9ucyA9IHN0YXRzLmJ5U3RhdHVzLmZhaWxlZFxuICAgICAgc3RhdHMuY29tcGxldGVkT3BlcmF0aW9ucyA9IHN0YXRzLmJ5U3RhdHVzLmNvbXBsZXRlZFxuICAgICAgXG4gICAgICAvLyDorqHnrpflubPlnYflpITnkIbml7bpl7RcbiAgICAgIGNvbnN0IGNvbXBsZXRlZENvdW50ID0gc3RhdHMuYnlTdGF0dXMuY29tcGxldGVkXG4gICAgICBpZiAoY29tcGxldGVkQ291bnQgPiAwKSB7XG4gICAgICAgIHN0YXRzLmF2ZXJhZ2VQcm9jZXNzaW5nVGltZSAvPSBjb21wbGV0ZWRDb3VudFxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDorqHnrpflubPlnYfph43or5XmrKHmlbBcbiAgICAgIGlmIChhbGxPcGVyYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc3RhdHMuYXZlcmFnZVJldHJ5Q291bnQgLz0gYWxsT3BlcmF0aW9ucy5sZW5ndGhcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8g6K6h566X5aSx6LSl546HXG4gICAgICBjb25zdCB0b3RhbFdpdGhTdGF0dXMgPSBhbGxPcGVyYXRpb25zLmZpbHRlcihvcCA9PiBcbiAgICAgICAgWydjb21wbGV0ZWQnLCAnZmFpbGVkJ10uaW5jbHVkZXMob3Auc3RhdHVzKVxuICAgICAgKS5sZW5ndGhcbiAgICAgIGlmICh0b3RhbFdpdGhTdGF0dXMgPiAwKSB7XG4gICAgICAgIHN0YXRzLmZhaWx1cmVSYXRlID0gc3RhdHMuZmFpbGVkT3BlcmF0aW9ucyAvIHRvdGFsV2l0aFN0YXR1c1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDorqHnrpfmnIDogIHnmoTlvoXlpITnkIbmk43kvZzlubTpvoRcbiAgICAgIGNvbnN0IHBlbmRpbmdPcGVyYXRpb25zID0gYWxsT3BlcmF0aW9ucy5maWx0ZXIob3AgPT4gb3Auc3RhdHVzID09PSAncGVuZGluZycpXG4gICAgICBpZiAocGVuZGluZ09wZXJhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBvbGRlc3QgPSBwZW5kaW5nT3BlcmF0aW9ucy5yZWR1Y2UoKG9sZGVzdCwgY3VycmVudCkgPT4gXG4gICAgICAgICAgY3VycmVudC50aW1lc3RhbXAgPCBvbGRlc3QudGltZXN0YW1wID8gY3VycmVudCA6IG9sZGVzdFxuICAgICAgICApXG4gICAgICAgIHN0YXRzLm9sZGVzdFBlbmRpbmdBZ2UgPSBEYXRlLm5vdygpIC0gb2xkZXN0LnRpbWVzdGFtcC5nZXRUaW1lKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHN0YXRzXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgcXVldWUgc3RhdHM6JywgZXJyb3IpXG4gICAgICByZXR1cm4gdGhpcy5nZXRFbXB0eVN0YXRzKClcbiAgICB9XG4gIH1cblxuICAvLyDojrflj5bnqbrnu5/orqHkv6Hmga9cbiAgcHJpdmF0ZSBnZXRFbXB0eVN0YXRzKCk6IFF1ZXVlU3RhdHMge1xuICAgIHJldHVybiB7XG4gICAgICB0b3RhbE9wZXJhdGlvbnM6IDAsXG4gICAgICBwZW5kaW5nT3BlcmF0aW9uczogMCxcbiAgICAgIHByb2Nlc3NpbmdPcGVyYXRpb25zOiAwLFxuICAgICAgZmFpbGVkT3BlcmF0aW9uczogMCxcbiAgICAgIGNvbXBsZXRlZE9wZXJhdGlvbnM6IDAsXG4gICAgICBieVR5cGU6IHsgY2FyZDogMCwgZm9sZGVyOiAwLCB0YWc6IDAsIGltYWdlOiAwIH0sXG4gICAgICBieVByaW9yaXR5OiB7IGNyaXRpY2FsOiAwLCBoaWdoOiAwLCBub3JtYWw6IDAsIGxvdzogMCB9LFxuICAgICAgYnlTdGF0dXM6IHsgcGVuZGluZzogMCwgcHJvY2Vzc2luZzogMCwgY29tcGxldGVkOiAwLCBmYWlsZWQ6IDAsIGNhbmNlbGxlZDogMCB9LFxuICAgICAgYXZlcmFnZVByb2Nlc3NpbmdUaW1lOiAwLFxuICAgICAgZmFpbHVyZVJhdGU6IDAsXG4gICAgICBvbGRlc3RQZW5kaW5nQWdlOiAwLFxuICAgICAgYXZlcmFnZVJldHJ5Q291bnQ6IDBcbiAgICB9XG4gIH1cblxuICAvLyDmm7TmlrDpmJ/liJfnu5/orqHkv6Hmga/lubbpgJrnn6Xnm5HlkKzlmahcbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVRdWV1ZVN0YXRzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHRoaXMuZ2V0UXVldWVTdGF0cygpXG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygncXVldWVTdGF0c0NoYW5nZWQnLCBzdGF0cylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBxdWV1ZSBzdGF0czonLCBlcnJvcilcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIOS6i+S7tuebkeWQrOWZqOeuoeeQhlxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLy8g5re75Yqg5LqL5Lu255uR5ZCs5ZmoXG4gIGFkZEV2ZW50TGlzdGVuZXI8SyBleHRlbmRzIGtleW9mIHR5cGVvZiB0aGlzLmxpc3RlbmVycz4oXG4gICAgZXZlbnQ6IEssXG4gICAgY2FsbGJhY2s6IE5vbk51bGxhYmxlPHR5cGVvZiB0aGlzLmxpc3RlbmVyc1tLXT5cbiAgKTogdm9pZCB7XG4gICAgdGhpcy5saXN0ZW5lcnNbZXZlbnRdID0gY2FsbGJhY2sgYXMgYW55XG4gIH1cblxuICAvLyDnp7vpmaTkuovku7bnm5HlkKzlmahcbiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjxLIGV4dGVuZHMga2V5b2YgdHlwZW9mIHRoaXMubGlzdGVuZXJzPihcbiAgICBldmVudDogS1xuICApOiB2b2lkIHtcbiAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNbZXZlbnRdXG4gIH1cblxuICAvLyDpgJrnn6Xnm5HlkKzlmahcbiAgcHJpdmF0ZSBub3RpZnlMaXN0ZW5lcnM8SyBleHRlbmRzIGtleW9mIHR5cGVvZiB0aGlzLmxpc3RlbmVycz4oXG4gICAgZXZlbnQ6IEssXG4gICAgLi4uYXJnczogYW55W11cbiAgKTogdm9pZCB7XG4gICAgY29uc3QgbGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyc1tldmVudF1cbiAgICBpZiAobGlzdGVuZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIChsaXN0ZW5lciBhcyBGdW5jdGlvbikoLi4uYXJncylcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGluICR7ZXZlbnR9IGxpc3RlbmVyOmAsIGVycm9yKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g5L6/5Yip5pa55rOVXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvLyDmuIXnqbrpmJ/liJdcbiAgYXN5bmMgY2xlYXJRdWV1ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZGIuc3luY1F1ZXVlLmNsZWFyKClcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlUXVldWVTdGF0cygpXG4gICAgICBjb25zb2xlLmxvZygnUXVldWUgY2xlYXJlZCBzdWNjZXNzZnVsbHknKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYXIgcXVldWU6JywgZXJyb3IpXG4gICAgfVxuICB9XG5cbiAgLy8g6I635Y+W5pON5L2c6K+m5oOFXG4gIGFzeW5jIGdldE9wZXJhdGlvbihpZDogc3RyaW5nKTogUHJvbWlzZTxMb2NhbFN5bmNPcGVyYXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGRiLnN5bmNRdWV1ZS5nZXQoaWQpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBnZXQgb3BlcmF0aW9uICR7aWR9OmAsIGVycm9yKVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cbiAgfVxuXG4gIC8vIOWIoOmZpOaTjeS9nFxuICBhc3luYyByZW1vdmVPcGVyYXRpb24oaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5zeW5jUXVldWUuZGVsZXRlKGlkKVxuICAgICAgYXdhaXQgdGhpcy51cGRhdGVRdWV1ZVN0YXRzKClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHJlbW92ZSBvcGVyYXRpb24gJHtpZH06YCwgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8vIOmHjeivleWksei0peeahOaTjeS9nFxuICBhc3luYyByZXRyeUZhaWxlZE9wZXJhdGlvbnMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmFpbGVkT3BlcmF0aW9ucyA9IGF3YWl0IGRiLnN5bmNRdWV1ZVxuICAgICAgICAud2hlcmUoJ3N0YXR1cycpXG4gICAgICAgIC5lcXVhbHMoJ2ZhaWxlZCcpXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2YgZmFpbGVkT3BlcmF0aW9ucykge1xuICAgICAgICBhd2FpdCBkYi5zeW5jUXVldWUudXBkYXRlKG9wZXJhdGlvbi5pZCEsIHtcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgICByZXRyeUNvdW50OiAwLFxuICAgICAgICAgIHJldHJ5RGVsYXk6IHRoaXMuY29uZmlnLmluaXRpYWxSZXRyeURlbGF5LFxuICAgICAgICAgIGxhc3RFcnJvcjogdW5kZWZpbmVkXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlUXVldWVTdGF0cygpXG4gICAgICBjb25zb2xlLmxvZyhgUmV0cmllZCAke2ZhaWxlZE9wZXJhdGlvbnMubGVuZ3RofSBmYWlsZWQgb3BlcmF0aW9uc2ApXG4gICAgICByZXR1cm4gZmFpbGVkT3BlcmF0aW9ucy5sZW5ndGhcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHJldHJ5IGZhaWxlZCBvcGVyYXRpb25zOicsIGVycm9yKVxuICAgICAgcmV0dXJuIDBcbiAgICB9XG4gIH1cblxuICAvLyDmuIXnkIblt7LlrozmiJDnmoTmk43kvZxcbiAgYXN5bmMgY2xlYXJDb21wbGV0ZWRPcGVyYXRpb25zKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbXBsZXRlZE9wZXJhdGlvbnMgPSBhd2FpdCBkYi5zeW5jUXVldWVcbiAgICAgICAgLndoZXJlKCdzdGF0dXMnKVxuICAgICAgICAuZXF1YWxzKCdjb21wbGV0ZWQnKVxuICAgICAgICAudG9BcnJheSgpXG4gICAgICBcbiAgICAgIC8vIOS/neeVmeacgOi/keWujOaIkOeahOaTjeS9nOeUqOS6juWOhuWPsuiusOW9lVxuICAgICAgY29uc3Qga2VlcFJlY2VudENvdW50ID0gMTAwXG4gICAgICBjb25zdCBvcGVyYXRpb25zVG9EZWxldGUgPSBjb21wbGV0ZWRPcGVyYXRpb25zLnNsaWNlKDAsIC1rZWVwUmVjZW50Q291bnQpXG4gICAgICBcbiAgICAgIGZvciAoY29uc3Qgb3BlcmF0aW9uIG9mIG9wZXJhdGlvbnNUb0RlbGV0ZSkge1xuICAgICAgICBhd2FpdCBkYi5zeW5jUXVldWUuZGVsZXRlKG9wZXJhdGlvbi5pZCEpXG4gICAgICB9XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlUXVldWVTdGF0cygpXG4gICAgICBjb25zb2xlLmxvZyhgQ2xlYXJlZCAke29wZXJhdGlvbnNUb0RlbGV0ZS5sZW5ndGh9IGNvbXBsZXRlZCBvcGVyYXRpb25zLCBrZXB0ICR7Y29tcGxldGVkT3BlcmF0aW9ucy5sZW5ndGggLSBvcGVyYXRpb25zVG9EZWxldGUubGVuZ3RofSByZWNlbnQgb25lc2ApXG4gICAgICByZXR1cm4gb3BlcmF0aW9uc1RvRGVsZXRlLmxlbmd0aFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYXIgY29tcGxldGVkIG9wZXJhdGlvbnM6JywgZXJyb3IpXG4gICAgICByZXR1cm4gMFxuICAgIH1cbiAgfVxuXG4gIC8vIOabtOaWsOmFjee9rlxuICB1cGRhdGVDb25maWcobmV3Q29uZmlnOiBQYXJ0aWFsPFF1ZXVlQ29uZmlnPik6IHZvaWQge1xuICAgIC8vIOmqjOivgemFjee9ruWPguaVsFxuICAgIGlmIChuZXdDb25maWcubWF4UmV0cmllcyAhPT0gdW5kZWZpbmVkICYmIG5ld0NvbmZpZy5tYXhSZXRyaWVzIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXhSZXRyaWVzIG11c3QgYmUgbm9uLW5lZ2F0aXZlJylcbiAgICB9XG4gICAgaWYgKG5ld0NvbmZpZy5iYXRjaFNpemUgIT09IHVuZGVmaW5lZCAmJiBuZXdDb25maWcuYmF0Y2hTaXplIDw9IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignYmF0Y2hTaXplIG11c3QgYmUgcG9zaXRpdmUnKVxuICAgIH1cbiAgICBpZiAobmV3Q29uZmlnLm1heFF1ZXVlU2l6ZSAhPT0gdW5kZWZpbmVkICYmIG5ld0NvbmZpZy5tYXhRdWV1ZVNpemUgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ21heFF1ZXVlU2l6ZSBtdXN0IGJlIG5vbi1uZWdhdGl2ZScpXG4gICAgfVxuICAgIGlmIChuZXdDb25maWcucHJvY2Vzc2luZ1RpbWVvdXQgIT09IHVuZGVmaW5lZCAmJiBuZXdDb25maWcucHJvY2Vzc2luZ1RpbWVvdXQgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzaW5nVGltZW91dCBtdXN0IGJlIHBvc2l0aXZlJylcbiAgICB9XG4gICAgaWYgKG5ld0NvbmZpZy5pZGxlQ2hlY2tJbnRlcnZhbCAhPT0gdW5kZWZpbmVkICYmIG5ld0NvbmZpZy5pZGxlQ2hlY2tJbnRlcnZhbCA8PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lkbGVDaGVja0ludGVydmFsIG11c3QgYmUgcG9zaXRpdmUnKVxuICAgIH1cbiAgICBcbiAgICAvLyDmm7TmlrDphY3nva5cbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4udGhpcy5jb25maWcsIC4uLm5ld0NvbmZpZyB9XG4gICAgXG4gICAgLy8g5aaC5p6c5a6a5pe25Zmo6Ze06ZqU5pS55Y+Y77yM6YeN5paw5ZCv5Yqo5a6a5pe25ZmoXG4gICAgaWYgKG5ld0NvbmZpZy5pZGxlQ2hlY2tJbnRlcnZhbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnN0YXJ0UHJvY2Vzc2luZygpXG4gICAgfVxuICAgIGlmIChuZXdDb25maWcuY2xlYW51cEludGVydmFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuc3RhcnRDbGVhbnVwKClcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0xvY2FsT3BlcmF0aW9uU2VydmljZSBjb25maWcgdXBkYXRlZCcpXG4gIH1cblxuICAvLyDplIDmr4HmnI3liqFcbiAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wcm9jZXNzaW5nVGltZXIpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wcm9jZXNzaW5nVGltZXIpXG4gICAgfVxuICAgIFxuICAgIGlmICh0aGlzLmNsZWFudXBUaW1lcikge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBUaW1lcilcbiAgICB9XG4gICAgXG4gICAgLy8g562J5b6F5b2T5YmN5om55qyh5a6M5oiQXG4gICAgUHJvbWlzZS5hbGwodGhpcy5jdXJyZW50QmF0Y2hlcy52YWx1ZXMoKSkudGhlbigoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnTG9jYWxPcGVyYXRpb25TZXJ2aWNlIGRlc3Ryb3llZCcpXG4gICAgfSlcbiAgfVxufVxuXG4vLyDlr7zlh7rljZXkvovlrp7kvotcbmV4cG9ydCBjb25zdCBsb2NhbE9wZXJhdGlvblNlcnZpY2UgPSBuZXcgTG9jYWxPcGVyYXRpb25TZXJ2aWNlKClcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g5a+85Ye65bel5YW35Ye95pWwXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIOWIm+W7uuWNoeeJh+aTjeS9nFxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNhcmRPcGVyYXRpb24gPSAoXG4gIG9wZXJhdGlvblR5cGU6ICdjcmVhdGUnIHwgJ3VwZGF0ZScgfCAnZGVsZXRlJyxcbiAgY2FyZERhdGE6IERiQ2FyZCxcbiAgdXNlcklkPzogc3RyaW5nLFxuICBwcmV2aW91c0RhdGE/OiBEYkNhcmRcbik6IE9taXQ8TG9jYWxTeW5jT3BlcmF0aW9uLCAnaWQnIHwgJ3RpbWVzdGFtcCcgfCAncmV0cnlDb3VudCcgfCAnc3RhdHVzJyB8ICdsb2NhbFZlcnNpb24nPiA9PiB7XG4gIHJldHVybiB7XG4gICAgZW50aXR5VHlwZTogJ2NhcmQnLFxuICAgIG9wZXJhdGlvblR5cGUsXG4gICAgZW50aXR5SWQ6IGNhcmREYXRhLmlkISxcbiAgICBkYXRhOiBjYXJkRGF0YSxcbiAgICBwcmV2aW91c0RhdGEsXG4gICAgdXNlcklkLFxuICAgIHByaW9yaXR5OiBvcGVyYXRpb25UeXBlID09PSAnZGVsZXRlJyA/ICdoaWdoJyA6ICdub3JtYWwnLFxuICAgIG1heFJldHJpZXM6IDVcbiAgfVxufVxuXG4vLyDliJvlu7rmlofku7blpLnmk43kvZxcbmV4cG9ydCBjb25zdCBjcmVhdGVGb2xkZXJPcGVyYXRpb24gPSAoXG4gIG9wZXJhdGlvblR5cGU6ICdjcmVhdGUnIHwgJ3VwZGF0ZScgfCAnZGVsZXRlJyxcbiAgZm9sZGVyRGF0YTogRGJGb2xkZXIsXG4gIHVzZXJJZD86IHN0cmluZyxcbiAgcHJldmlvdXNEYXRhPzogRGJGb2xkZXJcbik6IE9taXQ8TG9jYWxTeW5jT3BlcmF0aW9uLCAnaWQnIHwgJ3RpbWVzdGFtcCcgfCAncmV0cnlDb3VudCcgfCAnc3RhdHVzJyB8ICdsb2NhbFZlcnNpb24nPiA9PiB7XG4gIHJldHVybiB7XG4gICAgZW50aXR5VHlwZTogJ2ZvbGRlcicsXG4gICAgb3BlcmF0aW9uVHlwZSxcbiAgICBlbnRpdHlJZDogZm9sZGVyRGF0YS5pZCEsXG4gICAgZGF0YTogZm9sZGVyRGF0YSxcbiAgICBwcmV2aW91c0RhdGEsXG4gICAgdXNlcklkLFxuICAgIHByaW9yaXR5OiBvcGVyYXRpb25UeXBlID09PSAnZGVsZXRlJyA/ICdoaWdoJyA6ICdub3JtYWwnLFxuICAgIG1heFJldHJpZXM6IDVcbiAgfVxufVxuXG4vLyDliJvlu7rmoIfnrb7mk43kvZxcbmV4cG9ydCBjb25zdCBjcmVhdGVUYWdPcGVyYXRpb24gPSAoXG4gIG9wZXJhdGlvblR5cGU6ICdjcmVhdGUnIHwgJ3VwZGF0ZScgfCAnZGVsZXRlJyxcbiAgdGFnRGF0YTogRGJUYWcsXG4gIHVzZXJJZD86IHN0cmluZyxcbiAgcHJldmlvdXNEYXRhPzogRGJUYWdcbik6IE9taXQ8TG9jYWxTeW5jT3BlcmF0aW9uLCAnaWQnIHwgJ3RpbWVzdGFtcCcgfCAncmV0cnlDb3VudCcgfCAnc3RhdHVzJyB8ICdsb2NhbFZlcnNpb24nPiA9PiB7XG4gIHJldHVybiB7XG4gICAgZW50aXR5VHlwZTogJ3RhZycsXG4gICAgb3BlcmF0aW9uVHlwZSxcbiAgICBlbnRpdHlJZDogdGFnRGF0YS5pZCEsXG4gICAgZGF0YTogdGFnRGF0YSxcbiAgICBwcmV2aW91c0RhdGEsXG4gICAgdXNlcklkLFxuICAgIHByaW9yaXR5OiAnbm9ybWFsJyxcbiAgICBtYXhSZXRyaWVzOiAzXG4gIH1cbn1cblxuLy8g5Yib5bu65Zu+54mH5pON5L2cXG5leHBvcnQgY29uc3QgY3JlYXRlSW1hZ2VPcGVyYXRpb24gPSAoXG4gIG9wZXJhdGlvblR5cGU6ICdjcmVhdGUnIHwgJ3VwZGF0ZScgfCAnZGVsZXRlJyxcbiAgaW1hZ2VEYXRhOiBEYkltYWdlLFxuICB1c2VySWQ/OiBzdHJpbmcsXG4gIHByZXZpb3VzRGF0YT86IERiSW1hZ2Vcbik6IE9taXQ8TG9jYWxTeW5jT3BlcmF0aW9uLCAnaWQnIHwgJ3RpbWVzdGFtcCcgfCAncmV0cnlDb3VudCcgfCAnc3RhdHVzJyB8ICdsb2NhbFZlcnNpb24nPiA9PiB7XG4gIHJldHVybiB7XG4gICAgZW50aXR5VHlwZTogJ2ltYWdlJyxcbiAgICBvcGVyYXRpb25UeXBlLFxuICAgIGVudGl0eUlkOiBpbWFnZURhdGEuaWQhLFxuICAgIGRhdGE6IGltYWdlRGF0YSxcbiAgICBwcmV2aW91c0RhdGEsXG4gICAgdXNlcklkLFxuICAgIHByaW9yaXR5OiBvcGVyYXRpb25UeXBlID09PSAnZGVsZXRlJyA/ICdoaWdoJyA6ICdsb3cnLFxuICAgIG1heFJldHJpZXM6IDNcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==