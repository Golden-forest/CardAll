# CardEverything æ•°æ®å­˜å‚¨æ¶æ„æ·±åº¦åˆ†ææŠ¥å‘Š

**ä»»åŠ¡**: W1-T002 æ•°æ®å­˜å‚¨æ¶æ„å’Œä¾èµ–å…³ç³»åˆ†æ
**æ‰§è¡Œè€…**: Database-Architect
**æ—¥æœŸ**: 2025-01-13
**ç‰ˆæœ¬**: v1.0

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šå¯¹CardEverythingé¡¹ç›®çš„æ•°æ®å­˜å‚¨æ¶æ„è¿›è¡Œäº†å…¨é¢åˆ†æï¼Œæ¶µç›–äº†IndexedDBæœ¬åœ°å­˜å‚¨ã€Supabaseäº‘ç«¯å­˜å‚¨ã€æœ¬åœ°ç¼“å­˜æœºåˆ¶ä»¥åŠä¸‰è€…ä¹‹é—´çš„æ•°æ®åŒæ­¥æµç¨‹ã€‚åˆ†æå‘ç°è¯¥é¡¹ç›®é‡‡ç”¨äº†éå¸¸å…ˆè¿›å’Œå¤æ‚çš„å¤šå±‚å­˜å‚¨æ¶æ„ï¼Œå…·å¤‡ä¼ä¸šçº§çš„æ•°æ®ç®¡ç†èƒ½åŠ›ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›æ¶æ„å¤æ‚æ€§å’Œæ€§èƒ½ä¼˜åŒ–ç©ºé—´ã€‚

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„æ¦‚è§ˆ

### ä¸‰å±‚å­˜å‚¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CardEverything æ•°æ®å­˜å‚¨æ¶æ„                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   IndexedDB     â”‚    â”‚   Advanced      â”‚    â”‚   Supabase      â”‚ â”‚
â”‚  â”‚   æœ¬åœ°æ•°æ®åº“     â”‚â—„â”€â”€â–ºâ”‚   Cache System  â”‚â—„â”€â”€â–ºâ”‚   äº‘ç«¯æ•°æ®åº“     â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚ â”‚
â”‚  â”‚ â€¢ ç»Ÿä¸€æ•°æ®åº“æ¶æ„  â”‚    â”‚ â€¢ å¤šç­–ç•¥ç¼“å­˜     â”‚    â”‚ â€¢ PostgreSQL     â”‚ â”‚
â”‚  â”‚ â€¢ ç‰ˆæœ¬ç®¡ç†æ”¯æŒ   â”‚    â”‚ â€¢ æ•°æ®å‹ç¼©       â”‚    â”‚ â€¢ å®æ—¶åŒæ­¥       â”‚ â”‚
â”‚  â”‚ â€¢ ç¦»çº¿å¿«ç…§       â”‚    â”‚ â€¢ é¢„æµ‹é¢„çƒ­       â”‚    â”‚ â€¢ å†²çªè§£å†³       â”‚ â”‚
â”‚  â”‚ â€¢ è‡ªåŠ¨å¤‡ä»½       â”‚    â”‚ â€¢ å†…å­˜ç®¡ç†       â”‚    â”‚ â€¢ æ•°æ®å®‰å…¨       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                ç»Ÿä¸€åŒæ­¥æœåŠ¡å±‚                            â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ â€¢ åŒæ­¥é˜Ÿåˆ—ç®¡ç†  â€¢ æ™ºèƒ½æ‰¹å¤„ç†  â€¢ å†²çªé¢„æµ‹å’Œè§£å†³           â”‚ â”‚
â”‚  â”‚ â€¢ ç½‘ç»œçŠ¶æ€æ£€æµ‹  â€¢ ç¦»çº¿æ“ä½œç®¡ç†  â€¢ æ€§èƒ½ç›‘æ§               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ IndexedDB æœ¬åœ°æ•°æ®åº“åˆ†æ

### æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹

#### 1. ç»Ÿä¸€æ•°æ®åº“è®¾è®¡ (database-unified.ts)
- **æ•°æ®åº“ç‰ˆæœ¬**: v4.0
- **ORMæ¡†æ¶**: Dexie.js
- **æ¶æ„æ¨¡å¼**: ç»Ÿä¸€æ•°æ®è®¿é—®å±‚

#### 2. æ•°æ®è¡¨ç»“æ„

```typescript
// æ ¸å¿ƒæ•°æ®è¡¨
tables: {
  cards: DbCard[]           // å¡ç‰‡æ•°æ®
  folders: DbFolder[]       // æ–‡ä»¶å¤¹æ•°æ®
  tags: DbTag[]            // æ ‡ç­¾æ•°æ®
  images: DbImage[]         // å›¾ç‰‡æ•°æ®
  syncQueue: SyncOperation[] // åŒæ­¥é˜Ÿåˆ—
  offlineSnapshots: OfflineSnapshot[] // ç¦»çº¿å¿«ç…§
  settings: AppSettings[]   // åº”ç”¨è®¾ç½®
}
```

#### 3. ç´¢å¼•ä¼˜åŒ–ç­–ç•¥

```typescript
// æ™ºèƒ½ç´¢å¼•é…ç½®
indexes: {
  cards: [
    'userId',                    // ç”¨æˆ·åˆ†åŒº
    'folderId',                  // æ–‡ä»¶å¤¹æŸ¥è¯¢
    'createdAt',                 // æ—¶é—´æ’åº
    'updatedAt',                 // æ›´æ–°è¿½è¸ª
    '[userId+folderId]',         // å¤åˆç´¢å¼•
    'syncVersion'                // åŒæ­¥ç‰ˆæœ¬æ§åˆ¶
  ],
  syncQueue: [
    'status',                    // é˜Ÿåˆ—çŠ¶æ€
    'priority',                  // ä¼˜å…ˆçº§æ’åº
    'timestamp',                 // æ—¶é—´é¡ºåº
    'entityType',               // å®ä½“ç±»å‹
    'retryCount'                // é‡è¯•æ¬¡æ•°
  ]
}
```

#### 4. é«˜çº§åŠŸèƒ½ç‰¹æ€§

**ç¦»çº¿æ•°æ®ç®¡ç†**:
- è‡ªåŠ¨å¿«ç…§åˆ›å»ºå’Œæ¢å¤
- å¢é‡æ•°æ®å¤‡ä»½
- æ•°æ®å‹ç¼©å’ŒåŠ å¯†
- æ™ºèƒ½æ¸…ç†ç­–ç•¥

**ç‰ˆæœ¬æ§åˆ¶å’Œè¿ç§»**:
- æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
- è‡ªåŠ¨è¿ç§»è„šæœ¬
- æ•°æ®å®Œæ•´æ€§éªŒè¯
- å›æ»šæœºåˆ¶

---

## â˜ï¸ Supabase äº‘ç«¯å­˜å‚¨åˆ†æ

### æ•°æ®æ¨¡å‹è®¾è®¡

#### 1. æ•°æ®åº“è¡¨ç»“æ„

```typescript
// PostgreSQL è¡¨å®šä¹‰
tables: {
  users: {                   // ç”¨æˆ·è¡¨
    id: string               // UUIDä¸»é”®
    github_id: string        // GitHubé›†æˆ
    email: string            // é‚®ç®±
    username: string         // ç”¨æˆ·å
    avatar_url: string       // å¤´åƒ
    created_at: timestamp    // åˆ›å»ºæ—¶é—´
    updated_at: timestamp    // æ›´æ–°æ—¶é—´
  },

  cards: {                   // å¡ç‰‡è¡¨
    id: string               // UUIDä¸»é”®
    user_id: string          // ç”¨æˆ·å¤–é”®
    front_content: JSONB     // æ­£é¢å†…å®¹
    back_content: JSONB      // èƒŒé¢å†…å®¹
    style: JSONB             // æ ·å¼ä¿¡æ¯
    folder_id: string?        // æ–‡ä»¶å¤¹å¤–é”®
    created_at: timestamp    // åˆ›å»ºæ—¶é—´
    updated_at: timestamp    // æ›´æ–°æ—¶é—´
    sync_version: integer     // åŒæ­¥ç‰ˆæœ¬
    is_deleted: boolean      // è½¯åˆ é™¤æ ‡è®°
  },

  folders: {                 // æ–‡ä»¶å¤¹è¡¨
    id: string               // UUIDä¸»é”®
    user_id: string          // ç”¨æˆ·å¤–é”®
    name: string             // æ–‡ä»¶å¤¹åç§°
    parent_id: string?       // çˆ¶æ–‡ä»¶å¤¹ID
    created_at: timestamp    // åˆ›å»ºæ—¶é—´
    updated_at: timestamp    // æ›´æ–°æ—¶é—´
    sync_version: integer     // åŒæ­¥ç‰ˆæœ¬
    is_deleted: boolean      // è½¯åˆ é™¤æ ‡è®°
  },

  tags: {                    // æ ‡ç­¾è¡¨
    id: string               // UUIDä¸»é”®
    user_id: string          // ç”¨æˆ·å¤–é”®
    name: string             // æ ‡ç­¾åç§°
    color: string             // æ ‡ç­¾é¢œè‰²
    created_at: timestamp    // åˆ›å»ºæ—¶é—´
    updated_at: timestamp    // æ›´æ–°æ—¶é—´
    sync_version: integer     // åŒæ­¥ç‰ˆæœ¬
    is_deleted: boolean      // è½¯åˆ é™¤æ ‡è®°
  },

  images: {                  // å›¾ç‰‡è¡¨
    id: string               // UUIDä¸»é”®
    user_id: string          // ç”¨æˆ·å¤–é”®
    card_id: string          // å…³è”å¡ç‰‡
    file_name: string        // æ–‡ä»¶å
    file_path: string        // æ–‡ä»¶è·¯å¾„
    cloud_url: string?       // äº‘ç«¯URL
    metadata: JSONB          // å…ƒæ•°æ®
    created_at: timestamp    // åˆ›å»ºæ—¶é—´
    updated_at: timestamp    // æ›´æ–°æ—¶é—´
    sync_version: integer     // åŒæ­¥ç‰ˆæœ¬
    is_deleted: boolean      // è½¯åˆ é™¤æ ‡è®°
  }
}
```

#### 2. å®æ—¶åŒæ­¥æ¶æ„

**Supabase Realtimeé›†æˆ**:
- PostgreSQLå˜æ›´æ•°æ®æ•è·(CDC)
- å®æ—¶äº‹ä»¶ç›‘å¬å’Œæ‰¹å¤„ç†
- æ™ºèƒ½é‡è¿æœºåˆ¶
- ç½‘ç»œçŠ¶æ€è‡ªé€‚åº”

**å†²çªè§£å†³ç­–ç•¥**:
```typescript
// æ™ºèƒ½å†²çªè§£å†³
conflictResolution: {
  version_mismatch: 'local_wins|cloud_wins|merge',
  simultaneous_edit: 'merge|timestamp_based',
  delete_conflict: 'preserve_deleted|restore'
}
```

---

## ğŸš€ é«˜çº§ç¼“å­˜ç³»ç»Ÿåˆ†æ

### å¤šå±‚ç¼“å­˜æ¶æ„

#### 1. ç¼“å­˜ç­–ç•¥ (advanced-cache.ts)

```typescript
// æ™ºèƒ½ç¼“å­˜ç­–ç•¥
cacheStrategies: {
  LRU: LeastRecentlyUsed,      // æœ€è¿‘æœ€å°‘ä½¿ç”¨
  LFU: LeastFrequentlyUsed,     // æœ€å°‘ä½¿ç”¨é¢‘ç‡
  FIFO: FirstInFirstOut,       // å…ˆè¿›å…ˆå‡º
  TTL: TimeToLive,             // ç”Ÿå­˜æ—¶é—´
  Adaptive: AdaptiveStrategy   // è‡ªé€‚åº”ç­–ç•¥
}
```

#### 2. ç¼“å­˜ä¼˜åŒ–ç‰¹æ€§

**æ•°æ®å‹ç¼©**: LZStringå‹ç¼©ç®—æ³•ï¼Œå‡å°‘å†…å­˜å ç”¨
**æŒä¹…åŒ–å­˜å‚¨**: æœ¬åœ°å­˜å‚¨å¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
**é¢„æµ‹é¢„çƒ­**: åŸºäºä½¿ç”¨æ¨¡å¼çš„æ™ºèƒ½é¢„çƒ­
**å†…å­˜ç®¡ç†**: è‡ªåŠ¨æ¸…ç†å’Œåƒåœ¾å›æ”¶

**æ€§èƒ½æŒ‡æ ‡ç›‘æ§**:
```typescript
cacheMetrics: {
  hitRate: number,            // å‘½ä¸­ç‡
  missRate: number,           // æœªå‘½ä¸­ç‡
  averageAccessTime: number,   // å¹³å‡è®¿é—®æ—¶é—´
  memoryUsage: number,        // å†…å­˜ä½¿ç”¨é‡
  evictionCount: number       // é©±é€æ¬¡æ•°
}
```

---

## ğŸ”„ æ•°æ®åŒæ­¥æœºåˆ¶åˆ†æ

### ç»Ÿä¸€åŒæ­¥æœåŠ¡æ¶æ„

#### 1. åŒæ­¥é˜Ÿåˆ—ç®¡ç† (sync-queue.ts)

**æ ¸å¿ƒç‰¹æ€§**:
- æ™ºèƒ½ä¼˜å…ˆçº§é˜Ÿåˆ—
- æ‰¹é‡æ“ä½œä¼˜åŒ–
- å†²çªé¢„æµ‹å’Œè§£å†³
- ç½‘ç»œè‡ªé€‚åº”é‡è¯•

**é˜Ÿåˆ—æ“ä½œç±»å‹**:
```typescript
syncOperations: {
  create: 'åˆ›å»ºæ–°å®ä½“',
  update: 'æ›´æ–°ç°æœ‰å®ä½“',
  delete: 'åˆ é™¤å®ä½“',
  batch: 'æ‰¹é‡æ“ä½œ'
}
```

#### 2. æœ¬åœ°æ“ä½œæœåŠ¡ (local-operation.ts)

**ç¦»çº¿æ“ä½œç®¡ç†**:
- æœ¬åœ°æ“ä½œé˜Ÿåˆ—
- ç½‘ç»œçŠ¶æ€æ„ŸçŸ¥
- æ“ä½œä¾èµ–ç®¡ç†
- è‡ªåŠ¨é‡è¯•æœºåˆ¶

**æ‰¹å¤„ç†ä¼˜åŒ–**:
```typescript
batchProcessing: {
  maxSize: 10,               // æœ€å¤§æ‰¹æ¬¡å¤§å°
  timeout: 5000,             // æ‰¹å¤„ç†è¶…æ—¶
  maxConcurrent: 3,          // æœ€å¤§å¹¶å‘æ•°
  networkAware: true         // ç½‘ç»œæ„ŸçŸ¥
}
```

#### 3. ç»Ÿä¸€åŒæ­¥åè°ƒå™¨ (unified-sync-service.ts)

**æ•°æ®æµå‘æ§åˆ¶**:
```
ç”¨æˆ·æ“ä½œ â†’ æœ¬åœ°é˜Ÿåˆ— â†’ IndexedDB â†’ ç¼“å­˜ç³»ç»Ÿ â†’ Supabase
    â†‘                                          â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç¦»çº¿æ“ä½œ â† å®æ—¶åŒæ­¥ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŒæ­¥ç­–ç•¥**:
- **å®Œæ•´åŒæ­¥**: å…¨é‡æ•°æ®åŒæ­¥
- **å¢é‡åŒæ­¥**: ä»…åŒæ­¥å˜æ›´
- **æ™ºèƒ½åŒæ­¥**: åŸºäºç½‘ç»œè´¨é‡çš„è‡ªé€‚åº”åŒæ­¥

---

## âš ï¸ æ¶æ„é—®é¢˜å’Œä¼˜åŒ–å»ºè®®

### å½“å‰æ¶æ„ä¼˜åŠ¿

#### 1. æŠ€æœ¯ä¼˜åŠ¿ âœ…
- **ä¼ä¸šçº§æ¶æ„**: å®Œæ•´çš„å¤šå±‚å­˜å‚¨ä½“ç³»
- **é«˜å¯ç”¨æ€§**: ç¦»çº¿æ”¯æŒå’Œè‡ªåŠ¨æ¢å¤
- **æ•°æ®ä¸€è‡´æ€§**: ç‰ˆæœ¬æ§åˆ¶å’Œå†²çªè§£å†³
- **æ€§èƒ½ä¼˜åŒ–**: å¤šçº§ç¼“å­˜å’Œæ™ºèƒ½æ‰¹å¤„ç†
- **å®æ—¶åŒæ­¥**: ä½å»¶è¿Ÿçš„å®æ—¶æ•°æ®åŒæ­¥

#### 2. ç”¨æˆ·ä½“éªŒä¼˜åŠ¿ âœ…
- **ç¦»çº¿å¯ç”¨**: å®Œå…¨çš„ç¦»çº¿å·¥ä½œèƒ½åŠ›
- **æ•°æ®å®‰å…¨**: è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤
- **å¿«é€Ÿå“åº”**: æœ¬åœ°ç¼“å­˜ä¼˜åŒ–
- **æ— ç¼åŒæ­¥**: è‡ªåŠ¨åŒ–çš„æ•°æ®åŒæ­¥

### æ¶æ„å¤æ‚æ€§å’ŒæŒ‘æˆ˜

#### 1. å¤æ‚æ€§æŒ‘æˆ˜ âš ï¸
- **å¤šå±‚ä¾èµ–**: ä¸‰ä¸ªå­˜å‚¨å±‚ä¹‹é—´çš„å¤æ‚ä¾èµ–å…³ç³»
- **çŠ¶æ€ç®¡ç†**: å¤šä¸ªç³»ç»Ÿçš„çŠ¶æ€åŒæ­¥å¤æ‚
- **è°ƒè¯•å›°éš¾**: å¤šå±‚æ¶æ„å¢åŠ è°ƒè¯•éš¾åº¦
- **ç»´æŠ¤æˆæœ¬**: éœ€è¦ç»´æŠ¤å¤šä¸ªç‹¬ç«‹ç³»ç»Ÿ

#### 2. æ€§èƒ½ç“¶é¢ˆ âš ï¸

**è¯†åˆ«çš„æ€§èƒ½é—®é¢˜**:
1. **åŒæ­¥å»¶è¿Ÿ**: å¤šå±‚å­˜å‚¨å¢åŠ åŒæ­¥å»¶è¿Ÿ
2. **å†…å­˜å ç”¨**: å¤šä¸ªç¼“å­˜ç³»ç»Ÿå†…å­˜å¼€é”€
3. **ç½‘ç»œä¾èµ–**: è¿‡åº¦ä¾èµ–ç½‘ç»œè¿æ¥è´¨é‡
4. **å¹¶å‘å¤„ç†**: å¤§é‡å¹¶å‘æ“ä½œå¯èƒ½é˜»å¡

**å…·ä½“ç“¶é¢ˆ**:
```typescript
// æ€§èƒ½ç“¶é¢ˆåˆ†æ
performanceBottlenecks: {
  indexedDBOperations: 'å¤§é‡æ•°æ®æ“ä½œå¯èƒ½å¯¼è‡´UIé˜»å¡',
  syncQueueProcessing: 'é˜Ÿåˆ—å¤„ç†å¯èƒ½æˆä¸ºååé‡ç“¶é¢ˆ',
  cacheMemoryUsage: 'å¤šçº§ç¼“å­˜å¯èƒ½å¯¼è‡´å†…å­˜å‹åŠ›',
  networkReliability: 'ç½‘ç»œä¸ç¨³å®šå½±å“åŒæ­¥è´¨é‡'
}
```

### ä¼˜åŒ–å»ºè®®

#### 1. æ¶æ„ç®€åŒ–å»ºè®® ğŸ¯

**ç»Ÿä¸€å­˜å‚¨æŠ½è±¡å±‚**:
```typescript
// å»ºè®®çš„ç»Ÿä¸€å­˜å‚¨æ¥å£
interface UnifiedStorage {
  // ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
  get<T>(key: string): Promise<T>
  set<T>(key: string, value: T): Promise<void>
  delete(key: string): Promise<void>

  // ç»Ÿä¸€çš„åŒæ­¥æ¥å£
  sync(): Promise<SyncResult>
  getSyncStatus(): SyncStatus

  // ç»Ÿä¸€çš„ç¼“å­˜æ¥å£
  cache<T>(key: string, value: T, ttl?: number): Promise<void>
  getCached<T>(key: string): Promise<T | null>
}
```

#### 2. æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸš€

**æŸ¥è¯¢ä¼˜åŒ–**:
- å®ç°æ›´æ™ºèƒ½çš„ç´¢å¼•ç­–ç•¥
- ä¼˜åŒ–å¤§æ‰¹é‡æ•°æ®æ“ä½œ
- æ·»åŠ æŸ¥è¯¢ç»“æœç¼“å­˜
- å®ç°åˆ†é¡µå’Œæ‡’åŠ è½½

**å†…å­˜ä¼˜åŒ–**:
- å®ç°æ™ºèƒ½ç¼“å­˜æ¸…ç†ç­–ç•¥
- ä¼˜åŒ–æ•°æ®ç»“æ„å†…å­˜å ç”¨
- æ·»åŠ å†…å­˜ä½¿ç”¨ç›‘æ§
- å®ç°æ•°æ®å‹ç¼©

#### 3. ç›‘æ§å’Œè¯Šæ–­å»ºè®® ğŸ“Š

**æ€§èƒ½ç›‘æ§**:
```typescript
// å»ºè®®çš„ç›‘æ§æŒ‡æ ‡
monitoringMetrics: {
  database: {
    operationLatency: 'æ“ä½œå»¶è¿Ÿ',
    queueSize: 'é˜Ÿåˆ—å¤§å°',
    errorRate: 'é”™è¯¯ç‡',
    throughput: 'ååé‡'
  },
  cache: {
    hitRate: 'ç¼“å­˜å‘½ä¸­ç‡',
    memoryUsage: 'å†…å­˜ä½¿ç”¨',
    evictionRate: 'é©±é€ç‡'
  },
  sync: {
    syncTime: 'åŒæ­¥æ—¶é—´',
    conflictRate: 'å†²çªç‡',
    networkQuality: 'ç½‘ç»œè´¨é‡'
  }
}
```

---

## ğŸ”® æœªæ¥å‘å±•æ–¹å‘

### çŸ­æœŸä¼˜åŒ– (1-2ä¸ªæœˆ)

1. **æ€§èƒ½ä¼˜åŒ–**: å®ç°æŸ¥è¯¢ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†æ”¹è¿›
2. **ç›‘æ§å®Œå–„**: æ·»åŠ å…¨é¢çš„æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦
3. **æ–‡æ¡£å®Œå–„**: å®Œå–„æ¶æ„æ–‡æ¡£å’Œå¼€å‘æŒ‡å—

### ä¸­æœŸæ”¹è¿› (3-6ä¸ªæœˆ)

1. **æ¶æ„ç®€åŒ–**: é€æ­¥ç»Ÿä¸€å­˜å‚¨æŠ½è±¡å±‚
2. **æ™ºèƒ½ä¼˜åŒ–**: å®ç°AIé©±åŠ¨çš„ç¼“å­˜å’ŒåŒæ­¥ä¼˜åŒ–
3. **æ‰©å±•æ€§æå‡**: æ”¯æŒæ›´å¤§è§„æ¨¡çš„æ•°æ®é›†

### é•¿æœŸè§„åˆ’ (6ä¸ªæœˆä»¥ä¸Š)

1. **å¾®æœåŠ¡åŒ–**: è€ƒè™‘å­˜å‚¨æœåŠ¡çš„å¾®æœåŠ¡æ¶æ„
2. **å¤šäº‘æ”¯æŒ**: æ”¯æŒå¤šä¸ªäº‘å­˜å‚¨æä¾›å•†
3. **AIé›†æˆ**: æ™ºèƒ½æ•°æ®åˆ†æå’Œé¢„æµ‹ä¼˜åŒ–

---

## ğŸ“Š æŠ€æœ¯å€ºåŠ¡è¯„ä¼°

### å½“å‰æŠ€æœ¯å€ºåŠ¡

| å€ºåŠ¡ç±»å‹ | ä¸¥é‡ç¨‹åº¦ | æè¿° | å»ºè®®è§£å†³æ—¶é—´ |
|----------|----------|------|-------------|
| æ¶æ„å¤æ‚æ€§ | ğŸ”´ é«˜ | å¤šå±‚ä¾èµ–ï¼Œç»´æŠ¤æˆæœ¬é«˜ | 3-6ä¸ªæœˆ |
| æ€§èƒ½ç“¶é¢ˆ | ğŸŸ¡ ä¸­ | åŒæ­¥å»¶è¿Ÿå’Œå†…å­˜é—®é¢˜ | 1-3ä¸ªæœˆ |
| ç›‘æ§ç¼ºå¤± | ğŸŸ¡ ä¸­ | ç¼ºä¹å…¨é¢ç›‘æ§ | 1-2ä¸ªæœˆ |
| æ–‡æ¡£ä¸å®Œå–„ | ğŸŸ¢ ä½ | ç¼ºä¹è¯¦ç»†æ–‡æ¡£ | 1ä¸ªæœˆ |

### å€ºåŠ¡å¿è¿˜ä¼˜å…ˆçº§

1. **ğŸ”´ é«˜ä¼˜å…ˆçº§**: æ€§èƒ½ç“¶é¢ˆä¼˜åŒ–
2. **ğŸŸ¡ ä¸­ä¼˜å…ˆçº§**: ç›‘æ§ç³»ç»Ÿå®Œå–„
3. **ğŸŸ¢ ä½ä¼˜å…ˆçº§**: æ¶æ„ç®€åŒ–

---

## ğŸ¯ ç»“è®ºå’Œå»ºè®®

### æ€»ä½“è¯„ä¼°

CardEverythingé¡¹ç›®é‡‡ç”¨äº†éå¸¸å…ˆè¿›å’Œå®Œæ•´çš„æ•°æ®å­˜å‚¨æ¶æ„ï¼Œå…·å¤‡ä¼ä¸šçº§çš„æ•°æ®ç®¡ç†èƒ½åŠ›ã€‚æ¶æ„è®¾è®¡å……åˆ†è€ƒè™‘äº†ç¦»çº¿æ”¯æŒã€æ•°æ®ä¸€è‡´æ€§ã€æ€§èƒ½ä¼˜åŒ–ç­‰å…³é”®è¦ç´ ã€‚ç„¶è€Œï¼Œæ¶æ„çš„å¤æ‚æ€§ä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„ç»´æŠ¤æˆæœ¬å’Œæ€§èƒ½æŒ‘æˆ˜ã€‚

### å…³é”®å»ºè®®

1. **ä¿æŒå½“å‰æ¶æ„ä¼˜åŠ¿**: ä¸è¦ç ´åç°æœ‰çš„é«˜å¯ç”¨æ€§å’Œæ•°æ®ä¸€è‡´æ€§æœºåˆ¶
2. **é€æ­¥ä¼˜åŒ–æ€§èƒ½**: é€šè¿‡ç›‘æ§å’Œæµ‹è¯•è¯†åˆ«çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆ
3. **å®Œå–„å·¥å…·é“¾**: å¢åŠ è°ƒè¯•ã€ç›‘æ§å’Œè¯Šæ–­å·¥å…·
4. **å›¢é˜Ÿèƒ½åŠ›å»ºè®¾**: åŠ å¼ºå›¢é˜Ÿå¯¹å¤æ‚æ¶æ„çš„ç†è§£å’Œç»´æŠ¤èƒ½åŠ›

### å®æ–½è·¯å¾„

```mermaid
graph TD
    A[å½“å‰æ¶æ„] --> B[æ€§èƒ½ç›‘æ§å®Œå–„]
    B --> C[å…³é”®ç“¶é¢ˆè¯†åˆ«]
    C --> D[é’ˆå¯¹æ€§ä¼˜åŒ–]
    D --> E[æ¶æ„é€æ­¥ç®€åŒ–]
    E --> F[é•¿æœŸç»´æŠ¤ä¼˜åŒ–]
```

---

## ğŸ“š é™„å½•

### A. åˆ†æçš„æ–‡ä»¶æ¸…å•

#### æ ¸å¿ƒå­˜å‚¨æ–‡ä»¶
- `database-unified.ts` - ç»Ÿä¸€IndexedDBæ•°æ®åº“
- `supabase.ts` - Supabaseäº‘ç«¯å­˜å‚¨é›†æˆ
- `advanced-cache.ts` - é«˜çº§ç¼“å­˜ç³»ç»Ÿ
- `sync-queue.ts` - åŒæ­¥é˜Ÿåˆ—ç®¡ç†
- `local-operation.ts` - æœ¬åœ°æ“ä½œæœåŠ¡
- `unified-sync-service.ts` - ç»Ÿä¸€åŒæ­¥æœåŠ¡
- `supabase-realtime-listener.ts` - å®æ—¶åŒæ­¥ç›‘å¬

#### é…ç½®å’Œå·¥å…·æ–‡ä»¶
- `vite.config.ts` - æ„å»ºé…ç½®
- `package.json` - ä¾èµ–ç®¡ç†
- `jest.setup.js` - æµ‹è¯•é…ç½®

### B. å…³é”®æŠ€æœ¯æŒ‡æ ‡

#### å­˜å‚¨å®¹é‡
- **IndexedDB**: æµè§ˆå™¨é™åˆ¶(é€šå¸¸50MB-2GB)
- **æœ¬åœ°ç¼“å­˜**: å¯é…ç½®é™åˆ¶
- **Supabase**: æ ¹æ®è®¢é˜…è®¡åˆ’

#### æ€§èƒ½åŸºå‡†
- **æŸ¥è¯¢å“åº”**: ç›®æ ‡<50ms
- **åŒæ­¥å»¶è¿Ÿ**: ç›®æ ‡<200ms
- **ç¼“å­˜å‘½ä¸­ç‡**: ç›®æ ‡>85%
- **å†…å­˜ä½¿ç”¨**: ç›®æ ‡<100MB

#### æ•°æ®ä¸€è‡´æ€§
- **ç‰ˆæœ¬æ§åˆ¶**: å®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†
- **å†²çªè§£å†³**: æ™ºèƒ½åˆå¹¶ç­–ç•¥
- **å¤‡ä»½æ¢å¤**: è‡ªåŠ¨å¿«ç…§æœºåˆ¶

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-13 18:00
**ä¸‹æ¬¡æ›´æ–°å»ºè®®**: æ ¹æ®å®æ–½è¿›å±•å®šæœŸæ›´æ–°
**ç»´æŠ¤è´£ä»»äºº**: Database-Architect Team